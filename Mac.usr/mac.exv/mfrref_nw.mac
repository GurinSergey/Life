/****************************************************************************/
/*                   R-Style SoftWare Lab, RS-Bank 6.0                      */
/****************************************************************************/
/*                  Подсистема "Межбанковские расчеты"                      */
/*  Макроса формирования имени файла экспорта по транспорту ЭБМФР           */
/*  в филиал Воронеж АКБ "Экспресс-Волга"                                   */
/*  Имя файла: mfrref_nw.mac                                                */
/*  Создан:  19.01.11                                        Зубко С.       */
/*  Зубко С. 19.04.11 Универсализация именования файлов для всех филиалов   */
/****************************************************************************/

import globals, "wlmfr_lib.mac";

macro GetFileName( SeqValue, ObjKind, ObjAddr )
    var refer, error;
    var Дата, День, Месяц, Год;

    Дата = {curdate};
    DateSplit(Дата, День, Месяц, Год);

  /*АЛГОРИТМ ФОРМИРОВАНИЯ ФАЙЛА МФР  
    Файл именуется по алгоритму
    ff_name+ kod+ NN+ TT+ _36(День), ".", _36(Месяц), ff_ext
    где:

    1. ff_name(КУДА) и ff_ext(ОТКУДА) может принимать значения:
       Саратов (голова)- mg
       Сбербанк        - i1
       Э-В Энгельс     - mx
       Э-В Волгоград   - n7
       Э-В Ульяновск   - nu
       Э-В Воронеж     - nw
       Экономбанк      - k2
    2. Kod = b
    3. NN - порядковый номер
    4. TT - все что народилось в голове  это "05", все что в филиале (любом) это "07"
    5. _36(день) и _36(месяц) преобразованное число в символ по 36-ричной системе
    6. ff_ext код означает ОТКУДА отправляется сообщение.Значения как и у ff_name. 

    ПРИМЕРЫ:
    Файл из филиала в голову
    Волгоград - Саратов:   mgb0107i.4n7                     
    Энгельс   - Саратов:   mgb0107i.4mx                   
    Ульяновск - Саратов:   mgb0107i.4nu                      
    Воронеж   - Саратов:   mgb0107i.4nw                     

    Из Головного на филиалы так :    
    Саратов - Волгоград:   n7b0105i.4mg 
    Саратов - Энгельс  :   mxb0105i.4mg
    Саратов - Ульяновск:   nub0105i.4mg  
    Саратов - Воронеж  :   nwb0105i.4mg 
  */

    refer = string( "nw","b", SeqValue:2, Get_TT(), _36(День),".", _36(Месяц), Get_ff_ext());
    refer = strsubst( refer, " ", "0" );

    return refer;
end;
