/*──────────────────────────────────────────────────────────────────────────┐
  RS-Bank 5.10                                         R-Style Software Lab

  File Name   : poduvrep.mac
  Created     : 23.01.2003
  Programmer  : Андреева Е.П.
  Description : Печать ведомости расхождения для документа и дубликата
                (в одном экземпляре)
//Str! в ведомость рассхождения попадают лишь поля из макета поиска
// KS 22.11.2013 Перенесены доработки из 30й сборки

└───────────────────────────────────────────────────────────────────────────*/
IMPORT BankInter, FIInter, "ver_rep.mac", "likepy.mac", "oralib.mac", "pspobuff.mac";

var pr_rep  : integer = 0
   ,locked  : string  = ""
   ,locktax : string  = ""
   ,lockakkr: string  = "";

/* Нумерация полей в панелях */
const  po_fld_Number         = 1, /* Для поручений */
       po_fld_Date           = 2,
       po_fld_KindPaym       = 3,
       po_fld_KindPaymName   = 4,
       po_fld_ValueDate      = 5,
       po_fld_P_INN          = 6,
       po_fld_Payer          = 7,
       po_fld_AuthStat       = 8,
       po_fld_Sum            = 9,
       po_fld_P_Account      = 10,
       po_fld_R_Bank         = 11,
       po_fld_R_KindCode     = 12,
       po_fld_R_KindCodeName = 13,
       po_fld_R_Code         = 14,
       po_fld_R_CorrAcc      = 15,
       po_fld_R_INN          = 16,
       po_fld_Receiver       = 17,
       po_fld_R_Account      = 18,
       po_fld_Ground         = 19,
       po_fld_ShifrOper      = 20,
       po_fld_GroundNum      = 21,
       po_fld_PayDate        = 22,
       po_fld_Priority       = 23,
       po_fld_NumberPack     = 24,
       po_fld_DepartName     = 25,
       po_fld_KindOper       = 26,
       po_fld_KindOperName   = 27;

const  po_kzfld_Number         = 1, /* Для поручений казахов */
       po_kzfld_Date           = 2,
       po_kzfld_KindPaym       = 3,
       po_kzfld_KindPaymName   = 4,
       po_kzfld_ValueDate      = 5,
       po_kzfld_rnnpayer       = 6,
       po_kzfld_payercode      = 7,
       po_kzfld_payer          = 8,
       po_kzfld_kbkname        = 9,
       po_kzfld_kbk            = 10,
       po_kzfld_sum            = 11,
       po_kzfld_iikpayer       = 12,
       po_kzfld_bnkreceiver    = 13,
       po_kzfld_kndcoderec     = 14,
       po_kzfld_kndcoderecname = 15,
       po_kzfld_coderec        = 16,
       po_kzfld_rnnreceiver    = 17,
       po_kzfld_reccode        = 18,
       po_kzfld_receiver       = 19,
       po_kzfld_iikreceiver    = 20,
       po_kzfld_knpname        = 21,
       po_kzfld_ground         = 22,
       po_kzfld_knp            = 23,
       po_kzfld_shifroper      = 24,
       po_kzfld_paydate        = 25,
       po_kzfld_priority       = 26,
       po_kzfld_instancy       = 27,
       po_kzfld_numberpack     = 28,
       po_kzfld_depname        = 29,
       po_kzfld_kindoper       = 30,
       po_kzfld_kindopername   = 31;

const  dem_fld_Number         = 1, /* Для требований */
       dem_fld_Date           = 2,
       dem_fld_KindPaym       = 3,
       dem_fld_KindPaymName   = 4,
       dem_fld_ValueDate      = 5,
       dem_fld_IntoBank       = 6,
       dem_fld_AcceptTerm     = 7,
       dem_fld_AcceptPeriod   = 8,
       dem_fld_Sum            = 9,
       dem_fld_P_INN          = 10,
       dem_fld_Payer          = 11,
       dem_fld_AcceptSum      = 12,
       dem_fld_P_Account      = 13,
       dem_fld_R_Bank         = 14,
       dem_fld_R_KindCode     = 15,
       dem_fld_R_KindCodeName = 16,
       dem_fld_R_Code         = 17,
       dem_fld_R_CorrAcc      = 18,
       dem_fld_R_INN          = 19,
       dem_fld_Receiver       = 20,
       dem_fld_R_Account      = 21,
       dem_fld_Ground         = 22,
       dem_fld_ShifrOper      = 23,
       dem_fld_GroundNum      = 24,
       dem_fld_PayDate        = 25,
       dem_fld_CondPay        = 26,
       dem_fld_Priority       = 27,
       dem_fld_NumberPack     = 28,
       dem_fld_DepartName     = 29,
       dem_fld_Accept         = 30,
       dem_fld_KindOper       = 31,
       dem_fld_KindOperName   = 32;

const  req_fld_Number         = 1, /* Для требований-поручений */
       req_fld_Date           = 2,
       req_fld_KindPaym       = 3,
       req_fld_KindPaymName   = 4,
       req_fld_ValueDate      = 5,
       req_fld_IntoBank       = 6,
       req_fld_AcceptPeriod   = 7,
       req_fld_Sum            = 8,
       req_fld_P_INN          = 9,
       req_fld_Payer          = 10,
       req_fld_AcceptSum      = 11,
       req_fld_P_Account      = 12,
       req_fld_R_Bank         = 13,
       req_fld_R_KindCode     = 14,
       req_fld_R_KindCodeName = 15,
       req_fld_R_Code         = 16,
       req_fld_R_CorrAcc      = 17,
       req_fld_R_INN          = 18,
       req_fld_Receiver       = 19,
       req_fld_R_Account      = 20,
       req_fld_Ground         = 21,
       req_fld_ShifrOper      = 22,
       req_fld_GroundNum      = 23,
       req_fld_PayDate        = 24,
       req_fld_Priority       = 25,
       req_fld_NumberPack     = 26,
       req_fld_DepartName     = 27,
       req_fld_Accept         = 28,
       req_fld_KindOper       = 29,
       req_fld_KindOperName   = 30;

const  akk_fld_Number         = 1, /* Для аккредитивов */                
       akk_fld_Date           = 2,                                       
       akk_fld_KindPaym       = 3,                                       
       akk_fld_KindPaymName   = 4,                                       
       akk_fld_ValueDate      = 5,                                       
       akk_fld_P_INN          = 6,
       akk_fld_Payer          = 7,           
       akk_fld_Sum            = 8,                                       
       akk_fld_P_Account      = 9,                                       
       akk_fld_P_Bank         = 10,
       akk_fld_P_KindCode     = 11,
       akk_fld_P_KindCodeName = 12,                                      
       akk_fld_P_Code         = 13,                                                                  
       akk_fld_P_CorrAcc      = 14,                                                                  
       akk_fld_R_Bank         = 15,
       akk_fld_R_KindCode     = 16,                                      
       akk_fld_R_KindCodeName = 17,                                      
       akk_fld_R_Code         = 18,                                      
       akk_fld_R_CorrAcc      = 19,                                      
       akk_fld_R_INN          = 20,      
       akk_fld_Receiver       = 21,      
       akk_fld_Acc_40901      = 22,
       akk_fld_ShifrOper      = 23,
       akk_fld_Ground         = 24,
       akk_fld_NumberPack     = 25,                    
       akk_fld_DepartName     = 26,    
       akk_fld_KindOper       = 27,
       akk_fld_KindOperName   = 28;

const  akk_fld_Type           = 1,
       akk_fld_PayCondition   = 2,
       akk_fld_PayDate        = 3,
       akk_fld_Representation = 4,
       akk_fld_AddCondition   = 5,
       akk_fld_Acc_R_Real     = 6,
       akk_fld_AddDocs        = 7;

PRIVATE MACRO needUseKZpm():bool
  var err:integer = 0;
  var locale:string = "";
  GetRegistryValue("CB\\PAYMENTS\\PANEL\\LOCALE", V_STRING, locale, err);
  return ( ( err == 0 ) AND ( index( strupr(locale), "KZ" ) ) );
END; 

PRIVATE MACRO getKNPName( Element:integer ):string
  debugbreak;
  var query:string = " select llv.T_NAME " +
                       " from dllvalues_dbt llv " +
                      " where llv.T_LIST = 1804 " +
                        " and llv.T_ELEMENT = :ELEMENT ";
  VAR params:TArray = makeArray( SQLParam( "ELEMENT", Element ) );
  VAR rset:RsdRecordset = execSQLselect( query, params, TRUE );

  if( rset and rset.moveNext() )
    return ( rset.value(0) );
  end;     
  return string(Element);
END;
                                                                                                          
MACRO Print_ReportHeader()                                                
[                        Отчет о групповой верификации                                                            ];
[                рублевых платежных документов РКО и дубликатов                                                   ];
[───────────────────────────────────────────────────────────────────────────────];
END;

MACRO Print_ReportItog()
  Print_Itog();
END;

macro Print_Cround(pn1,pn2)
   Print_LargeStr("'"+pn1+"'","'"+pn2+"'", "Основание документа (назначение)");
end;

MACRO Print_ReportDupl(PaymentID, Number, Amount, ValueDate)
[
  Для дубликата платежного документа
     N дубликата #########################
     Сумма:   ############################
     Дата валютирования:  ################
  Найден первичный документ
]
(r_pmdurmpp.Number:l, r_pmdupaym.Amount:l:f, r_pmdupaym.ValueDate:l);
END;

private MACRO GetVOCode(VO_Code)
  FILE llval(llvalues) key 0;
  var Code = "";
  llval.List = 1805;
  llval.Element = VO_Code;
  if( getEQ(llval) )
    return llval.Code;
  end;
  return Code;
END;

MACRO Print_ReportOrder()

  var i = 0;

  Print_ReportDupl(r_pmdupaym.PaymentID, r_pmdurmpp.Number, r_pmdupaym.Amount, r_pmdupaym.ValueDate);
[    Платежное поручение N ##########################
     Сумма:   ############################
     Дата валютирования:  ################
]
( r_pmrmprop.Number:l, r_pmpaym.Amount:l:f, r_pmpaym.ValueDate:l);

/* Ведомость расхождения печатается при соответствующей настройке */
if( pr_rep )
   Print_Head();
   if((SubStr( locked, po_fld_Number, 1 ) == " ") and (r_pmrmprop.Number != r_pmdurmpp.Number))
      Print_SmallStr(r_pmrmprop.Number, r_pmdurmpp.Number, "Номер документа"); i = i+1;
   end;
   if((SubStr( locked, po_fld_Date, 1 ) == " ") and (r_pmrmprop.Date != r_pmdurmpp.Date))
      Print_SmallStr(r_pmrmprop.Date, r_pmdurmpp.Date, "Дата (заполняемая клиентом)"); i = i+1;
   end;
/*   if((SubStr( locked, po_fld_KindPaym, 1 ) == " ") and (r_pmrmprop.PaymentKind != r_pmdurmpp.PaymentKind))
      Print_PaymentKind(r_pmrmprop.PaymentKind, r_pmdurmpp.PaymentKind); i = i+1;
   end;*/
   if((SubStr( locked, po_fld_ValueDate, 1 ) == " ") and (r_pmpaym.ValueDate != r_pmdupaym.ValueDate))
      Print_SmallStr(r_pmpaym.ValueDate, r_pmdupaym.ValueDate, "Дата"); i = i+1;
   end;
/* Str!   if( ( (SubStr( locked, IfThenElse( needUseKZpm(), po_kzfld_rnnpayer, po_fld_P_INN ), 1 ) == " ") OR
         ( (NOT needUseKZpm()) AND
           ( (SubStr( locktax, tax_fld_PayerINN, 1 ) == " ") OR (SubStr( locktax, tax_fld_PayerKPP, 1 ) == " ") ) ) ) AND
       (r_pmrmprop.PayerINN != r_pmdurmpp.PayerINN) )
      Print_PayerINN(r_pmrmprop.PayerINN, r_pmdurmpp.PayerINN); i = i+1;
   end;
   if((SubStr( locked, IfThenElse( needUseKZpm(), po_kzfld_payer, po_fld_Payer ), 1 ) == " ") and (r_pmrmprop.PayerName != r_pmdurmpp.PayerName))
      Print_PayerName(r_pmrmprop.PayerName,r_pmdurmpp.PayerName); i = i+1;
   end;*/
   if((SubStr( locked, IfThenElse( needUseKZpm(), po_kzfld_sum, po_fld_Sum ), 1 ) == " ") and (r_pmpaym.Amount != r_pmdupaym.Amount))
      Print_Amount(r_pmpaym.Amount, r_pmdupaym.Amount, "Сумма"); i = i+1;
   end;
   if((SubStr( locked, IfThenElse( needUseKZpm(), po_kzfld_iikpayer, po_fld_P_Account ), 1 ) == " ") and (r_pmpaym.PayerAccount != r_pmdupaym.PayerAccount))
      Print_SmallStr(r_pmpaym.PayerAccount, r_pmdupaym.PayerAccount, "Счет плательщика"); i = i+1;
   end;
/*   if((SubStr( locked, IfThenElse( needUseKZpm(), po_kzfld_bnkreceiver, po_fld_R_Bank ), 1 ) == " ") and (r_pmrmprop.ReceiverBankName != r_pmdurmpp.ReceiverBankName))
      Print_ReceiverBankName(r_pmrmprop.ReceiverBankName, r_pmdurmpp.ReceiverBankName); i = i+1;
   end;
   if((SubStr( locked, IfThenElse( needUseKZpm(), po_kzfld_kndcoderec, po_fld_R_KindCode ), 1 ) == " ") and (r_credit.CodeKind != r_ducredit.CodeKind))
      Print_CodeKind(r_credit.CodeKind, r_ducredit.CodeKind); i = i+1;
   end;*/
   if((SubStr( locked, IfThenElse( needUseKZpm(), po_kzfld_coderec, po_fld_R_Code ), 1 ) == " ") and (r_credit.BankCode != r_ducredit.BankCode))
      Print_SmallStr(r_credit.BankCode, r_ducredit.BankCode, "Код банка получателя"); i = i+1;
   end;
   if( (NOT needUseKZpm()) and (SubStr( locked, po_fld_R_CorrAcc, 1 ) == " ") and (r_pmrmprop.ReceiverCorrAccNostro != r_pmdurmpp.ReceiverCorrAccNostro))
      Print_SmallStr(r_pmrmprop.ReceiverCorrAccNostro, r_pmdurmpp.ReceiverCorrAccNostro, "Корсчет банка получателя в РКЦ"); i = i+1;
   end;
/*   if(((SubStr( locked, IfThenElse( needUseKZpm(), po_kzfld_rnnreceiver, po_fld_R_INN ), 1 ) == " ") or (SubStr( locktax, tax_fld_ReceiverINN, 1 ) == " ") or (SubStr( locktax, tax_fld_ReceiverKPP, 1 ) == " ")) and
      (r_pmrmprop.ReceiverINN != r_pmdurmpp.ReceiverINN))
      Print_ReceiverINN(r_pmrmprop.ReceiverINN, r_pmdurmpp.ReceiverINN); i = i+1;
   end;
   if((SubStr( locked, IfThenElse( needUseKZpm(), po_kzfld_receiver, po_fld_Receiver ), 1 ) == " ") and (r_pmrmprop.ReceiverName != r_pmdurmpp.ReceiverName))
      Print_ReceiverName(r_pmrmprop.ReceiverName, r_pmdurmpp.ReceiverName); i = i+1;
   end;*/
   if((SubStr( locked, IfThenElse( needUseKZpm(), po_kzfld_iikreceiver, po_fld_R_Account ), 1 ) == " ") and (r_pmpaym.ReceiverAccount != r_pmdupaym.ReceiverAccount))
      Print_SmallStr(r_pmpaym.ReceiverAccount, r_pmdupaym.ReceiverAccount, "Счет получателя"); i = i+1;
   end;
   if((SubStr( locked, IfThenElse( needUseKZpm(), po_kzfld_ground, po_fld_Ground ), 1 ) == " ") and (r_pmrmprop.Ground != r_pmdurmpp.Ground))
      Print_Cround(r_pmrmprop.Ground, r_pmdurmpp.Ground); i = i+1;
   end;
/*   if((SubStr( locked, IfThenElse( needUseKZpm(), po_kzfld_shifroper, po_fld_ShifrOper ), 1 ) == " ") and (r_pmrmprop.ShifrOper != r_pmdurmpp.ShifrOper))
      Print_SmallStr(r_pmrmprop.ShifrOper, r_pmdurmpp.ShifrOper, "Шифр"); i = i+1;
   end;
   if((SubStr( locked, IfThenElse( needUseKZpm(), po_kzfld_paydate, po_fld_PayDate ), 1 ) == " ") and (r_pmrmprop.PayDate != r_pmdurmpp.PayDate))
      Print_SmallStr(r_pmrmprop.PayDate, r_pmdurmpp.PayDate, "Срок платежа"); i = i+1;
   end;
   if((SubStr( locked, IfThenElse( needUseKZpm(), po_kzfld_priority, po_fld_Priority ), 1 ) == " ") and (r_pmrmprop.Priority != r_pmdurmpp.Priority))
      Print_SmallStr(r_pmrmprop.Priority, r_pmdurmpp.Priority, "Очередность платежа"); i = i+1;
   end;*/
/*   if((SubStr( locked, IfThenElse( needUseKZpm(), po_kzfld_numberpack, po_fld_NumberPack ), 1 ) == " ") and (r_pmpaym.NumberPack != r_pmdupaym.NumberPack))
      Print_SmallStr(r_pmpaym.NumberPack, r_pmdupaym.NumberPack, "Номер пачки"); i = i+1;
   end;
   
   if( needUseKZpm() ) // специфичности для казахов
     if( (SubStr( locked, po_kzfld_knp, 1 ) == " ") AND (r_pmkz.groundcode != r_pmdupkz.groundcode) )
       Print_SmallStr(getKNPName(r_pmkz.GroundCode), getKNPName(r_pmdupkz.GroundCode), "Код назначения платежа"); i = i+1;
     end;
     if( (SubStr( locked, po_kzfld_payercode, 1 ) == " ") AND (r_pmkz.PayerCode != r_pmdupkz.PayerCode) )
       Print_SmallStr(r_pmkz.PayerCode, r_pmdupkz.PayerCode, "Код отправителя денег"); i = i+1;
     end;
     if( (SubStr( locked, po_kzfld_reccode, 1 ) == " ") AND (r_pmkz.ReceiverCode != r_pmdupkz.ReceiverCode) )
       Print_SmallStr(r_pmkz.ReceiverCode, r_pmdupkz.ReceiverCode, "Код бенефициара"); i = i+1;
     end;
     if( (SubStr( locked, po_kzfld_kbk, 1 ) == " ") AND (r_pmrmprop.BttTICode != r_pmdurmpp.BttTICode) )
       Print_SmallStr(r_pmrmprop.BttTICode, r_pmdurmpp.BttTICode, "Код бюджетной классификации"); i = i+1;
     end;
   end;

   /* Всякие налоговые заморочки - кроме ИНН и КПП */
   if(((SubStr( locked, po_fld_AuthStat, 1 ) == " ") or (SubStr( locktax, tax_fld_AuthorStatusCode, 1 ) == " ") ) and
      (r_pmrmprop.TaxAuthorState != r_pmdurmpp.TaxAuthorState))
      Print_SmallStr(r_pmrmprop.TaxAuthorState, r_pmdurmpp.TaxAuthorState, "Статус составителя"); i = i+1;
   end;

   if((NOT needUseKZpm()) and (SubStr( locktax, tax_fld_TaxCode, 1 ) == " ") and (r_pmrmprop.BttTICode != r_pmdurmpp.BttTICode))
      Print_SmallStr(r_pmrmprop.BttTICode, r_pmdurmpp.BttTICode, "Код бюджетной классификации"); i = i+1;
   end;

   if((SubStr( locktax, tax_fld_OKATOCode, 1 ) == " ") and (r_pmrmprop.OKATOCode != r_pmdurmpp.OKATOCode))
      Print_SmallStr(r_pmrmprop.OKATOCode, r_pmdurmpp.OKATOCode, "Код ОКАТО"); i = i+1;
   end;

   if((SubStr( locktax, tax_fld_GroundCode, 1 ) == " ") and (r_pmrmprop.TaxPmGround != r_pmdurmpp.TaxPmGround))
      Print_SmallStr(r_pmrmprop.TaxPmGround, r_pmdurmpp.TaxPmGround, "Код основания документа"); i = i+1;
   end;

   if((SubStr( locktax, tax_fld_Period, 1 ) == " ") and (r_pmrmprop.TaxPmPeriod != r_pmdurmpp.TaxPmPeriod))
      Print_SmallStr(r_pmrmprop.TaxPmPeriod, r_pmdurmpp.TaxPmPeriod, "Налоговый период"); i = i+1;
   end;

   if((SubStr( locktax, tax_fld_Number, 1 ) == " ") and (r_pmrmprop.TaxPmNumber != r_pmdurmpp.TaxPmNumber))
      Print_SmallStr(r_pmrmprop.TaxPmNumber, r_pmdurmpp.TaxPmNumber, "Номер налогового документа"); i = i+1;
   end;

   if((SubStr( locktax, tax_fld_Date, 1 ) == " ") and (r_pmrmprop.TaxPmDate != r_pmdurmpp.TaxPmDate))
      Print_SmallStr(r_pmrmprop.TaxPmDate, r_pmdurmpp.TaxPmDate, "Дата налогового документа"); i = i+1;
   end;

   if((SubStr( locktax, tax_fld_TypeCode, 1 ) == " ") and (r_pmrmprop.TaxPmType != r_pmdurmpp.TaxPmType))
      Print_SmallStr(r_pmrmprop.TaxPmType, r_pmdurmpp.TaxPmType, "Код типа налогового платежа"); i = i+1;
   end;*/

   Print_Kolvo(i);
end;
return;
END;

MACRO Print_ReportDemand()
  var i = 0;

  Print_ReportDupl(r_pmdupaym.PaymentID, r_pmdurmpp.Number, r_pmdupaym.Amount, r_pmdupaym.ValueDate);
[    Платежное требование N ##########################
     Сумма:   ############################
     Дата валютирования:  ################
]
( r_pmrmprop.Number:l, r_pmpaym.Amount:l:f, r_pmpaym.ValueDate:l);

if( pr_rep )
   Print_Head();
   if((SubStr( locked, dem_fld_Number, 1 ) == " ") and (r_pmrmprop.Number != r_pmdurmpp.Number))
      Print_SmallStr(r_pmrmprop.Number, r_pmdurmpp.Number, "Номер документа"); i = i+1;
   end;
   if((SubStr( locked, dem_fld_Date, 1 ) == " ") and (r_pmrmprop.Date != r_pmdurmpp.Date))
      Print_SmallStr(r_pmrmprop.Date, r_pmdurmpp.Date, "Дата (заполняемая клиентом)"); i = i+1;
   end;
   if((SubStr( locked, dem_fld_KindPaym, 1 ) == " ") and (r_pmrmprop.PaymentKind != r_pmdurmpp.PaymentKind))
      Print_PaymentKind(r_pmrmprop.PaymentKind, r_pmdurmpp.PaymentKind); i = i+1;
   end;
   if((SubStr( locked, dem_fld_ValueDate, 1 ) == " ") and (r_pmpaym.ValueDate != r_pmdupaym.ValueDate))
      Print_SmallStr(r_pmpaym.ValueDate, r_pmdupaym.ValueDate, "Дата"); i = i+1;
   end;
   if((SubStr( locked, dem_fld_IntoBank, 1 ) == " ") and (r_pmpaym.PayerBankEnterDate != r_pmdupaym.PayerBankEnterDate))
      Print_SmallStr(r_pmpaym.PayerBankEnterDate, r_pmdupaym.PayerBankEnterDate, "Дата ввода"); i = i+1;
   end;
   if((SubStr( locked, dem_fld_AcceptTerm, 1 ) == " ") and (r_pspaydem.AcceptTerm != r_psdupade.AcceptTerm))
      Print_SmallStr(r_pspaydem.AcceptTerm, r_psdupade.AcceptTerm, "Условие акцепта"); i = i+1;
   end;
   if((SubStr( locked, dem_fld_AcceptPeriod, 1 ) == " ") and (r_pspaydem.AcceptPeriod != r_psdupade.AcceptPeriod))
      Print_SmallStr(r_pspaydem.AcceptPeriod, r_psdupade.AcceptPeriod, "Срок акцепта (в рабочих днях)"); i = i+1;
   end;
   if((SubStr( locked, dem_fld_P_INN, 1 ) == " ") and (r_pmrmprop.PayerINN != r_pmdurmpp.PayerINN))
      Print_PayerINN(r_pmrmprop.PayerINN, r_pmdurmpp.PayerINN); i = i+1;
   end;
   if((SubStr( locked, dem_fld_Payer, 1 ) == " ") and (r_pmrmprop.PayerName != r_pmdurmpp.PayerName))
      Print_PayerName(r_pmrmprop.PayerName,r_pmdurmpp.PayerName); i = i+1;
   end;
   if((SubStr( locked, dem_fld_AcceptSum, 1 ) == " ") and (r_pspaydem.ReqSum != r_psdupade.ReqSum))
      Print_Amount(r_pspaydem.ReqSum, r_psdupade.ReqSum, "Сумма (требуемая)"); i = i+1;
   end;
   if((SubStr( locked, dem_fld_P_Account, 1 ) == " ") and (r_pmpaym.PayerAccount != r_pmdupaym.PayerAccount))
      Print_SmallStr(r_pmpaym.PayerAccount, r_pmdupaym.PayerAccount, "Счет плательщика"); i = i+1;
   end;
   if((SubStr( locked, dem_fld_R_Bank, 1 ) == " ") and (r_pmrmprop.ReceiverBankName != r_pmdurmpp.ReceiverBankName))
      Print_ReceiverBankName(r_pmrmprop.ReceiverBankName, r_pmdurmpp.ReceiverBankName); i = i+1;
   end;
   if((SubStr( locked, dem_fld_R_KindCode, 1 ) == " ") and (r_credit.CodeKind != r_ducredit.CodeKind))
      Print_CodeKind(r_credit.CodeKind, r_ducredit.CodeKind); i = i+1;
   end;
   if((SubStr( locked, dem_fld_R_Code, 1 ) == " ") and (r_credit.BankCode != r_ducredit.BankCode))
      Print_SmallStr(r_credit.BankCode, r_ducredit.BankCode, "Код банка получателя"); i = i+1;
   end;
   if((SubStr( locked, dem_fld_R_CorrAcc, 1 ) == " ") and (r_pmrmprop.ReceiverCorrAccNostro != r_pmdurmpp.ReceiverCorrAccNostro))
      Print_SmallStr(r_pmrmprop.ReceiverCorrAccNostro, r_pmdurmpp.ReceiverCorrAccNostro, "Корсчет банка получателя в РКЦ"); i = i+1;
   end;
   if((SubStr( locked, dem_fld_R_INN, 1 ) == " ") and (r_pmrmprop.ReceiverINN != r_pmdurmpp.ReceiverINN))
      Print_ReceiverINN(r_pmrmprop.ReceiverINN, r_pmdurmpp.ReceiverINN); i = i+1;
   end;
   if((SubStr( locked, dem_fld_Receiver, 1 ) == " ") and (r_pmrmprop.ReceiverName != r_pmdurmpp.ReceiverName))
      Print_ReceiverName(r_pmrmprop.ReceiverName, r_pmdurmpp.ReceiverName); i = i+1;
   end;
   if((SubStr( locked, dem_fld_R_Account, 1 ) == " ") and (r_pmpaym.ReceiverAccount != r_pmdupaym.ReceiverAccount))
      Print_SmallStr(r_pmpaym.ReceiverAccount, r_pmdupaym.ReceiverAccount, "Счет получателя"); i = i+1;
   end;
   if((SubStr( locked, dem_fld_Ground, 1 ) == " ") and (r_pmrmprop.Ground != r_pmdurmpp.Ground))
      Print_Cround(r_pmrmprop.Ground, r_pmdurmpp.Ground); i = i+1;
   end;
   if((SubStr( locked, dem_fld_ShifrOper, 1 ) == " ") and (r_pmrmprop.ShifrOper != r_pmdurmpp.ShifrOper))
      Print_SmallStr(r_pmrmprop.ShifrOper, r_pmdurmpp.ShifrOper, "Шифр"); i = i+1;
   end;
   if((SubStr( locked, dem_fld_PayDate, 1 ) == " ") and (r_pmrmprop.PayDate != r_pmdurmpp.PayDate))
      Print_SmallStr(r_pmrmprop.PayDate, r_pmdurmpp.PayDate, "Срок платежа"); i = i+1;
   end;
   if((SubStr( locked, dem_fld_CondPay, 1 ) == " ") and (r_pspaydem.PayCondition != r_psdupade.PayCondition))
      Print_SmallStr(r_pspaydem.PayCondition, r_psdupade.PayCondition, "Условие оплаты"); i = i+1;
   end;
   if((SubStr( locked, dem_fld_Priority, 1 ) == " ") and (r_pmrmprop.Priority != r_pmdurmpp.Priority))
      Print_SmallStr(r_pmrmprop.Priority, r_pmdurmpp.Priority, "Очередность платежа"); i = i+1;
   end;
   if((SubStr( locked, dem_fld_NumberPack, 1 ) == " ") and (r_pmpaym.NumberPack != r_pmdupaym.NumberPack))
      Print_SmallStr(r_pmpaym.NumberPack, r_pmdupaym.NumberPack, "Номер пачки"); i = i+1;
   end;

   Print_Kolvo(i);
end;
return;
END;

MACRO Print_ReportRequest()
  var i = 0;

  Print_ReportDupl(r_pmdupaym.PaymentID, r_pmdurmpp.Number, r_pmdupaym.Amount, r_pmdupaym.ValueDate);
[    Платежное требование-поручение N ##########################
     Сумма:   ############################
     Дата валютирования:  ################
]
( r_pmrmprop.Number:l, r_pmpaym.Amount:l:f, r_pmpaym.ValueDate:l);

if( pr_rep )
   Print_Head();
   if((SubStr( locked, req_fld_Number, 1 ) == " ") and (r_pmrmprop.Number != r_pmdurmpp.Number))
      Print_SmallStr(r_pmrmprop.Number, r_pmdurmpp.Number, "Номер документа"); i = i+1;
   end;
   if((SubStr( locked, req_fld_Date, 1 ) == " ") and (r_pmrmprop.Date != r_pmdurmpp.Date))
      Print_SmallStr(r_pmrmprop.Date, r_pmdurmpp.Date, "Дата (заполняемая клиентом)"); i = i+1;
   end;
   if((SubStr( locked, req_fld_KindPaym, 1 ) == " ") and (r_pmrmprop.PaymentKind != r_pmdurmpp.PaymentKind))
      Print_PaymentKind(r_pmrmprop.PaymentKind, r_pmdurmpp.PaymentKind); i = i+1;
   end;
   if((SubStr( locked, req_fld_ValueDate, 1 ) == " ") and (r_pmpaym.ValueDate != r_pmdupaym.ValueDate))
      Print_SmallStr(r_pmpaym.ValueDate, r_pmdupaym.ValueDate, "Дата"); i = i+1;
   end;
   if((SubStr( locked, req_fld_IntoBank, 1 ) == " ") and (r_pmpaym.PayerBankEnterDate != r_pmdupaym.PayerBankEnterDate))
      Print_SmallStr(r_pmpaym.PayerBankEnterDate, r_pmdupaym.PayerBankEnterDate, "Дата ввода"); i = i+1;
   end;
   if((SubStr( locked, req_fld_AcceptPeriod, 1 ) == " ") and (r_pspaydem.AcceptPeriod != r_psdupade.AcceptPeriod))
      Print_SmallStr(r_pspaydem.AcceptPeriod, r_psdupade.AcceptPeriod, "Срок акцепта (в рабочих днях)"); i = i+1;
   end;
   if((SubStr( locked, req_fld_P_INN, 1 ) == " ") and (r_pmrmprop.PayerINN != r_pmdurmpp.PayerINN))
      Print_PayerINN(r_pmrmprop.PayerINN, r_pmdurmpp.PayerINN); i = i+1;
   end;
   if((SubStr( locked, req_fld_Payer, 1 ) == " ") and (r_pmrmprop.PayerName != r_pmdurmpp.PayerName))
      Print_PayerName(r_pmrmprop.PayerName,r_pmdurmpp.PayerName); i = i+1;
   end;
   if((SubStr( locked, req_fld_AcceptSum, 1 ) == " ") and (r_pspaydem.ReqSum != r_psdupade.ReqSum))
      Print_Amount(r_pspaydem.ReqSum, r_psdupade.ReqSum, "Сумма (требуемая)"); i = i+1;
   end;
   if((SubStr( locked, req_fld_P_Account, 1 ) == " ") and (r_pmpaym.PayerAccount != r_pmdupaym.PayerAccount))
      Print_SmallStr(r_pmpaym.PayerAccount, r_pmdupaym.PayerAccount, "Счет плательщика"); i = i+1;
   end;
   if((SubStr( locked, req_fld_R_Bank, 1 ) == " ") and (r_pmrmprop.ReceiverBankName != r_pmdurmpp.ReceiverBankName))
      Print_ReceiverBankName(r_pmrmprop.ReceiverBankName, r_pmdurmpp.ReceiverBankName); i = i+1;
   end;
   if((SubStr( locked, req_fld_R_KindCode, 1 ) == " ") and (r_credit.CodeKind != r_ducredit.CodeKind))
      Print_CodeKind(r_credit.CodeKind, r_ducredit.CodeKind); i = i+1;
   end;
   if((SubStr( locked, req_fld_R_Code, 1 ) == " ") and (r_credit.BankCode != r_ducredit.BankCode))
      Print_SmallStr(r_credit.BankCode, r_ducredit.BankCode, "Код банка получателя"); i = i+1;
   end;
   if((SubStr( locked, req_fld_R_CorrAcc, 1 ) == " ") and (r_pmrmprop.ReceiverCorrAccNostro != r_pmdurmpp.ReceiverCorrAccNostro))
      Print_SmallStr(r_pmrmprop.ReceiverCorrAccNostro, r_pmdurmpp.ReceiverCorrAccNostro, "Корсчет банка получателя в РКЦ"); i = i+1;
   end;
   if((SubStr( locked, req_fld_R_INN, 1 ) == " ") and (r_pmrmprop.ReceiverINN != r_pmdurmpp.ReceiverINN))
      Print_ReceiverINN(r_pmrmprop.ReceiverINN, r_pmdurmpp.ReceiverINN); i = i+1;
   end;
   if((SubStr( locked, req_fld_Receiver, 1 ) == " ") and (r_pmrmprop.ReceiverName != r_pmdurmpp.ReceiverName))
      Print_ReceiverName(r_pmrmprop.ReceiverName, r_pmdurmpp.ReceiverName); i = i+1;
   end;
   if((SubStr( locked, req_fld_R_Account, 1 ) == " ") and (r_pmpaym.ReceiverAccount != r_pmdupaym.ReceiverAccount))
      Print_SmallStr(r_pmpaym.ReceiverAccount, r_pmdupaym.ReceiverAccount, "Счет получателя"); i = i+1;
   end;
   if((SubStr( locked, req_fld_Ground, 1 ) == " ") and (r_pmrmprop.Ground != r_pmdurmpp.Ground))
      Print_Cround(r_pmrmprop.Ground, r_pmdurmpp.Ground); i = i+1;
   end;
   if((SubStr( locked, req_fld_ShifrOper, 1 ) == " ") and (r_pmrmprop.ShifrOper != r_pmdurmpp.ShifrOper))
      Print_SmallStr(r_pmrmprop.ShifrOper, r_pmdurmpp.ShifrOper, "Шифр"); i = i+1;
   end;
   if((SubStr( locked, req_fld_PayDate, 1 ) == " ") and (r_pmrmprop.PayDate != r_pmdurmpp.PayDate))
      Print_SmallStr(r_pmrmprop.PayDate, r_pmdurmpp.PayDate, "Срок платежа"); i = i+1;
   end;
   if((SubStr( locked, req_fld_Priority, 1 ) == " ") and (r_pmrmprop.Priority != r_pmdurmpp.Priority))
      Print_SmallStr(r_pmrmprop.Priority, r_pmdurmpp.Priority, "Очередность платежа"); i = i+1;
   end;
   if((SubStr( locked, req_fld_NumberPack, 1 ) == " ") and (r_pmpaym.NumberPack != r_pmdupaym.NumberPack))
      Print_SmallStr(r_pmpaym.NumberPack, r_pmdupaym.NumberPack, "Номер пачки"); i = i+1;      
   end;

   Print_Kolvo(i);
end;
  return;
END;

MACRO Print_ReportAkkr()
  var i = 0;

  Print_ReportDupl(r_pmdupaym.PaymentID, r_pmdurmpp.Number, r_pmdupaym.Amount, r_pmdupaym.ValueDate);
[    Аккредитив N ##########################
     Сумма:   ############################
     Дата валютирования:  ################
]
( r_pmrmprop.Number:l, r_pmpaym.Amount:l:f, r_pmpaym.ValueDate:l);

if( pr_rep )
   Print_Head();
   if((SubStr( locked, akk_fld_Number, 1 ) == " ") and (r_pmrmprop.Number != r_pmdurmpp.Number))
      Print_SmallStr(r_pmrmprop.Number, r_pmdurmpp.Number, "Номер документа"); i = i+1;
   end;
   if((SubStr( locked, akk_fld_Date, 1 ) == " ") and (r_pmrmprop.Date != r_pmdurmpp.Date))
      Print_SmallStr(r_pmrmprop.Date, r_pmdurmpp.Date, "Дата (заполняемая клиентом)"); i = i+1;
   end;
   if((SubStr( locked, akk_fld_KindPaym, 1 ) == " ") and (r_pmrmprop.PaymentKind != r_pmdurmpp.PaymentKind))
      Print_PaymentKind(r_pmrmprop.PaymentKind, r_pmdurmpp.PaymentKind); i = i+1;
   end;
   if((SubStr( locked, akk_fld_ValueDate, 1 ) == " ") and (r_pmpaym.ValueDate != r_pmdupaym.ValueDate))
      Print_SmallStr(r_pmpaym.ValueDate, r_pmdupaym.ValueDate, "Дата"); i = i+1;
   end;
   if((SubStr( locked, akk_fld_Sum, 1 ) == " ") and (r_pmpaym.Amount != r_pmdupaym.Amount))
      Print_Amount(r_pmpaym.Amount, r_pmdupaym.Amount); i = i+1;
   end;
   if((SubStr( locked, akk_fld_P_Account, 1 ) == " ") and (r_pmpaym.PayerAccount != r_pmdupaym.PayerAccount))
      Print_SmallStr(r_pmpaym.PayerAccount, r_pmdupaym.PayerAccount, "Счет плательщика"); i = i+1;
   end;
   if((SubStr( locked, akk_fld_P_INN, 1 ) == " ") and (r_pmrmprop.PayerINN != r_pmdurmpp.PayerINN))
      Print_PayerINN(r_pmrmprop.PayerINN, r_pmdurmpp.PayerINN); i = i+1;
   end;
   if((SubStr( locked, akk_fld_Payer, 1 ) == " ") and (r_pmrmprop.PayerName != r_pmdurmpp.PayerName))
      Print_PayerName(r_pmrmprop.PayerName,r_pmdurmpp.PayerName); i = i+1;
   end;
   if((SubStr( locked, akk_fld_R_KindCode, 1 ) == " ") and (r_credit.CodeKind != r_ducredit.CodeKind))
      Print_CodeKind(r_credit.CodeKind, r_ducredit.CodeKind); i = i+1;
   end;
   if((SubStr( locked, akk_fld_R_Code, 1 ) == " ") and (r_credit.BankCode != r_ducredit.BankCode))
      Print_SmallStr(r_credit.BankCode, r_ducredit.BankCode, "Код банка получателя"); i = i+1;
   end;
   if((SubStr( locked, akk_fld_R_CorrAcc, 1 ) == " ") and (r_pmrmprop.ReceiverCorrAccNostro != r_pmdurmpp.ReceiverCorrAccNostro))
      Print_SmallStr(r_pmrmprop.ReceiverCorrAccNostro, r_pmdurmpp.ReceiverCorrAccNostro, "Корсчет банка получателя в РКЦ"); i = i+1;
   end;
   if((SubStr( locked, akk_fld_R_Bank, 1 ) == " ") and (r_pmrmprop.ReceiverBankName != r_pmdurmpp.ReceiverBankName))
      Print_ReceiverBankName(r_pmrmprop.ReceiverBankName, r_pmdurmpp.ReceiverBankName); i = i+1;
   end;
   if((SubStr( locked, akk_fld_Acc_40901, 1 ) == " ") and (r_pmpaym.ReceiverAccount != r_pmdupaym.ReceiverAccount))
      Print_SmallStr(r_pmpaym.ReceiverAccount, r_pmdupaym.ReceiverAccount, "Счет получателя"); i = i+1;
   end;
   if((SubStr( locked, akk_fld_R_INN, 1 ) == " ") and (r_pmrmprop.ReceiverINN != r_pmdurmpp.ReceiverINN))
      Print_ReceiverINN(r_pmrmprop.ReceiverINN, r_pmdurmpp.ReceiverINN); i = i+1;
   end;
   if((SubStr( locked, akk_fld_Receiver, 1 ) == " ") and (r_pmrmprop.ReceiverName != r_pmdurmpp.ReceiverName))
      Print_ReceiverName(r_pmrmprop.ReceiverName, r_pmdurmpp.ReceiverName); i = i+1;
   end;
   if((SubStr( locked, akk_fld_ShifrOper, 1 ) == " ") and (r_pmrmprop.ShifrOper != r_pmdurmpp.ShifrOper))
      Print_SmallStr(r_pmrmprop.ShifrOper, r_pmdurmpp.ShifrOper, "Шифр"); i = i+1;
   end;
   if((SubStr( locked, akk_fld_Ground, 1 ) == " ") and (r_pmrmprop.Ground != r_pmdurmpp.Ground))
      Print_Cround(r_pmrmprop.Ground, r_pmdurmpp.Ground); i = i+1;
   end;
   if((SubStr( locked, akk_fld_NumberPack, 1 ) == " ") and (r_pmpaym.NumberPack != r_pmdupaym.NumberPack))
      Print_SmallStr(r_pmpaym.NumberPack, r_pmdupaym.NumberPack, "Номер пачки"); i = i+1;
   end;
   /* условия аккредитива */                                                             
   if((SubStr( lockakkr, akk_fld_Type, 1 ) == " ") and (r_pmakkr.Type != r_pmduakkr.Type))
      Print_SmallStr(r_pmakkr.Type, r_pmduakkr.Type, "Вид аккредитива"); i = i+1;
   end;
   if((SubStr( lockakkr, akk_fld_PayCondition, 1 ) == " ") and (r_pmakkr.PayCondition != r_pmduakkr.PayCondition))
      Print_SmallStr(r_pmakkr.PayCondition, r_pmduakkr.PayCondition, "Условие оплаты"); i = i+1;
   end;  
   if((SubStr( lockakkr, akk_fld_PayDate, 1 ) == " ") and (r_pmakkr.Date != r_pmduakkr.Date))
      Print_SmallStr(r_pmakkr.Date, r_pmduakkr.Date, "Дата окончания действия аккредитива"); i = i+1;
   end;
   if((SubStr( lockakkr, akk_fld_Representation, 1 ) == " ") and (r_pmakkr.Representation != r_pmduakkr.Representation))
      Print_SmallStr(r_pmakkr.Representation, r_pmduakkr.Representation, "Платеж по представлению"); i = i+1;
   end;
   if((SubStr( lockakkr, akk_fld_AddCondition, 1 ) == " ") and (r_pmakkr.AddCondition != r_pmduakkr.AddCondition))
      Print_SmallStr(r_pmakkr.AddCondition, r_pmduakkr.AddCondition, "Дополнительные условия"); i = i+1;
   end; 
   if((SubStr( lockakkr, akk_fld_Acc_R_Real, 1 ) == " ") and (r_pmakkr.AccRealReceiver != r_pmduakkr.AccRealReceiver))
      Print_SmallStr(r_pmakkr.AccRealReceiver, r_pmduakkr.AccRealReceiver, "Конечный получатель"); i = i+1;
   end;
   if((SubStr( lockakkr, akk_fld_AddDocs, 1 ) == " ") and (s_pmakkradd != s_pmduakkradd))
      Print_LargeStr(s_pmakkradd, s_pmduakkradd, "Приложение к аккредитиву"); i = i+1;
   end;  

   Print_Kolvo(i);
end;
  return;
END;

/* Печать результатов верификации */
MACRO Print_Report()
  
  if  (r_pspayord.DocKind == 1) Print_ReportOrder  ();
  elif(r_pspayord.DocKind == 2) Print_ReportDemand ();
  elif(r_pspayord.DocKind == 3) Print_ReportRequest();
  elif(r_pspayord.DocKind == 4) Print_ReportAkkr   ();
  end;

  return 0;
END;
