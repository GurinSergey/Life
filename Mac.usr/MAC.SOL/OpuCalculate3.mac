class TCalculate3()

    private var m_attributeValue = rcbApplication.currentReport.attributeValue("Символы");

    private var m_headAttributeValue = null;

    private macro getCompositeValue(attributeValue, code)
        var keyValue = attributeValue.createKeyValue();

        keyValue.fieldValue("code") = code;

        var compositeValue = attributeValue.value(keyValue);

        if (compositeValue == null)
            compositeValue = attributeValue.addValue(keyValue);
        end;

        return compositeValue;
    end;

    macro execute()
        var value10000Rexact = getCompositeValue(m_attributeValue, "10000").fieldValue("roubleValue").exact;
        var value20000Rexact = getCompositeValue(m_attributeValue, "20000").fieldValue("roubleValue").exact;
        var value10000Cexact = getCompositeValue(m_attributeValue, "10000").fieldValue("currencyValue").exact;
        var value20000Cexact = getCompositeValue(m_attributeValue, "20000").fieldValue("currencyValue").exact;
        var value10000Texact = getCompositeValue(m_attributeValue, "10000").fieldValue("totalValue").exact;
        var value20000Texact = getCompositeValue(m_attributeValue, "20000").fieldValue("totalValue").exact;
        var value33001Rexact = max($0, value10000Rexact - value20000Rexact);
        var value33002Rexact = max($0, value20000Rexact - value10000Rexact);
        var value33001Cexact = max($0, value10000Cexact - value20000Cexact);
        var value33002Cexact = max($0, value20000Cexact - value10000Cexact);
        var value33001Texact = max($0, value10000Texact - value20000Texact);
        var value33002Texact = max($0, value20000Texact - value10000Texact);
        var value31005exact = $0;
        var value32005exact = $0;
        var value31003      =  0;
        var value31004exact = $0;
        var value32003      =  0;
        var value32004exact = $0;

        var value10000Rscaled = getCompositeValue(m_attributeValue, "10000").fieldValue("roubleValue").scaled;
        var value20000Rscaled = getCompositeValue(m_attributeValue, "20000").fieldValue("roubleValue").scaled;
        var value10000Cscaled = getCompositeValue(m_attributeValue, "10000").fieldValue("currencyValue").scaled;
        var value20000Cscaled = getCompositeValue(m_attributeValue, "20000").fieldValue("currencyValue").scaled;
        var value10000Tscaled = getCompositeValue(m_attributeValue, "10000").fieldValue("totalValue").scaled;
        var value20000Tscaled = getCompositeValue(m_attributeValue, "20000").fieldValue("totalValue").scaled;
        var value33001Rscaled = max(0.0, value10000Rscaled - value20000Rscaled);
        var value33002Rscaled = max(0.0, value20000Rscaled - value10000Rscaled);
        var value33001Cscaled = max(0.0, value10000Cscaled - value20000Cscaled);
        var value33002Cscaled = max(0.0, value20000Cscaled - value10000Cscaled);
        var value33001Tscaled = max(0.0, value10000Tscaled - value20000Tscaled);
        var value33002Tscaled = max(0.0, value20000Tscaled - value10000Tscaled);
        var value31005scaled = 0.0;
        var value32005scaled = 0.0;
        var value31004scaled = 0.0;
        var value32004scaled = 0.0;

        macro setSymbol3ForDepartment()
        end;

        macro setSymbol3ForHeadWithoutDepartments()
            value31005exact = value33001Texact;
            value32005exact = value33002Texact;

            value31005scaled = value33001Tscaled;
            value32005scaled = value33002Tscaled;
        end;

        macro setSymbol3ForHeadWithDepartments()
            var department     = TRsbDataset("SELECT t_code FROM ddp_dep_dbt WHERE t_crx_usesum = 'X' UNION SELECT 0 FROM DUAL");
            var report         = null;
            var attributeValue = null;

            var department33001exact = null;
            var department33002exact = null;

            var department33001scaled = null;
            var department33002scaled = null;

            while (department.next())
                report = rcbApplication.objectFactory.createReport(rcbApplication.currentReport.form.id,
                                                                   RcbReportContext(rcbApplication.currentReport.context.period,
                                                                                    department.code));
                if (report.isCalculated())
                    attributeValue = report.attributeValue("Символы");

                    department33001exact = getCompositeValue(attributeValue, "33001").fieldValue("totalValue").exact;
                    department33002exact = getCompositeValue(attributeValue, "33002").fieldValue("totalValue").exact;

                    department33001scaled = getCompositeValue(attributeValue, "33001").fieldValue("totalValue").scaled;
                    department33002scaled = getCompositeValue(attributeValue, "33002").fieldValue("totalValue").scaled;

                    if (department.code == {numdprt})
                        value31005exact = department33001exact;
                        value32005exact = department33002exact;

                        value31005scaled = department33001scaled;
                        value32005scaled = department33002scaled;
                    else
                        if (department33001exact > $0)
                            value31003       = value31003 + 1;
                            value31004exact  = value31004exact + department33001exact;
                            value31004scaled = value31004scaled + department33001scaled;
                        end;

                        if (department33002exact > $0)
                            value32003       = value32003 + 1;
                            value32004exact  = value32004exact + department33002exact;
                            value32004scaled = value32004scaled + department33002scaled;
                        end;
                    end;
                end;
            end;
        end;

        var we = global.whoWeAre();

        if   (we == DEPARTMENT)               setSymbol3ForDepartment();
        elif (we == HEAD_WITHOUT_DEPARTMENTS) setSymbol3ForHeadWithoutDepartments();
        elif (we == HEAD_WITH_DEPARTMENTS)    setSymbol3ForHeadWithDepartments();
        end;

        var compositeValue = null;

        compositeValue = getCompositeValue(m_attributeValue, "33001");
        compositeValue.fieldValue("roubleValue").exact    = value33001Rexact;
        compositeValue.fieldValue("roubleValue").scaled   = value33001Rscaled;
        compositeValue.fieldValue("currencyValue").exact  = value33001Cexact;
        compositeValue.fieldValue("currencyValue").scaled = value33001Cscaled;
        compositeValue.fieldValue("totalValue").exact     = value33001Texact;
        compositeValue.fieldValue("totalValue").scaled    = value33001Tscaled;

        compositeValue = getCompositeValue(m_attributeValue, "33002");
        compositeValue.fieldValue("roubleValue").exact    = value33002Rexact;
        compositeValue.fieldValue("roubleValue").scaled   = value33002Rscaled;
        compositeValue.fieldValue("currencyValue").exact  = value33002Cexact;
        compositeValue.fieldValue("currencyValue").scaled = value33002Cscaled;
        compositeValue.fieldValue("totalValue").exact     = value33002Texact;
        compositeValue.fieldValue("totalValue").scaled    = value33002Tscaled;

        compositeValue = getCompositeValue(m_attributeValue, "31005");
        compositeValue.fieldValue("totalValue").exact  = value31005exact;
        compositeValue.fieldValue("totalValue").scaled = value31005scaled;

        compositeValue = getCompositeValue(m_attributeValue, "32005");
        compositeValue.fieldValue("totalValue").exact  = value32005exact;
        compositeValue.fieldValue("totalValue").scaled = value32005scaled;

        compositeValue = getCompositeValue(m_attributeValue, "31003");
        compositeValue.fieldValue("totalValue").exact  = Int(value31003);
        compositeValue.fieldValue("totalValue").scaled = Int(value31003);

        compositeValue = getCompositeValue(m_attributeValue, "32003");
        compositeValue.fieldValue("totalValue").exact  = Int(value32003);
        compositeValue.fieldValue("totalValue").scaled = Int(value32003);

        compositeValue = getCompositeValue(m_attributeValue, "31004");
        compositeValue.fieldValue("totalValue").exact  = value31004exact;
        compositeValue.fieldValue("totalValue").scaled = value31004scaled;

        compositeValue = getCompositeValue(m_attributeValue, "32004");
        compositeValue.fieldValue("totalValue").exact  = value32004exact;
        compositeValue.fieldValue("totalValue").scaled = value32004scaled;

        rcbApplication.transactionManager.commit();
    end;
end;

class (TCalculate3) TCalculate32055()
    initTCalculate3();

    private var m_advisorySymbol = TArray(19);

    private macro initializeAdvisorySymbol()
        m_advisorySymbol[0] = "26101";      m_advisorySymbol[10] = "26305";
        m_advisorySymbol[1] = "26102";      m_advisorySymbol[11] = "26401";
        m_advisorySymbol[2] = "26103";      m_advisorySymbol[12] = "26402";
        m_advisorySymbol[3] = "26104";      m_advisorySymbol[13] = "26403";
        m_advisorySymbol[4] = "26201";      m_advisorySymbol[14] = "26404";
        m_advisorySymbol[5] = "26202";      m_advisorySymbol[15] = "26405";
        m_advisorySymbol[6] = "26203";      m_advisorySymbol[16] = "26406";
        m_advisorySymbol[7] = "26301";      m_advisorySymbol[17] = "26410";
        m_advisorySymbol[8] = "26302";      m_advisorySymbol[18] = "26412";
        m_advisorySymbol[9] = "26303";
    end;

    private macro normalizeAdvisorySymbol()
        var advisoryAttributeValue = rcbApplication.currentReport.attributeValue("AdvisorySymbol");
        var symbolValueExact;
        var symbolValueScaled;
        var advisorySymbolValueExact;
        var advisorySymbolValueScaled;
        var totalSymbolValueExact  = 0;
        var totalSymbolValueScaled = 0;
        var i = 0;

        if (advisoryAttributeValue) /*для Приложения 4 этой переменной нет, т.к. Справка не расчитыывается*/
            initializeAdvisorySymbol();
            while (i < 19)
                symbolValueExact          = getCompositeValue(m_attributeValue,       m_advisorySymbol[i]).fieldValue("totalValue").exact;
                symbolValueScaled         = getCompositeValue(m_attributeValue,       m_advisorySymbol[i]).fieldValue("totalValue").scaled;
                advisorySymbolValueExact  = getCompositeValue(advisoryAttributeValue, m_advisorySymbol[i]).fieldValue("value").exact;
                advisorySymbolValueScaled = getCompositeValue(advisoryAttributeValue, m_advisorySymbol[i]).fieldValue("value").scaled;

                totalSymbolValueExact     = totalSymbolValueExact  + min(symbolValueExact,  advisorySymbolValueExact);
                totalSymbolValueScaled    = totalSymbolValueScaled + min(symbolValueScaled, advisorySymbolValueScaled);

                getCompositeValue(advisoryAttributeValue, m_advisorySymbol[i]).fieldValue("value").exact  = min(symbolValueExact,  advisorySymbolValueExact);
                getCompositeValue(advisoryAttributeValue, m_advisorySymbol[i]).fieldValue("value").scaled = min(symbolValueScaled, advisorySymbolValueScaled);

                i = i + 1;
            end;
            getCompositeValue(advisoryAttributeValue, "26000").fieldValue("value").exact  = totalSymbolValueExact;
            getCompositeValue(advisoryAttributeValue, "26000").fieldValue("value").scaled = totalSymbolValueScaled;
        end;
    end;

    macro execute()
        execute();
        normalizeAdvisorySymbol();
        rcbApplication.transactionManager.commit();
    end;
end;


class (TCalculate32055)TCalculate32090()
    initTCalculate32055();

     macro execute()
        var value1_7Rexact = getCompositeValue(m_attributeValue, "2А").fieldValue("roubleValue").exact
					       + getCompositeValue(m_attributeValue, "2Б").fieldValue("roubleValue").exact
					       + getCompositeValue(m_attributeValue, "2В").fieldValue("roubleValue").exact;

        var value1_7Cexact = getCompositeValue(m_attributeValue, "2А").fieldValue("currencyValue").exact
					       + getCompositeValue(m_attributeValue, "2Б").fieldValue("currencyValue").exact
					       + getCompositeValue(m_attributeValue, "2В").fieldValue("currencyValue").exact;

        var value1_7Texact = getCompositeValue(m_attributeValue, "2А").fieldValue("totalValue").exact
					       + getCompositeValue(m_attributeValue, "2Б").fieldValue("totalValue").exact
					       + getCompositeValue(m_attributeValue, "2В").fieldValue("totalValue").exact;

        var value10000Texact = getCompositeValue(m_attributeValue, "10000").fieldValue("totalValue").exact;
        var value28101Texact = getCompositeValue(m_attributeValue, "28101").fieldValue("totalValue").exact;
        var value32101Texact = getCompositeValue(m_attributeValue, "320").fieldValue("totalValue").exact;


        var value1_7Rscaled = getCompositeValue(m_attributeValue, "2А").fieldValue("roubleValue").scaled
					        + getCompositeValue(m_attributeValue, "2Б").fieldValue("roubleValue").scaled
					        + getCompositeValue(m_attributeValue, "2В").fieldValue("roubleValue").scaled;

        var value1_7Cscaled = getCompositeValue(m_attributeValue, "2А").fieldValue("currencyValue").scaled
					        + getCompositeValue(m_attributeValue, "2Б").fieldValue("currencyValue").scaled
					        + getCompositeValue(m_attributeValue, "2В").fieldValue("currencyValue").scaled;

        var value1_7Tscaled = getCompositeValue(m_attributeValue, "2А").fieldValue("totalValue").scaled
					        + getCompositeValue(m_attributeValue, "2Б").fieldValue("totalValue").scaled
					        + getCompositeValue(m_attributeValue, "2В").fieldValue("totalValue").scaled;

        var value10000Tscaled = getCompositeValue(m_attributeValue, "10000").fieldValue("totalValue").scaled;
        var value28101Tscaled = getCompositeValue(m_attributeValue, "28101").fieldValue("totalValue").scaled;
        var value32101Tscaled = getCompositeValue(m_attributeValue, "320").fieldValue("totalValue").scaled;


        var value01000Texact = max($0, value10000Texact - value1_7Texact);
        var value02000Texact = max($0, value1_7Texact - value10000Texact);

        var value01000Tscaled = max($0, value10000Tscaled - value1_7Tscaled);
        var value02000Tscaled = max($0, value1_7Tscaled - value10000Tscaled);

        var compositeValue = null;

        compositeValue = getCompositeValue(m_attributeValue, "2АБВ");
        compositeValue.fieldValue("roubleValue").exact    = value1_7Rexact;
        compositeValue.fieldValue("roubleValue").scaled   = value1_7Rscaled;
        compositeValue.fieldValue("currencyValue").exact  = value1_7Cexact;
        compositeValue.fieldValue("currencyValue").scaled = value1_7Cscaled;
        compositeValue.fieldValue("totalValue").exact     = value1_7Texact;
        compositeValue.fieldValue("totalValue").scaled    = value1_7Tscaled;

        compositeValue = getCompositeValue(m_attributeValue, "01000");
        compositeValue.fieldValue("totalValue").exact     = value01000Texact;
        compositeValue.fieldValue("totalValue").scaled    = value01000Tscaled;

        compositeValue = getCompositeValue(m_attributeValue, "02000");
        compositeValue.fieldValue("totalValue").exact     = value02000Texact;
        compositeValue.fieldValue("totalValue").scaled    = value02000Tscaled;


        macro setSymbol3ForDepartment()
            macro setUndefined(symbolName)
                compositeValue = getCompositeValue(m_attributeValue, symbolName);
                compositeValue.fieldValue("roubleValue").setUndefined();
                compositeValue.fieldValue("currencyValue").setUndefined();
                compositeValue.fieldValue("totalValue").setUndefined();
            end;

            setUndefined("3");
            setUndefined("31001");
            setUndefined("31002");
            setUndefined("32");
            setUndefined("320");
            setUndefined("32001");
            setUndefined("32002");
            setUndefined("33001");
            setUndefined("33002");
        end;

        macro setSymbol3ForDepartmentHead()
            var value31001Texact = max($0, value01000Texact - value28101Texact);
            var value31002Texact = max($0, value28101Texact - value01000Texact + value02000Texact);
            var value33001Texact = max($0, value31001Texact - value32101Texact);
            var value33002Texact = max($0, value32101Texact - value31001Texact + value31002Texact);

            var value31001Tscaled = max(0.0, value01000Tscaled - value28101Tscaled);
            var value31002Tscaled = max(0.0, value28101Tscaled - value01000Tscaled + value02000Tscaled);
            var value33001Tscaled = max(0.0, value31001Tscaled - value32101Tscaled);
            var value33002Tscaled = max(0.0, value32101Tscaled - value31001Tscaled + value31002Tscaled);

        	compositeValue = getCompositeValue(m_attributeValue, "31001");
	        compositeValue.fieldValue("totalValue").exact     = value31001Texact;
    	    compositeValue.fieldValue("totalValue").scaled    = value31001Tscaled;

	        compositeValue = getCompositeValue(m_attributeValue, "31002");
    	    compositeValue.fieldValue("totalValue").exact     = value31002Texact;
        	compositeValue.fieldValue("totalValue").scaled    = value31002Tscaled;

	        compositeValue = getCompositeValue(m_attributeValue, "33001");
    	    compositeValue.fieldValue("totalValue").exact     = value33001Texact;
        	compositeValue.fieldValue("totalValue").scaled    = value33001Tscaled;

	        compositeValue = getCompositeValue(m_attributeValue, "33002");
    	    compositeValue.fieldValue("totalValue").exact     = value33002Texact;
        	compositeValue.fieldValue("totalValue").scaled    = value33002Tscaled;
        end;

        if   (global.isHeadDepartment()) setSymbol3ForDepartmentHead();
        else                             setSymbol3ForDepartment();
        end;

        normalizeAdvisorySymbol();

        rcbApplication.transactionManager.commit();
    end;
end;
class (TCalculate32090)TCalculate32514()
    initTCalculate32090();

    macro execute()
        var value173067Rexact = getCompositeValue(m_attributeValue, "17306").fieldValue("roubleValue").exact
                              + getCompositeValue(m_attributeValue, "17307").fieldValue("roubleValue").exact;
        var value273089Rexact = getCompositeValue(m_attributeValue, "27308").fieldValue("roubleValue").exact
                              + getCompositeValue(m_attributeValue, "27309").fieldValue("roubleValue").exact;

        var value173067Cexact = getCompositeValue(m_attributeValue, "17306").fieldValue("currencyValue").exact
                              + getCompositeValue(m_attributeValue, "17307").fieldValue("currencyValue").exact;
        var value273089Cexact = getCompositeValue(m_attributeValue, "27308").fieldValue("currencyValue").exact
                              + getCompositeValue(m_attributeValue, "27309").fieldValue("currencyValue").exact;

        var value173067Texact = getCompositeValue(m_attributeValue, "17306").fieldValue("totalValue").exact
                              + getCompositeValue(m_attributeValue, "17307").fieldValue("totalValue").exact;
        var value273089Texact = getCompositeValue(m_attributeValue, "27308").fieldValue("totalValue").exact
                              + getCompositeValue(m_attributeValue, "27309").fieldValue("totalValue").exact;


        var value173067Rscaled = getCompositeValue(m_attributeValue, "17306").fieldValue("roubleValue").scaled
                               + getCompositeValue(m_attributeValue, "17307").fieldValue("roubleValue").scaled;
        var value273089Rscaled = getCompositeValue(m_attributeValue, "27308").fieldValue("roubleValue").scaled
                               + getCompositeValue(m_attributeValue, "27309").fieldValue("roubleValue").scaled;

        var value173067Cscaled = getCompositeValue(m_attributeValue, "17306").fieldValue("currencyValue").scaled
                               + getCompositeValue(m_attributeValue, "17307").fieldValue("currencyValue").scaled;
        var value273089Cscaled = getCompositeValue(m_attributeValue, "27308").fieldValue("currencyValue").scaled
                               + getCompositeValue(m_attributeValue, "27309").fieldValue("currencyValue").scaled;

        var value173067Tscaled = getCompositeValue(m_attributeValue, "17306").fieldValue("totalValue").scaled
                               + getCompositeValue(m_attributeValue, "17307").fieldValue("totalValue").scaled;
        var value273089Tscaled = getCompositeValue(m_attributeValue, "27308").fieldValue("totalValue").scaled
                               + getCompositeValue(m_attributeValue, "27309").fieldValue("totalValue").scaled;

        var compositeValue = null;

        compositeValue = getCompositeValue(m_attributeValue, "173067");
        compositeValue.fieldValue("roubleValue").exact    = value173067Rexact;
        compositeValue.fieldValue("roubleValue").scaled   = value173067Rscaled;
        compositeValue.fieldValue("currencyValue").exact  = value173067Cexact;
        compositeValue.fieldValue("currencyValue").scaled = value173067Cscaled;
        compositeValue.fieldValue("totalValue").exact     = value173067Texact;
        compositeValue.fieldValue("totalValue").scaled    = value173067Tscaled;

        compositeValue = getCompositeValue(m_attributeValue, "273089");
        compositeValue.fieldValue("roubleValue").exact    = value273089Rexact;
        compositeValue.fieldValue("roubleValue").scaled   = value273089Rscaled;
        compositeValue.fieldValue("currencyValue").exact  = value273089Cexact;
        compositeValue.fieldValue("currencyValue").scaled = value273089Cscaled;
        compositeValue.fieldValue("totalValue").exact     = value273089Texact;
        compositeValue.fieldValue("totalValue").scaled    = value273089Tscaled;

        execute();
    end;
end;

class (TCalculate32090)TCalculate33053()
    initTCalculate32090();

     macro execute()
        var value1_7Rexact = getCompositeValue(m_attributeValue, "2А").fieldValue("roubleValue").exact
					       + getCompositeValue(m_attributeValue, "2Б").fieldValue("roubleValue").exact
					       + getCompositeValue(m_attributeValue, "2В").fieldValue("roubleValue").exact;

        var value1_7Cexact = getCompositeValue(m_attributeValue, "2А").fieldValue("currencyValue").exact
					       + getCompositeValue(m_attributeValue, "2Б").fieldValue("currencyValue").exact
					       + getCompositeValue(m_attributeValue, "2В").fieldValue("currencyValue").exact;

        var value1_7Texact = getCompositeValue(m_attributeValue, "2А").fieldValue("totalValue").exact
					       + getCompositeValue(m_attributeValue, "2Б").fieldValue("totalValue").exact
					       + getCompositeValue(m_attributeValue, "2В").fieldValue("totalValue").exact;

        var value10000Texact = getCompositeValue(m_attributeValue, "10000").fieldValue("totalValue").exact;
        var value28101Texact = getCompositeValue(m_attributeValue, "28101").fieldValue("totalValue").exact;
        var value32101Texact = getCompositeValue(m_attributeValue, "320").fieldValue("totalValue").exact;


        var value1_7Rscaled = getCompositeValue(m_attributeValue, "2А").fieldValue("roubleValue").scaled
					        + getCompositeValue(m_attributeValue, "2Б").fieldValue("roubleValue").scaled
					        + getCompositeValue(m_attributeValue, "2В").fieldValue("roubleValue").scaled;

        var value1_7Cscaled = getCompositeValue(m_attributeValue, "2А").fieldValue("currencyValue").scaled
					        + getCompositeValue(m_attributeValue, "2Б").fieldValue("currencyValue").scaled
					        + getCompositeValue(m_attributeValue, "2В").fieldValue("currencyValue").scaled;

        var value1_7Tscaled = getCompositeValue(m_attributeValue, "2А").fieldValue("totalValue").scaled
					        + getCompositeValue(m_attributeValue, "2Б").fieldValue("totalValue").scaled
					        + getCompositeValue(m_attributeValue, "2В").fieldValue("totalValue").scaled;

        var value10000Tscaled = getCompositeValue(m_attributeValue, "10000").fieldValue("totalValue").scaled;
        var value28101Tscaled = getCompositeValue(m_attributeValue, "28101").fieldValue("totalValue").scaled;

        var value32101Tscaled = getCompositeValue(m_attributeValue, "320").fieldValue("totalValue").scaled;


        var value28201Rexact  = getCompositeValue(m_attributeValue, "28101").fieldValue("roubleValue").exact
                              + getCompositeValue(m_attributeValue, "28102").fieldValue("roubleValue").exact
                              - getCompositeValue(m_attributeValue, "28103").fieldValue("roubleValue").exact;

        var value28201Rscaled = getCompositeValue(m_attributeValue, "28101").fieldValue("roubleValue").scaled
                              + getCompositeValue(m_attributeValue, "28102").fieldValue("roubleValue").scaled
                              - getCompositeValue(m_attributeValue, "28103").fieldValue("roubleValue").scaled;

        var value28201Texact  = getCompositeValue(m_attributeValue, "28101").fieldValue("totalValue").exact
                              + getCompositeValue(m_attributeValue, "28102").fieldValue("totalValue").exact
                              - getCompositeValue(m_attributeValue, "28103").fieldValue("totalValue").exact;

        var value28201Tscaled = getCompositeValue(m_attributeValue, "28101").fieldValue("totalValue").scaled
                              + getCompositeValue(m_attributeValue, "28102").fieldValue("totalValue").scaled
                              - getCompositeValue(m_attributeValue, "28103").fieldValue("totalValue").scaled;

        var value28202Rexact  = getCompositeValue(m_attributeValue, "28103").fieldValue("roubleValue").exact
                              - getCompositeValue(m_attributeValue, "28101").fieldValue("roubleValue").exact
                              - getCompositeValue(m_attributeValue, "28102").fieldValue("roubleValue").exact;

        var value28202Rscaled = getCompositeValue(m_attributeValue, "28103").fieldValue("roubleValue").scaled
                              - getCompositeValue(m_attributeValue, "28101").fieldValue("roubleValue").scaled
                              - getCompositeValue(m_attributeValue, "28102").fieldValue("roubleValue").scaled;

        var value28202Texact  = getCompositeValue(m_attributeValue, "28103").fieldValue("totalValue").exact
                              - getCompositeValue(m_attributeValue, "28101").fieldValue("totalValue").exact
                              - getCompositeValue(m_attributeValue, "28102").fieldValue("totalValue").exact;

        var value28202Tscaled = getCompositeValue(m_attributeValue, "28103").fieldValue("totalValue").scaled
                              - getCompositeValue(m_attributeValue, "28101").fieldValue("totalValue").scaled
                              - getCompositeValue(m_attributeValue, "28102").fieldValue("totalValue").scaled;

        // KS 25.06.2014 Сумма должна быть либо в 28201, либо в 28202. Если в одном симоле положительная сумма, то в другом должен быть ноль
        if (value28201Rexact > 0)
          value28202Rexact  = 0;
          value28202Rscaled = 0;
          value28202Rexact  = 0;
          value28202Rscaled = 0;
          value28202Texact  = 0;
          value28202Tscaled = 0;
          value28202Texact  = 0;
          value28202Tscaled = 0;
        else
          value28201Rexact  = 0;
          value28201Rscaled = 0;
          value28201Rexact  = 0;
          value28201Rscaled = 0;
          value28201Texact  = 0;
          value28201Tscaled = 0;
          value28201Texact  = 0;
          value28201Tscaled = 0;
        end;

        var value173067Rexact = getCompositeValue(m_attributeValue, "17306").fieldValue("roubleValue").exact
                              + getCompositeValue(m_attributeValue, "17307").fieldValue("roubleValue").exact;
        var value273089Rexact = getCompositeValue(m_attributeValue, "27308").fieldValue("roubleValue").exact
                              + getCompositeValue(m_attributeValue, "27309").fieldValue("roubleValue").exact;

        var value173067Cexact = getCompositeValue(m_attributeValue, "17306").fieldValue("currencyValue").exact
                              + getCompositeValue(m_attributeValue, "17307").fieldValue("currencyValue").exact;
        var value273089Cexact = getCompositeValue(m_attributeValue, "27308").fieldValue("currencyValue").exact
                              + getCompositeValue(m_attributeValue, "27309").fieldValue("currencyValue").exact;

        var value173067Texact = getCompositeValue(m_attributeValue, "17306").fieldValue("totalValue").exact
                              + getCompositeValue(m_attributeValue, "17307").fieldValue("totalValue").exact;
        var value273089Texact = getCompositeValue(m_attributeValue, "27308").fieldValue("totalValue").exact
                              + getCompositeValue(m_attributeValue, "27309").fieldValue("totalValue").exact;


        var value173067Rscaled = getCompositeValue(m_attributeValue, "17306").fieldValue("roubleValue").scaled
                               + getCompositeValue(m_attributeValue, "17307").fieldValue("roubleValue").scaled;
        var value273089Rscaled = getCompositeValue(m_attributeValue, "27308").fieldValue("roubleValue").scaled
                               + getCompositeValue(m_attributeValue, "27309").fieldValue("roubleValue").scaled;

        var value173067Cscaled = getCompositeValue(m_attributeValue, "17306").fieldValue("currencyValue").scaled
                               + getCompositeValue(m_attributeValue, "17307").fieldValue("currencyValue").scaled;
        var value273089Cscaled = getCompositeValue(m_attributeValue, "27308").fieldValue("currencyValue").scaled
                               + getCompositeValue(m_attributeValue, "27309").fieldValue("currencyValue").scaled;

        var value173067Tscaled = getCompositeValue(m_attributeValue, "17306").fieldValue("totalValue").scaled
                               + getCompositeValue(m_attributeValue, "17307").fieldValue("totalValue").scaled;
        var value273089Tscaled = getCompositeValue(m_attributeValue, "27308").fieldValue("totalValue").scaled
                               + getCompositeValue(m_attributeValue, "27309").fieldValue("totalValue").scaled;


        var value01000Texact = max($0, value10000Texact + value28202Texact - value1_7Texact);
        var value02000Texact = max($0, value1_7Texact - value10000Texact - value28202Texact);

        var value01000Tscaled = max($0, value10000Tscaled + value28202Tscaled - value1_7Tscaled);
        var value02000Tscaled = max($0, value1_7Tscaled - value10000Tscaled - value28202Tscaled);


        var compositeValue = null;

        compositeValue = getCompositeValue(m_attributeValue, "173067");
        compositeValue.fieldValue("roubleValue").exact    = value173067Rexact;
        compositeValue.fieldValue("roubleValue").scaled   = value173067Rscaled;
        compositeValue.fieldValue("currencyValue").exact  = value173067Cexact;
        compositeValue.fieldValue("currencyValue").scaled = value173067Cscaled;
        compositeValue.fieldValue("totalValue").exact     = value173067Texact;
        compositeValue.fieldValue("totalValue").scaled    = value173067Tscaled;

        compositeValue = getCompositeValue(m_attributeValue, "273089");
        compositeValue.fieldValue("roubleValue").exact    = value273089Rexact;
        compositeValue.fieldValue("roubleValue").scaled   = value273089Rscaled;
        compositeValue.fieldValue("currencyValue").exact  = value273089Cexact;
        compositeValue.fieldValue("currencyValue").scaled = value273089Cscaled;
        compositeValue.fieldValue("totalValue").exact     = value273089Texact;
        compositeValue.fieldValue("totalValue").scaled    = value273089Tscaled;

        compositeValue = getCompositeValue(m_attributeValue, "2АБВ");
        compositeValue.fieldValue("roubleValue").exact    = value1_7Rexact;
        compositeValue.fieldValue("roubleValue").scaled   = value1_7Rscaled;
        compositeValue.fieldValue("currencyValue").exact  = value1_7Cexact;
        compositeValue.fieldValue("currencyValue").scaled = value1_7Cscaled;
        compositeValue.fieldValue("totalValue").exact     = value1_7Texact;
        compositeValue.fieldValue("totalValue").scaled    = value1_7Tscaled;

        compositeValue = getCompositeValue(m_attributeValue, "01000");
        compositeValue.fieldValue("totalValue").exact     = value01000Texact;
        compositeValue.fieldValue("totalValue").scaled    = value01000Tscaled;

        compositeValue = getCompositeValue(m_attributeValue, "02000");
        compositeValue.fieldValue("totalValue").exact     = value02000Texact;
        compositeValue.fieldValue("totalValue").scaled    = value02000Tscaled;

        compositeValue = getCompositeValue(m_attributeValue, "28201");
        compositeValue.fieldValue("roubleValue").exact    = value28201Rexact;
        compositeValue.fieldValue("roubleValue").scaled   = value28201Rscaled;
        compositeValue.fieldValue("totalValue").exact     = value28201Rexact;
        compositeValue.fieldValue("totalValue").scaled    = value28201Rscaled;

        compositeValue = getCompositeValue(m_attributeValue, "28202");
        compositeValue.fieldValue("roubleValue").exact    = value28202Rexact;
        compositeValue.fieldValue("roubleValue").scaled   = value28202Rscaled;
        compositeValue.fieldValue("totalValue").exact     = value28202Rexact;
        compositeValue.fieldValue("totalValue").scaled    = value28202Rscaled;

        // KS 25.06.2014 В сумма тогда будет не ноль
        compositeValue = getCompositeValue(m_attributeValue, "28");
        compositeValue.fieldValue("roubleValue").exact    = value28201Rexact  + value28202Rexact;//0;
        compositeValue.fieldValue("roubleValue").scaled   = value28201Rscaled + value28202Rscaled;//0;
        compositeValue.fieldValue("totalValue").exact     = value28201Rexact  + value28202Rexact;//0;
        compositeValue.fieldValue("totalValue").scaled    = value28201Rscaled + value28202Rscaled;//0;

        compositeValue = getCompositeValue(m_attributeValue, "10000");
        compositeValue.fieldValue("roubleValue").exact    = compositeValue.fieldValue("roubleValue").exact  + value28202Rexact;
        compositeValue.fieldValue("roubleValue").scaled   = compositeValue.fieldValue("roubleValue").scaled + value28202Rscaled;
        compositeValue.fieldValue("totalValue").exact     = compositeValue.fieldValue("totalValue").exact   + value28202Texact;
        compositeValue.fieldValue("totalValue").scaled    = compositeValue.fieldValue("totalValue").scaled  + value28202Tscaled;

        compositeValue = getCompositeValue(m_attributeValue, "20000");
        compositeValue.fieldValue("roubleValue").exact    = value1_7Rexact  + value28201Rexact;
        compositeValue.fieldValue("roubleValue").scaled   = value1_7Rscaled + value28201Rscaled;
        compositeValue.fieldValue("totalValue").exact     = value1_7Texact  + value28201Texact;
        compositeValue.fieldValue("totalValue").scaled    = value1_7Tscaled + value28201Tscaled;

        macro setSymbol3ForDepartment()
            macro setUndefined(symbolName)
                compositeValue = getCompositeValue(m_attributeValue, symbolName);
                compositeValue.fieldValue("roubleValue").setUndefined();
                compositeValue.fieldValue("currencyValue").setUndefined();
                compositeValue.fieldValue("totalValue").setUndefined();
            end;

            setUndefined("3");
            setUndefined("31001");
            setUndefined("31002");
            setUndefined("32");
            setUndefined("320");
            setUndefined("32001");
            setUndefined("32002");
            setUndefined("33001");
            setUndefined("33002");
        end;

        macro setSymbol3ForDepartmentHead()
            var value31001Texact = 0;
            var value31002Texact = 0;
            var value31001Tscaled = 0;
            var value31002Tscaled = 0;

            if ((value01000Texact > 0) AND (value28201Texact > 0))
                if (value28201Texact < value01000Texact)
                    value31001Texact = value01000Texact - value28201Texact;
                    value31002Texact = 0;
                    value31001Tscaled = value01000Tscaled - value28201Tscaled;
                    value31002Tscaled = 0;
                elif (value28201Texact > value01000Texact)
                    value31001Texact = 0;
                    value31002Texact = value28201Texact - value01000Texact;
                    value31001Tscaled = 0;
                    value31002Tscaled = value28201Tscaled - value01000Tscaled;
                elif (value28201Texact == value01000Texact)
                    value31001Texact = 0;
                    value31002Texact = 0;
                    value31001Tscaled = 0;
                    value31002Tscaled = 0;
                end;
            elif ((value01000Texact > 0) AND (value28201Texact == 0) AND (value28202Texact == 0))
                value31001Texact = value01000Texact;
                value31002Texact = 0;
                value31001Tscaled = value01000Tscaled;
                value31002Tscaled = 0;
            elif ((value01000Texact > 0) AND (value28202Texact > 0))
                value31001Texact = value01000Texact + value28202Texact;
                value31002Texact = 0;
                value31001Tscaled = value01000Tscaled + value28202Tscaled;
                value31002Tscaled = 0;
            elif ((value01000Texact == 0) AND (value02000Texact == 0) AND (value28201Texact > 0))
                value31001Texact = 0;
                value31002Texact = value28201Texact;
                value31001Tscaled = 0;
                value31002Tscaled = value28201Tscaled;
            elif ((value01000Texact == 0) AND (value02000Texact == 0) AND (value28202Texact > 0))
                value31001Texact = value28202Texact;
                value31002Texact = 0;
                value31001Tscaled = value28202Tscaled;
                value31002Tscaled = 0;
            elif ((value02000Texact > 0) AND (value28201Texact > 0))
                value31001Texact = 0;
                value31002Texact = value02000Texact + value28201Texact;
                value31001Tscaled = 0;
                value31002Tscaled = value02000Tscaled + value28201Tscaled;
            elif ((value02000Texact > 0) AND (value28201Texact == 0) AND (value28202Texact == 0))
                value31001Texact = 0;
                value31002Texact = value02000Texact;
                value31001Tscaled = 0;
                value31002Tscaled = value02000Tscaled;
            elif ((value02000Texact > 0) AND (value28202Texact > 0))
                if (value28202Texact < value02000Texact)
                    value31001Texact = 0;
                    value31002Texact = value02000Texact - value28202Texact;
                    value31001Tscaled = 0;
                    value31002Tscaled = value02000Tscaled - value28202Tscaled;
                elif (value28202Texact > value02000Texact)
                    value31001Texact = value28202Texact - value02000Texact;
                    value31002Texact = 0;
                    value31001Tscaled = value28202Tscaled - value02000Tscaled;
                    value31002Tscaled = 0;
                elif (value28202Texact == value02000Texact)
                    value31001Texact = 0;
                    value31002Texact = 0;
                    value31001Tscaled = 0;
                    value31002Tscaled = 0;
                end;
            end;

            var value33001Texact = max($0, value31001Texact - value32101Texact);
            var value33002Texact = max($0, value32101Texact - value31001Texact + value31002Texact);

            var value33001Tscaled = max(0.0, value31001Tscaled - value32101Tscaled);
            var value33002Tscaled = max(0.0, value32101Tscaled - value31001Tscaled + value31002Tscaled);

        	compositeValue = getCompositeValue(m_attributeValue, "31001");
	        compositeValue.fieldValue("totalValue").exact     = value31001Texact;
    	    compositeValue.fieldValue("totalValue").scaled    = value31001Tscaled;

	        compositeValue = getCompositeValue(m_attributeValue, "31002");
    	    compositeValue.fieldValue("totalValue").exact     = value31002Texact;
        	compositeValue.fieldValue("totalValue").scaled    = value31002Tscaled;

	        compositeValue = getCompositeValue(m_attributeValue, "33001");
    	    compositeValue.fieldValue("totalValue").exact     = value33001Texact;
        	compositeValue.fieldValue("totalValue").scaled    = value33001Tscaled;

	        compositeValue = getCompositeValue(m_attributeValue, "33002");
    	    compositeValue.fieldValue("totalValue").exact     = value33002Texact;
        	compositeValue.fieldValue("totalValue").scaled    = value33002Tscaled;
        end;

        if   (global.isHeadDepartment()) setSymbol3ForDepartmentHead();
        else                             setSymbol3ForDepartment();
        end;

        normalizeAdvisorySymbol();

        rcbApplication.transactionManager.commit();
    end;
end;

