/*Адаптировано для всех банков группы Life в связи с унификацией текстов уведомлений и извещений
02.10.2012 г. Телешова Александра (R-108382-2, R-107803-2)*/
//Тихомиров А.Н. 7.08.2009
// Вспомогательный макрос печати/отправки сообщений ВК
//DEV 18.05.2012 по I-00195316-1

/*DEV 18.05.2012 по I-00195316-1*/
import "fg_Life_parm.mac", globals;
private Const fdBank = fg_life_subject({OurBank});
/*END DEV*/
//TAM 08.11.2012 R-118400-3
   var bank_name = "";
if (fdBank.is_prbb)
   bank_name = "          ОАО АКБ \"ПРОБИЗНЕСБАНК\"         ";
//TAM 09.11.2012 I-00282248-3
elif (fdBank.is_EXV_VOLGOGRAD )
   bank_name = "Ф. ЗАО АКБ \"ЭКСПРЕСС-ВОЛГА\" в г. Волгоград"; 
elif (fdBank.is_EXV_VORONEZH )
   bank_name = " Ф. ЗАО АКБ \"ЭКСПРЕСС-ВОЛГА\" в г. Воронеж ";
elif (fdBank.is_EXV_ULYANOVSK )
   bank_name = "Ф. ЗАО АКБ \"ЭКСПРЕСС-ВОЛГА\" в г. Ульяновск";
elif (fdBank.is_EXV_STAVROPOL )
   bank_name = "Ф. ЗАО АКБ \"ЭКСПРЕСС-ВОЛГА\" в г.Ставрополь";
//end TAM I-00282248-3
elif (fdBank.is_EXV )
   if(bank_name == "") //09.11.12 I-00282248-3 TAM
   /*bank_name = "        ЗАО АКБ \"ЭКСПРЕСС-ВОЛГА\"          "; VDN 01.04.2015 R-565212-2*/
   bank_name = "           " + {NAME_BANK} + "        ";
   end;
elif (fdBank.is_VUZ)
   bank_name = "                АО \"ВУЗ-БАНК\"             ";
elif (fdBank.is_GEB)
   bank_name = "            ОАО \"ГАЗЭНЕРГОБАНК\"           ";
elif (fdBank.is_NBS)
   bank_name = "    ЗАО \"НАЦИОНАЛЬНЫЙ БАНК СБЕРЕЖЕНИЙ\"    ";
elif (fdBank.is_GO)
   bank_name = "             ОАО КБ \"ПОЙДЁМ!\"             ";
//Gurin S. 17.06.2014 I-00495178-2
elif (fdBank.is_SLD)
   bank_name = "             ОАО КБ \"СОЛИДАРНОСТЬ\"        ";
end;

macro ISPayerNerezAcc(PayerAccount)
   var AcNer="";/*маски счета нерез.*/
   var errAn:integer; /*код ошибки*/
   var simvol_OPU="1116, 1117, 1119, 1214, 1216, 1303, 1403, 1506, 1507, 1508, 1605, 1606, 1607, 1608, 3106, 3107, 3108,  4103,  4104,  4203,  4204, 4302, 4304, 4402, 4404";
   var simvol_OPU_2 ="1103, 1211, 1213, 1214, 1314, 1316, 1414, 1416, 1502, 1602, 1702, 3106, 3107, 3108, 5201";
   /*счета нерезидентов*/  
   GetRegistryValue("PS\\REQOPENACC\\173-ФЗ СЧЕТА НЕРЕЗИДЕНТОВ\\ДЛЯ ВК", V_STRING, AcNer, errAn);
   if (not(CompareStrWithMasks (AcNer,PayerAccount)))
      return true;     
   end;   
   if  (((not(CompareStrWithMasks ("70603",PayerAccount))) and (substr(PayerAccount,10,1)==3) ) 
       or ((index(simvol_OPU_2, substr(PayerAccount,14,4))) and (substr(PayerAccount,1,1) == "7")))
       return true;
   elIf  (((not(CompareStrWithMasks ("70603",PayerAccount))) and (substr(PayerAccount,10,1)==3) ) 
       or ((index(simvol_OPU_2, substr(PayerAccount,14,4))) and (substr(PayerAccount,1,1) == "7")))
       return true;
   end;
   return false;
end;

Macro GetNotifyNumber( pmId, isCur )
  debugbreak;
  var query, rs;
   /* EVG 23/03/2011 Возникла проблема: номера валютных и рублёвых уведомлений
      потенциально могут пересекаться (пересекутся сразу, если нумерация будет с 1).
      Поэтому для рублёвых уведомлений я создал отдельную таблицу usr_trnsf_notify_rur,
      полностью идентичную usr_trnsf_notify. Она будет использоваться только для сохране-
      ния номера уведомления, в других процессах она не задействована. */
   var tblName = "usr_trnsf_notify";
   if ( not isCur and (fdBank.is_GEB or fdBank.is_EXV)) /*DEV 18.05.2012 по I-00195316-1
     доработка в print_vk.mac была выполнена только для ГЭБа. Была ошибка, так как в ВУЗ нет таблицы usr_trnsf_notify_rur*/

      tblName = "usr_trnsf_notify_rur";
   end;

   query = " Select notify_num from " + tblName + " where payment_id = " + pmId;
   rs = rsdRecordSet( query );
   if ( rs and rs.moveNext() )
      return string( rs.value( 0, null, V_INTEGER ) );
   end;

   return "";
end;

//TAM 24.09.12 I-00257398-2 добавлен 9 параметр
Macro ТекстУведомления(nameClient, paymentid, Currency_str, Value, Value_str, Account_Num, printNtfDate, Reply_date)
   debugbreak;
   private var text = string("Банк     ",{NAME_BANK},"\n",
      "Клиент   ",nameclient,"\n",                                                           
      "\n",
      "                            УВЕДОМЛЕНИЕ № ",GetNotifyNumber(paymentid,true), " от ",date(printNtfDate),"\n",
      "\n",
      "В пользу Вашего предприятия поступили средства в сумме ",Value," ",Currency_str,"\n",
      "(",Value_str,")," ,"\n",
      "которые зачислены на Ваш транзитный валютный  счет ", Account_num," ",date(printNtfDate), " г." ,"\n",
      "Последняя дата предоставления в Банк Распоряжения по транзитному счету и справки,","\n",
      "идентифицирующей поступившие средства - ",Reply_date,".","\n",     //TAM 
      "\n",
      "Ответственный  исполнитель   _____________________  (подпись)","\n",
      "уполномоченного  банка" ,"\n",
      "                             ┌──────────────────────────────────────────┐\n", //TAM 08.11.2012 R-118400-3
      "                             │                 ПОДПИСАНО                │\n",
      "                             │",bank_name,"│\n",
      "                             └──────────────────────────────────────────┘",
      "\n");
   return text;
END;

Macro ТекстИзвещения(nameclient, paymentid, value, currency_str, value_str, account_num, pdate);
   debugbreak;
   private var text = string("   ","\n",
      "     "+{NAME_BANK},"\n",
      "\n",
      "     ",nameclient ,"\n",
      "   ","\n",
      "                               Извещение № ",GetNotifyNumber(paymentid,false),"\n",
      "   ","\n",
      "                               от  ",pdate,"\n",
      "   ","\n",
      "     В пользу Вашего предприятия поступила ", pdate, " года валюта    ","\n",  //TAM 01.10.12 R-107803
      "     Российской Федерации " ,Value," ",Currency_str," (",Value_str,"),","\n", 
      "     которая зачислена на ваш счет № ", Account_num,".   ","\n",
      "   ","\n",
      "     Просим Вас предоставить необходимые документы (договор/контракт/счет и т.д),    ","\n",
      "     идентифицирующие поступившие денежные средства в рублях РФ.   ","\n",
      "   ", "\n",  
      "     Если операция связана с оформлением Паспорта сделки*, Вам  ", "\n", //или уже оформленным паспортом  ","\n",
      "     необходимо в срок не позднее ", DateAfterWorkDays(pdate,15), " (15 рабочих дней после даты ", "\n",
      "     зачисления) предоставить и оформить в банке: ", "\n",
      "           - Паспорт сделки и документы (контракт/договор займа),","\n",
      "     необходимые для оформления паспорта сделки;", "\n",
      "           - Справку о валютных операциях  и документы, относящиеся", "\n",
      "     к проведению данной операции.", "\n",
      "   ","\n",
      "   ","\n",
      "     Ответственное лицо банка     ____________________________   ","\n",
      "   ","\n",
      "   ","\n",
      "     *Требование об оформлении Паспорта сделки распространяется  на договора,", "\n",
      "     указанные в п. 5.1 Инструкции Банка России от 04.06.12 г. № 138-И, при условии","\n",
      "     равенства или превышения суммы обязательств  по таким договорам эквивалента 50 000 долларов США.","\n",
      "\n",
      "                             ┌──────────────────────────────────────────┐\n", //TAM 08.11.2012 R-118400-3
      "                             │                  ПОДПИСАНО               │\n",
      "                             │",bank_name,"│\n",
      "                             └──────────────────────────────────────────┘",
      "\n");
   return text;

END;
