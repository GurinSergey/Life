/*********************************************************************/
/*  Проставление балансовых символов для Ф. 202                      */
/*  Коркин Иван                                                      */
/*  25.10.2010                                 	                    */
/*  Реализовано по заявке I-006781.                                  */
/*  Автоматическое заполнение балансовых символов                    */
/*  для проводок у которых они отсутствуют                           */
/*  для расчета формы 0409202.	                                  */
// KS 12.12.2013 Адаптация пользовательских доработок под 31ю сборку
/*********************************************************************/

import rsbdataset, bankinter, globals, календарь;

var beginDate, endDate;

const  KEY_F1      =315;
const  KEY_F2      =316;
const  KEY_F3      =317;
const KEY_ESC      = 27;
const KEY_SPACE    = 32;
const KEY_ENTER    = 13;

var Fulloutputl, outl, outputl="addsymbfor202blnc.lbr";                    
GetRegistryValue("BANK_INI\\ОБЩИЕ ПАРАМЕТРЫ\\ДИРЕКТОРИИ\\LBRDIR",2,outl);
Fulloutputl = FindPath(outputl, outl);
if (not Fulloutputl)
	msgbox("Не найдена LBR");
	exit();
end;

var dlg = TRecHandler("dates", fulloutputl, TRUE); 


private macro printHead()
   [
			             Протокол проставления балансовых символов для Ф. 202
	]
end;

private macro printNameTableYes()
	[                             
	                                             Проставлены символа
	]
end; 

private macro printNameTableNo()
	[                           
	                                           Не удалось проставить символа
	]
end; 

private macro printHeadTable()
	 
   [        ┌──────┬─────────────┬──────┬────────────────────┬────────────────────┬───────────────┬───────┐
            │№ док.│    Дата     │Символ│     Счет Дт.       │     Счет Кт.       │     Сумма     │  Опер.│
            ├──────┼─────────────┼──────┼────────────────────┼────────────────────┼───────────────┼───────┤]
    
end;

private macro printLine(par1, par2, par3, par4, par5, par6, par7)	
	[        │######│#############│######│####################│####################│###############│#######│
	](par1, date(par2), par3, par4, par5, par6, par7);	
end;

private macro printSeparator()
	[        ├──────┼─────────────┼──────┼────────────────────┼────────────────────┼───────────────┼───────┤]
end;


private macro getPartName(code)
	var query, data;
   query = "select PARTY.T_NAME from ddp_dep_dbt dp_dep, dparty_dbt party"
   + "\n" +"where DP_DEP.T_PARTYID = PARTY.T_PARTYID"
   + "\n" +"AND DP_DEP.T_CODE = " + code
   + "\n" +"order by DP_DEP.T_NAME;";
   data = TRsbDataset(query);
   if (data.movenext)
   	return data.value("t_name");
  	else
  		return "Не найден";
   end;	
end; 


macro EvProc (rsrec, cmd, id, key)
    if(( cmd == DLG_KEY ) and ( key == 13 ))
      return CM_SELECT;
    end;
end;


 /*Обработчик диалоговой панели ввода исходных данных для печати*/
MACRO Event (dlg, cmd, id, key) 

   var const_mess = " ~F3~ Выбор значения из списка ~F2~ Продолжить ~ESC~ Выход ",
   SQLQuery, SQLQuery1, rsrec, cmd1;

   /*Первоначальная инициализация полей*/
   if(cmd == DLG_INIT)
      dlg.rec.BeginDate = {curDate} - 1;
      dlg.rec.EndDate = {curDate} - 1;
      BeginDate  = dlg.rec.BeginDate;
      EndDate  = dlg.rec.EndDate;
      UpdateFields(dlg); 
   end;
   
   /*Установка подсказок в строке состояния*/
   if (cmd==DLG_SETFOCUS)
       message(const_mess);
   end;
   
   if (cmd == DLG_REMFOCUS)
     /*Проверка корректности дат отчета*/
      UpdateFields(dlg); 
   end;

   if (cmd == DLG_KEY)
     /*Выход из диалогового окна формирования отчета*/
     if (KEY == KEY_ESC)
       return exit(1);//CM_CANCEL;
     /*Выбор данных из списка*/
     elif ( KEY == KEY_F3)
        if (FldName(dlg,id) == "BeginDate")
          dlg.rec.BeginDate = GetDateByCalendar ({curDate}-1);
        end;
        if (FldName(dlg,id) == "EndDate")
          dlg.rec.EndDate = GetDateByCalendar ({curDate}-1);
        end;
     elif (( KEY == KEY_F2 ) or (KEY == KEY_ENTER))         //Проверки при вводе
        if ( dlg.rec.BeginDate > dlg.rec.EndDate )
                MsgBox("Дата начала периода должна быть меньше даты окончания");
                return CM_IGNORE;
        end;
        if (GetTrue(TRUE,"Сейчас будет выполнено проставление балансовых символов. Вы уверены?"))
           BeginDate  = dlg.rec.BeginDate;
           EndDate  = dlg.rec.EndDate;
           Return CM_SAVE;
        else
          return  CM_IGNORE;    
        end;

        BeginDate  = dlg.rec.BeginDate;
        EndDate  = dlg.rec.EndDate;
        Return CM_SAVE;
     end;
      else
           Return CM_IGNORE;
   end;
        
END;



macro addsymbol()
   var query, rs;

   query = "insert into dsymbcash_dbt  "
   + "\n" + "(t_dockind, t_kind, t_applicationkey, t_symbol, t_sum, t_date, t_recid, t_reserved, t_acctrnid)"
   + "\n" + "select 1, t_kind, null, ' ' || t_symbol, t_sum, t_date_carry, 0, chr(1), t_acctrnid  "
   + "\n" + "from ( "
   + "\n" + "        SELECT   t_date_carry, "
   + "\n" + "           t_numb_document, "
   + "\n" + "           TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) t_shv, "
   + "\n" + "           t_account_payer, "
   + "\n" + "           t_account_receiver, "
   + "\n" + "           t_acctrnid, "
   + "\n" + "           t_sum_natcur t_sum, "
   + "\n" + "           case "
   + "\n" + "/*new 02092010*/        /* Дт 20202  Кт 40911*/ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '40911810' "
   + "\n" + "                then '11' "
   + "\n" + "            /* Дт 20202 Кт 60309 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '60309810' "
   + "\n" + "                then '12' "
   + "\n" + "            /* Дт 20202  Кт 42301(42601) */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and (substr(t_account_receiver, 1, 8) = '42301810' or substr(t_account_receiver, 1, 8) = '42601810') "
   + "\n" + "                then '16' "
   + "\n" + "            /* Дт касса РУБЛИ Кт касса ВАЛЮТА */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and (substr(t_account_receiver, 1, 5) = '20202' or substr(t_account_receiver, 1, 5) = '20207') and substr(t_account_receiver, 5, 3) != '810'   "
   + "\n" + "                then '30' "
   + "\n" + "            /* Дт 20202 Кт 70601 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '70601810' "
   + "\n" + "                then '32' "
   + "\n" + "            /* Дт 20202  Кт 47422*760164 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and t_account_receiver like '47422810%760164' "
   + "\n" + "                then '23' "
   + "\n" + "            /* Дт 42301(42601) Кт20202 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '03/3' and (substr(t_account_payer, 1, 8) = '42301810' or substr(t_account_payer, 1, 8) = '42601810') and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810') "
   + "\n" + "                then '55' "
   + "\n" + "            /* Дт касса ВАЛЮТА Кт касса РУБЛИ */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '03/3' and (substr(t_account_payer, 1, 5) = '20202' or substr(t_account_payer, 1, 5) = '20207') and substr(t_account_payer, 5, 3) != '810' and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810')   "
   + "\n" + "                then '57' "
   + "\n" + "          /* Дт 47423  Кт 20202 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '03/3' and substr(t_account_payer, 1, 8) = '47423810' and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810') "
   + "\n" + "                then '62'                 "
   + "\n" + "/*end new*/             "
   + "\n" + "            /* Дт 20202  Кт 40911 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '40911810' "
   + "\n" + "                then '11' "
   + "\n" + "            /* Дт 20202 Кт 60309 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '60309810' "
   + "\n" + "                then '12' "
   + "\n" + "            /* Дт 20202  Кт 42301(42601) */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and (substr(t_account_receiver, 1, 8) = '42301810' or substr(t_account_receiver, 1, 8) = '42601810') "
   + "\n" + "                then '16' "
   + "\n" + "            /* Дт касса РУБЛИ Кт касса ВАЛЮТА */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and (substr(t_account_receiver, 1, 5) = '20202' or substr(t_account_receiver, 1, 5) = '20207') and substr(t_account_receiver, 5, 3) != '810'   "
   + "\n" + "                then '30' "
   + "\n" + "            /* Дт 20202 Кт 70601 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '70601810' "
   + "\n" + "                then '32' "
   + "\n" + "            /* Дт 20202  Кт 40802 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '40802810' "
   + "\n" + "                then '19' "
   + "\n" + "            /* Дт 20202  Кт 47422*760164 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and t_account_receiver like '47422810%760164' "
   + "\n" + "                then '23' "
   + "\n" + "            /* Дт 42301(42601) Кт20202 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '42301810' or substr(t_account_payer, 1, 8) = '42601810') and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810') "
   + "\n" + "                then '55' "
   + "\n" + "            /* Дт касса ВАЛЮТА Кт касса РУБЛИ */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 5) = '20202' or substr(t_account_payer, 1, 5) = '20207') and substr(t_account_payer, 5, 3) != '810' and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810')   "
   + "\n" + "                then '57' "
   + "\n" + "            /* Дт 40802  Кт 20202 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '03/3' and substr(t_account_payer, 1, 8) = '40802810' and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810') "
   + "\n" + "                then '58' "
   + "\n" + "            /* Дт 47423  Кт 20202 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and substr(t_account_payer, 1, 8) = '47423810' and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810') "
   + "\n" + "                then '62'                 "
   + "\n" + "            else '' "
   + "\n" + "           end as t_symbol, /*('11', '12', '16', '32', '19', '55', '30', '57', '62', '58')*/ "
   + "\n" + "           case  "
   + "\n" + "/*new 02092010*/            /* Дт 20202  Кт 40911 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '40911810' "
   + "\n" + "                then '1' "
   + "\n" + "            /* Дт 20202 Кт 60309 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '60309810' "
   + "\n" + "                then '1' "
   + "\n" + "            /* Дт 20202  Кт 42301(42601) */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and (substr(t_account_receiver, 1, 8) = '42301810' or substr(t_account_receiver, 1, 8) = '42601810') "
   + "\n" + "                then '1' "
   + "\n" + "            /* Дт касса РУБЛИ Кт касса ВАЛЮТА */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and (substr(t_account_receiver, 1, 5) = '20202' or substr(t_account_receiver, 1, 5) = '20207') and substr(t_account_receiver, 5, 3) != '810'   "
   + "\n" + "                then '1' "
   + "\n" + "            /* Дт 20202 Кт 70601 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '70601810' "
   + "\n" + "                then '1' "
   + "\n" + "            /* Дт 20202  Кт 47422*760164 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and t_account_receiver like '47422810%760164' "
   + "\n" + "                then '1'                 "
   + "\n" + "            /* Дт 42301(42601) Кт20202 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '03/3' and (substr(t_account_payer, 1, 8) = '42301810' or substr(t_account_payer, 1, 8) = '42601810') and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810') "
   + "\n" + "                then '2' "
   + "\n" + "            /* Дт касса ВАЛЮТА Кт касса РУБЛИ */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '03/3' and (substr(t_account_payer, 1, 5) = '20202' or substr(t_account_payer, 1, 5) = '20207') and substr(t_account_payer, 5, 3) != '810' and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810')   "
   + "\n" + "                then '2' "
   + "\n" + "          /* Дт 47423  Кт 20202 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '03/3' and substr(t_account_payer, 1, 8) = '47423810' and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810') "
   + "\n" + "                then '2'                "
   + "\n" + "/* end new*/            "
   + "\n" + "            /* Дт 20202  Кт 40911 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '40911810' "
   + "\n" + "                then '1' "
   + "\n" + "            /* Дт 20202 Кт 60309 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '60309810' "
   + "\n" + "                then '1' "
   + "\n" + "            /* Дт 20202  Кт 42301(42601) */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and (substr(t_account_receiver, 1, 8) = '42301810' or substr(t_account_receiver, 1, 8) = '42601810') "
   + "\n" + "                then '1' "
   + "\n" + "            /* Дт касса РУБЛИ Кт касса ВАЛЮТА */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and (substr(t_account_receiver, 1, 5) = '20202' or substr(t_account_receiver, 1, 5) = '20207') and substr(t_account_receiver, 5, 3) != '810'   "
   + "\n" + "                then '1' "
   + "\n" + "            /* Дт 20202 Кт 70601 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '70601810' "
   + "\n" + "                then '1' "
   + "\n" + "            /* Дт 20202  Кт 40802 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '40802810' "
   + "\n" + "                then '1' "
   + "\n" + "            /* Дт 20202  Кт 47422*760164 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and t_account_receiver like '47422810%760164' "
   + "\n" + "                then '1'                 "
   + "\n" + "            /* Дт 42301(42601) Кт20202 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '42301810' or substr(t_account_payer, 1, 8) = '42601810') and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810') "
   + "\n" + "                then '2' "
   + "\n" + "            /* Дт касса ВАЛЮТА Кт касса РУБЛИ */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 5) = '20202' or substr(t_account_payer, 1, 5) = '20207') and substr(t_account_payer, 5, 3) != '810' and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810')   "
   + "\n" + "                then '2' "
   + "\n" + "            /* Дт 40802  Кт 20202 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '03/3' and substr(t_account_payer, 1, 8) = '40802810' and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810') "
   + "\n" + "                then '2' "
   + "\n" + "            /* Дт 47423  Кт 20202 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and substr(t_account_payer, 1, 8) = '47423810' and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810') "
   + "\n" + "                then '2'                 "
   + "\n" + "           end as t_kind, /*('11', '12', '16', '32', '19', '55', '30', '57', '62', '58')*/            "
   + "\n" + "           t_ground "
   + "\n" + "    FROM   dacctrn_dbt arhdoc "
   + "\n" + "   WHERE       t_fiid_payer = 0 and t_fiid_receiver = 0 "
   + "\n" + "           AND t_date_carry >= TO_DATE ('" + beginDate + "', 'DD-MM-YYYY') "
   + "\n" + "           AND t_date_carry <= TO_DATE ('" + endDate + "', 'DD-MM-YYYY') "
   + "\n" + "           AND t_result_carry != 23 "
   + "\n" + "           AND (   (t_account_payer LIKE '20202810%') "
   + "\n" + "                OR (t_account_receiver LIKE '20202810%') "
   + "\n" + "                OR (t_account_payer LIKE '20206810%') "
   + "\n" + "                OR (t_account_receiver LIKE '20206810%') "
   + "\n" + "                OR (t_account_payer LIKE '20207810%') "
   + "\n" + "                OR (t_account_receiver LIKE '20207810%')) "
   + "\n" + "           AND NOT ( (t_account_payer LIKE '20202810%') "
   + "\n" + "                    AND (t_account_receiver LIKE '20202810%')) "
   + "\n" + "           AND NOT EXISTS "
   + "\n" + "                 (SELECT   1 "
   + "\n" + "                    FROM   dsymbcash_dbt dcash "
   + "\n" + "                   WHERE   dcash.t_acctrnid(+) = arhdoc.t_acctrnid) "
   + "\n" + "ORDER BY   arhdoc.t_date_carry) "
   + "\n" + "where t_symbol in ('11', '12', '16', '32', '19', '23', '55', '30', '57', '62', '58') ";

   rs = rsdcommand(query);
   if(rs)
      rs.execute;
      rs = rsdcommand("commit");
      rs.execute;
      return true;
   else 
      return false;
   end;
end;


macro calculate()
   var query, data, query_count, datacount, branch_sql, first, query1;
   printHead();
   /* Cимволы которые проставятся */
   query = "select *  "
   + "\n" + "from ( "
   + "\n" + "        SELECT    "
   + "\n" + "           t_numb_document, t_date_carry,"
   + "\n" + "           case "
   + "\n" + "/*new 02092010*/        /* Дт 20202  Кт 40911*/ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '40911810' "
   + "\n" + "                then '11' "
   + "\n" + "            /* Дт 20202 Кт 60309 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '60309810' "
   + "\n" + "                then '12' "
   + "\n" + "            /* Дт 20202  Кт 42301(42601) */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and (substr(t_account_receiver, 1, 8) = '42301810' or substr(t_account_receiver, 1, 8) = '42601810') "
   + "\n" + "                then '16' "
   + "\n" + "            /* Дт касса РУБЛИ Кт касса ВАЛЮТА */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and (substr(t_account_receiver, 1, 5) = '20202' or substr(t_account_receiver, 1, 5) = '20207') and substr(t_account_receiver, 5, 3) != '810'   "
   + "\n" + "                then '30' "
   + "\n" + "            /* Дт 20202 Кт 70601 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '70601810' "
   + "\n" + "                then '32' "
   + "\n" + "            /* Дт 20202  Кт 47422*760164 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and t_account_receiver like '47422810%760164' "
   + "\n" + "                then '23' "
   + "\n" + "            /* Дт 42301(42601) Кт20202 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '03/3' and (substr(t_account_payer, 1, 8) = '42301810' or substr(t_account_payer, 1, 8) = '42601810') and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810') "
   + "\n" + "                then '55' "
   + "\n" + "            /* Дт касса ВАЛЮТА Кт касса РУБЛИ */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '03/3' and (substr(t_account_payer, 1, 5) = '20202' or substr(t_account_payer, 1, 5) = '20207') and substr(t_account_payer, 5, 3) != '810' and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810')   "
   + "\n" + "                then '57' "
   + "\n" + "          /* Дт 47423  Кт 20202 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '03/3' and substr(t_account_payer, 1, 8) = '47423810' and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810') "
   + "\n" + "                then '62'                 "
   + "\n" + "/*end new*/             "
   + "\n" + "            /* Дт 20202  Кт 40911 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '40911810' "
   + "\n" + "                then '11' "
   + "\n" + "            /* Дт 20202 Кт 60309 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '60309810' "
   + "\n" + "                then '12' "
   + "\n" + "            /* Дт 20202  Кт 42301(42601) */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and (substr(t_account_receiver, 1, 8) = '42301810' or substr(t_account_receiver, 1, 8) = '42601810') "
   + "\n" + "                then '16' "
   + "\n" + "            /* Дт касса РУБЛИ Кт касса ВАЛЮТА */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and (substr(t_account_receiver, 1, 5) = '20202' or substr(t_account_receiver, 1, 5) = '20207') and substr(t_account_receiver, 5, 3) != '810'   "
   + "\n" + "                then '30' "
   + "\n" + "            /* Дт 20202 Кт 70601 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '70601810' "
   + "\n" + "                then '32' "
   + "\n" + "            /* Дт 20202  Кт 40802 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '40802810' "
   + "\n" + "                then '19' "
   + "\n" + "            /* Дт 20202  Кт 47422*760164 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and t_account_receiver like '47422810%760164' "
   + "\n" + "                then '23' "
   + "\n" + "            /* Дт 42301(42601) Кт20202 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '42301810' or substr(t_account_payer, 1, 8) = '42601810') and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810') "
   + "\n" + "                then '55' "
   + "\n" + "            /* Дт касса ВАЛЮТА Кт касса РУБЛИ */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 5) = '20202' or substr(t_account_payer, 1, 5) = '20207') and substr(t_account_payer, 5, 3) != '810' and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810')   "
   + "\n" + "                then '57' "
   + "\n" + "            /* Дт 40802  Кт 20202 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '03/3' and substr(t_account_payer, 1, 8) = '40802810' and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810') "
   + "\n" + "                then '58' "
   + "\n" + "            /* Дт 47423  Кт 20202 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and substr(t_account_payer, 1, 8) = '47423810' and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810') "
   + "\n" + "                then '62'                 "
   + "\n" + "            else '' "
   + "\n" + "           end as t_symbol, /*('11', '12', '16', '32', '19', '55', '30', '57', '62', '58')*/ "
   + "\n" + "           t_account_payer, "
   + "\n" + "           t_account_receiver, "
   + "\n" + "           t_sum_natcur t_sum, "
   + "\n" + "           t_oper "
   + "\n" + "    FROM   dacctrn_dbt arhdoc "
   + "\n" + "   WHERE       t_fiid_payer = 0 and t_fiid_receiver = 0 "
   + "\n" + "           AND t_date_carry >= TO_DATE ('" + beginDate + "', 'DD-MM-YYYY') "
   + "\n" + "           AND t_date_carry <= TO_DATE ('" + endDate + "', 'DD-MM-YYYY') "
   + "\n" + "           AND t_result_carry != 23 "
   + "\n" + "           AND (   (t_account_payer LIKE '20202810%') "
   + "\n" + "                OR (t_account_receiver LIKE '20202810%') "
   + "\n" + "                OR (t_account_payer LIKE '20206810%') "
   + "\n" + "                OR (t_account_receiver LIKE '20206810%') "
   + "\n" + "                OR (t_account_payer LIKE '20207810%') "
   + "\n" + "                OR (t_account_receiver LIKE '20207810%')) "
   + "\n" + "           AND NOT ( (t_account_payer LIKE '20202810%') "
   + "\n" + "                    AND (t_account_receiver LIKE '20202810%')) "
   + "\n" + "           AND NOT EXISTS "
   + "\n" + "                 (SELECT   1 "
   + "\n" + "                    FROM   dsymbcash_dbt dcash "
   + "\n" + "                   WHERE   dcash.t_acctrnid(+) = arhdoc.t_acctrnid ) "
   + "\n" + "ORDER BY   arhdoc.t_date_carry) "
   + "\n" + "where t_symbol in ('11', '12', '16', '32', '19', '23', '55', '30', '57', '62', '58') ";

   data = TRsbDataset(query);
   first = true;
   while (data.movenext)
   	if (first)
   		if (not addsymbol())
   			println("Ошибка выполнения запроса символы проставить не удалось");
   		end;
   		printNameTableYes();
  			printHeadTable();
  			first = false; 
   	end;
   	printLine(data.value(0), data.value(1), data.value(2), data.value(3), data.value(4), data.value(5), data.value(6));
   	printSeparator();
   end;
   if (first)
		println("Символа проставлены не были.");
	end;   
   /* Не удалось проставить*/
   query = " select t_numb_document, t_date_carry,"
   + "\n" + "t_account_payer, t_account_receiver, t_sum_natcur t_sum, t_oper"
   + "\n" + "from  dacctrn_dbt arhdoc                                                                                     "
   + "\n" + "where t_fiid_payer = 0 and t_fiid_receiver = 0 "
   + "\n" + "  and t_date_carry >= to_date ( '" + beginDate + "', 'DD.MM.YYYY' ) and                                              "
   + "\n" + "      t_date_carry <= to_date ( '" + endDate + "', 'DD.MM.YYYY' ) and                                              "
   + "\n" + "t_result_carry!=23 and                                                                                       "
   + "\n" + "((t_account_payer like '20202810%') or (t_account_receiver like '20202810%') or                              "
   + "\n" + "(t_account_payer like '20206810%') or (t_account_receiver like '20206810%') or                              "
   + "\n" + "(t_account_payer like '20207810%') or (t_account_receiver like '20207810%'))                               "
   + "\n" + "and not ((t_account_payer like '20202810%') and (t_account_receiver like '20202810%'))                               "
   + "\n" + "        and not exists                                                                                       "
   + "\n" + "             (select 1                                                                                       "
   + "\n" + "              from dsymbcash_dbt dcash                                                                       "
   + "\n" + "              where dcash.t_acctrnid(+) = arhdoc.t_acctrnid) "
   + "\n" + "minus "
   + "\n" + "select t_numb_document, t_date_carry, "
   + "\n" + "t_account_payer, t_account_receiver, t_sum, t_oper"
   + "\n" + "from ( "
   + "\n" + "        SELECT    "
   + "\n" + "           t_numb_document, t_date_carry,"
   + "\n" + "           case "
   + "\n" + "/*new 02092010*/        /* Дт 20202  Кт 40911*/ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '40911810' "
   + "\n" + "                then '11' "
   + "\n" + "            /* Дт 20202 Кт 60309 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '60309810' "
   + "\n" + "                then '12' "
   + "\n" + "            /* Дт 20202  Кт 42301(42601) */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and (substr(t_account_receiver, 1, 8) = '42301810' or substr(t_account_receiver, 1, 8) = '42601810') "
   + "\n" + "                then '16' "
   + "\n" + "            /* Дт касса РУБЛИ Кт касса ВАЛЮТА */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and (substr(t_account_receiver, 1, 5) = '20202' or substr(t_account_receiver, 1, 5) = '20207') and substr(t_account_receiver, 5, 3) != '810'   "
   + "\n" + "                then '30' "
   + "\n" + "            /* Дт 20202 Кт 70601 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '70601810' "
   + "\n" + "                then '32' "
   + "\n" + "            /* Дт 20202  Кт 47422*760164 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and t_account_receiver like '47422810%760164' "
   + "\n" + "                then '23' "
   + "\n" + "            /* Дт 42301(42601) Кт20202 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '03/3' and (substr(t_account_payer, 1, 8) = '42301810' or substr(t_account_payer, 1, 8) = '42601810') and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810') "
   + "\n" + "                then '55' "
   + "\n" + "            /* Дт касса ВАЛЮТА Кт касса РУБЛИ */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '03/3' and (substr(t_account_payer, 1, 5) = '20202' or substr(t_account_payer, 1, 5) = '20207') and substr(t_account_payer, 5, 3) != '810' and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810')   "
   + "\n" + "                then '57' "
   + "\n" + "          /* Дт 47423  Кт 20202 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '03/3' and substr(t_account_payer, 1, 8) = '47423810' and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810') "
   + "\n" + "                then '62'                 "
   + "\n" + "/*end new*/             "
   + "\n" + "            /* Дт 20202  Кт 40911 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '40911810' "
   + "\n" + "                then '11' "
   + "\n" + "            /* Дт 20202 Кт 60309 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '60309810' "
   + "\n" + "                then '12' "
   + "\n" + "            /* Дт 20202  Кт 42301(42601) */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and (substr(t_account_receiver, 1, 8) = '42301810' or substr(t_account_receiver, 1, 8) = '42601810') "
   + "\n" + "                then '16' "
   + "\n" + "            /* Дт касса РУБЛИ Кт касса ВАЛЮТА */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and (substr(t_account_receiver, 1, 5) = '20202' or substr(t_account_receiver, 1, 5) = '20207') and substr(t_account_receiver, 5, 3) != '810'   "
   + "\n" + "                then '30' "
   + "\n" + "            /* Дт 20202 Кт 70601 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '70601810' "
   + "\n" + "                then '32' "
   + "\n" + "            /* Дт 20202  Кт 40802 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '04/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and substr(t_account_receiver, 1, 8) = '40802810' "
   + "\n" + "                then '19' "
   + "\n" + "            /* Дт 20202  Кт 47422*760164 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '20202810' or substr(t_account_payer, 1, 8) = '20207810') and t_account_receiver like '47422810%760164' "
   + "\n" + "                then '23' "
   + "\n" + "            /* Дт 42301(42601) Кт20202 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 8) = '42301810' or substr(t_account_payer, 1, 8) = '42601810') and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810') "
   + "\n" + "                then '55' "
   + "\n" + "            /* Дт касса ВАЛЮТА Кт касса РУБЛИ */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and (substr(t_account_payer, 1, 5) = '20202' or substr(t_account_payer, 1, 5) = '20207') and substr(t_account_payer, 5, 3) != '810' and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810')   "
   + "\n" + "                then '57' "
   + "\n" + "            /* Дт 40802  Кт 20202 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '03/3' and substr(t_account_payer, 1, 8) = '40802810' and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810') "
   + "\n" + "                then '58' "
   + "\n" + "            /* Дт 47423  Кт 20202 */ "
   + "\n" + "            when TO_CHAR (t_shifr_oper || '/' || SUBSTR (t_kind_oper, 2, 1)) = '09/3' and substr(t_account_payer, 1, 8) = '47423810' and (substr(t_account_receiver, 1, 8) = '20202810' or substr(t_account_receiver, 1, 8) = '20207810') "
   + "\n" + "                then '62'                 "
   + "\n" + "            else '' "
   + "\n" + "           end as t_symbol, /*('11', '12', '16', '32', '19', '55', '30', '57', '62', '58')*/ "
   + "\n" + "           t_account_payer, "
   + "\n" + "           t_account_receiver, "
   + "\n" + "           t_sum_natcur t_sum, "
   + "\n" + "           t_oper "
   + "\n" + "    FROM   dacctrn_dbt arhdoc "
   + "\n" + "   WHERE       t_fiid_payer = 0 and t_fiid_receiver = 0 "
   + "\n" + "           AND t_date_carry >= TO_DATE ('" + beginDate + "', 'DD-MM-YYYY') "
   + "\n" + "           AND t_date_carry <= TO_DATE ('" + endDate + "', 'DD-MM-YYYY') "
   + "\n" + "           AND t_result_carry != 23 "
   + "\n" + "           AND (   (t_account_payer LIKE '20202810%') "
   + "\n" + "                OR (t_account_receiver LIKE '20202810%') "
   + "\n" + "                OR (t_account_payer LIKE '20206810%') "
   + "\n" + "                OR (t_account_receiver LIKE '20206810%') "
   + "\n" + "                OR (t_account_payer LIKE '20207810%') "
   + "\n" + "                OR (t_account_receiver LIKE '20207810%')) "
   + "\n" + "           AND NOT ( (t_account_payer LIKE '20202810%') "
   + "\n" + "                    AND (t_account_receiver LIKE '20202810%')) "
   + "\n" + "           AND NOT EXISTS "
   + "\n" + "                 (SELECT   1 "
   + "\n" + "                    FROM   dsymbcash_dbt dcash "
   + "\n" + "                   WHERE   dcash.t_acctrnid(+) = arhdoc.t_acctrnid) "
   + "\n" + "ORDER BY   arhdoc.t_date_carry) "
   + "\n" + "where t_symbol in ('11', '12', '16', '32', '19', '23', '55', '30', '57', '62', '58') ";
   data = TRsbDataset(query);
   first = true;
   while (data.movenext)
   	if (first)
   		printNameTableNo();
  			printHeadTable();
  			first = false; 
   	end;
   	printLine(data.value(0), data.value(1), "", data.value(2), data.value(3), data.value(4), data.value(5));
   	printSeparator();
   end;

end;

/*Точка входа в макрос*/
if (RunDialog(dlg, "Event"))                  
  calculate();
end; 

