/********************************************************************************************/
/*    Œ ªà®á ¯¥ç â¨ 101 ä®à¬ë                                                               */
/********************************************************************************************/
/* Modified                                                                                 */
/* 23.01.2013 GSP ¯® I-00309788-3 Š®àà¥ªâ¨à®¢ª  è¨à¨­ë ¯®«¥© ¤«ï ¯¥ç â¨ ¢ txt ä®à¬ â¥       */
/********************************************************************************************/

import BankInter,
       RsbDataSet,
       Š «¥­¤ àì,
       ReptCBInter,
       ReptCBCommon,
       cb_sql,
       rsexts,
       param,
       cy_find,
       chk_regd,
       exp_exl,
       lib_path,
       rcb_lib;

import exp_lib;
import rcbimport;

const RRG_OS =  0;
const RRG_OR =  1;
const RRG_OV =  2;
const RRG_IS =  3;
const RRG_IR =  4;
const RRG_IV =  5;
const RRG_DS =  6;
const RRG_DR =  7;
const RRG_DV =  8;
const RRG_CS =  9;
const RRG_CR = 10;
const RRG_CV = 11;

const RRG_F101_XOK      = 0;
const RRG_F101_XWarning = 1;
const RRG_F101_XError   = 2;

private const KA_A  = "€";
private const KA_P  = "";
private const KA_AP = "€";
private const KA_0  = "0";

private const FORM_NAME = " « ­á®¢ë¥ áç¥â ";
private const FORM_ID   =  ©â¨ˆ¤¥­â¨ä¨ª â®àâç¥â ® §¢ ­¨î( FORM_NAME );

private const PRK_ALL = 0;
private const PRK_BWP = 1;
private const PRK_NOZ = 2;
private const PRK_BEG = PRK_ALL;
private const PRK_END = PRK_NOZ;

private const PRINT_KIND_REGPATH      = "REPTREG/REP_GROUPS/BALANCE_ACCOUNTS/…—€’œ ”Œ› 101";
private const PRINT_COPECKS_REGPATH   = "REPTREG/REP_GROUPS/BALANCE_ACCOUNTS/…—€’œ ‚ Š…‰Š€•";
private const PRINT_EVERY_DAY_REGPATH = "REPTREG/REP_GROUPS/BALANCE_ACCOUNTS/…—€’œ ‡€ Š€†„›‰ „…œ …ˆ„€";

private const VF_MONEY  = "„";
private const VF_DOUBLE = "—";
private const VF_PERC   = "%";
private const VF_ITEM   = "˜";

CLASS RRG_F101_Error( p_XType : Integer, p_XMessage : String )

    var XType    = p_XType;
    var XMessage = p_XMessage;

END;

private var RRG_F101_X = RRG_F101_Error( RRG_F101_XOK, "" );

MACRO RRG_F101_XThrow( XType : Integer, XMessage : String )

    RRG_F101_X = RRG_F101_Error( XType, XMessage );

    RunError(XMessage);

END;

MACRO RRG_F101_XCatch(err)

    if   ( RRG_F101_X.XType == RRG_F101_XWarning )
        MsgBox( RRG_F101_X.XMessage );
    elif ( RRG_F101_X.XType == RRG_F101_XError   )
        MsgBox( RRG_F101_X.XMessage );
    else
        RunError();
    end;

    Exit(1);

END;

private
MACRO ZeroValue( Format )
    if (  áç¥â‚Š®¯¥©ª å )
        if   ( format == VF_MONEY  ) return Money ($0);
        elif ( format == VF_DOUBLE ) return Double(0.);
        elif ( format == VF_PERC   ) return Double(0.);
        elif ( format == VF_ITEM   ) return Int   (0);
        else
            RRG_F101_XThrow( RRG_F101_XError, String("¥¨§¢¥áâ­ë© ä®à¬ â ¯¥à¥¬¥­­®©: ",format) );
        end;
    else
        return RCB_FloorTerm(0.);
    end;
END;

CLASS RRG_F101_Balance( dataSet )

    private var m_Balance : String;
    private var m_BKind   : String;
    private var m_isAP    : Integer;
    private var m_Sums    : TArray;

    private var m_isWork  : Bool;
    private var m_isZero  : Bool;

    private var m_Format  : String;
    private var m_Zero;

    private var m_isSkip : Bool;

    private
    Macro getValue( dataSet, cname, varname, make_error )

        macro getMean( mean1 : Double, mean2 : Double )

           var value;

           if (m_Format == VF_MONEY)
               if (  áç¥â‚Š®¯¥©ª å )
                   value = Money(mean1);
               else
                   value = RCB_FloorTerm(mean2);
               end;
           else
               if   ( m_Format == VF_DOUBLE ) value = Double(mean1);
               elif ( m_Format == VF_PERC   ) value = Double(mean1);
               elif ( m_Format == VF_ITEM   ) value = Int   (mean1);
               else
                   RRG_F101_XThrow( RRG_F101_XError, String("¥¨§¢¥áâ­ë© ä®à¬ â ¯¥à¥¬¥­­®©: ", m_Format) );
               end;
           end;

           return value;
        end;

        if (m_isSkip)
            m_isZero = true;
            return 0;
        end;

        var iswrk  = dataSet.value(cname+"w") == 1;
        var mean1  = dataSet.value(cname+"1");
        var mean2  = dataSet.value(cname+"2");
        var value;

        if ( not iswrk )
            value = m_Zero;
        else
            m_isWork = true;

            if ( (mean1 == NULL) or (mean2 == NULL)  )
                if ( (not make_error) or (MeanUndefByZero != 0) )
                    value = m_Zero;
                else
                    RRG_F101_XThrow( RRG_F101_XError, String("¥ ­ ©¤¥­® §­ ç¥­¨¥ ¯¥à¥¬¥­­®© \"",varname,"\"") );
                end;
            else
                value = getMean( mean1, mean2 );
            end;
        end;

        if ( value != m_Zero )
            m_isZero = false;
        end;

        return value;
    End;

    private
    Macro Constructor( dataSet )

        macro setSums()
            if (m_isSkip)
                return;
            end;

            var cr = getValue( dataSet, "cr", String("­",m_Balance,"ãŠ"), true ),
                cp = getValue( dataSet, "cp", String("­",m_Balance,"®Š"), true ),
                cs = getValue( dataSet, "cs", String("­",m_Balance,"__Š"), true ),
                dr = getValue( dataSet, "dr", String("­",m_Balance,"ã„"), true ),
                dp = getValue( dataSet, "dp", String("­",m_Balance,"®„"), true ),
                ds = getValue( dataSet, "ds", String("­",m_Balance,"__„"), true ),
                ar = getValue( dataSet, "ar", String("­",m_Balance,"ã€"), m_isAP or (m_BKind == KA_A) ),
                ap = getValue( dataSet, "ap", String("­",m_Balance,"®€"), m_isAP or (m_BKind == KA_A) ),
                as = getValue( dataSet, "as", String("­",m_Balance,"__€"), m_isAP or (m_BKind == KA_A) ),
                pr = getValue( dataSet, "pr", String("­",m_Balance,"ã"), m_isAP or (m_BKind == KA_P) ),
                pp = getValue( dataSet, "pp", String("­",m_Balance,"®"), m_isAP or (m_BKind == KA_P) ),
                ps = getValue( dataSet, "ps", String("­",m_Balance,"__"), m_isAP or (m_BKind == KA_P) );

            m_Sums[RRG_CR] = cr;
            m_Sums[RRG_CV] = cp;
            m_Sums[RRG_CS] = cs;
            m_Sums[RRG_DR] = dr;
            m_Sums[RRG_DV] = dp;
            m_Sums[RRG_DS] = ds;

            if   ( m_BKind == KA_A )

                m_Sums[RRG_OR] = ar - pr;
                m_Sums[RRG_OV] = ap - pp;
                m_Sums[RRG_OS] = as - ps;

                m_Sums[RRG_IR] = m_Sums[RRG_OR] - m_Sums[RRG_DR] + m_Sums[RRG_CR];
                m_Sums[RRG_IV] = m_Sums[RRG_OV] - m_Sums[RRG_DV] + m_Sums[RRG_CV];
                m_Sums[RRG_IS] = m_Sums[RRG_OS] - m_Sums[RRG_DS] + m_Sums[RRG_CS];

            elif ( m_BKind == KA_P )

                m_Sums[RRG_OR] = pr - ar;
                m_Sums[RRG_OV] = pp - ap;
                m_Sums[RRG_OS] = ps - as;

                m_Sums[RRG_IR] = m_Sums[RRG_OR] + m_Sums[RRG_DR] - m_Sums[RRG_CR];
                m_Sums[RRG_IV] = m_Sums[RRG_OV] + m_Sums[RRG_DV] - m_Sums[RRG_CV];
                m_Sums[RRG_IS] = m_Sums[RRG_OS] + m_Sums[RRG_DS] - m_Sums[RRG_CS];

            end;
        end;

        macro setFormat()
            m_Format = NULL;

            if ( m_Format == NULL ) m_Format = dataSet.crf; end;
            if ( m_Format == NULL ) m_Format = dataSet.cpf; end;
            if ( m_Format == NULL ) m_Format = dataSet.csf; end;
            if ( m_Format == NULL ) m_Format = dataSet.drf; end;
            if ( m_Format == NULL ) m_Format = dataSet.dpf; end;
            if ( m_Format == NULL ) m_Format = dataSet.dsf; end;
            if ( m_Format == NULL ) m_Format = dataSet.arf; end;
            if ( m_Format == NULL ) m_Format = dataSet.apf; end;
            if ( m_Format == NULL ) m_Format = dataSet.asf; end;
            if ( m_Format == NULL ) m_Format = dataSet.prf; end;
            if ( m_Format == NULL ) m_Format = dataSet.ppf; end;
            if ( m_Format == NULL ) m_Format = dataSet.psf; end;

            if ( m_Format == NULL )
                m_isSkip = true;
                return;
//                RRG_F101_XThrow( RRG_F101_XError, "âáãâáâ¢ãîâ ¯¥à¥¬¥­­ë¥ ¤«ï ¡/á: " + m_Balance );
            end;

            m_Zero = ZeroValue(m_Format);
        end;

        m_isSkip = false;

        m_Balance = dataSet.balance;
        m_BKind   = dataSet.BKind;
        m_isAP    = dataSet.isAP;

        m_Sums    = TArray();

        m_isWork = false;
        m_isZero = true;

        setFormat();

        setSums();

    End;

    Macro Balance()
        return m_Balance;
    End;

    Macro Sums()
        return m_Sums;
    End;

    Macro isWork()
        return m_isWork;
    End;

    Macro isZero()
        return m_isZero;
    End;

    Macro isAP()
        return m_isAP;
    End;

    Constructor(dataSet);

END;

CLASS (RRG_F101_Balance) RRG_F1015_Balance( dataSet )

    initRRG_F101_Balance(dataSet);

    private var m_precision;
    private var m_multiplier;

    private
    Macro getValue( dataSet, cname, varname, make_error )

        if (m_isSkip)
            m_isZero = true;
            return 0;
        end;

        var iswrk  = dataSet.value(cname+"w") == 1;
        var mean2  = dataSet.value(cname+"2");
        var value;

        if ( not iswrk )
            value = m_Zero;
        else
            m_isWork = true;

            if (mean2 == NULL)
                if ( (not make_error) or (MeanUndefByZero != 0) )
                    value = m_Zero;
                else
                    RRG_F101_XThrow( RRG_F101_XError, String("¥ ­ ©¤¥­® §­ ç¥­¨¥ ¯¥à¥¬¥­­®© \"",varname,"\"") );
                end;
            else
                value = mean2/m_multiplier;
            end;
        end;

        if ( value != m_Zero )
            m_isZero = false;
        end;

        return value;
    End;


        private
    Macro Constructor( dataSet )

        macro setSums()
            if (m_isSkip)
                return;
            end;

            var cr = getValue( dataSet, "cr", String("­",m_Balance,"ãŠ"), true ),
                cp = getValue( dataSet, "cp", String("­",m_Balance,"®Š"), true ),
                cs = getValue( dataSet, "cs", String("­",m_Balance,"__Š"), true ),
                dr = getValue( dataSet, "dr", String("­",m_Balance,"ã„"), true ),
                dp = getValue( dataSet, "dp", String("­",m_Balance,"®„"), true ),
                ds = getValue( dataSet, "ds", String("­",m_Balance,"__„"), true ),
                ar = getValue( dataSet, "ar", String("­",m_Balance,"ã€"), m_isAP or (m_BKind == KA_A) ),
                ap = getValue( dataSet, "ap", String("­",m_Balance,"®€"), m_isAP or (m_BKind == KA_A) ),
                as = getValue( dataSet, "as", String("­",m_Balance,"__€"), m_isAP or (m_BKind == KA_A) ),
                pr = getValue( dataSet, "pr", String("­",m_Balance,"ã"), m_isAP or (m_BKind == KA_P) ),
                pp = getValue( dataSet, "pp", String("­",m_Balance,"®"), m_isAP or (m_BKind == KA_P) ),
                ps = getValue( dataSet, "ps", String("­",m_Balance,"__"), m_isAP or (m_BKind == KA_P) );

            m_Sums[RRG_CR] = cr;
            m_Sums[RRG_CV] = cp;
            m_Sums[RRG_CS] = cs;
            m_Sums[RRG_DR] = dr;
            m_Sums[RRG_DV] = dp;
            m_Sums[RRG_DS] = ds;

            if   ( m_BKind == KA_A )

                m_Sums[RRG_OR] = ar - pr;
                m_Sums[RRG_OV] = ap - pp;
                m_Sums[RRG_OS] = as - ps;

                m_Sums[RRG_IR] = m_Sums[RRG_OR] - m_Sums[RRG_DR] + m_Sums[RRG_CR];
                m_Sums[RRG_IV] = m_Sums[RRG_OV] - m_Sums[RRG_DV] + m_Sums[RRG_CV];
                m_Sums[RRG_IS] = m_Sums[RRG_OS] - m_Sums[RRG_DS] + m_Sums[RRG_CS];

            elif ( m_BKind == KA_P )

                m_Sums[RRG_OR] = pr - ar;
                m_Sums[RRG_OV] = pp - ap;
                m_Sums[RRG_OS] = ps - as;

                m_Sums[RRG_IR] = m_Sums[RRG_OR] + m_Sums[RRG_DR] - m_Sums[RRG_CR];
                m_Sums[RRG_IV] = m_Sums[RRG_OV] + m_Sums[RRG_DV] - m_Sums[RRG_CV];
                m_Sums[RRG_IS] = m_Sums[RRG_OS] + m_Sums[RRG_DS] - m_Sums[RRG_CS];

            end;
        end;

        macro setFormat()
            m_Format = NULL;

            if ( m_Format == NULL ) m_Format = dataSet.crf; end;
            if ( m_Format == NULL ) m_Format = dataSet.cpf; end;
            if ( m_Format == NULL ) m_Format = dataSet.csf; end;
            if ( m_Format == NULL ) m_Format = dataSet.drf; end;
            if ( m_Format == NULL ) m_Format = dataSet.dpf; end;
            if ( m_Format == NULL ) m_Format = dataSet.dsf; end;
            if ( m_Format == NULL ) m_Format = dataSet.arf; end;
            if ( m_Format == NULL ) m_Format = dataSet.apf; end;
            if ( m_Format == NULL ) m_Format = dataSet.asf; end;
            if ( m_Format == NULL ) m_Format = dataSet.prf; end;
            if ( m_Format == NULL ) m_Format = dataSet.ppf; end;
            if ( m_Format == NULL ) m_Format = dataSet.psf; end;

            if ( m_Format == NULL )
                m_isSkip = true;
                return;
//                RRG_F101_XThrow( RRG_F101_XError, "âáãâáâ¢ãîâ ¯¥à¥¬¥­­ë¥ ¤«ï ¡/á: " + m_Balance );
            end;

            if(m_precision == 0)
                m_Zero = Int   (0);
            else
                m_Zero = Double(0.);
            end;

        end;

        m_isSkip = false;

        getRegistryValue("REPTREG/REP_GROUPS/BALANCE_ACCOUNTS/’—‘’œ „‹Ÿ ƒ‹€‚› „", V_INTEGER,  m_precision, null);
        m_multiplier = rcbApplication.currentReport.multiplier;

        m_Balance = dataSet.balance;
        m_BKind   = dataSet.BKind;
        m_isAP    = dataSet.isAP;

        m_Sums = TArray();

        m_isWork = false;
        m_isZero = true;

        setFormat();

        setSums();

    End;
END;

CLASS RRG_F101_Protocol( p_NameFile )

    private var m_NameFile : String;

    private
    Macro Constructor(p_NameFile)
        m_NameFile = getTxtFileName(p_NameFile);

        SetOutPut( m_NameFile, false );
        SetOutPut( NULL,       true  );
    End;

    Macro NameFile()
        return m_NameFile;
    End;

    Macro PrintLine( Mess : String )
        SetOutPut(m_NameFile,true);
        PrintLn(Mess);
        SetOutPut(NULL,true);
    End;

    Macro View()
        file p() txt;

        if ( not Open(p,m_NameFile) )
            RRG_F101_XThrow( RRG_F101_XWarning, String("è¨¡ª  ®âªàëâ¨ï ä ©«  ¯à®â®ª®« :|",m_NameFile) );
        end;

        ViewFile(p);
    End;

    Constructor(p_NameFile);

END;

CLASS RRG_F101_Parm( p_Chapter : Integer )

    var Chapter   : Integer;
    var PrintKind : Integer;
    var EveryDay  : Bool;
    var PrintCop  : Bool;
    var Date1376  : Date;

    var BegDate   : Date;
    var EndDate   : Date;
    var Protocol  : RRG_F101_Protocol;
    var kindView  : Integer;

    private
    Macro initPrintKind()
        var type = V_UNDEF,
            err  = 0,
            val  = PRK_NOZ;

        PrintKind = PRK_NOZ;

        type = GetRegistryValue( PRINT_KIND_REGPATH, V_INTEGER, val, err );
        if ( (err == 0) and (type == V_INTEGER) )
            if ( (val >= PRK_BEG) and (val <= PRK_END) )
                PrintKind = val;
            end;
        end;
    End;

    private
    Macro initEveryDay()
        var type = V_UNDEF,
            err  = 0,
            val  = false;

        EveryDay = false;

        type = GetRegistryValue( PRINT_EVERY_DAY_REGPATH, V_BOOL, val, err );
        if ( (err == 0) and (type == V_BOOL) )
            EveryDay = val;
        end;
    End;

    private
    Macro initPrintCop()
        var type = V_UNDEF,
            err  = 0,
            val  = false;

        PrintCop = false;

        type = GetRegistryValue( PRINT_COPECKS_REGPATH, V_BOOL, val, err );
        if ( (err == 0) and (type == V_BOOL) )
            PrintCop = val;
        end;
    End;

    private
    Macro initDate1376()
        Date1376 = Date(1,4,2004);

        GetRegDate(Date1376,"„€’€_1376“");
        if ( Date1376 == date(0,0,0) )
            Date1376 = date(1,4,2004);
        end;
    End;

    private
    Macro initProtocol()
        Protocol = RRG_F101_Protocol("f101_log");
    End;

    private
    Macro initExcel()
        kindView = ee_user_select_xl();
    End;

    private
    Macro Constructor( p_Chapter )
        Chapter = p_Chapter;

        initPrintKind();
        initEveryDay();
        initPrintCop();
        initDate1376();
        initProtocol();
        initExcel();

        BegDate = à¥¤„ â âç¥â ;
        EndDate = „ â âç¥â ;
    End;

    Constructor(p_Chapter);

END;

CLASS RRG_F101_Itog( Parm : RRG_F101_Parm )

    private var m_Sums    : TArray;
    private var m_IsValid : Bool;

    private
    Macro Constructor( Parm )
        m_Sums    = TArray();
        m_IsValid = false;
        m_Sums[RRG_OR] = $0;
        m_Sums[RRG_OV] = $0;
        m_Sums[RRG_OS] = $0;
        m_Sums[RRG_IR] = $0;
        m_Sums[RRG_IV] = $0;
        m_Sums[RRG_IS] = $0;
        m_Sums[RRG_CR] = $0;
        m_Sums[RRG_CV] = $0;
        m_Sums[RRG_CS] = $0;
        m_Sums[RRG_DR] = $0;
        m_Sums[RRG_DV] = $0;
        m_Sums[RRG_DS] = $0;
    End;

    Macro Sums()
        return m_Sums;
    End;

    private
    Macro OpAdd( Sums : TArray )
        var i = 0;

        while( i < m_Sums.Size() )
            m_Sums[i] = m_Sums[i] + Sums[i];
            i = i + 1;
        end;

    End;

    private
    Macro OpSub( Sums : TArray )
        var i = 0;

        while( i < m_Sums.Size() )
            m_Sums[i] = m_Sums[i] - Sums[i];
            i = i + 1;
        end;

    End;

    Macro AddI( Itog : RRG_F101_Itog )
        OpAdd(Itog.Sums());
    End;

    Macro SubI( Itog : RRG_F101_Itog )
        OpSub(Itog.Sums());
    End;

    Macro AddB( Balance : RRG_F101_Balance )
        OpAdd(Balance.Sums());
    End;

    Macro SubB( Balance : RRG_F101_Balance )
        OpSub(Balance.Sums());
    End;

    Constructor(parm);

END;

private
MACRO NamePeriod( parm : RRG_F101_Parm )
    var Name = "";
    var m = 0,
        y = 0;

    if ( parm.EveryDay )
        Name = String( parm.EndDate:m:f );
    else
        DateSplit( parm.EndDate, NULL, m, y );

        if (  ª®¯¨â¥«ì­ë© )
            Name = String( "¯¥à¨®¤ á ", parm.BegDate:m:f, " ¯® ", parm.EndDate:m:f );
        else
            if   ( ‚¨¤¥à¨®¤  == ‚_ƒ®¤ )
                Name = String( y, " £.");
            elif ( ‚¨¤¥à¨®¤  == ‚_Š¢ àâ « )
                Name = String( (m-1)/3 + 1, " ª¢ àâ « ", y, " £.");
            elif ( ‚¨¤¥à¨®¤  == ‚_Œ¥áïæ )
                Name = String( MonName(m), " ", y, " £.");
            elif ( ‚¨¤¥à¨®¤  == ‚_„¥­ì )
                Name = String( „ â âç¥â :m:f );
            else
               Name = String( "¯¥à¨®¤ á ", à¥¤„ â âç¥â :m:f, " ¯® ", „ â âç¥â :m:f);
            end;
        end;
    end;

    return Name;
END;

CLASS Report101()

    private var m_EE_EXP_FILE_NAME   = "";
    private var m_EE_LOCAL_FILE_NAME = "";

    private
    Macro Constructor()
        m_EE_LOCAL_FILE_NAME = "pr_f101.exl";
        m_EE_EXP_FILE_NAME   = ReturnDirString("TEXTDIR","TXTFILE") + m_EE_LOCAL_FILE_NAME;
    End;

    macro getEE_EXP_FILE_NAME()
        return m_EE_EXP_FILE_NAME;
    end;

    macro getEE_LOCAL_FILE_NAME()
        return m_EE_LOCAL_FILE_NAME;
    end;

    Macro Pr( Value, Parm : RRG_F101_Parm )
        var str = String(Value);

        if (  áç¥â‚Š®¯¥©ª å and Parm.PrintCop )
            str = SubStr( str, 1, StrLen(str)-3 )+SubStr( str, StrLen(str)-1, 2 );
            if ( str == "000" )
                str = "0";
            end;
        elif ( not  áç¥â‚Š®¯¥©ª å )
            return Value;
        end;

        return str;
    End;

    Macro PrintChapterName( Parm : RRG_F101_Parm )
        var dataSet = TRsbDataSet("SELECT t_Symbol, t_Name FROM dobchaptr_dbt WHERE t_Chapter = " + Parm.Chapter);

        if ( not dataSet.moveNext() )
            RRG_F101_XThrow( RRG_F101_XError, String("¥ ­ ©¤¥­  £« ¢  á ­®¬¥à®¬ ",Parm.Chapter) );
        end;

        var ChapterStr = String( String(dataSet.Symbol, ".", dataSet.Name):172:c );

        ee_insert_ef_values( ChapterStr );
        [#]( ChapterStr );
    End;

    private macro printTableHead()

/*        [ÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÒÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÒÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿];
        [     ³                                         º                              ¡®à®âë §  ®âç¥â­ë© ¯¥à¨®¤                           º                                         ³];
        [®¬¥à³            ‚å®¤ïé¨¥ ®áâ âª¨             ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶            ˆáå®¤ïé¨¥ ®áâ âª¨            ³];
        [áç¥â ³                                         º               ¯® ¤¥¡¥âã                 ³               ¯® ªà¥¤¨âã                º                                         ³];     
        [¢â®- ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄ×ÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄ×ÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
        [à®£® ³     àã¡.    ³   ¨­.¢ «.,  ³    ¨â®£®    º     àã¡.    ³   ¨­.¢ «.,  ³    ¨â®£®    ³     àã¡.    ³   ¨­.¢ «.,  ³    ¨â®£®    º     àã¡.    ³   ¨­.¢ «.,  ³    ¨â®£®    ³];        23.01.2013 GSP ¯® I-00309788-3
        [¯®-  ³             ³    ¤à £.    ³             º             ³    ¤à £.    ³             ³             ³    ¤à £.    ³             º             ³    ¤à £.    ³             ³];
        [àï¤ª ³             ³   ¬¥â ««ë   ³             º             ³   ¬¥â ««ë   ³             ³             ³   ¬¥â ««ë   ³             º             ³   ¬¥â ««ë   ³             ³];
        [ÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄ×ÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄ×ÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
        [  1  ³      2      ³      3      ³      4      º      5      ³      6      ³      7      ³      8      ³      9      ³     10      º      11     ³     12      ³     13      ³];
        [ÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄĞÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄĞÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÙ];*/
        [ÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÒÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÒÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿];
        [     ³                                                      º                                         ¡®à®âë §  ®âç¥â­ë© ¯¥à¨®¤                                          º                                                      ³];
        [®¬¥à³                  ‚å®¤ïé¨¥ ®áâ âª¨                    ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶                  ˆáå®¤ïé¨¥ ®áâ âª¨                   ³];
        [áç¥â ³                                                      º                        ¯® ¤¥¡¥âã                     ³                    ¯® ªà¥¤¨âã                        º                                                      ³];
        [¢â®- ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ×ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ×ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
        [à®£® ³       àã¡.      ³     ¨­.¢ «.,    ³       ¨â®£®      º       àã¡.      ³     ¨­.¢ «.,    ³       ¨â®£®      ³       àã¡.      ³     ¨­.¢ «.,    ³      ¨â®£®       º       àã¡.      ³     ¨­.¢ «.,    ³       ¨â®£®      ³];
        [¯®-  ³                 ³      ¤à £.      ³                  º                 ³      ¤à £.      ³                  ³                 ³      ¤à £.      ³                  º                 ³      ¤à £.      ³                  ³];
        [àï¤ª ³                 ³     ¬¥â ««ë     ³                  º                 ³     ¬¥â ««ë     ³                  ³                 ³     ¬¥â ««ë     ³                  º                 ³     ¬¥â ««ë     ³                  ³];
        [ÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ×ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ×ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
        [  1  ³        2        ³        3        ³         4        º        5        ³        6        ³         7        ³        8        ³        9        ³       10         º        11       ³       12        ³        13        ³];
        [ÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄĞÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄĞÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ];
    end;

    Macro PrintHead( Parm : RRG_F101_Parm )

        var m_view;
        var kindPeriod;

        var objectFactoryInstance = RcbObjectFactoryBase();

        if (Parm.endDate >= RCB_I2742_DATE)
            m_view = RcbReportView("’€Ÿ ‚…„Œ‘’œ  ‘—…’€Œ “•ƒ€‹’…‘Šƒ “—…’€ Š…„ˆ’‰ ƒ€ˆ‡€–ˆˆ", "0409101", arrCreate(RCB_PK_QUARTER, RCB_PK_MONTH, RCB_PK_DAY), DATE_IN_PERIOD_FORMAT);
        elif (Parm.endDate >= RCB_I2332_DATE)
            m_view = RcbReportView("’€Ÿ ‚…„Œ‘’œ  ‘—…’€Œ “•ƒ€‹’…‘Šƒ “—…’€ Š…„ˆ’‰ ƒ€ˆ‡€–ˆˆ", "0409101", arrCreate(RCB_PK_MONTH, RCB_PK_DAY), DATE_IN_PERIOD_FORMAT);
        else
            m_view = RcbReportView("’€Ÿ ‚…„Œ‘’œ  ‘—…’€Œ “•ƒ€‹’…‘Šƒ “—…’€ Š…„ˆ’‰ ƒ€ˆ‡€–ˆˆ", "0409101", RCB_PK_MONTH, DATE_IN_PERIOD_FORMAT);
        end;

        m_view.setReportWidth(174);

        m_view.printLendingAgencyCodeZone();
        m_view.printNamesZone();

        if ( not ee_open_ef(true,m_EE_EXP_FILE_NAME) )
            RRG_F101_XThrow( RRG_F101_XError, String("è¨¡ª  ®âªàëâ¨ï ä ©«  ",m_EE_EXP_FILE_NAME) );
        end;

        if ( (Parm.EveryDay and (Parm.EndDate < Parm.Date1376)) or ((not Parm.EveryDay) and (Parm.EndDate < Parm.Date1376)) )
            ee_insert_cell_data( m_view.getLendingAgencyCodeZone().getOkato(), 10,   6 );
            ee_insert_cell_data( m_view.getLendingAgencyCodeZone().getOkpo(),  11,   6 );
        else
            ee_insert_cell_data( m_view.getLendingAgencyCodeZone().getOkato(),  9,   6 );
            ee_insert_cell_data( m_view.getLendingAgencyCodeZone().getOkpo(),  10,   6 );
            ee_insert_cell_data( m_view.getLendingAgencyCodeZone().getOgrn(),      11,   6 );
        end;

        ee_insert_cell_data( m_view.getLendingAgencyCodeZone().getRegistrationNumber(), 12, 6 );
        ee_insert_cell_data( m_view.getLendingAgencyCodeZone().getBic(),   13, 6 );  /* 18.10.2007 Malakhova 110424 - § ¬¥­¨«  {MFO_Bank} ­  rcbGetBic()*/

        ee_insert_cell_data( "§  " + NamePeriod(parm), 7, 11 );

        ee_insert_cell_data( m_view.getNamesZone().getLendingAgencyName() ,        10, 12 );
        ee_insert_cell_data( m_view.getNamesZone().getLendingAgencyPostalAdress(), 3,  13 );

        ee_insert_cell_data( m_view.getNamesZone().getOkudString(40),    13, 15 );
        ee_insert_cell_data( m_view.getNamesZone().getFormPeriodicity(), 13, 16 );

        if (  áç¥â‚Š®¯¥©ª å and Parm.PrintCop )
            ee_insert_cell_data( "ª®¯.",      13, 17 );
        elif (  áç¥â‚Š®¯¥©ª å )
            ee_insert_cell_data( "àã¡.",      13, 17 );
        else
            ee_insert_cell_data( "âëá. àã¡.", 13, 17 );
        end;

        ee_start_tbl;

        printTableHead();

    End;

    Macro PrintHeadActive( Parm : RRG_F101_Parm )
        ee_insert_ef_values( " €ªâ¨¢" );
        [ €ªâ¨¢                                                                                                                                                                        ];
    End;

    Macro PrintItogActive( Parm : RRG_F101_Parm, Itog : RRG_F101_Itog )
        ee_insert_ef_values( " " );
        ee_insert_ef_values( " ˆâ®£® ¯®  ªâ¨¢ã (¡ « ­á)" );
        ee_insert_ef_values( " ", Pr(Itog.Sums()[RRG_IR],Parm), Pr(Itog.Sums()[RRG_IV],Parm), Pr(Itog.Sums()[RRG_IS],Parm),
                                  Pr(Itog.Sums()[RRG_DR],Parm), Pr(Itog.Sums()[RRG_DV],Parm), Pr(Itog.Sums()[RRG_DS],Parm),
                                  Pr(Itog.Sums()[RRG_CR],Parm), Pr(Itog.Sums()[RRG_CV],Parm), Pr(Itog.Sums()[RRG_CS],Parm),
                                  Pr(Itog.Sums()[RRG_OR],Parm), Pr(Itog.Sums()[RRG_OV],Parm), Pr(Itog.Sums()[RRG_OS],Parm)
                           );
        ee_insert_ef_values( " " );

/*        [ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ]; 23.01.2013 GSP ¯® I-00309788-3 */  
        [ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ];
        [ ˆâ®£® ¯®  ªâ¨¢ã (¡ « ­á)                                                                                                                                                     ];
/*        [      ############# ############# ############# ############# ############# ############# ############# ############# ############# ############# ############# ############# ]*/
        [      ################# ################# ################## ################# ################# ################## ################# ################# ################## ################# ################# ##################]
        ( Pr(Itog.Sums()[RRG_IR],Parm):r:0:0, Pr(Itog.Sums()[RRG_IV],Parm):r:0:0, Pr(Itog.Sums()[RRG_IS],Parm):r:0:0,
          Pr(Itog.Sums()[RRG_DR],Parm):r:0:0, Pr(Itog.Sums()[RRG_DV],Parm):r:0:0, Pr(Itog.Sums()[RRG_DS],Parm):r:0:0,
          Pr(Itog.Sums()[RRG_CR],Parm):r:0:0, Pr(Itog.Sums()[RRG_CV],Parm):r:0:0, Pr(Itog.Sums()[RRG_CS],Parm):r:0:0,
          Pr(Itog.Sums()[RRG_OR],Parm):r:0:0, Pr(Itog.Sums()[RRG_OV],Parm):r:0:0, Pr(Itog.Sums()[RRG_OS],Parm):r:0:0
        );
/*        [ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ];*/
        [ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ];
    End;

    Macro PrintHeadPassive( Parm : RRG_F101_Parm )
        ee_insert_ef_values( "  áá¨¢" );
        [  áá¨¢                                                                                                                                                                       ];
    End;

    Macro PrintItogPassive( Parm : RRG_F101_Parm, Itog : RRG_F101_Itog )
        ee_insert_ef_values( " " );
        ee_insert_ef_values( " ˆâ®£® ¯® ¯ áá¨¢ã (¡ « ­á)" );
        ee_insert_ef_values( " ", Pr(Itog.Sums()[RRG_IR],Parm), Pr(Itog.Sums()[RRG_IV],Parm), Pr(Itog.Sums()[RRG_IS],Parm),
                                  Pr(Itog.Sums()[RRG_DR],Parm), Pr(Itog.Sums()[RRG_DV],Parm), Pr(Itog.Sums()[RRG_DS],Parm),
                                  Pr(Itog.Sums()[RRG_CR],Parm), Pr(Itog.Sums()[RRG_CV],Parm), Pr(Itog.Sums()[RRG_CS],Parm),
                                  Pr(Itog.Sums()[RRG_OR],Parm), Pr(Itog.Sums()[RRG_OV],Parm), Pr(Itog.Sums()[RRG_OS],Parm)
                           );
        ee_insert_ef_values( " " );

/*        [ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ]; 23.01.2013 GSP ¯® I-00309788-3 */
        [ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ];
        [ ˆâ®£® ¯® ¯ áá¨¢ã (¡ « ­á)                                                                                                                                                    ];
/*        [      ############# ############# ############# ############# ############# ############# ############# ############# ############# ############# ############# ############# ]*/
        [      ################# ################# ################## ################# ################# ################## ################# ################# ################## ################# ################# ##################]
        ( Pr(Itog.Sums()[RRG_IR],Parm):r:0:0, Pr(Itog.Sums()[RRG_IV],Parm):r:0:0, Pr(Itog.Sums()[RRG_IS],Parm):r:0:0,
          Pr(Itog.Sums()[RRG_DR],Parm):r:0:0, Pr(Itog.Sums()[RRG_DV],Parm):r:0:0, Pr(Itog.Sums()[RRG_DS],Parm):r:0:0,
          Pr(Itog.Sums()[RRG_CR],Parm):r:0:0, Pr(Itog.Sums()[RRG_CV],Parm):r:0:0, Pr(Itog.Sums()[RRG_CS],Parm):r:0:0,
          Pr(Itog.Sums()[RRG_OR],Parm):r:0:0, Pr(Itog.Sums()[RRG_OV],Parm):r:0:0, Pr(Itog.Sums()[RRG_OS],Parm):r:0:0
        );
/*        [ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ];*/
        [ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ];
    End;

    Macro PrintFoot( Parm : RRG_F101_Parm )
        ee_insert_ef_values( " " );
        ee_insert_ef_values( string( {Name_Boss}:35,   " ", {FIO_Boss}:40,  " (”.ˆ..)" ) );
        ee_insert_ef_values( string( {Name_Book}:35,   " ", {FIO_Book}:40,  " (”.ˆ..)" ) );
        ee_insert_ef_values( "Œ.." );
        ee_insert_ef_values( string( "ˆá¯®«­¨â¥«ì":35, " ", ˆá¯®«­¨â¥«ì:40, " (”.ˆ..)" ) );
        ee_insert_ef_values( string( "’¥«¥ä®­:":35,    " ", ’¥«¥ä®­ˆá¯®«­¨â¥«ï ) );
        ee_insert_ef_values( {curdate} );
        ee_end_tbl;
        ee_close_ef;

        [ ];
        [   #                                 ##################################      (”.ˆ..)]( {Name_Boss}:l, {FIO_Boss}:l );
        [   #                                 ##################################      (”.ˆ..)]( {Name_Book}:l, {FIO_Book}:l );
        [   Œ..                                                                              ];
        [   ˆá¯®«­¨â¥«ì                       ##################################      (”.ˆ..)]( ˆá¯®«­¨â¥«ì );
        [   ’¥«¥ä®­:                          #                                               ]( ’¥«¥ä®­ˆá¯®«­¨â¥«ï:l );
        [   #                                                                                 ]( {curdate}:l );
        [ ];
    End;

    Macro ProcessBalance( Balance : RRG_F101_Balance, Parm : RRG_F101_Parm )

        ee_insert_ef_values( balance.Balance(), Pr(Balance.Sums()[RRG_IR],Parm), Pr(Balance.Sums()[RRG_IV],Parm), Pr(Balance.Sums()[RRG_IS],Parm),
                                                Pr(Balance.Sums()[RRG_DR],Parm), Pr(Balance.Sums()[RRG_DV],Parm), Pr(Balance.Sums()[RRG_DS],Parm),
                                                Pr(Balance.Sums()[RRG_CR],Parm), Pr(Balance.Sums()[RRG_CV],Parm), Pr(Balance.Sums()[RRG_CS],Parm),
                                                Pr(Balance.Sums()[RRG_OR],Parm), Pr(Balance.Sums()[RRG_OV],Parm), Pr(Balance.Sums()[RRG_OS],Parm)
                           );

/*        [##### ############# ############# ############# ############# ############# ############# ############# ############# ############# ############# ############# ############# ] 23.01.2013 GSP ¯® I-00309788-3 */
        [##### ################# ################# ################## ################# ################# ################## ################# ################# ################## ################# ################# ##################]
        ( balance.Balance(), Pr(Balance.Sums()[RRG_IR],Parm):r:0:0, Pr(Balance.Sums()[RRG_IV],Parm):r:0:0, Pr(Balance.Sums()[RRG_IS],Parm):r:0:0,
                             Pr(Balance.Sums()[RRG_DR],Parm):r:0:0, Pr(Balance.Sums()[RRG_DV],Parm):r:0:0, Pr(Balance.Sums()[RRG_DS],Parm):r:0:0,
                             Pr(Balance.Sums()[RRG_CR],Parm):r:0:0, Pr(Balance.Sums()[RRG_CV],Parm):r:0:0, Pr(Balance.Sums()[RRG_CS],Parm):r:0:0,
                             Pr(Balance.Sums()[RRG_OR],Parm):r:0:0, Pr(Balance.Sums()[RRG_OV],Parm):r:0:0, Pr(Balance.Sums()[RRG_OS],Parm):r:0:0
        );
    End;

    Macro ViewDOS( Parm : RRG_F101_Parm )

        file f() txt;

        Parm.Protocol.PrintLine("¥ç âì § ¢¥àè¥­  ãá¯¥è­®.");
        Parm.Protocol.PrintLine(" ¦¬¨â¥ ESC ¤«ï ¯à®á¬®âà  ®âç¥â .");

        Parm.Protocol.View();

    End;

    Macro ViewExcel( Parm : RRG_F101_Parm )

        var path    = "",
            exlname = "";

        path = GetCurDir(false);

        if ( Parm.EndDate < Parm.Date1376 )
            exlname = "tmpl_101.xls";
        else
            exlname = "tmpl101b.xls";
        end;

        ExecMacroFile( "pr101_xl.mac", "PrintByFile", m_EE_EXP_FILE_NAME, exlname,  áç¥â‚Š®¯¥©ª å and (not Parm.PrintCop), path, parm.chapter);

    End;

    Macro View( Parm : RRG_F101_Parm )

        if ( Parm.kindView == 0 )
            ViewDOS( Parm );
        else
            ViewExcel( Parm );
        end;

    End;

    Constructor();

END;

class (Report101) Report101_2332()
    initReport101();

    private macro printTableHead()
/*        [ÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÒÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÒÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿];
        [     ³                                         º                              ¡®à®âë §  ®âç¥â­ë© ¯¥à¨®¤                           º                                         ³];
        [®¬¥à³            ‚å®¤ïé¨¥ ®áâ âª¨             ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶            ˆáå®¤ïé¨¥ ®áâ âª¨            ³];
        [áç¥â ³                                         º               ¯® ¤¥¡¥âã                 ³               ¯® ªà¥¤¨âã                º                                         ³];
        [¢â®- ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄ×ÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄ×ÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
        [à®£® ³  ¢ àã¡«ïå   ³   ¨­.¢ «.,  ³    ¨â®£®    º   ¢ àã¡«ïå  ³   ¨­.¢ «.,  ³    ¨â®£®    ³  ¢ àã¡«ïå   ³   ¨­.¢ «.,  ³    ¨â®£®    º   ¢ àã¡«ïå  ³   ¨­.¢ «.,  ³    ¨â®£®    ³];        23.01.2013 GSP ¯® I-00309788-3
        [¯®-  ³             ³    ¤à £.    ³             º             ³    ¤à £.    ³             ³             ³    ¤à £.    ³             º             ³    ¤à £.    ³             ³];
        [àï¤ª ³             ³   ¬¥â ««ë   ³             º             ³   ¬¥â ««ë   ³             ³             ³   ¬¥â ««ë   ³             º             ³   ¬¥â ««ë   ³             ³];
        [ÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄ×ÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄ×ÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
        [  1  ³      2      ³      3      ³      4      º      5      ³      6      ³      7      ³      8      ³      9      ³     10      º      11     ³     12      ³     13      ³];
        [ÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄĞÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄĞÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÙ];*/
        [ÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÒÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÒÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿];
        [     ³                                                      º                                         ¡®à®âë §  ®âç¥â­ë© ¯¥à¨®¤                                          º                                                      ³];
        [®¬¥à³                  ‚å®¤ïé¨¥ ®áâ âª¨                    ÇÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¶                  ˆáå®¤ïé¨¥ ®áâ âª¨                   ³];
        [áç¥â ³                                                      º                        ¯® ¤¥¡¥âã                     ³                    ¯® ªà¥¤¨âã                        º                                                      ³];
        [¢â®- ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ×ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ×ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
        [à®£® ³    ¢ àã¡«ïå     ³     ¨­.¢ «.,    ³       ¨â®£®      º     ¢ àã¡«ïå    ³     ¨­.¢ «.,    ³      ¨â®£®       ³    ¢ àã¡«ïå     ³     ¨­.¢ «.,    ³       ¨â®£®      º     ¢ àã¡«ïå    ³     ¨­.¢ «.,    ³       ¨â®£®      ³];
        [¯®-  ³                 ³      ¤à £.      ³                  º                 ³      ¤à £.      ³                  ³                 ³      ¤à £.      ³                  º                 ³      ¤à £.      ³                  ³];
        [àï¤ª ³                 ³     ¬¥â ««ë     ³                  º                 ³     ¬¥â ««ë     ³                  ³                 ³     ¬¥â ««ë     ³                  º                 ³     ¬¥â ««ë     ³                  ³];
        [ÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ×ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ×ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´];
        [  1  ³        2        ³        3        ³         4        º        5        ³        6        ³         7        ³        8        ³        9        ³       10         º        11       ³       12        ³        13        ³];
        [ÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄĞÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄĞÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ];
    end;

    Macro ViewExcel( Parm : RRG_F101_Parm )

        var path    = "",
            exlname = "";

        path = GetCurDir(false);

        exlname = "tmpl101b_2332.xls";


        ExecMacroFile( "pr101_xl.mac", "PrintByFile", m_EE_EXP_FILE_NAME, exlname,  áç¥â‚Š®¯¥©ª å and (not Parm.PrintCop), path, parm.chapter);

    End;

end;

class RRG_F101_Report()

    private var m_report;

    private macro Constructor()
        if (rcbApplication.currentReport.context.period.endDate < RCB_I2332_DATE)
            m_report = Report101();
        else
            m_report = Report101_2332();
        end;
    End;

    macro getEE_EXP_FILE_NAME()
        return m_report.getEE_EXP_FILE_NAME();
    end;

    macro getEE_LOCAL_FILE_NAME()
        return m_report.getEE_LOCAL_FILE_NAME();
    end;

    Macro Pr( Value, Parm : RRG_F101_Parm )
        return m_report.Pr( Value, Parm);
    End;

    Macro PrintChapterName( Parm : RRG_F101_Parm )
        m_report.PrintChapterName(Parm);
    End;

    Macro PrintHead( Parm : RRG_F101_Parm )
        m_report.PrintHead(Parm);
    End;

    Macro PrintHeadActive( Parm : RRG_F101_Parm )
        m_report.PrintHeadActive(Parm);
    End;

    Macro PrintItogActive( Parm : RRG_F101_Parm, Itog : RRG_F101_Itog )
        m_report.PrintItogActive(Parm, Itog);
    End;

    Macro PrintHeadPassive( Parm : RRG_F101_Parm )
        m_report.PrintHeadPassive(Parm);
    End;

    Macro PrintItogPassive( Parm : RRG_F101_Parm, Itog : RRG_F101_Itog )
        m_report.PrintItogPassive(Parm, Itog);
    End;

    Macro PrintFoot( Parm : RRG_F101_Parm )
        m_report.PrintFoot(Parm);
    End;

    Macro ProcessBalance( Balance : RRG_F101_Balance, Parm : RRG_F101_Parm )
        m_report.ProcessBalance(Balance, Parm);
    End;

    Macro ViewDOS( Parm : RRG_F101_Parm )
        m_report.ViewDOS(Parm);
    End;

    Macro ViewExcel( Parm : RRG_F101_Parm )
        m_report.ViewExcel(Parm);
    End;

    Macro View( Parm : RRG_F101_Parm )
        m_report.View(Parm);
    End;

    Constructor();
end;

private
MACRO GetQuery( Chapter, BKind, BegDate, EndDate )

    Macro GetVarName( Suffix )
        return "'­' || TRANSLATE(bl.t_Balance,'.\\/','___') || " + GetSQLString(Suffix);
    End;

    Macro SelectString( ps )
        return "       CASE"                                                                                            + "\n" +
               "           WHEN    NVL(vd"+ps+".t_bdInclude," + GetSQLDate(Date(0,0,0)) + ") <= " + GetSQLDate(EndDate) + "\n" +
               "               AND NVL(vd"+ps+".t_bdExclude," + GetSQLDate(Date(0,0,0)) + ") >= " + GetSQLDate(BegDate) + "\n" +
               "               THEN 1 "                                                                                 + "\n" +
               "           ELSE 0 "                                                                                     + "\n" +
               "       END "+ps+"w, "                                                                                   + "\n" +
               "       vd"+ps+".t_cFormat "+ps+"f,"                                                                     + "\n" +
               "       mr"+ps+".t_mean1   "+ps+"1,"                                                                     + "\n" +
               "       mr"+ps+".t_mean2   "+ps+"2 ";
    End;

    Macro WhereString( ps, suff, begdate, enddate )
        return "       AND vd"+ps+".t_iFormId(+)               = " + 1                            + "\n" +
               "       AND vd"+ps+".t_szVarName(+)             = " + GetVarName(suff)             + "\n" +
               "       AND mr"+ps+".t_iNumDprt(+)              = " + ®¬¥à®¤à §¤¥«¥­¨ï           + "\n" +
               "       AND mr"+ps+".t_OrganizationStructure(+) = " + RcbOrganizationStructure     + "\n" +
               "       AND mr"+ps+".t_IssueMode(+)             = " + RcbIssueMode                 + "\n" +
               "       AND mr"+ps+".t_IsSummary(+)             = " + RcbSqlBool(RcbIsSummaryMode) + "\n" +
               "       AND mr"+ps+".t_bdRepDate(+)             = " + GetSQLDate(enddate)          + "\n" +
               "       AND mr"+ps+".t_bdPrevDate(+)            = DECODE(vd"+ps+".t_cDoubleDates, CHR(0),"+GetSQLDate(Date(0,0,0))+","+GetSQLDate(begdate)+")" + "\n"+
               "       AND mr"+ps+".t_iFormId(+)               = " + 1                            + "\n" +
               "       AND mr"+ps+".t_iVarId(+)                = vd"+ps+".t_iVarId";
    End;

    Macro GetIsAP()
        return "       DECODE(INSTR(bl.t_Kind_Account,"+GetSQLString(KA_AP)+"),0,0,1)";
    End;

    Macro GetFilterBKind()
        return "       INSTR(DECODE(bl.t_Kind_Account, " + GetSQLString(KA_0) + ", " + GetSQLString(KA_A) + ", bl.t_Kind_Account), " + GetSQLChar(BKind) + ") > 0";
    End;

    return "SELECT bl.t_Balance      Balance,"                                  + "\n" +
                   GetSQLChar(BKind)  + " BKind,"                               + "\n" +
                   GetIsAP()          + " isAP,"                                + "\n" +
                   SelectString("cs") + ","                                     + "\n" +
                   SelectString("cr") + ","                                     + "\n" +
                   SelectString("cp") + ","                                     + "\n" +
                   SelectString("ds") + ","                                     + "\n" +
                   SelectString("dr") + ","                                     + "\n" +
                   SelectString("dp") + ","                                     + "\n" +
                   SelectString("as") + ","                                     + "\n" +
                   SelectString("ar") + ","                                     + "\n" +
                   SelectString("ap") + ","                                     + "\n" +
                   SelectString("ps") + ","                                     + "\n" +
                   SelectString("pr") + ","                                     + "\n" +
                   SelectString("pp")                                           + "\n" +
           "FROM   dbalance_dbt  bl, "                                          + "\n" +
           "       dcy_varsd_dbt vdcs, dcy_varsd_dbt vdcr, dcy_varsd_dbt vdcp," + "\n" +
           "       dcy_varsd_dbt vdds, dcy_varsd_dbt vddr, dcy_varsd_dbt vddp," + "\n" +
           "       dcy_varsd_dbt vdas, dcy_varsd_dbt vdar, dcy_varsd_dbt vdap," + "\n" +
           "       dcy_varsd_dbt vdps, dcy_varsd_dbt vdpr, dcy_varsd_dbt vdpp," + "\n" +
           "       dcy_mreal_dbt mrcs, dcy_mreal_dbt mrcr, dcy_mreal_dbt mrcp," + "\n" +
           "       dcy_mreal_dbt mrds, dcy_mreal_dbt mrdr, dcy_mreal_dbt mrdp," + "\n" +
           "       dcy_mreal_dbt mras, dcy_mreal_dbt mrar, dcy_mreal_dbt mrap," + "\n" +
           "       dcy_mreal_dbt mrps, dcy_mreal_dbt mrpr, dcy_mreal_dbt mrpp " + "\n" +
           "WHERE      bl.t_Chapter         = " + Chapter                       + "\n" +
           "       AND bl.t_iNumPlan        = " + ®«ãç¨âì¥ «ì­ë©®¬¥à« ­ ()  + "\n" +
           "       AND " + GetFilterBKind()                                     + "\n" +
           "       AND INSTR(bl.t_Type_Balance," + GetSQLChar("1")   + ") = 0"  + "\n" +
           "       AND INSTR(bl.t_Type_Balance," + GetSQLChar("T")   + ") = 0"  + "\n" +
           "       AND bl.t_bdIncludeBwp <= " + getSqlDate(EndDate)             + "\n" +
           "       AND (    bl.t_bdExcludeBwp >= " + getSqlDate(BegDate)        + "\n" +
           "             OR bl.t_bdExcludeBwp <  bl.t_bdIncludeBwp)"            + "\n" +
                   WhereString("cs","__Š", BegDate, EndDate)                    + "\n" +
                   WhereString("cr","ãŠ", BegDate, EndDate)                    + "\n" +
                   WhereString("cp","®Š", BegDate, EndDate)                    + "\n" +
                   WhereString("ds","__„", BegDate, EndDate)                    + "\n" +
                   WhereString("dr","ã„", BegDate, EndDate)                    + "\n" +
                   WhereString("dp","®„", BegDate, EndDate)                    + "\n" +
                   WhereString("as","__€", BegDate, EndDate)                    + "\n" +
                   WhereString("ar","ã€", BegDate, EndDate)                    + "\n" +
                   WhereString("ap","®€", BegDate, EndDate)                    + "\n" +
                   WhereString("ps","__", BegDate, EndDate)                    + "\n" +
                   WhereString("pr","ã", BegDate, EndDate)                    + "\n" +
                   WhereString("pp","®", BegDate, EndDate)                    + "\n" +
           "ORDER BY bl.t_Balance";

END;

private
MACRO CheckForm()
    if ( { §¢ ­¨¥ ®âç¥â } != FORM_NAME )
        RRG_F101_XThrow( RRG_F101_XError, String("Œ ªà®á à¥ «¨§®¢ ­ â®«ìª® ¤«ï ¯à¨«®¦¥­¨ï \"",FORM_NAME,"\"") );
    end;
END;

private
MACRO ProcessBalances( parm : RRG_F101_Parm, BKind : String, Itog : RRG_F101_Itog, Report : RRG_F101_Report )

    Macro isPrint( Balance : RRG_F101_Balance )

        var stat : Bool = true;

        if ( stat )
            stat =    (parm.PrintKind == PRK_ALL)
                   or (parm.PrintKind == PRK_BWP) and     Balance.isWork()
                   or (parm.PrintKind == PRK_NOZ) and not Balance.isZero();
        end;

        if ( stat )
            stat =    (not Balance.isAP())
                   or ((Balance.Sums()[RRG_OR] >= 0) and (BKind == KA_A))
                   or ((Balance.Sums()[RRG_OR] >  0) and (BKind == KA_P));
        end;

        return stat;

    End;

    var dataSet = TRsbDataSet(GetQuery(parm.Chapter, BKind, parm.BegDate, parm.EndDate));

    var Balance;

    while( dataSet.moveNext() )

        if ( ®àï¤®ª « ­á®¢®£®‘ç¥â ( dataSet.Balance ) != 3)
          continue;
        end;

        if (parm.Chapter != 5)
            Balance = RRG_F101_Balance( dataSet );
        else
            Balance = RRG_F1015_Balance( dataSet );
        end;

        Message("¡à ¡ âë¢ ¥âáï ¡ « ­á®¢ë© áç¥â: ", Balance.Balance(), " (" + BKind + ")");

        if ( isPrint(Balance) )
            Report.ProcessBalance( Balance, parm );

            Itog.AddB(Balance);
        end;
    end;

END;

private
MACRO PrintFormBody( parm : RRG_F101_Parm, Report : RRG_F101_Report )

    var Itog : RRG_F101_Itog;

    Report.PrintChapterName( parm );

    Itog = RRG_F101_Itog(parm);
    Report.PrintHeadActive( parm );
    ProcessBalances( parm, "€", Itog, Report );
    Report.PrintItogActive( parm, Itog );

    Itog = RRG_F101_Itog(parm);
    Report.PrintHeadPassive( parm );
    ProcessBalances( parm, "", Itog, Report );
    Report.PrintItogPassive( parm, Itog );

END;

private
MACRO PrintFormPeriod( parm : RRG_F101_Parm, Report : RRG_F101_Report )

    var Chapter : Integer;

    Report.PrintHead( parm );

    if ( parm.Chapter == 0 )
        Chapter = 1;
        while( Chapter <= 5 )
            parm.Chapter = Chapter;
            PrintFormBody( parm, Report );
            Chapter = Chapter + 1;
        end;
        parm.Chapter = 0;
    else
        PrintFormBody( parm, Report );
    end;

    Report.PrintFoot( parm );

END;

private
MACRO PrintForm( Parm : RRG_F101_Parm, Report : RRG_F101_Report )

    var CurDate = Parm.BegDate;
    var BegDate = Parm.BegDate;
    var EndDate = Parm.EndDate;

    while ((not RcbIsWorkday(CurDate)) and (CurDate <= EndDate))
        CurDate = CurDate + 1;
    end;

    if ( CurDate > parm.EndDate )
        RRG_F101_XThrow( RRG_F101_XWarning, "‚ § ¤ ­­®¬ ®âç¥â­®¬ ¯¥à¨®¤¥ â®«ìª® ¢ëå®¤­ë¥ ¤­¨.|âç¥â ­¥ áä®à¬¨à®¢ ­." );
    end;

    if ( Parm.EveryDay )

        while( CurDate <= EndDate )
            parm.BegDate = CurDate;
            parm.EndDate = CurDate;

            PrintFormPeriod(parm,Report);

            CurDate = DateAfterWorkDays(CurDate,1);
        end;

    else
        PrintFormPeriod(Parm,Report);
    end;

    Parm.BegDate = BegDate;
    Parm.EndDate = EndDate;

END;

private
MACRO ExitCode( Parm : RRG_F101_Parm )
    if ( Parm.kindView == 0)
        return 0;
    else
        return 1;
    end;
END;

MACRO RRG_F101_Main( Chapter, Report : RRG_F101_Report )

    var Parm : RRG_F101_Parm;

    CheckForm();

    Parm = RRG_F101_Parm(Chapter);

    if (Parm.kindView >= 0)

        PrintForm(Parm,Report);

        Report.View(Parm);
    end;

    return ExitCode(Parm);

    OnError(err);
    RRG_F101_XCatch(err);
    return 1;

END;
