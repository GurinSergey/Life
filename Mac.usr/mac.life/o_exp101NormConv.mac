/* MODiFiED: 2009-06-03 zip_z. - Æ‚≠Î≠• ¢ Ø•Á†‚Ï ≠• ØÆØ†§†Ó‚ ·Á•‚† éÇè
 *
 */
/* 2009-07-07 HP - Ë®‡®≠† ™Æ´Æ≠™® „¢•´®Á•≠† §Æ 17-‚® ·®¨¢Æ´Æ¢ */
/* É„Ê„ Ö. Ç. (EVG) 12/03/2014 è•‡•ÂÆ§ ≠† ¢•‡·®Ó 2031 */

import BankInter,
       RsbDataSet,
       ä†´•≠§†‡Ï,
       ReptCBInter,
       ReptCBCommon,
       cb_sql,
       rsexts,
       param,
       cy_find,
       chk_regd,
       exp_exl,
       lib_path,
       rcb_lib;

import exp_lib;

/* EVG 12/03/2014 Ñ´Ô Ì™·ØÆ‡‚† ≠Æ¢Æ© ‰Æ‡¨Î 155 "Å†´†≠·Æ¢Î• ·Á•‚†" */
import rcbimport;
import balanceCalculateController;

const RRG_OS =  0;
const RRG_OR =  1;
const RRG_OV =  2;
const RRG_IS =  3;
const RRG_IR =  4;
const RRG_IV =  5;
const RRG_DS =  6;
const RRG_DR =  7;
const RRG_DV =  8;
const RRG_CS =  9;
const RRG_CR = 10;
const RRG_CV = 11;

const RRG_F101_XOK      = 0;
const RRG_F101_XWarning = 1;
const RRG_F101_XError   = 2;

private const KA_A  = "Ä";
private const KA_P  = "è";
private const KA_AP = "Äè";
private const KA_0  = "0";

private const FORM_NAME = "Å†´†≠·Æ¢Î• ·Á•‚†";
private const FORM_ID   = ç†©‚®à§•≠‚®‰®™†‚Æ‡é‚Á•‚†èÆç†ß¢†≠®Ó( FORM_NAME );

private const PRK_ALL = 0;
private const PRK_BWP = 1;
private const PRK_NOZ = 2;
private const PRK_BEG = PRK_ALL;
private const PRK_END = PRK_NOZ;

private const PRINT_KIND_REGPATH      = "REPTREG/REP_GROUPS/BALANCE_ACCOUNTS/èÖóÄíú îéêåõ 101";
private const PRINT_COPECKS_REGPATH   = "REPTREG/REP_GROUPS/BALANCE_ACCOUNTS/èÖóÄíú Ç äéèÖâäÄï";
private const PRINT_EVERY_DAY_REGPATH = "REPTREG/REP_GROUPS/BALANCE_ACCOUNTS/èÖóÄíú áÄ äÄÜÑõâ ÑÖçú èÖêàéÑÄ";

private const VF_MONEY  = "Ñ";
private const VF_DOUBLE = "ó";
private const VF_PERC   = "%";
private const VF_ITEM   = "ò";

CLASS RRG_F101_Error( p_XType : Integer, p_XMessage : String )

    var XType    = p_XType;
    var XMessage = p_XMessage;

END;

private var RRG_F101_X = RRG_F101_Error( RRG_F101_XOK, "" );

MACRO RRG_F101_XThrow( XType : Integer, XMessage : String )

    RRG_F101_X = RRG_F101_Error( XType, XMessage );

    RunError(XMessage);

END;

MACRO RRG_F101_XCatch(err)

    if   ( RRG_F101_X.XType == RRG_F101_XWarning )
        MsgBox( RRG_F101_X.XMessage );
    elif ( RRG_F101_X.XType == RRG_F101_XError   )
        MsgBox( RRG_F101_X.XMessage );
    else
        RunError();
    end;

    Exit(1);

END;

private
MACRO ZeroValue( Format )
    if ( ê†·Á•‚ÇäÆØ•©™†Â )
        if   ( format == VF_MONEY  ) return Money ($0);
        elif ( format == VF_DOUBLE ) return Double(0.);
        elif ( format == VF_PERC   ) return Double(0.);
        elif ( format == VF_ITEM   ) return Int   (0);
        else
            RRG_F101_XThrow( RRG_F101_XError, String("ç•®ß¢•·‚≠Î© ‰Æ‡¨†‚ Ø•‡•¨•≠≠Æ©: ",format) );
        end;
    else
        return RCB_FloorTerm(0.);
    end;
END;



/* EVG 12/03/2014 è•‡•ÂÆ§ ≠† 2031. ë‚†‡Î© ™´†·· - ß†™Æ¨¨•≠‚®´, ‚•Ø•‡Ï Æ≠ §‡„£Æ©.
CLASS RRG_F101_Balance( dataSet )

    private var m_Balance : String;
    private var m_BKind   : String;
    private var m_isAP    : Integer;
    private var m_Sums    : TArray;

    private var m_isWork  : Bool;
    private var m_isZero  : Bool;

    private var m_Format  : String;
    private var m_Zero;

    private
    Macro getValue( dataSet, cname, varname, make_error )

        macro getMean( mean1 : Double, mean2 : Double )

           var value;

           if (m_Format == VF_MONEY)
               if ( ê†·Á•‚ÇäÆØ•©™†Â )
                   value = Money(mean1);
               else
                   value = RCB_FloorTerm(mean2);
               end;
           else
               if   ( m_Format == VF_DOUBLE ) value = Double(mean1);
               elif ( m_Format == VF_PERC   ) value = Double(mean1);
               elif ( m_Format == VF_ITEM   ) value = Int   (mean1);
               else
                   RRG_F101_XThrow( RRG_F101_XError, String("ç•®ß¢•·‚≠Î© ‰Æ‡¨†‚ Ø•‡•¨•≠≠Æ©: ", m_Format) );
               end;
           end;

           return value;
        end;

        var iswrk  = dataSet.value(cname+"w") == 1;
        var mean1  = dataSet.value(cname+"1");
        var mean2  = dataSet.value(cname+"2");
        var value;

        if ( not iswrk )
            value = m_Zero;
        else
            m_isWork = true;
   
            if ( (mean1 == NULL) or (mean2 == NULL)  )
                if ( (not make_error) or (MeanUndefByZero != 0) )
                    value = m_Zero;
                else
                    RRG_F101_XThrow( RRG_F101_XError, String("ç• ≠†©§•≠Æ ß≠†Á•≠®• Ø•‡•¨•≠≠Æ© \"",varname,"\"") );
                end;
            else
                value = getMean( mean1, mean2 );
            end;
        end;
   
        if ( value != m_Zero )
            m_isZero = false;
        end;
   
        return value;
    End;

    private 
    Macro Constructor( dataSet )

        macro setSums()

            var cr = getValue( dataSet, "cr", String("Å≠",m_Balance,"ê„ä"), true ),
                cp = getValue( dataSet, "cp", String("Å≠",m_Balance,"èÆä"), true ),
                cs = getValue( dataSet, "cs", String("Å≠",m_Balance,"__ä"), true ),
                dr = getValue( dataSet, "dr", String("Å≠",m_Balance,"ê„Ñ"), true ),
                dp = getValue( dataSet, "dp", String("Å≠",m_Balance,"èÆÑ"), true ),
                ds = getValue( dataSet, "ds", String("Å≠",m_Balance,"__Ñ"), true ),
                ar = getValue( dataSet, "ar", String("Å≠",m_Balance,"ê„Ä"), m_isAP or (m_BKind == KA_A) ),
                ap = getValue( dataSet, "ap", String("Å≠",m_Balance,"èÆÄ"), m_isAP or (m_BKind == KA_A) ),
                as = getValue( dataSet, "as", String("Å≠",m_Balance,"__Ä"), m_isAP or (m_BKind == KA_A) ),
                pr = getValue( dataSet, "pr", String("Å≠",m_Balance,"ê„è"), m_isAP or (m_BKind == KA_P) ),
                pp = getValue( dataSet, "pp", String("Å≠",m_Balance,"èÆè"), m_isAP or (m_BKind == KA_P) ),
                ps = getValue( dataSet, "ps", String("Å≠",m_Balance,"__è"), m_isAP or (m_BKind == KA_P) );

            m_Sums = TArray();

            m_Sums[RRG_CR] = cr;
            m_Sums[RRG_CV] = cp;
            m_Sums[RRG_CS] = cs;
            m_Sums[RRG_DR] = dr;
            m_Sums[RRG_DV] = dp;
            m_Sums[RRG_DS] = ds;

            if   ( m_BKind == KA_A )

                m_Sums[RRG_OR] = ar - pr;
                m_Sums[RRG_OV] = ap - pp;
                m_Sums[RRG_OS] = as - ps;

                m_Sums[RRG_IR] = m_Sums[RRG_OR] - m_Sums[RRG_DR] + m_Sums[RRG_CR];
                m_Sums[RRG_IV] = m_Sums[RRG_OV] - m_Sums[RRG_DV] + m_Sums[RRG_CV];
                m_Sums[RRG_IS] = m_Sums[RRG_OS] - m_Sums[RRG_DS] + m_Sums[RRG_CS];

            elif ( m_BKind == KA_P )

                m_Sums[RRG_OR] = pr - ar;
                m_Sums[RRG_OV] = pp - ap;
                m_Sums[RRG_OS] = ps - as;

                m_Sums[RRG_IR] = m_Sums[RRG_OR] + m_Sums[RRG_DR] - m_Sums[RRG_CR];
                m_Sums[RRG_IV] = m_Sums[RRG_OV] + m_Sums[RRG_DV] - m_Sums[RRG_CV];
                m_Sums[RRG_IS] = m_Sums[RRG_OS] + m_Sums[RRG_DS] - m_Sums[RRG_CS];

            end;
        end;

        macro setFormat()
            m_Format = NULL;

            if ( m_Format == NULL ) m_Format = dataSet.crf; end;
            if ( m_Format == NULL ) m_Format = dataSet.cpf; end;
            if ( m_Format == NULL ) m_Format = dataSet.csf; end;
            if ( m_Format == NULL ) m_Format = dataSet.drf; end;
            if ( m_Format == NULL ) m_Format = dataSet.dpf; end;
            if ( m_Format == NULL ) m_Format = dataSet.dsf; end;
            if ( m_Format == NULL ) m_Format = dataSet.arf; end;
            if ( m_Format == NULL ) m_Format = dataSet.apf; end;
            if ( m_Format == NULL ) m_Format = dataSet.asf; end;
            if ( m_Format == NULL ) m_Format = dataSet.prf; end;
            if ( m_Format == NULL ) m_Format = dataSet.ppf; end;
            if ( m_Format == NULL ) m_Format = dataSet.psf; end;

            if ( m_Format == NULL )
                RRG_F101_XThrow( RRG_F101_XError, "é‚·„‚·‚¢„Ó‚ Ø•‡•¨•≠≠Î• §´Ô °/·: " + m_Balance );
            end;

            m_Zero = ZeroValue(m_Format);
        end;

        m_Balance = dataSet.balance;
        m_BKind   = dataSet.BKind;
        m_isAP    = dataSet.isAP;

        m_isWork = false;
        m_isZero = true;

        setFormat();

        setSums();

    End;

    Macro Balance()
        return m_Balance;
    End;

    Macro Sums()
        return m_Sums;
    End;

    Macro isWork()
        return m_isWork;
    End;

    Macro isZero()
        return m_isZero;
    End;

    Macro isAP()
        return m_isAP;
    End;

    Macro BKind()
        return m_BKind;
    End;

    Constructor(dataSet);

END;
EVG 12/03/2014 è•‡•ÂÆ§ ≠† 2031 */


/* EVG 12/03/2014 çÆ¢Î© ™´†·· */
CLASS RRG_F101_Balance( balanceAttribute )


    private var m_Balance : String;
    private var m_BKind   : String;
    private var m_Chapter : String;
    private var m_isAP    : Integer;
    private var m_Sums    : TArray;

    private var m_isWork  : Bool;

    private 
    Macro Constructor( balanceAttribute )

        macro setSums()

            var valueType = string("Exact");
            if ( not ê†·Á•‚ÇäÆØ•©™†Â )
               valueType = string("Scaled");
            end;

            var cr = GenGetProp( balanceAttribute.getCreditNatCur(),            valueType ),
                cp = GenGetProp( balanceAttribute.getCreditCur(),               valueType ),
                cs = GenGetProp( balanceAttribute.getCredit(),                  valueType ),
                dr = GenGetProp( balanceAttribute.getDebetNatCur(),             valueType ),
                dp = GenGetProp( balanceAttribute.getDebetCur(),                valueType ),
                ds = GenGetProp( balanceAttribute.getDebet(),                   valueType ),
                ar = GenGetProp( balanceAttribute.getOutRestNatCurActive(),     valueType ),
                ap = GenGetProp( balanceAttribute.getOutRestCurActive(),        valueType ),
                as = GenGetProp( balanceAttribute.getOutRestActive(),           valueType ),
                pr = GenGetProp( balanceAttribute.getOutRestNatCurPassive(),    valueType ),
                pp = GenGetProp( balanceAttribute.getOutRestCurPassive(),       valueType ),  
                ps = GenGetProp( balanceAttribute.getOutRestPassive(),          valueType );

            m_Sums = TArray();

            m_Sums[RRG_CR] = cr;
            m_Sums[RRG_CV] = cp;
            m_Sums[RRG_CS] = cs;
            m_Sums[RRG_DR] = dr;
            m_Sums[RRG_DV] = dp;
            m_Sums[RRG_DS] = ds;

            if   ( m_BKind == KA_A )

                m_Sums[RRG_OR] = ar - pr;
                m_Sums[RRG_OV] = ap - pp;
                m_Sums[RRG_OS] = as - ps;

                m_Sums[RRG_IR] = m_Sums[RRG_OR] - m_Sums[RRG_DR] + m_Sums[RRG_CR];
                m_Sums[RRG_IV] = m_Sums[RRG_OV] - m_Sums[RRG_DV] + m_Sums[RRG_CV];
                m_Sums[RRG_IS] = m_Sums[RRG_OS] - m_Sums[RRG_DS] + m_Sums[RRG_CS];

            elif ( m_BKind == KA_P )

                m_Sums[RRG_OR] = pr - ar;
                m_Sums[RRG_OV] = pp - ap;
                m_Sums[RRG_OS] = ps - as;

                m_Sums[RRG_IR] = m_Sums[RRG_OR] + m_Sums[RRG_DR] - m_Sums[RRG_CR];
                m_Sums[RRG_IV] = m_Sums[RRG_OV] + m_Sums[RRG_DV] - m_Sums[RRG_CV];
                m_Sums[RRG_IS] = m_Sums[RRG_OS] + m_Sums[RRG_DS] - m_Sums[RRG_CS];

            else
               //debugbreak
            end;
        end;


        m_Balance = balanceAttribute.getBalance();

        m_BKind   = balanceAttribute.getKindBalance();

        m_Chapter = balanceAttribute.getChapter();

        m_isAP = 0;
        if( m_BKind == KA_AP )
           m_isAP = 1;
        end;

        m_isWork = false;

        setSums();

    End;

    Macro Balance()
        return m_Balance;
    End;

    Macro Sums()
        return m_Sums;
    End;

    Macro isWork()
        return m_isWork;
    End;

    Macro isAP()
        return m_isAP;
    End;

    Macro BKind()
        return m_BKind;
    End;

    Constructor( balanceAttribute );

END;

CLASS RRG_F101_Protocol( p_NameFile )

    private var m_NameFile : String;

    private
    Macro Constructor(p_NameFile)
        m_NameFile = getTxtFileName(p_NameFile);

        SetOutPut( m_NameFile, false );
        SetOutPut( NULL,       true  );
    End;

    Macro NameFile()
        return m_NameFile;
    End;

    Macro PrintLine( Mess : String )
        SetOutPut(m_NameFile,true);
        PrintLn(Mess);
        SetOutPut(NULL,true);
    End;

    Macro View()
        file p() txt;

        if ( not Open(p,m_NameFile) )
            RRG_F101_XThrow( RRG_F101_XWarning, String("éË®°™† Æ‚™‡Î‚®Ô ‰†©´† Ø‡Æ‚Æ™Æ´†:|",m_NameFile) );
        end;

        ViewFile(p);
    End;

    Constructor(p_NameFile);

END;

CLASS RRG_F101_Parm( p_Chapter : Integer )

    var Chapter   : Integer;
    var PrintKind : Integer;
    var EveryDay  : Bool;
    var PrintCop  : Bool;
    var Date1376  : Date;

    var BegDate   : Date;
    var EndDate   : Date;
    var Protocol  : RRG_F101_Protocol;
    var isExcel   : Bool;

    private 
    Macro initPrintKind()
        var type = V_UNDEF,
            err  = 0,
            val  = PRK_NOZ;

        PrintKind = PRK_NOZ;

        type = GetRegistryValue( PRINT_KIND_REGPATH, V_INTEGER, val, err );
        if ( (err == 0) and (type == V_INTEGER) )
            if ( (val >= PRK_BEG) and (val <= PRK_END) )
                PrintKind = val;
            end;
        end;
    End;

    private 
    Macro initEveryDay()
        var type = V_UNDEF,
            err  = 0,
            val  = false;

        EveryDay = false;

        type = GetRegistryValue( PRINT_EVERY_DAY_REGPATH, V_BOOL, val, err );
        if ( (err == 0) and (type == V_BOOL) )
            EveryDay = val;
        end;
    End;

    private 
    Macro initPrintCop()
        var type = V_UNDEF,
            err  = 0,
            val  = false;

        PrintCop = false;

        type = GetRegistryValue( PRINT_COPECKS_REGPATH, V_BOOL, val, err );
        if ( (err == 0) and (type == V_BOOL) )
            PrintCop = val;
        end;
    End;

    private 
    Macro initDate1376()
        Date1376 = Date(1,4,2004);

        GetRegDate(Date1376,"ÑÄíÄ_1376ì");
        if ( Date1376 == date(0,0,0) )
            Date1376 = date(1,4,2004);
        end;
    End;

    private 
    Macro initProtocol()
        Protocol = RRG_F101_Protocol("f101_log");
    End;

    private
    Macro initExcel()
//        isExcel = ee_user_select_xl();
        isExcel = false;
    End;

    private 
    Macro Constructor( p_Chapter )
        Chapter = p_Chapter;

        initPrintKind();
        initEveryDay();
        initPrintCop();
        initDate1376();
        initProtocol();
        initExcel();

        BegDate = è‡•§Ñ†‚†é‚Á•‚†;
        EndDate = Ñ†‚†é‚Á•‚†;
    End;

    Constructor(p_Chapter);

END;

CLASS RRG_F101_Itog( Parm : RRG_F101_Parm )

    private var m_Sums    : TArray;
    private var m_IsValid : Bool;

    private
    Macro Constructor( Parm )
        m_Sums    = TArray();
        m_IsValid = false;
        m_Sums[RRG_OR] = $0;
        m_Sums[RRG_OV] = $0;
        m_Sums[RRG_OS] = $0;
        m_Sums[RRG_IR] = $0;
        m_Sums[RRG_IV] = $0;
        m_Sums[RRG_IS] = $0;
        m_Sums[RRG_CR] = $0;
        m_Sums[RRG_CV] = $0;
        m_Sums[RRG_CS] = $0;
        m_Sums[RRG_DR] = $0;
        m_Sums[RRG_DV] = $0;
        m_Sums[RRG_DS] = $0;
    End;

    Macro Sums()
        return m_Sums;
    End;

    private
    Macro OpAdd( Sums : TArray )
        var i = 0;

        while( i < m_Sums.Size() )
            m_Sums[i] = m_Sums[i] + Sums[i];
            i = i + 1;
        end;

    End;

    private
    Macro OpSub( Sums : TArray )
        var i = 0;

        while( i < m_Sums.Size() )
            m_Sums[i] = m_Sums[i] - Sums[i];
            i = i + 1;
        end;

    End;

    Macro AddI( Itog : RRG_F101_Itog )
        OpAdd(Itog.Sums());
    End;

    Macro SubI( Itog : RRG_F101_Itog )
        OpSub(Itog.Sums());
    End;

    Macro AddB( Balance : RRG_F101_Balance )
        OpAdd(Balance.Sums());
    End;

    Macro SubB( Balance : RRG_F101_Balance )
        OpSub(Balance.Sums());
    End;

    Constructor(parm);

END;

private
MACRO NamePeriod( parm : RRG_F101_Parm )
    var Name = "";
    var m = 0,
        y = 0;

    if ( parm.EveryDay )
        Name = String( parm.EndDate:m );
    else
        DateSplit( parm.EndDate, NULL, m, y );

        if ( ç†™ÆØ®‚•´Ï≠Î© )
            Name = String( "Ø•‡®Æ§ · ", parm.BegDate:m, " ØÆ ", parm.EndDate:m );
        else
            if   ( Ç®§è•‡®Æ§† == Çè_ÉÆ§ )
                Name = String( y, " £Æ§");
            elif ( Ç®§è•‡®Æ§† == Çè_ä¢†‡‚†´ )
                Name = String( (m-1)/3 + 1, " ™¢†‡‚†´ ", y, " £Æ§†");
            elif ( Ç®§è•‡®Æ§† == Çè_å•·ÔÊ )
                Name = String( MonName( m), " ", y, " £Æ§†");
            elif ( Ç®§è•‡®Æ§† == Çè_Ñ•≠Ï )
                Name = String( Ñ†‚†é‚Á•‚†:m );
            else
               Name = String( "Ø•‡®Æ§ · ", è‡•§Ñ†‚†é‚Á•‚†:m, " ØÆ ", Ñ†‚†é‚Á•‚†:m);
            end;
        end;
    end;

    return Name;
END;

CLASS RRG_F101_Report()

    private var m_EE_EXP_FILE_NAME   = "";
    private var m_EE_LOCAL_FILE_NAME = "";

    private 
    Macro Constructor()
        m_EE_LOCAL_FILE_NAME = "pr_f101.exl";
        m_EE_EXP_FILE_NAME   = ReturnDirString("TEXTDIR","TXTFILE") + m_EE_LOCAL_FILE_NAME;
    End;

    Macro Pr( Value, Parm : RRG_F101_Parm )
        var str = String(Value);

        if ( ê†·Á•‚ÇäÆØ•©™†Â and Parm.PrintCop )
            str = SubStr( str, 1, StrLen(str)-3 )+SubStr( str, StrLen(str)-1, 2 );
            if ( str == "000" )
                str = "0";
            end;
        elif ( not ê†·Á•‚ÇäÆØ•©™†Â )
            return Value;
        end;

        return str;
    End;

    Macro PrintChapterName( Parm : RRG_F101_Parm )
        var dataSet = TRsbDataSet("SELECT t_Symbol, t_Name FROM dobchaptr_dbt WHERE t_Chapter = " + Parm.Chapter);

        if ( not dataSet.moveNext() )
            RRG_F101_XThrow( RRG_F101_XError, String("ç• ≠†©§•≠† £´†¢† · ≠Æ¨•‡Æ¨ ",Parm.Chapter) );
        end;

        var ChapterStr = String( String(dataSet.Symbol, ".", dataSet.Name):172:c );

        ee_insert_ef_values( ChapterStr );
        [#]( ChapterStr );
    End;

    Macro PrintHead( Parm : RRG_F101_Parm )

        if ( not ee_open_ef(true,m_EE_EXP_FILE_NAME) )
            RRG_F101_XThrow( RRG_F101_XError, String("éË®°™† Æ‚™‡Î‚®Ô ‰†©´† ",m_EE_EXP_FILE_NAME) );
        end;

        if ( (Parm.EveryDay and (Parm.EndDate < Parm.Date1376)) or ((not Parm.EveryDay) and (Parm.EndDate < Parm.Date1376)) )
            ee_insert_cell_data( äÆ§_ëéÄíé, 10,   6 );
            ee_insert_cell_data( äÆ§_éäèé,  11,   6 );
        else
            ee_insert_cell_data( äÆ§_ëéÄíé,  9,   6 );
            ee_insert_cell_data( äÆ§_éäèé,  10,   6 );
            ee_insert_cell_data( éÉêç,      11,   6 );
        end;

        ee_insert_cell_data( ê•£çÆ¨•‡Å†≠™†, 12, 6 );
        ee_insert_cell_data( rcbGetBic(),   13, 6 );  /* 18.10.2007 Malakhova 110424 - ß†¨•≠®´† {MFO_Bank} ≠† rcbGetBic()*/

        ee_insert_cell_data( "ß† " + NamePeriod(parm), 7, 11 );

        if ( ê†·Á•‚ÇäÆØ•©™†Â and Parm.PrintCop )
            ee_insert_cell_data( "™ÆØ.",      13, 17 );
        elif ( ê†·Á•‚ÇäÆØ•©™†Â )
            ee_insert_cell_data( "‡„°.",      13, 17 );
        else
            ee_insert_cell_data( "‚Î·. ‡„°.", 13, 17 );
        end;

        ee_start_tbl;

        [                                                                                                                                                                      Å†≠™Æ¢·™†Ô Æ‚Á•‚≠Æ·‚Ï  ];

        if ( (Parm.EveryDay and (Parm.EndDate < Parm.Date1376)) or ((not Parm.EveryDay) and (Parm.EndDate < Parm.Date1376)) )                   
            [                                                                                                                                                    äÆ§ ‰Æ‡¨Î §Æ™„¨•≠‚† ØÆ éäìÑ 0409101  ];
            [                                                                                                                                   ⁄ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø];
            [                                                                                                                                   ≥    äÆ§     ≥       äÆ§ ™‡•§®‚≠Æ© Æ‡£†≠®ß†Ê®®       ≥];
            [                                                                                                                                   ≥ ‚•‡‡®‚Æ‡®® √ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒ¥];
            [                                                                                                                                   ≥  ØÆ éäÄíé  ≥ ØÆ éäèé  ≥ê•£®·‚‡†Ê®Æ≠≠Î©≥    Åàä     ≥];
            [                                                                                                                                   ≥            ≥          ≥    ≠Æ¨•‡      ≥            ≥];
            [                                                                                                                                   √ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ¥];
            [                                                                                                                                   ≥     #      ≥    #     ≥       #       ≥      #     ≥]( äÆ§_ëéÄíé:c, äÆ§_éäèé:c, ê•£çÆ¨•‡Å†≠™†:c, {MFO_Bank}:c );
            [                                                                                                                                   ¿ƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒŸ];
        else
            [                                                                                                                     ⁄ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø];
            [                                                                                                                     ≥    äÆ§     ≥            äÆ§ ™‡•§®‚≠Æ© Æ‡£†≠®ß†Ê®® (‰®´®†´†)        ≥];
            [                                                                                                                     ≥ ‚•‡‡®‚Æ‡®® √ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒ¥];
            [                                                                                                                     ≥  ØÆ éäÄíé  ≥ ØÆ éäèé  ≥    é·≠Æ¢≠Æ©   ≥ê•£®·‚‡†Ê®Æ≠≠Î©≥    Åàä     ≥];
            [                                                                                                                     ≥            ≥          ≥£Æ·„§†‡·‚¢•≠≠Î©≥    ≠Æ¨•‡      ≥            ≥];
            [                                                                                                                     ≥            ≥          ≥‡•£®·‚‡†Ê®Æ≠≠Î©≥  (/ØÆ‡Ô§™Æ¢Î© ≥            ≥];
            [                                                                                                                     ≥            ≥          ≥     ≠Æ¨•‡     ≥    ≠Æ¨•‡)     ≥            ≥];
            [                                                                                                                     √ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ¥];
            [                                                                                                                     ≥     #      ≥    #     ≥       #       ≥       #       ≥      #     ≥]( äÆ§_ëéÄíé:c, äÆ§_éäèé:c, éÉêç:c, ê•£çÆ¨•‡Å†≠™†:c, {MFO_Bank}:c );
            [                                                                                                                     ¿ƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒŸ];
        end;

        [                                                                                                                                                                                                     ];

        if ( (Parm.EveryDay and (Parm.EndDate < Parm.Date1376)) or ((not Parm.EveryDay) and (Parm.EndDate < Parm.Date1376)) )
        [                                                                       éÅéêéíçÄü ÇÖÑéåéëíú èé ëóÖíÄå ÅìïÉÄãíÖêëäéÉé ìóÖíÄ                                                                            ];
        else                        
        [                                                                       éÅéêéíçÄü ÇÖÑéåéëíú èé ëóÖíÄå ÅìïÉÄãíÖêëäéÉé ìóÖíÄ                                                                            ];
        [                                                                                      äêÖÑàíçéâ éêÉÄçàáÄñàà                                                                                          ];
        end;

        [                                                                                             ß† #                                                                                                    ]( NamePeriod(parm) );
        [                                                                                                                                                                                                     ];
        [ ################################################################################################################################################################################################### ]( "ç†®¨•≠Æ¢†≠®• ™‡•§®‚≠Æ© Æ‡£†≠®ß†Ê®®   " + {Name_Bank}:w);
        [ èÆÁ‚Æ¢Î© †§‡•·   #                                                                                                                                                                                  ]( {Post_Addr}:l);
        [                                                                                                                                                                                                     ];

        if ( (Parm.EveryDay and (Parm.EndDate < Parm.Date1376)) or ((not Parm.EveryDay) and (Parm.EndDate < Parm.Date1376)) )
            [                                                                                                                                                                                   îÆ‡¨†  N 101  ];
        else
            [                                                                                                                                                                              äÆ§ ‰Æ‡¨Î 0409101  ];
        end;

        [                                                                                                                                                                                           å•·ÔÁ≠†Ô  ];

        if ( ê†·Á•‚ÇäÆØ•©™†Â and Parm.PrintCop )
            [                                                                                                                                                                                           ™ÆØ.  ];
        elif ( ê†·Á•‚ÇäÆØ•©™†Â )
            [                                                                                                                                                                                           ‡„°.  ];
        else
            [                                                                                                                                                                                      ‚Î·. ‡„°.  ];
        end;
        
        [ƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ“ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ“ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø];
        [     ≥                                                      ∫                                         é°Æ‡Æ‚Î ß† Æ‚Á•‚≠Î© Ø•‡®Æ§                                          ∫                                                      ≥];
        [çÆ¨•‡≥                  ÇÂÆ§ÔÈ®• Æ·‚†‚™®                    «ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ∂                  à·ÂÆ§ÔÈ®• Æ·‚†‚™®                   ≥];
        [·Á•‚†≥                                                      ∫                        ØÆ §•°•‚„                     ≥                    ØÆ ™‡•§®‚„                        ∫                                                      ≥];
        [¢‚Æ- √ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ◊ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ◊ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¥];
        [‡Æ£Æ ≥       ‡„°.      ≥     ®≠.¢†´.,    ≥       ®‚Æ£Æ      ∫       ‡„°.      ≥     ®≠.¢†´.,    ≥       ®‚Æ£Æ      ≥       ‡„°.      ≥     ®≠.¢†´.,    ≥      ®‚Æ£Æ       ∫       ‡„°.      ≥     ®≠.¢†´.,    ≥       ®‚Æ£Æ      ≥];
        [ØÆ-  ≥                 ≥      §‡†£.      ≥                  ∫                 ≥      §‡†£.      ≥                  ≥                 ≥      §‡†£.      ≥                  ∫                 ≥      §‡†£.      ≥                  ≥];
        [‡Ô§™†≥                 ≥     ¨•‚†´´Î     ≥                  ∫                 ≥     ¨•‚†´´Î     ≥                  ≥                 ≥     ¨•‚†´´Î     ≥                  ∫                 ≥     ¨•‚†´´Î     ≥                  ≥];
        [ƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ◊ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ◊ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¥];
        [  1  ≥        2        ≥        3        ≥         4        ∫        5        ≥        6        ≥         7        ≥        8        ≥        9        ≥       10         ∫        11       ≥       12        ≥        13        ≥];
        [ƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ–ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ–ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ];
    End;

    Macro PrintHeadActive( Parm : RRG_F101_Parm )
        ee_insert_ef_values( " Ä™‚®¢" );
        [ Ä™‚®¢                                                                                                                                                                                                                            ];
    End;

    Macro PrintItogActive( Parm : RRG_F101_Parm, Itog : RRG_F101_Itog )
        ee_insert_ef_values( " " );
        ee_insert_ef_values( " à‚Æ£Æ ØÆ †™‚®¢„ (°†´†≠·)" );
        ee_insert_ef_values( " ", Pr(Itog.Sums()[RRG_IR],Parm), Pr(Itog.Sums()[RRG_IV],Parm), Pr(Itog.Sums()[RRG_IS],Parm), 
                                  Pr(Itog.Sums()[RRG_DR],Parm), Pr(Itog.Sums()[RRG_DV],Parm), Pr(Itog.Sums()[RRG_DS],Parm),
                                  Pr(Itog.Sums()[RRG_CR],Parm), Pr(Itog.Sums()[RRG_CV],Parm), Pr(Itog.Sums()[RRG_CS],Parm),
                                  Pr(Itog.Sums()[RRG_OR],Parm), Pr(Itog.Sums()[RRG_OV],Parm), Pr(Itog.Sums()[RRG_OS],Parm)
                           );
        ee_insert_ef_values( " " );

        [ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ];
        [ à‚Æ£Æ ØÆ †™‚®¢„ (°†´†≠·)                                                                                                                                                                     ];
        [      ################# ################# ################## ################# ################# ################## ################# ################# ################## ################# ################# ################## ]
        ( Pr(Itog.Sums()[RRG_IR],Parm):r:0:0, Pr(Itog.Sums()[RRG_IV],Parm):r:0:0, Pr(Itog.Sums()[RRG_IS],Parm):r:0:0, 
          Pr(Itog.Sums()[RRG_DR],Parm):r:0:0, Pr(Itog.Sums()[RRG_DV],Parm):r:0:0, Pr(Itog.Sums()[RRG_DS],Parm):r:0:0,
          Pr(Itog.Sums()[RRG_CR],Parm):r:0:0, Pr(Itog.Sums()[RRG_CV],Parm):r:0:0, Pr(Itog.Sums()[RRG_CS],Parm):r:0:0,
          Pr(Itog.Sums()[RRG_OR],Parm):r:0:0, Pr(Itog.Sums()[RRG_OV],Parm):r:0:0, Pr(Itog.Sums()[RRG_OS],Parm):r:0:0
        );
        [ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ];
    End;

    Macro PrintHeadPassive( Parm : RRG_F101_Parm )
        ee_insert_ef_values( " è†··®¢" );
        [ è†··®¢                                                                                                                                                                                       ];
    End;

    Macro PrintItogPassive( Parm : RRG_F101_Parm, Itog : RRG_F101_Itog )
        ee_insert_ef_values( " " );
        ee_insert_ef_values( " à‚Æ£Æ ØÆ Ø†··®¢„ (°†´†≠·)" );
        ee_insert_ef_values( " ", Pr(Itog.Sums()[RRG_IR],Parm), Pr(Itog.Sums()[RRG_IV],Parm), Pr(Itog.Sums()[RRG_IS],Parm), 
                                  Pr(Itog.Sums()[RRG_DR],Parm), Pr(Itog.Sums()[RRG_DV],Parm), Pr(Itog.Sums()[RRG_DS],Parm),
                                  Pr(Itog.Sums()[RRG_CR],Parm), Pr(Itog.Sums()[RRG_CV],Parm), Pr(Itog.Sums()[RRG_CS],Parm),
                                  Pr(Itog.Sums()[RRG_OR],Parm), Pr(Itog.Sums()[RRG_OV],Parm), Pr(Itog.Sums()[RRG_OS],Parm)
                           );
        ee_insert_ef_values( " " );

        [ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ];
        [ à‚Æ£Æ ØÆ Ø†··®¢„ (°†´†≠·)                                                                                                                                                                    ];
        [      ################# ################# ################## ################# ################# ################## ################# ################# ################## ################# ################# ################## ]
        ( Pr(Itog.Sums()[RRG_IR],Parm):r:0:0, Pr(Itog.Sums()[RRG_IV],Parm):r:0:0, Pr(Itog.Sums()[RRG_IS],Parm):r:0:0, 
          Pr(Itog.Sums()[RRG_DR],Parm):r:0:0, Pr(Itog.Sums()[RRG_DV],Parm):r:0:0, Pr(Itog.Sums()[RRG_DS],Parm):r:0:0,
          Pr(Itog.Sums()[RRG_CR],Parm):r:0:0, Pr(Itog.Sums()[RRG_CV],Parm):r:0:0, Pr(Itog.Sums()[RRG_CS],Parm):r:0:0,
          Pr(Itog.Sums()[RRG_OR],Parm):r:0:0, Pr(Itog.Sums()[RRG_OV],Parm):r:0:0, Pr(Itog.Sums()[RRG_OS],Parm):r:0:0
        );
        [ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ];
    End;

    Macro PrintFoot( Parm : RRG_F101_Parm )
        ee_insert_ef_values( " " );
        ee_insert_ef_values( string( {Name_Boss}:35,   " ", {FIO_Boss}:40,  " (î.à.é.)" ) );
        ee_insert_ef_values( string( {Name_Book}:35,   " ", {FIO_Book}:40,  " (î.à.é.)" ) );
        ee_insert_ef_values( "å.è." );
        ee_insert_ef_values( string( "à·ØÆ´≠®‚•´Ï":35, " ", à·ØÆ´≠®‚•´Ï:40, " (î.à.é.)" ) );
        ee_insert_ef_values( string( "í•´•‰Æ≠:":35,    " ", í•´•‰Æ≠à·ØÆ´≠®‚•´Ô ) );
        ee_insert_ef_values( {curdate} );
        ee_end_tbl;
        ee_close_ef;

        [ ];
        [   #                                 ##################################      (î.à.é.)]( {Name_Boss}:l, {FIO_Boss}:l );
        [   #                                 ##################################      (î.à.é.)]( {Name_Book}:l, {FIO_Book}:l );
        [   å.è.                                                                              ];
        [   à·ØÆ´≠®‚•´Ï                       ##################################      (î.à.é.)]( à·ØÆ´≠®‚•´Ï );
        [   í•´•‰Æ≠:                          #                                               ]( í•´•‰Æ≠à·ØÆ´≠®‚•´Ô:l );
        [   #                                                                                 ]( {curdate}:l );
        [ ];
    End;

    Macro ProcessBalance( Balance : RRG_F101_Balance, Parm : RRG_F101_Parm )

        ee_insert_ef_values( balance.Balance(), Pr(Balance.Sums()[RRG_IR],Parm), Pr(Balance.Sums()[RRG_IV],Parm), Pr(Balance.Sums()[RRG_IS],Parm), 
                                                Pr(Balance.Sums()[RRG_DR],Parm), Pr(Balance.Sums()[RRG_DV],Parm), Pr(Balance.Sums()[RRG_DS],Parm),
                                                Pr(Balance.Sums()[RRG_CR],Parm), Pr(Balance.Sums()[RRG_CV],Parm), Pr(Balance.Sums()[RRG_CS],Parm),
                                                Pr(Balance.Sums()[RRG_OR],Parm), Pr(Balance.Sums()[RRG_OV],Parm), Pr(Balance.Sums()[RRG_OS],Parm)
                           );
        [ ##### ############ ############ ############ ############ ############ ############ ############ ############ ############ ############ ############ ############  #]
        ( balance.Balance(), Pr(Balance.Sums()[RRG_IR],Parm):r:0:0, Pr(Balance.Sums()[RRG_IV],Parm):r:0:0, Pr(Balance.Sums()[RRG_IS],Parm):r:0:0, 
                             Pr(Balance.Sums()[RRG_DR],Parm):r:0:0, Pr(Balance.Sums()[RRG_DV],Parm):r:0:0, Pr(Balance.Sums()[RRG_DS],Parm):r:0:0,
                             Pr(Balance.Sums()[RRG_CR],Parm):r:0:0, Pr(Balance.Sums()[RRG_CV],Parm):r:0:0, Pr(Balance.Sums()[RRG_CS],Parm):r:0:0,
                             Pr(Balance.Sums()[RRG_OR],Parm):r:0:0, Pr(Balance.Sums()[RRG_OV],Parm):r:0:0, Pr(Balance.Sums()[RRG_OS],Parm):r:0:0,
          balance.BKind()
        );
    End;

    Macro ViewDOS( Parm : RRG_F101_Parm )

        file f() txt;

//        Parm.Protocol.PrintLine("é™Æ≠Á†≠®• Ì™·ØÆ‡‚† §†≠≠ÎÂ îÆ‡¨Î 101.");
        Parm.Protocol.PrintLine( "*** "+ time+ " "+ date+ " é™Æ≠Á†≠®• Ì™·ØÆ‡‚† §†≠≠ÎÂ îÆ‡¨Î 101" );
//        Parm.Protocol.PrintLine("ç†¶¨®‚• ESC §´Ô Ø‡Æ·¨Æ‚‡† ‰†©´† Ì™·ØÆ‡‚†.");

        Parm.Protocol.View();

    End;

    Macro ViewExcel( Parm : RRG_F101_Parm )

        var path    = "",
            exlname = "";

        path = GetCurDir(not IsStandAlone );

        if ( Parm.EndDate < Parm.Date1376 )
            exlname = "tmpl_101.xls";
        else
            exlname = "tmpl101b.xls";
        end;

        if( IsStandAlone )
            ExecMacroFile( "pr101_xl.mac", "PrintByFile", m_EE_EXP_FILE_NAME, exlname, ê†·Á•‚ÇäÆØ•©™†Â and (not Parm.PrintCop), path, parm.EndDate );
        else
            if ( not CopyFile(m_EE_EXP_FILE_NAME,"$"+m_EE_LOCAL_FILE_NAME) )
                RRG_F101_XThrow( RRG_F101_XError, String("éË®°™† Ø‡® Ø•‡•§†Á• ‰†©´†:|",m_EE_EXP_FILE_NAME) );
            end;
            CallRemoteRsl( "pr101_xl.mac", "printByFile", path + "\\" + m_EE_LOCAL_FILE_NAME, exlname, ê†·Á•‚ÇäÆØ•©™†Â and (not Parm.PrintCop), path );
        end;

    End;

    Macro View( Parm : RRG_F101_Parm )

        if ( not Parm.isExcel )
            ViewDOS( Parm );
        else
            ViewExcel( Parm );
        end;

    End;

    Constructor();

END;


/* EVG 12/03/2014 è•‡•ÂÆ§ ≠† 2031. Ç Ì‚Æ¨ °Æ´ÏË• ≠•‚ ≠•Æ°ÂÆ§®¨Æ·‚®, ®·ØÆ´Ïß„•¨ §®·‚‡®°„‚®¢≠Î• Æ°Í•™‚Î.
private
MACRO GetQuery( Chapter, BKind, BegDate, EndDate )

    Macro GetVarName( Suffix )
        return "'Å≠' || TRANSLATE(bl.t_Balance,'.\\/','___') || " + GetSQLString(Suffix);
    End;

    Macro SelectString( ps )
        return "       CASE"                                                                                            + "\n" +
               "           WHEN    NVL(vd"+ps+".t_bdInclude," + GetSQLDate(Date(0,0,0)) + ") <= " + GetSQLDate(EndDate) + "\n" +
               "               AND NVL(vd"+ps+".t_bdExclude," + GetSQLDate(Date(0,0,0)) + ") >= " + GetSQLDate(BegDate) + "\n" +
               "               THEN 1 "                                                                                 + "\n" +
               "           ELSE 0 "                                                                                     + "\n" +
               "       END "+ps+"w, "                                                                                   + "\n" +
               "       vd"+ps+".t_cFormat "+ps+"f,"                                                                     + "\n" +
               "       mr"+ps+".t_mean1   "+ps+"1,"                                                                     + "\n" +
               "       mr"+ps+".t_mean2   "+ps+"2 ";
    End;

    Macro WhereString( ps, suff, begdate, enddate )
        return "       AND vd"+ps+".t_iFormId(+)               = " + 1                            + "\n" +
               "       AND vd"+ps+".t_szVarName(+)             = " + GetVarName(suff)             + "\n" +
               "       AND mr"+ps+".t_iNumDprt(+)              = " + çÆ¨•‡èÆ§‡†ß§•´•≠®Ô           + "\n" +
               "       AND mr"+ps+".t_OrganizationStructure(+) = " + RcbOrganizationStructure     + "\n" +
               "       AND mr"+ps+".t_IssueMode(+)             = " + RcbIssueMode                 + "\n" +
               "       AND mr"+ps+".t_IsSummary(+)             = " + RcbSqlBool(RcbIsSummaryMode) + "\n" +
               "       AND mr"+ps+".t_bdRepDate(+)             = " + GetSQLDate(enddate)          + "\n" +
               "       AND mr"+ps+".t_bdPrevDate(+)            = DECODE(vd"+ps+".t_cDoubleDates, CHR(0),"+GetSQLDate(Date(0,0,0))+","+GetSQLDate(begdate)+")" + "\n"+
               "       AND mr"+ps+".t_iFormId(+)               = " + 1                            + "\n" +
               "       AND mr"+ps+".t_iVarId(+)                = vd"+ps+".t_iVarId";
    End;
    
    Macro GetIsAP()
        return "       DECODE(INSTR(bl.t_Kind_Account,"+GetSQLString(KA_AP)+"),0,0,1)";
    End;

    Macro GetFilterBKind()
//return "       INSTR(DECODE(bl.t_Kind_Account, " + GetSQLString(KA_0) + ", " + GetSQLString(KA_A) + ", bl.t_Kind_Account), " + GetSQLChar(BKind) + ") > 0";
      if (chapter==1)
        return "       ((INSTR(DECODE(bl.t_Kind_Account, " + GetSQLString(KA_0) + ", " + GetSQLString(KA_A) + ", bl.t_Kind_Account), 'Ä') > 0) or" +
               "        (INSTR(DECODE(bl.t_Kind_Account, " + GetSQLString(KA_0) + ", " + GetSQLString(KA_A) + ", bl.t_Kind_Account), 'è') > 0) )";
      else
        return "       (vdar.t_szVarName is not null or"                        + "\n" +
               "        vdpr.t_szVarName is not null)"                          + "\n";
      end;
    End;

    return "SELECT bl.t_Balance      Balance,"                                  + "\n" +
//                   GetSQLChar(BKind)  + " BKind,"                               + "\n" +
           "       decode(bl.t_kind_account,'0','Ä',bl.t_kind_account) BKind,"  + "\n" +
                   GetIsAP()          + " isAP,"                                + "\n" +
                   SelectString("cs") + ","                                     + "\n" +
                   SelectString("cr") + ","                                     + "\n" +
                   SelectString("cp") + ","                                     + "\n" +
                   SelectString("ds") + ","                                     + "\n" +
                   SelectString("dr") + ","                                     + "\n" +
                   SelectString("dp") + ","                                     + "\n" +
                   SelectString("as") + ","                                     + "\n" +
                   SelectString("ar") + ","                                     + "\n" +
                   SelectString("ap") + ","                                     + "\n" +
                   SelectString("ps") + ","                                     + "\n" +
                   SelectString("pr") + ","                                     + "\n" +
                   SelectString("pp")                                           + "\n" +
           "FROM   dbalance_dbt  bl, "                                          + "\n" +
           "       dcy_varsd_dbt vdcs, dcy_varsd_dbt vdcr, dcy_varsd_dbt vdcp," + "\n" +
           "       dcy_varsd_dbt vdds, dcy_varsd_dbt vddr, dcy_varsd_dbt vddp," + "\n" +
           "       dcy_varsd_dbt vdas, dcy_varsd_dbt vdar, dcy_varsd_dbt vdap," + "\n" +
           "       dcy_varsd_dbt vdps, dcy_varsd_dbt vdpr, dcy_varsd_dbt vdpp," + "\n" +
           "       dcy_mreal_dbt mrcs, dcy_mreal_dbt mrcr, dcy_mreal_dbt mrcp," + "\n" +
           "       dcy_mreal_dbt mrds, dcy_mreal_dbt mrdr, dcy_mreal_dbt mrdp," + "\n" +
           "       dcy_mreal_dbt mras, dcy_mreal_dbt mrar, dcy_mreal_dbt mrap," + "\n" +
           "       dcy_mreal_dbt mrps, dcy_mreal_dbt mrpr, dcy_mreal_dbt mrpp " + "\n" +
           "WHERE      bl.t_Chapter         = " + Chapter                       + "\n" +
           "       AND bl.t_iNumPlan        = " + èÆ´„Á®‚Ïê•†´Ï≠Î©çÆ¨•‡è´†≠†()  + "\n" +
           "       AND " + GetFilterBKind()                                     + "\n" +
           "       AND INSTR(bl.t_Type_Balance," + GetSQLChar("1")   + ") = 0"  + "\n" +
           "       AND INSTR(bl.t_Type_Balance," + GetSQLChar("T")   + ") = 0"  + "\n" +
           "       AND bl.t_bdIncludeBwp <= " + getSqlDate(EndDate)             + "\n" +
           "       AND (    bl.t_bdExcludeBwp >= " + getSqlDate(BegDate)        + "\n" +
           "             OR bl.t_bdExcludeBwp <  bl.t_bdIncludeBwp)"            + "\n" +

           "       AND NOT bl. t_balance like '%éÇè%'"                          + "\n" +

                   WhereString("cs","__ä", BegDate, EndDate)                    + "\n" +
                   WhereString("cr","ê„ä", BegDate, EndDate)                    + "\n" +
                   WhereString("cp","èÆä", BegDate, EndDate)                    + "\n" +
                   WhereString("ds","__Ñ", BegDate, EndDate)                    + "\n" +
                   WhereString("dr","ê„Ñ", BegDate, EndDate)                    + "\n" +
                   WhereString("dp","èÆÑ", BegDate, EndDate)                    + "\n" +
                   WhereString("as","__Ä", BegDate, EndDate)                    + "\n" +
                   WhereString("ar","ê„Ä", BegDate, EndDate)                    + "\n" +
                   WhereString("ap","èÆÄ", BegDate, EndDate)                    + "\n" +
                   WhereString("ps","__è", BegDate, EndDate)                    + "\n" +
                   WhereString("pr","ê„è", BegDate, EndDate)                    + "\n" +
                   WhereString("pp","èÆè", BegDate, EndDate)                    + "\n" +
           "ORDER BY decode(bl.t_Chapter,3,0,bl.t_Chapter),bl.t_Balance";

END;
EVG 12/03/2014 è•‡•ÂÆ§ ≠† 2031 */

private
MACRO CheckForm()
    if ( {ç†ß¢†≠®• Æ‚Á•‚†} != FORM_NAME )
        RRG_F101_XThrow( RRG_F101_XError, String("å†™‡Æ· ‡•†´®ßÆ¢†≠ ‚Æ´Ï™Æ §´Ô Ø‡®´Æ¶•≠®Ô \"",FORM_NAME,"\"") );
    end;
END;


/* EVG 12/03/2014 è•‡•ÂÆ§ ≠† 2031. ë‚†‡†Ô ‰„≠™Ê®Ô - ß†™Æ¨¨•≠‚®´, ‚•Ø•‡Ï §‡„£†Ô.
private
MACRO ProcessBalances( parm : RRG_F101_Parm, BKind : String, Itog : RRG_F101_Itog, Report : RRG_F101_Report )

    Macro isPrint( Balance : RRG_F101_Balance )

        var stat : Bool = true;

        if ( stat )
            stat =    (parm.PrintKind == PRK_ALL)
                   or (parm.PrintKind == PRK_BWP) and     Balance.isWork()
                   or (parm.PrintKind == PRK_NOZ) and not Balance.isZero();
        end;

        if ( stat )
            stat =    (not Balance.isAP())
                   or ((Balance.Sums()[RRG_OR] >= 0) and (BKind == KA_A))
                   or ((Balance.Sums()[RRG_OR] >  0) and (BKind == KA_P));
        end;
     
        return stat;

    End;


    var dataSet = TRsbDataSet(GetQuery(parm.Chapter, BKind, parm.BegDate, parm.EndDate));

    var Balance : RRG_F101_Balance;

    while( dataSet.moveNext() )

        if ( èÆ‡Ô§Æ™Å†´†≠·Æ¢Æ£ÆëÁ•‚†( dataSet.Balance ) != 3)
          continue;
        end;

        Balance = RRG_F101_Balance( dataSet );

        Message("é°‡†°†‚Î¢†•‚·Ô °†´†≠·Æ¢Î© ·Á•‚: ", Balance.Balance(), " (" + BKind + ")");

        if ( isPrint(Balance) )
            Report.ProcessBalance( Balance, parm );

            Itog.AddB(Balance);
        end;
    end;

END;
EVG 12/03/2014 è•‡•ÂÆ§ ≠† 2031 */



/* EVG 12/03/2014 è•‡•ÂÆ§ ≠† 2031. çÆ¢†Ô ‰„≠™Ê®Ô Ø•‡•°Æ‡† Åë. */
private
MACRO ProcessBalances( parm : RRG_F101_Parm, BKind : String, Itog : RRG_F101_Itog, Report : RRG_F101_Report )

    var av = TBalanceAttribute("ÅÄãÄçë");

    av.createBalanceIterator( parm.Chapter, KIND_ALL, false, false );
    av.sortIteratorByBalance();

    var Balance : RRG_F101_Balance;


    Macro isPrint()
        var stat : Bool = true;

        if ( stat )
            stat =    (parm.PrintKind == PRK_ALL)
                   or (parm.PrintKind == PRK_BWP) and av.isBwp()
                   or (parm.PrintKind == PRK_NOZ) and av.isNonZero( av.getValue() );
        end;

        /* ëÁ•‚† · ‚®ØÆ¨ 0 ®·™´ÓÁ†Ó‚·Ô ®ß Æ°‡†°Æ‚™® */
        if ( stat )
            stat =  Balance.BKind != KA_0;
        end;

        if ( stat )
            stat =    (not Balance.isAP())
                   or ((Balance.Sums()[RRG_OR] >= 0) and (BKind == KA_A))
                   or ((Balance.Sums()[RRG_OR] >  0) and (BKind == KA_P));
        end;
     
        return stat;
    End;


    //debugbreak;
    while( av.next() )

        Balance = RRG_F101_Balance( av );

        Message("é°‡†°†‚Î¢†•‚·Ô °†´†≠·Æ¢Î© ·Á•‚: ", Balance.Balance(), " (" + BKind + ")");

        if ( isPrint() )
            Report.ProcessBalance( Balance, parm );

            Itog.AddB( Balance );
        end;

    end;

END;



private
MACRO PrintFormBody( parm : RRG_F101_Parm, Report : RRG_F101_Report )

    var Itog : RRG_F101_Itog;

//    Report.PrintChapterName( parm );

//    Itog = RRG_F101_Itog(parm);    
//    Report.PrintHeadActive( parm );
    ProcessBalances( parm, "Ä", Itog, Report );
//    Report.PrintItogActive( parm, Itog );

//    Itog = RRG_F101_Itog(parm);
//    Report.PrintHeadPassive( parm );
//    ProcessBalances( parm, "è", Itog, Report );
//    Report.PrintItogPassive( parm, Itog );

END;

private
MACRO PrintFormPeriod( parm : RRG_F101_Parm, Report : RRG_F101_Report )

    var Chapter : Integer;
    
//    Report.PrintHead( parm );

    if ( parm.Chapter == 0 )
        Chapter = 1;
        while( Chapter <= 5 )
            parm.Chapter = Chapter;
            PrintFormBody( parm, Report );
            Chapter = Chapter + 1;
        end;
        parm.Chapter = 0;
    else
        PrintFormBody( parm, Report );
    end;

//    Report.PrintFoot( parm );

END;

private
MACRO PrintForm( Parm : RRG_F101_Parm, Report : RRG_F101_Report )

    var CurDate = Parm.BegDate;
    var BegDate = Parm.BegDate;
    var EndDate = Parm.EndDate;

    while ((not RcbIsWorkday(CurDate)) and (CurDate <= EndDate))
        CurDate = CurDate + 1;
    end;

    if ( CurDate > parm.EndDate )
        RRG_F101_XThrow( RRG_F101_XWarning, "Ç ß†§†≠≠Æ¨ Æ‚Á•‚≠Æ¨ Ø•‡®Æ§• ‚Æ´Ï™Æ ¢ÎÂÆ§≠Î• §≠®.|é‚Á•‚ ≠• ·‰Æ‡¨®‡Æ¢†≠." );
    end;

    if ( Parm.EveryDay )

        while( CurDate <= EndDate )
            parm.BegDate = CurDate;
            parm.EndDate = CurDate;

            PrintFormPeriod(parm,Report);

            CurDate = DateAfterWorkDays(CurDate,1);
        end;

    else
        PrintFormPeriod(Parm,Report);
    end;

    Parm.BegDate = BegDate;
    Parm.EndDate = EndDate;

END;

private
MACRO ExitCode( Parm : RRG_F101_Parm )
    if ( Parm.isExcel )
        return 1;
    else
        return 0;
    end;
END;

MACRO RRG_F101_Main( Chapter, Report : RRG_F101_Report )

    var Parm : RRG_F101_Parm;

    CheckForm();

    Parm = RRG_F101_Parm(Chapter);

    var exponame = "bal"+Chapter+".txt";//buildFileName;

    if( not GetExpFileName( exponame ) )
      exit(1);
    end;

    setOutput( exponame, FALSE);

    PrintForm(Parm,Report);

    Report.View(Parm);

    setOutput();

    viewfile(exponame,false);

    println("ç†¶¨®‚• Esc §´Ô Ø‡Æ§Æ´¶•≠®Ô");

    return ExitCode(Parm);

    OnError(err);
    RRG_F101_XCatch(err);
    return 1;

END;

