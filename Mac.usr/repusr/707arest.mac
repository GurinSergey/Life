//import cb_sql;
//import rcbCoreInter;
//;import RcbProtocolView;
//;import RcbPtkPsdView;
//;import Календарь;

// zmp 29.12.2014 I-00542502-2 убрано daccount$_dbt
//12.03.2015 I-00556114-2 DPN Полю t_type_account нельзя присвоить NULL

//
import "rsexts.d32";
import globals, RSD,rcw, rslx, Календарь, rsbdataset, ptinter, bankinter;
//import commonInter;

//ConfDlg ("Укажите с каким признаком выполнить выгрузку", null, "Ежемесячная","Внутримесячная");


macro ustanovka();
   var cmd;
   var str_dobavit:string = " "+
                            " UPDATE   daccount_dbt "+
                            "   SET   t_type_account  = CASE "+
                            "                              WHEN (t_type_account = CHR (1)) THEN 'Т' "+
                            "                              WHEN INSTR (t_type_account, 'Т', 1) = 0 THEN TRIM (t_type_account || 'Т') "+
                            "                              ELSE t_type_account "+
                            "                           END "+
                            " WHERE   t_account LIKE '707%' ";
        cmd = RSDCommand(str_dobavit);
	cmd.Execute;

        str_dobavit      = " UPDATE   daccount_dbt "+
                           "   SET   t_type_account   = CASE "+
                           "                               WHEN (t_type_account = CHR (1)) THEN 'У' "+
                           "                               WHEN INSTR (t_type_account, 'У', 1) = 0 THEN TRIM (t_type_account || 'У') "+
                           "                               ELSE t_type_account "+
                           "                            END "+
                           " WHERE   t_account LIKE '707%' ";
	cmd = RSDCommand(str_dobavit);
	cmd.Execute;
end;


macro snyat;
   var cmd, str_del:string = " ";
            str_del = "	UPDATE   daccount_dbt	"+
                      "	   SET   t_type_account   = CASE	"+
                      "	                               WHEN INSTR (t_type_account, 'У', 1) <> 0	"+
                      "	                               THEN	"+
                      "	                                  nvl(SUBSTR (t_type_account, 1, (INSTR (t_type_account, 'У', 1) - 1))|| SUBSTR (t_type_account, INSTR (t_type_account, 'У', 1) + 1), ' ')"+ //12.03.2015 I-00556114-2 DPN 
                      "	                               ELSE	"+
                      "	                                  t_type_account	"+
                      "	                            END	"+
                      "	 WHERE   t_account LIKE '707%'	";
	cmd = RSDCommand(str_del);
	cmd.Execute;

        str_del = " UPDATE   daccount_dbt	"+
                  "	   SET   t_type_account   = CASE	"+
                  "	                               WHEN INSTR (t_type_account, 'Т', 1) <> 0	"+
                  "	                               THEN	"+
                  "	                                  nvl(SUBSTR (t_type_account, 1, (INSTR (t_type_account, 'Т', 1) - 1))|| SUBSTR (t_type_account, INSTR (t_type_account, 'Т', 1) + 1), ' ')"+ //12.03.2015 I-00556114-2 DPN 
                  "	                               ELSE	"+
                  "	                                  t_type_account	"+
                  "	                            END	"+
                  "	 WHERE   t_account LIKE '707%'	";
  	cmd = RSDCommand(str_del);
	cmd.Execute;
end;


Array Text;
Array Buttons;
var vybor:integer=-3;

Text(0) = "'ТУ' - арест на дебет, арест на кредит";

Buttons(0) = "Отмена";
Buttons(1) = "УСТАНОВИТЬ признаки на 707*";
Buttons(2) = "СНЯТЬ признаки с 707*";

vybor=ConfWin( Text, Buttons );
if (vybor==1)  // 
   ustanovka;
   msgbox("рекомендуем проверить корректность установки признаков ареста дебета и кредита на счетах 707* (валюта, рубли, покрытие)");
elif (vybor==2)
   snyat;
   msgbox("рекомендуем проверить корректность снятия признаков ареста дебета и кредита со счетов 707* (валюта, рубли, покрытие)");
else 
   msgbox("останавливаюсь vybor="+vybor);
   exit(1);
end;
exit(1);
/*



*/