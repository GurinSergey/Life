/****************************************************************************************************************************************************************/
/*                                    Макрос Rep_DocDay.mac - функции для работы отчетов "Документы дня"                                                        */
/****************************************************************************************************************************************************************/
/* Дата создания: 02.07.2012                                                                                                                                    */
/* Автор:         Glushin S.P. по С-10079, С-11944, С-12388                                                                                                     */
/* Клиент:        Пробизнесбанк                                                                                                                                 */ 
/* Переписаны функции под отчет нового образца, использовано несколько старых макропроцедур                                                                     */
/****************************************************************************************************************************************************************/
/*    Дата    * подпись * расшифровка  *   заявка    *                                      комментарии                                                         */
/****************************************************************************************************************************************************************/
/* 06.07.2012     GSP     Glushin S.P.                 исправлен отбор док-в в реестр внешних                                                                   */
/* 11.07.2012     GSP     Glushin S.P.   I-00219670-2  добавлено определение переменной oper2                                                                   */
/*                GSP     Glushin S.P.   I-00219763-2  увеличена длина поля отдел                                                                               */
/* 12.07.2012     GSP     Glushin S.P.                 Исправлен отбор приходно-расходных и подсчет суммы внешних конверсионных в сводной контрольной ведомости */
/*                                                     Исправлен отбор в реестре внешних по подразделению и отделу, исправлено задвоение транзитных             */
/* 13.07.2012     GSP     Glushin S.P.                 Исправления в подтягивании дат в отчет                                                                   */
/* 13.07.2012     GSP     Glushin S.P.                 Добавлена возможность выпуска контр.ведомости банка только по выбранному отделу                          */
/*                                                     Изменен входной параметр процедуры Get_Dev_prop c paym.t_usertypedocument на arh.t_typedocument          */
/* 16.07.2012     GSP     Glushin S.P.                 Внесены поправки в определение внутрибанковских документов, добавлены упущенные балансовые счета         */
/* 30.07.2012     GSP     Glushin S.P.                 Исправлены ошибки задвоения опер-а в неизв.подр-и и выпуска сводного реестра в валюте по банку           */
/* 31.07.2012     GSP     Glushin S.P.   I-00227921-2  Исправлены отчеты по Внебалансу и Срочным операциям, Исправлен отбор приходно-расходных                  */
/*                                                     Исправлена печать шапки отчета для сводного реестра по операционисту                                     */			       
/* 01.08.2012     GSP     Glushin S.P.   I-00228943-2  Исправлена ошибка определения типа хранения по внебалансу, приводящая к расхождению контр. ведомости и   */
/*                                       I-00228779-2  сводного реестра.Исправления в справке ДЭВ по внебалансу                                                 */
/* 02.08.2012     GSP     Glushin S.P.   I-00229018-2  Исправления в справке ДЭВ                                                                                */
/*                GSP     Glushin S.P.   I-00223454-2  Вывод в итогах контролера, нач.подразделения                                                             */
/* 08.08.2012     GSP     Glushin S.P.                 Дополнение в поиске проводки покрытия для валютной проводки                                              */
/* 09.08.2012     GSP     Glushin S.P.                 Добавлено определение вида хранения по категории платежа, если она есть, не смотря на стандартный отбор  */
/* 10.08.2012     GSP     Glushin S.P.                 Исправления в отборе кассовых, в запросе по внутренним документам в сводной контрольной ведомости        */
/* 03.09.2012     GSP     Glushin S.P.                 Исправлено несоответствие отчетов по конверсионным операциям                                             */
/* 03.09.2012     GSP     Glushin S.P.                 Исправления в справке ДЭВ по конверсионным операциям, добавленн result_carry = 82                        */
/* 10.09.2012     GSP     Glushin S.P.                 Исправление вывода сумм курсовой разницы. Это проводки в рублях, а не в валюте эквиваленте               */
/* 11.10.2012     GSP     Glushin S.P.   I-00264212-2  В отчет "реестр внешних" добавлена процедура проверки категории вида хранения платежа                    */
/* 26.10.2012     GSP     Glushin S.P.   I-00274826-2  Добавлена проверка на число документов в запросе и отчете по конверсионным кассовым.                     */
/* 29.10.2012     GSP     Glushin S.P.                 исключены проводки курсовой разницы из отбора кассовых, они учитываются во внутренних.                   */
/* 07.11.2012     GSP     Glushin S.P.   I-00280317-3  Исправление в процедуре проверки категории вида хранения документа                                       */
/* 14.11.2012     GSP     Glushin S.P.   C-15636       Добавлена возможность выпуска Реестра внешних по номеру пачки.                                           */
/* 19.11.2012     GSP     Glushin S.P.   I-00286355-3  Исправлена ошибка с выпуском реестра внешних платежей                                                    */
/* 23.11.2012     GSP     Glushin S.P.   C-9695        Проверка привязки опера к оргструктуре при выпуске отчета по операционисту                               */
/* 18.12.2012     GSP     Glushin S.P.                 В справке ДЭВ добавлен exists на проверку категории вида хранения                                        */
/* 27.12.2012     GSP     Glushin S.P.   I-00306552-3  Добавил nvl() при отборе кассовых, чтобы не было ошибки приведения типов.                                */
/*                                       I-00304098-3  Исправления в справке ДЭВ, отмена проверки категории по внебалансовым счетам картотек.                   */
/* 01.02.2013     GSP     Glushin S.P.   C-17070       Убрано условие по типу отчета при заполнении поля "пачка" для рублевого отчета(временно) до C-17070      */
/* 06.02.2013     GSP     Glushin S.P.   I-00321900-2  Отредактировал получение суммы в рублях для валютной справки ДЭВ                                         */
/* 12.02.2013     GSP     Glushin S.P.                 Справка ДЭВ, добавлена проверка на specval в поле рублевой суммы,добавлен импорт lib_const               */
/*                                                     Исправлено определение вида хранения для документов по внебалансу для контрольной ведомости банка        */
/* 15.03.2013     joy     Жаворонкова Н. I-00291358-3  Исправление подсчета суммы покрытия и исклюбчение счетов ОВП                                             */
/* 15.05.2013     GSP     Glushin S.P.                 Приведение контрольной ведомости банка в соответствие со сводной ведомостью                              */
/* 21.05.2013     joy     Жаворонкова Н.               В янв. 2013 г. в ГЭБе по вине внешней системы есть некоректные проводки, которые требуют отдельного учета*/
/* 19.07.2013     GSP     Glushin S.P.   C-17070-6     Наборное поле "пачка", вывод информации по заданным номерам пачек в отчете                               */
/* 02.08.2013     joy     Жаворонкова Н. I-00408066-2  Баланс\Внешние Рубли или Валюта (реестр платежей) дата закрытия БИК д.б. строго больше даты отчета,      */
/*                                                     иначе в день закрытия БИКа один документ отбирается дважды                                               */
/* 20.08.2013     GSP     Glushin S.P.   C-22673       Реализация расшифровки данных по неизвестному подразделению в сводной контрольной ведомости              */
/* 15.08.2014     DPN     Dyachuk. P.N   R-421158-2    Попадали лишние проводки по внешним валютным платежам. Добавил условие отбора по корсхеме                */
/* 06.09.2014     GSP     Glushin S.P.   R-465268-2    Изменен принцип отбора поля главы БС для отчетов по подразделению                                        */
/* 10.10.2014     GSP     Glushin S.P.   I-00486434-2  Изменения в отборе проводок курсовой разницы по неизвестному подразделлению                              */
/* 17.11.2014     GSP     Glushin S.P.   R-485464-2    Изменен алгоритм определения вида хранения для внебаланса на соответствующий ЭА                          */
/* 25.11.2014     GSP     Glushin S.P.                 Изменение отбора параметра t_chapter - глава должна браться только с проводки, а не с платежа            */
/****************************************************************************************************************************************************************/


import globals, oralib, "lib_lang.mac", FIInter,OprInter, treport,payminter,/*UF_Common,*/LikePy;
//import "repdocdaydiag"; //Диалоговая панель и ее обработчик
import "rep_func.mac";      //Доп. функции
/*//RunDialog(dlg,"HandleEvent");  */
import "fg_Life_parm.mac"; // KS 26.01.2011
import likePy, lib_const;
var const_message=" ~F2~ Продолжить ~F3~ Выбор (Shift)~F12~ Сохранение/очистка настроек  ~ESC~ Выход ";
var DateDocum,
    CodDep:integer,
    CodOtdela:integer,
    NumDepart:string = "",
    NameDepart:string = "",
/*rssl*/ 
    ButDep:string = "",
    ButOtd:string = "",
    NumOtdel:string = "",
    NumPodOtdel:string = "",
    NameOtdel:string = "",
    HeaderName:string = "", /*Руководитель подразделения*/
    ControlName:string = "", /*Контролер*/
/*rssl*/
    NumDep:string = "",
    Dep:string = "",
    Oper:integer = 0,
    NameOper:string = "",
    Account:string = "",
    
    RepTypeS = "",
    RepFormS = "",
    VidHranS = "",
    PachkaS:string,
    Valuta_otchetaS = "";
var OrgRegStruct = "", 
    OrgRegStructName = "",
    OperSelect = "";
    private var fgBank = fg_life_subject({OurBank});
/* ------------------------------------------------------------------------ */
   Macro LoadRegVal ( Path, Type )
        Var sql, DefVal = "";
        if ( Type == V_INTEGER )
            sql = "select t_lintvalue from dregval_dbt where t_keyid = rsb_common.GetRegParm (:path) and t_regkind=0";
            DefVal = 0;
        elif ( Type == V_STRING )
            sql = "select utl_raw.cast_to_varchar2 (t_fmtblobdata_xxxx) from dregval_dbt where t_keyid = rsb_common.GetRegParm (:path) and t_regkind=0";
        end;
        if ( sql )
            sql = ExecSqlSelect (sql, MakeArray (SqlParam ("path", Path)));
            if ( sql.MoveNext ())// and (ValType (sql.value (0)) != V_SPECVAL) )
                return sql.value (0);
            end;
        end;
        return DefVal;
    End;
/* ------------------------------------------------------------------------ */
// 17.10.2011 Жаворонкова Н. по R-18310-2, I-00118990-2
private macro getShortName (fullname:string):string
  while (index (fullname, "  ")) // 2011-11-11 zip_z. Защита от некорректных параметров
     fullname = trim (strSubst (fullName, "  ", " "));
  end;

  var f = split (trim(fullName), " ");
  if (f.size (f) == 2)
    return fullName;
  else
    return (string(f[0], " ", strUpr (substr (f[1], 1, 1)), ".", strUpr (substr (f[2], 1, 1)), "."));
  end;
end;


/* ------------------------------------------------------------------------ */
// KS 11.10.2010 I-037484 Доработка мемориального ордера для валютных операций: Сумма в рублях
MACRO СуммаРуб( m_AmountCur: money, m_FIID:integer, onDate:date )
  var m_AmountRub = $0;
  if( ( ( m_FIID != 0 ) and ( m_AmountCur != $0 )))
    if( not(ConvSumCross( m_AmountRub, m_AmountCur, onDate, m_FIID, 0/*NATCUR*/ ) ) )
      m_AmountRub = $0;
    end;
  end;
  return m_AmountRub;
END;

/* if( CompareStrWithMasks("10-29", Pmkz.PayerCode) )
        MsgBox("Некорректное значение КОд");
        return fld_kzPayerCode;
      end;*/
/* ------------------------------------------------------------------------ */
MACRO kateg_vid_hran(paymentid:integer, StoreKindC:integer,t_Chapter:integer); //GSP 07.11.2012 добавлен параметр t_chapter, чтобы исключить проверку по внебалансу
private var select,data;
	select =
"	select obj.t_attrid from dobjatcor_dbt obj     "+
"	where t_object = lpad("+ paymentid +",10,0)    "+
"	and obj.t_groupid = 1010                       "+
"	and obj.t_objecttype = 501                     ";
        Data = ExecSQLSelect(Select);
if((data.movenext()) and (t_chapter !=3))
	if(data.value("t_attrid") == 1)	
debugbreak;
debugbreak;
	StoreKindC = 0;
	return(StoreKindC);
	elif(data.value("t_attrid") == 2)	
	StoreKindC = 1;
	return(StoreKindC);
	else
	return(StoreKindC);
	end;
else
	return(StoreKindC);
end;
END;
/* ------------------------------------------------------------------------ */
MACRO checkZeroSum(summa, payment, debet:bool);
   private var selectSum,paramSum,dataSum;
   if (payment != 0)
    if(summa == 0)
       selectSum = " Select t_sum_payer from dacctrn_dbt arh, dpmdocs_dbt doc "+
                   " Where arh.t_acctrnID = doc.t_acctrnID                    "+
                   "   and doc.t_paymentid = :paym                            ";
       if(debet) selectSum = selectSum +
                   "   and arh.t_account_receiver like '%ОВП%'                ";
       else selectSum = selectSum +
                   "   and arh.t_account_payer like '%ОВП%'                   ";
       end;
       paramSum = makeArray (SQLParam ("paym",payment));
       dataSum = ExecSQLSelect(SelectSum,paramSum);
       if(dataSum.movenext())
          return dataSum.value(0);
       else
          return summa;
       end;
    else
       return summa;
    end;
   else
      return " - ";
   end;
END;

MACRO poluchenie_summ_v_valute(debet:string,credit:string, payment:integer,sum:money)
var summa_дебет, valuta_дебет, summa_кредит, valuta_кредит,select_val,data_val;
 if(substr(debet,6,3) == "810")
        summa_дебет = sum;//"-";//  data.value("Sum");
       valuta_дебет = "RUR";
 else
   if(payment != 0)
     select_val = "select arh.T_SUM,fi.t_ccy from darhdoc$_dbt arh,dpmdocs_dbt docs, dfininstr_dbt fi "+
             "where arh.t_applicationkey = docs.t_applicationkey                                 "+
             "and fi.T_CODEINACCOUNT = substr(arh.t_account_payer,6,3)                        "+
             "and docs.t_paymentid = " + payment                                ;
     Data_val = ExecSQLSelect(Select_val);
        if(Data_val.movenext())
        summa_дебет = Data_val.value("t_sum");
       valuta_дебет = Data_val.value("t_ccy");
        else
        summa_дебет = sum;// "-";// data.value("Sum");
       valuta_дебет = "RUR";
        end;
   else
        summa_дебет = sum;// "-";//  data.value("Sum");
       valuta_дебет = "RUR";
   end;
 end;
 if(substr(credit,6,3) == "810")
        summa_кредит = sum;// "-";//  data.value("Sum");
       valuta_кредит = "RUR";
 else
   if(payment != 0)
     select_val = "select arh.T_SUM,fi.t_ccy from darhdoc$_dbt arh,dpmdocs_dbt docs, dfininstr_dbt fi "+
             " where arh.t_applicationkey = docs.t_applicationkey                                 "+
             " and fi.T_CODEINACCOUNT = substr(arh.t_account_receiver,6,3)                        "+
             " and docs.t_paymentid = " + payment                                ;
     Data_val = ExecSQLSelect(Select_val);
        if(Data_val.movenext())
        summa_кредит = Data_val.value("t_sum");
       valuta_кредит = Data_val.value("t_ccy");
        else
        summa_кредит = sum;// "-";//  data.value("Sum");
       valuta_кредит = "RUR";
        end;
   else
        summa_кредит = sum;// "-";//  data.value("Sum");
       valuta_кредит = "RUR";
   end;
 end;
    SetParm(4,summa_дебет);
    SetParm(5,valuta_дебет);
    SetParm(6,summa_кредит);
    SetParm(7,valuta_кредит);
END;
/*-----------------------------------------------------------------------*/
MACRO summa_pokritia(appkey:string)
private var select,data,summa;
select = "select rub.t_sum from darhdoc_dbt rub,darhdoc$_dbt val "+
         " where val.t_applicationkey = rub.t_connappkey"+
	 " and val.t_applicationkey = '" + appkey + "'";
data = ExecSQLSelect(Select);
if(data.movenext());
summa = Data.value("t_sum");
return summa;
else
summa = -1;
return summa;
//msgbox("по проводке с appkey = "+ appkey + "нет покрытия")
end;
END;
/**/

   MACRO procedura_message_oper_otdel(OperSelect:integer, NumOtdel:integer, NumPodOtdel:integer/*, DateDocum:Date*/);     //GSP по C-9695
     var Data1, Select1;
     select1 = "  select t_code1,t_code2 from DOP_OTDEL_DBT where t_oper = "+ Operselect    +
               "  and (DOP_OTDEL_DBT.t_dateend >=to_date('"+ DateDocum + "','DD.MM.YYYY')  "+
               "  or t_dateend = to_date('01.01.0001','DD.MM.YYYY'))                       "+       
        	       "  and t_datebegin <=to_date('"+ DateDocum + "','DD.MM.YYYY')               ";
     Data1 = ExecSQLSelect(Select1);
     if(Data1.movenext())
       if((Data1.value("t_code1") != NumOtdel) or (Data1.value("t_code2") != NumPodOtdel))
       msgbox("Операционист " + OperSelect + ": " + GetOperName(OperSelect) + "|на дату" + DateDocum + " прикреплен к подразделению " + Data1.value("t_code1") + "." + Data1.value("t_code2"));
       end;
     else
     msgbox("Операционист " + OperSelect + ": " + GetOperName(OperSelect) + " |не принадлежит ни к отдному из подразделений| на дату: " + DateDocum + " обратитесь за информацией |в бухгалтерию" );
     end;
   END;
/* ------------------------------------------------------------------------ */
MACRO opredelenie_podotcheta(debet:string,credit:string)
    var podotchet;
    if   ((not( CompareStrWithMasks("30110,30114,30118,30119,30202,30204,30208,30210,30211,30213,30220,30221,30222,30223,30224,30228,47416,47417", debet )))
     or   (not( CompareStrWithMasks("30110,30114,30118,30119,30202,30204,30208,30210,30211,30213,30220,30221,30222,30223,30224,30228,47416,47417", credit))))
	podotchet = "НОСТРО";
	return(podotchet);
    elif ((not( CompareStrWithMasks("30301,30302,30305,30306",debet))) or (not( CompareStrWithMasks("30301,30302,30305,30306",credit))))
	podotchet = "МФР";
	return(podotchet);
    elif ((not( CompareStrWithMasks("30109,30111,30122,30123,30231,401??-408??,40911,40912,40913, 410??-426??",debet)))
     and  (not( CompareStrWithMasks("30109,30111,30122,30123,30231,401??-408??,40911,40912,40913, 410??-426??",credit)))) 
	podotchet = "Внутриклиентские";
	return(podotchet);
    elif(((not( CompareStrWithMasks("30109,30111,30122,30123,30231,401??-408??,40911,40912,40913, 410??-426??",debet)))
     and      ( CompareStrWithMasks("30109,30111,30122,30123,30231,401??-408??,40911,40912,40913, 410??-426??",credit)))
      or ((not( CompareStrWithMasks("47423,47422,60312,60311",debet)))
     and  (not( CompareStrWithMasks("30109,30111,30122,30123,30231,401??-408??,40911,40912,40913, 410??-426??",credit)))))
	podotchet = "Внутрибанковские";
	return(podotchet);
    else
	podotchet = "Внутренние ордера";
	return(podotchet);
    end;
END;
/* ------------------------------------------------------------------------ */
MACRO opredelenie_razdela_vneshnih(debet:string,credit:string,corschem:integer)
    var razdel, i;
    array nostro;       
    array mfr;                     
         i = 0;
         nostro(0)  = "30110"; nostro(1)  = "30114"; nostro(2)  = "30118"; nostro(3)  = "30119"; nostro(4)  = "30202"; nostro(5)  = "30204";
         nostro(6)  = "30208"; nostro(7)  = "30210"; nostro(8)  = "30211"; nostro(9)  = "30213"; nostro(10) = "30220"; nostro(11) = "30221";
         nostro(12) = "30222"; nostro(13) = "30223"; nostro(14) = "30224"; nostro(15) = "30228"; nostro(16) = "47416"; nostro(17) = "47417";
         mfr(0) = "30301"; mfr(1) = "30302"; mfr(0) = "30305"; mfr(0) = "30306";
    if ((substr(debet,1,5) == "30102") or (substr(credit,1,5) == "30102"))// and (corschem == 1))  
      razdel = "ОПЕРУ"; 
      return(razdel);
    elif((substr(debet,1,5) != "30102") and (substr(credit,1,5) != "30102"))// or (corschem != 1))
        while(i != 18)
          if((substr(debet,1,5) == nostro(i)) or (substr(credit,1,5) == nostro(i)))
            razdel = "НОСТРО"; 
            return(razdel);
          end;
            i = i + 1;
        end;
         i = 0;
        while(i != 4)
          if((substr(debet,1,5) == mfr(i)) or (substr(credit,1,5) == mfr(i)))
            razdel = "МФР"; 
            return(razdel);
          end;
            i = i + 1;
        end;
            razdel = "ПРОЧИЕ"; 
            return(razdel);
    else
            razdel = "ПРОЧИЕ"; 
            return(razdel);
    end;
END;
/* ------------------------------------------------------------------------ */
  MACRO Pechat_po_vidu_hranenia(StoreKind:integer,VidHranS:string);
   var  Vid_Hran, Flag_pechati_provodki;
     if (((VidHranS == "Бумажный") or (VidHranS == "")) and (StoreKind == 0))
        Vid_Hran = "Б";
        Flag_pechati_provodki = 1;
     elif ((VidHranS == "Электронно") and (StoreKind != 0))
        Vid_Hran = "Э";
        Flag_pechati_provodki = 1;
     elif (VidHranS == "Электр+Бум")
        Flag_pechati_provodki = 1;
        if (StoreKind == 0)
            Vid_Hran = "Б";
        else
            Vid_Hran = "Э";
        end;
     else
        if (StoreKind == 0)
            Vid_Hran = "Б";
        else
            Vid_Hran = "Э";
        end;
        Flag_pechati_provodki = 0;

     end;
    SetParm(2,Flag_pechati_provodki);
    SetParm(3,Vid_Hran);
  END;

/* ------------------------------------------------------------------------ */
/* отчеты по внутренним документам в рублях                                 */
/* ------------------------------------------------------------------------ */
macro Report_vnutr_doc_rub(Mode:string,Chapter:integer, Oper_new:integer, kontr:integer, otchetbank:bool, nbalanse1:string, nbalanse2:string, VidHran:string)  
//msgbox("Report_vnutr_doc_rub");                                                                   
	var tabl=ctablereport(), type_report:string="";                                                        /* ------------------------------------------------------------------------ */
	var Select, select_oper, Data, StoreKind,pechat_hran,NumOtdel1;                                        /* otchetbank:false - по подразделению, true - по банку                     */
	var Kol, Sum, KolP, SumP, Op, Office, podrazdel,kolOP, sumOP,KolP_B,KolP_E,SumP_B,SumP_E;              /* kontr:2 - контрольная ведомость, 1 - сводный реестр, 3 - реестр операций */
        var oper1, oper2, OperSelect, flag_pechati_GetOperName, Vid_Hran, Vid_HranS, Flag_pechati_provodkiS;   /* символом /* ==>> */ отмечены ветвления с выбором подвида отчета          */
        var kolP_B_O,sumP_B_O,kolP_E_O,sumP_E_O,kolp_B_OP, kolp_E_OP, sump_B_OP, sump_E_OP;
	OperSelect = Oper_new;
	var printhead = true;
private var payment_id;
      pechat_hran = "";
  if   (kontr == 2)                                                                                            /* ------------------------------------------------------------------------ */
      type_report = "КОНТРОЛЬНАЯ ВЕДОМОСТЬ ПОДРАЗДЕЛЕНИЯ";
  elif (kontr == 1)
      type_report = "СВОДНЫЙ РЕЕСТР ВНУТРЕННИХ ОПЕРАЦИЙ";
  elif (kontr == 3)
      type_report = "РЕЕСТР ОПЕРАЦИЙ        ";
  end;

     if(VidHran == "Бумажный")
      pechat_hran = "на документы бумажного вида хранения";
     elif(VidHran == "Электронно")
      pechat_hran = "на документы электронного вида хранения";
     elif(VidHran == "Электр+Бум")
      pechat_hran = "на документы бумажного+электронного вида хранения";
     end;
    if((otchetbank) and(kontr !=2))

	[ ##########################

        	               ######################################  по Банку
                                                в рублях РФ

                              ##################################################]({Name_Bank},type_report:r,pechat_hran);
if (pachkaS != "") 
        [
                              по номерам пачек:  #](pachkaS);
end;
        [                      
            	                            за  ##########

          Отчет: ###################################################################

	]  (DateDocum,Mode);
    else	
	[ ##########################

        	                 ######################################
                                               в рублях РФ

                          ##################################################

                       по подразделению: ##################################################################]({Name_Bank},type_report:r,pechat_hran, NameDepart);
  if(OperSelect!=0)
        [              по операционисту: ##### - ##############################################](operselect,GetOperName(operselect));                
  end;
  if (pachkaS != "")
        [
                              по номерам пачек:  #](string(pachkaS));
  end;
        [
            	                              за  ##########

          Отчет: ###################################################################

	]  (DateDocum,Mode);
    end;

	SumOP     = $0; kolOP     = 0;
	Sump_B    = $0; kolp_B    = 0;
	Sump_E    = $0; kolp_E    = 0;
	Sump      = $0; kolp      = 0;
	Sum       = $0; kol       = 0;
        sumP_B_O  = $0; kolP_B_O  = 0;
	sumP_E_O  = $0; kolP_E_O  = 0;
	sump_B_OP = $0; kolp_B_OP = 0;   
	sump_E_OP = $0; kolp_E_OP = 0;
	Select = " ";
	oper2 = 0;//I-00219670-2
/* ==>> */if(kontr == 2)// and (not(otchetbank)))     /*контрольная ведомость по отделу*/
        Select = select+
"       select distinct a.t_oper, a.sum, a.t_code1, a.t_code2,                                               "+  
"       case when a.docKind not in (15,70) and a.chapter <> 1 then 1 else to_number(NVL((SELECT storeKind FROM TABLE (USER_EA.Get_dev_prop ";

if(substr(RepTypes,1,9) == "Баланс ->")
        Select = select+
"        (a.dockind, a.origin, a.paymkind, a.shifr_oper, a.numb_pack, a.chapter,a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))),1)) end vid_hran,a.accdeb,a.acckr,AppKey,nvl(t_paymentid,-1) t_paymentid"+
"       from                                                                                                                                         ";
else
        Select = select+
"        (null, a.origin, null, a.shifr_oper, a.numb_pack, a.chapter,a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))),1)) end vid_hran,a.accdeb,a.acckr,AppKey,nvl(t_paymentid,-1) t_paymentid "+
"       from                                                                                                                                         ";
end;
/* ==>> */elif((kontr == 1) and (not(otchetbank)))    /*сводный реестр по отделу*/
        Select = select+
"       SELECT distinct a.NumDoc, a.AccDeb, a.name1, a.AccKr, a.name2, a.SUM, a.sh, a.t_Oper, a.Ground, T_CODE1||'.'||T_CODE2||' '||name_otdel as otdel,    "+
"       case when a.docKind not in (15,70) and a.chapter <> 1 then 1 else to_number(NVL((SELECT storeKind FROM TABLE (USER_EA.Get_dev_prop ";
if(substr(RepTypes,1,9) == "Баланс ->")
        Select = select+
"        (a.dockind, a.origin, a.paymkind, a.shifr_oper, a.numb_pack, a.chapter, a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))),1)) end  vid_hran, appkey,nvl(t_paymentid,-1) t_paymentid       "+
"       FROM                                                                                                                                         ";
else
        Select = select+
"        (null, a.origin, null, a.shifr_oper, a.numb_pack, a.chapter,a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))),1)) end  vid_hran,appkey,nvl(t_paymentid,-1) t_paymentid       "+
"       FROM                                                                                                                                         ";
end;
/* ==>> */elif((kontr == 1) and (otchetbank))         /*сводный реестр по банку*/
        Select = select+                                                                                                                            
"       select distinct t_code1,t_code2,name_otdel,t_oper,numdoc,accdeb,name1,acckr,name2,SUM,sh,ground, "+  
"       case when a.docKind not in (15,70) and a.chapter <> 1 then 1 else to_number(NVL((SELECT storeKind FROM TABLE (USER_EA.Get_dev_prop ";

if(substr(RepTypes,1,9) == "Баланс ->")
        Select = select+
"        (a.dockind, a.origin, a.paymkind, a.shifr_oper, a.numb_pack, a.chapter,a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))),1)) end  vid_hran,AppKey,nvl(t_paymentid,-1) t_paymentid       "+
"       FROM                                                                                                                                         ";
else
        Select = select+
"        (null, a.origin, null, a.shifr_oper, a.numb_pack, a.chapter,a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))),1)) end  vid_hran,AppKey,nvl(t_paymentid,-1) t_paymentid       "+
"       FROM                                                                                                                                         ";
end;
/* ==>> */elif((kontr == 3))
        Select = select+
"       select distinct t_code1,t_code2,name_otdel,t_oper,numdoc,accdeb,name1,acckr,name2,SUM,sh,ground, "+  
"       case when a.docKind not in (15,70) and a.chapter <> 1 then 1 else to_number(NVL((SELECT storeKind FROM TABLE (USER_EA.Get_dev_prop "+
"        (a.dockind, a.origin, a.paymkind, a.shifr_oper, a.numb_pack, a.chapter, a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))),1)) end vid_hran,appkey,nvl(t_paymentid,-1) t_paymentid       "+
"       from                                                                                                                                         ";
       end;

        Select = select+   /*основной запрос - начало*/
"        (select distinct DOTDELS_DBT.T_CODE1,DOTDELS_DBT.T_CODE2,DOTDELS_DBT.T_NAME as NAME_OTDEL, arh.t_oper,                                      "+
"                arh.t_numb_document AS NumDoc, arh.t_account_payer AS AccDeb, acc1.t_nameaccount name1, arh.t_account_receiver AS AccKr,            "+
"                acc2.t_nameaccount name2, arh.T_SUM_NATCUR AS SUM, arh.t_shifr_oper||'/'||t_kind_oper sh, arh.t_ground AS Ground,                          "+   
"                arh.T_acctrnid AppKey,arh.T_FIID_PAYER, arh.T_FIID_RECEIVER,                                                                     "+
"                prop.T_PAYMENTKIND paymkind, user_ea.GetOrigin ( paym.t_dockind, paym.t_paymentid) origin, arh.T_CHAPTER chapter, paym.T_DOCKIND dockind, arh.T_NUMBER_PACK numb_pack,     "+
"                prop.T_SHIFROPER shifr_oper, paym.T_FIID cred_fiid, arh.t_typedocument, paym.T_PAYFIID deb_fiid,paym.t_paymentid                                     "+
"           FROM dacctrn_dbt arh,dpmdocs_dbt docs,dpmpaym_dbt paym,daccount_dbt acc1,daccount_dbt acc2,DOTDELS_DBT,dpmrmprop_dbt prop,               "+
"                (select * from DOP_OTDEL_DBT where (T_oper,t_datebegin) in (select T_oper,max(t_datebegin) t_datebegin                              "+                    
"                   from DOP_OTDEL_DBT where t_datebegin<=TO_DATE ('"+ DateDocum + "', 'DD.MM.YYYY')                                                 "+
"                        and (t_dateend >= TO_DATE ('"+ DateDocum + "', 'DD.MM.YYYY') OR t_dateend  = TO_DATE ('01.01.0001', 'DD.MM.YYYY'))          "+                                                                 
"                        group by T_oper)) DOP_OTDEL_DBT                                                                                             "+
"	   WHERE arh.t_date_carry = to_date('" + DateDocum +"','DD.MM.YYYY')                                                                         "+ 
"            and (DOP_OTDEL_DBT.t_dateend >=to_date('"+ DateDocum + "','DD.MM.YYYY') or t_dateend = to_date('01.01.0001','DD.MM.YYYY'))              "+
"            and t_datebegin <=to_date('"+ DateDocum + "','DD.MM.YYYY')                                                                              "+
"	     AND acc1.t_account = arh.t_account_payer	                                                                                     "+
"	     AND acc2.t_account = arh.t_account_receiver                                                                                          "+
"	     AND arh.t_chapter = acc1.t_chapter                                                                                                      "+ 
"	     AND acc1.t_chapter = acc2.t_chapter                                                                                                     "; 
if (pachkaS != "") 
select = select+ 
"            AND arh.T_NUMBER_PACK in (" + pachkaS + ")";
end;
select = select+ 
"	     AND arh.t_chapter = "+ Chapter                                                                                                           ;
if(substr(RepTypes,1,9) != "Баланс ->")
Select = Select +
"            AND arh.t_result_carry <> 14                                                                                                            ";
end;
Select = Select +
"	     AND arh.T_acctrnid = docs.T_acctrnid(+)                                                                                                 "+
"            AND docs.T_PAYMENTID = paym.T_PAYMENTID(+)                                                                                              "+
"            AND prop.t_paymentid(+) = paym.t_paymentid                                                                                              ";
if(substr(RepTypes,1,9) == "Баланс ->")
        Select = select+
"            AND substr(arh.T_ACCOUNT_PAYER,6,3) = '810' and substr(arh.T_ACCOUNT_RECEIVER,6,3) = '810'                                              ";
else
        Select = select+
"            AND((SUBSTR (arh.t_account_payer, 6, 3) = '810' and SUBSTR (arh.t_account_receiver, 6,3) = '810')                                       "+
"             OR (SUBSTR (arh.t_account_payer, 6, 3) <> SUBSTR (arh.t_account_receiver, 6,3)))                                                       ";
end;
        Select = select+
"	     AND SUBSTR (arh.t_account_payer, 1, 5) NOT IN ('20202','20203','20207')                                                     "+
"	     AND SUBSTR (arh.t_account_receiver, 1, 5) NOT IN ('20202','20203','20207')                                                  "+
"            and arh.T_OPER = DOP_OTDEL_DBT.T_oper                                                                                                   "+
"            and DOP_OTDEL_DBT.T_CODE1 = DOTDELS_DBT.T_CODE1                                                                                         "+
"            and DOP_OTDEL_DBT.T_CODE2 = DOTDELS_DBT.T_CODE2                                                                                         ";
if(substr(RepTypes,1,9) == "Баланс ->")
        Select = select+
"            and (exists (select 1 from dpmprop_dbt  deb,dpmprop_dbt cred                                                                            "+
"            where cred.T_PAYMENTID = docs.T_PAYMENTID                                                                                               "+
"            and deb.T_PAYMENTID = docs.T_PAYMENTID                                                                                                  "+
"            and deb.T_PAYMENTID = cred.T_PAYMENTID                                                                                                  "+
"            and deb.t_debetcredit = 0 and cred.t_debetcredit = 1                                                                                    "+
"            and cred.t_group <> 1 and deb.t_group <> 1)  /*условие для внутренних*/                                                                 "+        
"             or docs.t_paymentid is null)                                                                                                           "; 
end;
        Select = select+
             nbalanse1 + ")" + "\n" + nbalanse2 + ")" + "\n                                                                                          ";
	if ((OperSelect!=0) and (kontr !=2))       /*если выбран опер, то запрос по одному оперу*/
       Select = select +
"	     AND arh.T_OPER =" + OperSelect;       
           procedura_message_oper_otdel(OperSelect, NumOtdel, NumPodOtdel);
	end;
       Select = select + ") a";
                                                   /*основной запрос - конец*/
/* ==>> */if(kontr == 2)  
 if(not(otchetbank))
        Select = select+
"          where a.T_CODE1 = "+ NumOtdel;                                                                                                              
    if (NumPodOtdel !=0)
        Select = select+
"            and a.T_CODE2 = "+ NumPodOtdel;
    end;
 end;
        Select = select+
"          order by a.t_code1,a.t_code2,a.t_oper                                                                                                                         ";
//debugbreak;
//debugbreak;
	Data = ExecSQLSelect(Select);
	tabl.addcolumn("Код |опер.",             5,AL_CENTER);  
	tabl.addcolumn("Операционист",          20,AL_LEFT); 
	tabl.addcolumn("Отдел",                  5,AL_RIGHT); 
	tabl.addcolumn("Количество |документов",11,AL_RIGHT);
	tabl.addcolumn("Сумма",                 20,AL_RIGHT);  
	tabl.addcolumn("Валюта",                 7,AL_CENTER); 
	tabl.addcolumn("Вид|хран",               4,AL_CENTER);
	tabl.printhead();
	KolP   = 0; 
	SumP   = $0;
	oper2  = 0;
	otdel2 = 0;
//debugbreak;
//debugbreak;
/* ==>> */elif((kontr == 1) and (not(otchetbank)))
        Select = select+
"          where a.T_CODE1 = "+ NumOtdel;
    if(NumPodOtdel !=0)
        Select = select+
"       	     and a.T_CODE2 = "+ NumPodOtdel;
    end;
        Select = select+
"          order by a.t_Oper, AccDeb, SUM                                                                                                            ";
	Data = ExecSQLSelect(Select);
//debugbreak;
//debugbreak;
	tabl.addcolumn("№ Док.",      10,AL_CENTER); 
	tabl.addcolumn("Счет дебет",  20,AL_CENTER);
	tabl.addcolumn("Наименование",20,AL_CENTER); 
	tabl.addcolumn("Счет кредит", 20,AL_CENTER); 
	tabl.addcolumn("Наименование",20,AL_CENTER); 
	tabl.addcolumn("Сумма",       14,AL_right);
	tabl.addcolumn("Шифр|/вид",    5,AL_CENTER); 
	tabl.addcolumn("Опер",         5,AL_CENTER); 
	tabl.addcolumn("Основание",   40,AL_LEFT); 
	tabl.addcolumn("Вид|хран",     4,AL_CENTER);
        if(Data.MoveNext());
        StoreKind = data.value("vid_hran");
         if(StoreKind != 0)
            StoreKind = 1;
         end;
	payment_id = data.value("t_paymentid");
	StoreKind = kateg_vid_hran(payment_id,StoreKind,chapter);
        Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);



 if(Vid_HranS == "Б")
		kolP_B_O = kolP_B_O + 1; sumP_B_O  = sumP_B_O  + money(data.value("sum"));
 else
		kolP_E_O = kolP_E_O + 1; sumP_E_O  = sumP_E_O  + money(data.value("sum"));
 end;
       if (Flag_pechati_provodkiS == 1)
	tabl.printhead("отдел "+ data.value("otdel") + " \n"+data.value("t_Oper") + " " + GetOperName(data.Value("t_oper")));
	tabl.printStringTransferByWord (data.value(0),
					data.value(1),
					data.value(2),
					data.value(3),
					data.value(4),
					data.value(5),
					data.value(6),
					data.value(7),
					data.value(8),
					vid_hranS);

	kolOP = 1; SumOP = money(data.value(5));
        kolp  = 1; sump  = money(data.value("sum"));
	printhead = false;
       end;	
        oper1 = data.value("t_oper");                            /*первую запись в сводном выводим вместе с шапкой таблицы*/
	oper2 = oper1;

        flag_pechati_GetOperName = 1;
	end;

/* ==>> */elif((kontr == 1) and (otchetbank))
        Select = select+
        " order by a.t_code1, a.t_code2, a.t_oper, AccDeb, SUM  ";
	Data = ExecSQLSelect(Select);
	tabl.addcolumn("№ Док.",      10,AL_CENTER); 
	tabl.addcolumn("Счет дебет",  20,AL_CENTER);
	tabl.addcolumn("Наименование",20,AL_CENTER); 
	tabl.addcolumn("Счет кредит", 20,AL_CENTER); 
	tabl.addcolumn("Наименование",20,AL_CENTER); 
	tabl.addcolumn("Сумма",       14,AL_right);
	tabl.addcolumn("Шифр|/вид",    5,AL_CENTER); 
	tabl.addcolumn("Опер",         5,AL_CENTER); 
	tabl.addcolumn("Основание",   40,AL_LEFT); 
	tabl.addcolumn("Вид|хран",     4,AL_CENTER);
        if(Data.MoveNext());

        StoreKind = data.value("vid_hran");
        if(StoreKind != 0)
         StoreKind = 1;
        end;
	payment_id = data.value("t_paymentid");
	StoreKind = kateg_vid_hran(payment_id,StoreKind,chapter);
        Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
       if (Flag_pechati_provodkiS == 1)
	tabl.printhead("отдел " +  data.value("t_code1") +"." + data.value("t_code2") + data.value("name_otdel") + " \n"+data.value("t_Oper") + " " + GetOperName(data.Value("t_oper")));

	tabl.printStringTransferByWord (data.value(4),
					data.value(5),
					data.value(6),
					data.value(7),
					data.value(8),
					data.value(9),
					data.value(10),
					data.value(3),
					data.value(11),
					vid_hranS);

	kolOP = 1; SumOP = money(data.value("sum"));
	kol   = 1; Sum   = money(data.value("sum")); 
        kolp  = 1; sump  = money(data.value("sum"));
       end;	
        oper1  = data.value("t_oper");
	otdel1 = data.value("name_otdel");
	oper2  = oper1;
	otdel2 = otdel1;

        flag_pechati_GetOperName = 1;
	end;
/* ==>> */elif(kontr == 3)

         if (not(otchetbank))
          Select = select+
          " where a.T_CODE1 = "+ NumOtdel; 
	   if(NumPodOtdel !=0)
            Select = select+
            " and a.T_CODE2 = "+ NumPodOtdel;
           end;
         end;

        Select = select+
        " order by a.t_code1, a.t_code2, a.t_oper, AccDeb, SUM  ";
	Data = ExecSQLSelect(Select);
	tabl.addcolumn("№ Док.",     10,AL_CENTER); 
	tabl.addcolumn("Счет дебет", 20,AL_CENTER); 
	tabl.addcolumn("Счет кредит",20,AL_CENTER);	 
	tabl.addcolumn("Сумма",      10,AL_right);  
	tabl.addcolumn("Основание",  30,AL_LEFT);    
	tabl.addcolumn("Шифр|/вид",   5,AL_CENTER);
        tabl.addcolumn("Опер",       10,AL_CENTER);   
	tabl.addcolumn("Отдел",       6,AL_CENTER);       
	tabl.addcolumn("Вид|хр.",     3,AL_CENTER);
	tabl.printhead();
       end;
//debugbreak;
//debugbreak;
        while(Data.MoveNext())

/* ==>> */if(kontr == 2)   /*11*/
debugbreak;
        Storekind  = data.value("vid_hran");
        otdel1     = data.value("t_code1") + "." + data.value("t_code2");
	oper1      = data.value("t_oper");
	payment_id = data.value("t_paymentid");
	StoreKind  = kateg_vid_hran(payment_id,StoreKind,chapter);
        Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
  if (Flag_pechati_provodkiS == 1)
    if((oper2 != oper1) and (oper2 !=0))
	if(VidHranS == "Бумажный")   
		if(Kolp_B_OP !=0)
                tabl.printStringTransferByWord (oper2,
						GetShortName(GetOperName(oper2)),
						otdel2,
						Kolp_B_OP,
						Sump_B_OP,
						"RUR",
						vid_hranS);
		tabl.printseparator();
		end;
	elif(VidHranS == "Электронно")
		if(Kolp_E_OP !=0)
                tabl.printStringTransferByWord (oper2,
						GetShortName(GetOperName(oper2)),
						otdel2,
						Kolp_E_OP,
						Sump_E_OP,
						"RUR",
						vid_hranS);
		tabl.printseparator();
		end;
        else
		[│       │                      │       │       ##### │       ############## │   RUR   │  Б   │
		 │ ##### │ #################### │ ##### ├─────────────┼──────────────────────┼─────────┼──────┤
		 │       │                      │       │       ##### │       ############## │   RUR   │  Э   │](kolp_B_OP,sump_B_OP,oper2,GetShortName(GetOperName(oper2)),otdel2,kolp_E_OP,sump_E_OP);
		[├───────┼──────────────────────┼───────┼─────────────┼──────────────────────┼─────────┼──────┤]
	end;
	KolOP = 0; SumOP = $0; kolp_B_OP = 0; kolp_E_OP = 0; sump_B_OP = $0; sump_E_OP = $0;
	oper2 = oper1;

      if((otdel2 != otdel1) and (otdel2 !=0))

	if((VidHranS != "Бумажный") and (VidHranS != "Электронно"))  
		[│                                      │       ##### │       ############## │   RUR   │  Б   │
		 │ ИТОГО ПО ОТДЕЛУ ######               ├─────────────┼──────────────────────┼─────────┼──────┤
		 │                                      │       ##### │       ############## │   RUR   │  Э   │
	         ├───────┬──────────────────────┬───────┼─────────────┼──────────────────────┼─────────┼──────┤](int(kolp_B_O),sump_B_O,otdel2,int(kolp_E_O),sump_E_O);
	elif(VidHranS == "Бумажный") 
	      if(kolp_B_O != 0)
		[│ ИТОГО ПО ОТДЕЛУ ######               │       ##### │       ############## │   RUR   │  Б   │
	         ├───────┬──────────────────────┬───────┼─────────────┼──────────────────────┼─────────┼──────┤](otdel2,int(kolp_B_O),sump_B_O);
	      end;
	elif(VidHranS == "Электронно") 
	      if(kolp_E_O != 0)
		[│ ИТОГО ПО ОТДЕЛУ ######               │       ##### │       ############## │   RUR   │  Э   │
	         ├───────┬──────────────────────┬───────┼─────────────┼──────────────────────┼─────────┼──────┤](otdel2,int(kolp_E_O),sump_E_O);
	      end;
	end;
	kolp_B_O = 0; sump_B_O = $0; kolp_E_O = 0; sump_E_O = $0;
      else
	tabl.printseparator();
      end;
    end;

	oper2  = oper1;
	otdel2 = otdel1;
        KolOP  = KolOP + 1; SumOP = SumOP + Data.Value("Sum");
        KolP   = KolP  + 1; SumP  = SumP  + Data.Value("Sum");
  end;
 if(Vid_HranS == "Б")
	KolP_B    = KolP_B    + 1; SumP_B    = SumP_B    + Data.Value("Sum");
	kolp_B_O  = kolp_B_O  + 1; sump_B_O  = sump_B_O  + Data.Value("Sum"); 
	kolp_B_OP = kolp_B_OP + 1; sump_B_OP = sump_B_OP + Data.Value("Sum"); 
  else
	KolP_E    = KolP_E    + 1; SumP_E    = SumP_E    + Data.Value("Sum");
	kolp_E_O  = kolp_E_O  + 1; sump_E_O  = sump_E_O  + Data.Value("Sum"); 
	kolp_E_OP = kolp_E_OP + 1; sump_E_OP = sump_E_OP + Data.Value("Sum"); 
  end;

/* ==>> */elif((kontr == 1) and (not(otchetbank)))
	        oper1 = data.value("t_oper");
            Storekind = data.value("vid_hran");
            if(StoreKind != 0)
               StoreKind = 1;
            end;	
	payment_id = data.value("t_paymentid");
	StoreKind  = kateg_vid_hran(payment_id,StoreKind,chapter);
        Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
        if (Flag_pechati_provodkiS == 1)
	    if (oper1 != oper2)                       /*если опер изменился*/
if(VidHranS == "Электр+Бум")
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
               │  Итого по отчету (Б+Э)   ##### ###############                                                         │ ############## │       │       │                                          │ Б+Э  │
               │  Документов               #######                                                                      │                │       │       │                                          │      │
               └────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────────────┴───────┴───────┴──────────────────────────────────────────┴──────┘](
                                         oper2,GetShortName(GetOperName(oper2)),                                              SumOP,  
                                           kolOP);
elif(VidHranS == "Бумажный")
        if(kolOP != 0)        
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
               │  Итого по отчету (Б)       ##### ###############                                                       │ ############## │       │       │                                          │  Б   │
               │  Документов бумажного вида: #######                                                                    │                │       │       │                                          │      │
               └────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────────────┴───────┴───────┴──────────────────────────────────────────┴──────┘](
                                         oper2,GetShortName(GetOperName(oper2)),                                              SumOP,  
                                           kolOP);
	end;
elif(VidHranS == "Электронно")
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
               │  Итого по отчету (Э)          ##### ###############                                                    │ ############## │       │       │                                          │  Э   │
               │  Документов электронного вида: #######                                                                 │                │       │       │                                          │      │
               └────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────────────┴───────┴───────┴──────────────────────────────────────────┴──────┘](
                                         oper2,GetShortName(GetOperName(oper2)),                                              SumOP,  
                                           kolOP);
end;
	if(OperSelect == 0) 
                [        ];
	else
                [Всего по операционисту ______________ ##################### документов:
                                                                             бумажного вида    ##### на сумму(руб.экв) ##############
                                                                             электронного вида ##### на сумму(руб.экв) ##############
                                                                             всего документов  ##### на сумму(руб.экв) ##############
		](getShortName(oper2),kolP_B_O,sumP_B_O,kolP_E_O,sumP_E_O,kolP_B_O+kolP_E_O,sumP_B_O+sumP_E_O);
	end;

                SumOP = $0; kolOP = 0;
//                tabl = ctablereport();

                tabl = ctablereport();
		tabl.addcolumn("№ Док.",      10,AL_CENTER); 
		tabl.addcolumn("Счет дебет",  20,AL_CENTER);
		tabl.addcolumn("Наименование",20,AL_CENTER); 
		tabl.addcolumn("Счет кредит", 20,AL_CENTER); 
		tabl.addcolumn("Наименование",20,AL_CENTER); 
		tabl.addcolumn("Сумма",       14,AL_right);
		tabl.addcolumn("Шифр|/вид",    5,AL_CENTER); 
		tabl.addcolumn("Опер",         5,AL_CENTER); 
		tabl.addcolumn("Основание",   40,AL_LEFT); 
		tabl.addcolumn("Вид|хран",     4,AL_CENTER);
		tabl.printhead(data.value("t_Oper") + " " + GetOperName(data.Value("t_oper")));
        end;
		oper2 = oper1;		
            end;

 if(Vid_HranS == "Б")
//		kolVOP_B = kolVOP_B + 1; sumRVOP_B = sumRVOP_B + SumR;
//					 sumVOP_B  = sumVOP_B  + money(data.value("sum"));
		kolP_B_O = kolP_B_O + 1; sumP_B_O  = sumP_B_O  + money(data.value("sum"));
//	        KolP_B   = KolP_B   + 1; SumP_B    = SumP_B    + money(data.value("sum"));
 else
//		kolVOP_E = kolVOP_E + 1; sumRVOP_E = sumRVOP_E + SumR;
//					 sumVOP_E  = sumVOP_E  + money(data.value("sum"));
		kolP_E_O = kolP_E_O + 1; sumP_E_O  = sumP_E_O  + money(data.value("sum"));
		KolP_E   = KolP_E   + 1; SumP_E    = SumP_E    + money(data.value("sum"));
 end;

        if (Flag_pechati_provodkiS == 1)

	if(printhead)		
	   tabl.printhead(data.value("t_Oper") + " " + GetOperName(data.Value("t_oper")));
	end;
		tabl.printseparator();
		tabl.printStringTransferByWord (data.value(0),
						data.value(1),
						data.value(2),
						data.value(3),
						data.value(4),
						data.value(5),
						data.value(6),
						data.value(7),
						data.value(8),
						vid_hranS);

		kolOP = kolOP + 1; sumOP = sumOP + money(data.value(5));
	        KolP  = KolP  + 1; SumP  = SumP  + money(Data.Value(5));
		printhead = false;
	end;	

/* ==>> */elif((kontr == 1) and (otchetbank))
		oper1     = data.value("t_oper");
		otdel1    = data.value("name_otdel");
                StoreKind = data.value("vid_hran");
               if(StoreKind != 0)
                StoreKind = 1;
               end;
		payment_id = data.value("t_paymentid");
		StoreKind  = kateg_vid_hran(payment_id,StoreKind,chapter);
                Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
           if (Flag_pechati_provodkiS == 1)
	      if (oper1 != oper2)
if(VidHranS == "Электр+Бум")
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
               │  Итого по отчету (Б+Э)   ##### ###############                                                         │ ############## │       │       │                                          │ Б+Э  │
               │  Документов               #######                                                                      │                │       │       │                                          │      │
               └────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────────────┴───────┴───────┴──────────────────────────────────────────┴──────┘](
                                         oper2,GetShortName(GetOperName(oper2)),                                              SumOP,  
                                           kolOP);
elif(VidHranS == "Бумажный")
        if(kolOP != 0)        
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
               │  Итого по отчету (Б)       ##### ###############                                                       │ ############## │       │       │                                          │  Б   │
               │  Документов бумажного вида: #######                                                                    │                │       │       │                                          │      │
               └────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────────────┴───────┴───────┴──────────────────────────────────────────┴──────┘](
                                         oper2,GetShortName(GetOperName(oper2)),                                              SumOP,  
                                           kolOP);
	end;
elif(VidHranS == "Электронно")
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
               │  Итого по отчету (Э)          ##### ###############                                                    │ ############## │       │       │                                          │  Э   │
               │  Документов электронного вида: #######                                                                 │                │       │       │                                          │      │
               └────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────────────┴───────┴───────┴──────────────────────────────────────────┴──────┘](
                                         oper2,GetShortName(GetOperName(oper2)),                                              SumOP,  
                                           kolOP);
end;
	    if (otdel1 != otdel2)      /*следующий отдел отдел*/
	        [Всего документов по подразделению ################# на сумму #################   



	        ###############################################################################
                ](int(kolp),sump,"отдел "+  data.value("t_code1") +"." + data.value("t_code2") + " " + otdel1);


                SumP = $0; kolP = 0;
		otdel2 = otdel1;
            end;
		SumOP = $0; kolOP = 0;
		tabl = ctablereport();
		tabl.addcolumn("№ Док.",      10,AL_CENTER); 
		tabl.addcolumn("Счет дебет",  20,AL_CENTER);
		tabl.addcolumn("Наименование",20,AL_CENTER); 
		tabl.addcolumn("Счет кредит", 20,AL_CENTER); 
		tabl.addcolumn("Наименование",20,AL_CENTER); 
		tabl.addcolumn("Сумма",       14,AL_CENTER);
		tabl.addcolumn("Шифр|/вид",    5,AL_CENTER); 
		tabl.addcolumn("Опер",         5,AL_CENTER); 
		tabl.addcolumn("Основание",   40,AL_LEFT); 
		tabl.addcolumn("Вид|хран",     4,AL_CENTER);
		tabl.printhead(" \n"+data.value("t_Oper") + " " + GetOperName(data.Value("t_oper")));
		oper2 = oper1;		
	      end;
		tabl.printseparator();
		tabl.printStringTransferByWord(data.value(4),data.value(5),data.value(6),data.value(7),data.value(8),data.value(9),    /*data.value(9)*/
		data.value(10),data.value(3),data.value(11),vid_hranS);
		kolOP = kolOP + 1; sumOP = sumOP + money(data.value("sum"));
		KolP  = KolP  + 1; SumP  = SumP  + money(Data.Value("sum"));
		Kol   = Kol   + 1; Sum   = Sum   + money(Data.Value("sum"));
           end;

/* ==>> */elif((kontr == 3))
	tabl.printseparator();

                StoreKind = data.value("vid_hran");
               if(StoreKind != 0)
                StoreKind = 1;
               end;
	payment_id = data.value("t_paymentid");
	StoreKind = kateg_vid_hran(payment_id,StoreKind,chapter);
                Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
           if (Flag_pechati_provodkiS == 1)
		tabl.printStringTransferByWord (data.value("NumDoc"),
					        data.value("AccDeb"),
						data.value("AccKr"),
						data.value("Sum"),
						data.value("Ground"),
						data.value("Sh"),
					 string(data.value("t_Oper") + " " +GetoperName(data.value("t_Oper"))),
					 string(data.value("t_Code1") + "." +data.value("t_Code2")), 
						vid_hranS);

		Kol  = Kol  + 1; Sum  = Sum  + money(Data.Value("sum"));  
		kolp = kolp + 1; Sump = Sump + money(Data.Value("sum"));
	   end;	

        end;  /*11*/
        flag_pechati_GetOperName = 1;
     end; /*while*/
if(otchetbank)

                                                   /*тут будет отбор по неизвестному подразделению*/
       Select = "";
/* ==>> */if((kontr == 2) and (otchetbank))           /*контрольная ведомость по банку*/
        Select = select+
"      select distinct a.t_oper, a.sum,a.sumRUR, (SELECT storeKind FROM TABLE(USER_EA.Get_dev_prop                                                   ";
if(substr(RepTypes,1,9) == "Баланс ->")
        Select = select+
"        (a.dockind, a.origin, a.paymkind, a.shifr_oper, a.numb_pack, a.chapter, a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))) vid_hran,AccDeb,AccKr,appkey,nvl(t_paymentid,-1) t_paymentid  "+
"       from                                                                                                                                         ";
else
        Select = select+
"        (null, a.origin, null, a.shifr_oper, a.numb_pack, a.chapter, a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))) vid_hran,AccDeb,AccKr,appkey,nvl(t_paymentid,-1) t_paymentid  "+
"       from                                                                                                                                         ";
end;
/* ==>> */elif((kontr == 1) and (otchetbank))         /*сводный реестр по банку*/
        Select = select+
"       select distinct '1000 Неизвестное подразделение' as otdel,t_oper,NumDoc,AccDeb,name1,AccKr,name2,SUM,a.sumRUR,sh,Ground,AppKey,nvl(t_paymentid,-1) t_paymentid,                        "+
"       (SELECT storeKind FROM TABLE(USER_EA.Get_dev_prop                                                                                            ";
if(substr(RepTypes,1,9) == "Баланс ->")
        Select = select+
"        (a.dockind, a.origin, a.paymkind, a.shifr_oper, a.numb_pack, a.chapter, a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))) vid_hran       "+
"       FROM                                                                                                                                         ";
else
        Select = select+
"        (null, a.origin, null, a.shifr_oper, a.numb_pack, a.chapter,a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))) vid_hran       "+
"       FROM                                                                                                                                         ";
end;
/* ==>> */elif(kontr == 3)                         /*сводный реестр по банку*/
        Select = select+
"       select distinct '1000 'as otdel,t_oper,NumDoc,AccDeb,AccKr,SUM, sumRUR,sh,Ground,AppKey,nvl(t_paymentid,-1) t_paymentid,                     "+
"       (SELECT storeKind FROM TABLE(USER_EA.Get_dev_prop                                                                                            "+
"        (a.dockind, a.origin, a.paymkind, a.shifr_oper, a.numb_pack, a.chapter, a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))) vid_hran       "+
"       FROM                                                                                                                                         ";
       end;
        Select = select+                           /*основной запрос - начало*/
"        (select distinct arh.t_oper,                                                                                                                "+
"                arh.t_numb_document AS NumDoc, arh.t_account_payer AS AccDeb, acc1.t_nameaccount name1, arh.t_account_receiver AS AccKr,            "+
"                acc2.t_nameaccount name2, arh.T_SUM_PAYER AS SUM,arh.T_SUM_NATCUR sumRUR, arh.t_shifr_oper||'/'||t_kind_oper sh,                    "+   
"                arh.t_acctrnid AppKey, paym.T_DOCKIND dockind, arh.T_NUMBER_PACK numb_pack, arh.t_ground AS Ground,                                 "+
"                prop.T_PAYMENTKIND paymkind, user_ea.GetOrigin ( paym.t_dockind, paym.t_paymentid) origin, arh.T_CHAPTER chapter,                   "+
"                arh.T_SHIFR_OPER shifr_oper, arh.T_FIID_PAYER, arh.T_FIID_RECEIVER,arh.t_typedocument,paym.t_paymentid                              "+
"           FROM dacctrn_dbt arh, dpmdocs_dbt docs, dpmpaym_dbt paym, daccount_dbt acc1, daccount_dbt acc2,dpmrmprop_dbt prop                        "+
"	   WHERE arh.t_date_carry = to_date('" + DateDocum +"','DD.MM.YYYY')                                                                         "+ 
"            AND arh.t_oper not in (select dop_otdel_dbt.T_oper from dop_otdel_dbt                                                                   "+
"            where (dop_otdel_dbt.t_dateend >= TO_DATE ('" + DateDocum +"', 'DD.MM.YYYY')                                                            "+
"            or t_dateend  = TO_DATE ('01.01.0001', 'DD.MM.YYYY'))                                                                                   "+
"            and t_datebegin <= TO_DATE ('" + DateDocum +"', 'DD.MM.YYYY'))                                                                          "+
"	     AND acc1.t_account = arh.t_account_payer	                                                                                             "+
"	     AND acc2.t_account = arh.t_account_receiver                                                                                             "+
"	     AND arh.t_chapter = acc1.t_chapter                                                                                                      "+ 
"	     AND acc1.t_chapter = acc2.t_chapter                                                                                                     "+ 
"	     AND arh.t_chapter = "+ Chapter                                                                                                           ;
if(substr(RepTypes,1,9) != "Баланс ->")
Select = Select +
"            AND arh.t_result_carry <> 14                                                                                                            ";
end;
Select = Select +
"	     AND arh.T_ACCTRNID = docs.T_ACCTRNID(+)                                                                                                 "+
"            AND docs.T_PAYMENTID = paym.T_PAYMENTID(+)                                                                                              "+
"            AND prop.T_PAYMENTID(+) = paym.T_PAYMENTID                                                                                              ";
if(substr(RepTypes,1,9) == "Баланс ->")
        Select = select+
"            AND substr(arh.T_ACCOUNT_PAYER,6,3) = '810' and substr(arh.T_ACCOUNT_RECEIVER,6,3) = '810'                                              ";
else
        Select = select+
"            AND((SUBSTR (arh.t_account_payer, 6, 3) = '810' and SUBSTR (arh.t_account_receiver, 6,3) = '810')                                       "+
"             OR (SUBSTR (arh.t_account_payer, 6, 3) <> SUBSTR (arh.t_account_receiver, 6,3)))                                                       ";
end;
        Select = select+
"	     AND SUBSTR (arh.t_account_payer, 1, 5) NOT IN ('20202','20203','20207')                                                                 "+
"	     AND SUBSTR (arh.t_account_receiver, 1, 5) NOT IN ('20202','20203','20207')                                                              ";
if(substr(RepTypes,1,9) == "Баланс ->")
        Select = select+
"            and (exists (select 1 from dpmprop_dbt  deb,dpmprop_dbt cred                                                                            "+
"            where cred.T_PAYMENTID = docs.T_PAYMENTID                                                                                               "+
"            and deb.T_PAYMENTID = docs.T_PAYMENTID                                                                                                  "+
"            and deb.T_PAYMENTID = cred.T_PAYMENTID                                                                                                  "+
"            and deb.t_debetcredit = 0 and cred.t_debetcredit = 1                                                                                    "+
"            and cred.t_group <>"+ PAYMENTS_GROUP_EXTERNAL + " and deb.t_group <>"+ PAYMENTS_GROUP_EXTERNAL+  ")  /*условие для внутренних*/         "+                      
"            or docs.t_paymentid is null)                                                                                                            "; 
end;
        Select = select+
             nbalanse1 + ")" + "\n" + nbalanse2 + ")" + "\n" + ") a                                                                                  "; 

/* ==>> */if((kontr == 2) and (otchetbank))
//        Select = select+
	Data = ExecSQLSelect(Select);
	while (Data.moveNext())
         Storekind  = data.value("vid_hran");
         oper1      = data.value("t_oper");
	 otdel1     = 1000;
	 payment_id = data.value("t_paymentid");
	 StoreKind = kateg_vid_hran(payment_id,StoreKind,chapter);
         Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
        if (Flag_pechati_provodkiS == 1)
if((oper2 != oper1) and (oper2 !=0))

	if(VidHranS == "Бумажный")   
		if(Kolp_B_OP !=0)
                tabl.printStringTransferByWord(oper2,GetShortName(GetOperName(oper2)),otdel2,Kolp_B_OP,Sump_B_OP,"RUR",vid_hranS);
		tabl.printseparator();
		end;
	elif(VidHranS == "Электронно")
		if(Kolp_E_OP !=0)
                tabl.printStringTransferByWord(oper2,GetShortName(GetOperName(oper2)),otdel2,Kolp_E_OP,Sump_E_OP,"RUR",vid_hranS);
		tabl.printseparator();
		end;
        else
		[│       │                      │       │       ##### │       ############## │   RUR   │  Б   │
		 │ ##### │ #################### │ ##### ├─────────────┼──────────────────────┼─────────┼──────┤
		 │       │                      │       │       ##### │       ############## │   RUR   │  Э   │](kolp_B_OP,sump_B_OP,oper2,GetShortName(GetOperName(oper2)),otdel2,kolp_E_OP,sump_E_OP);
		[├───────┼──────────────────────┼───────┼─────────────┼──────────────────────┼─────────┼──────┤]
	end;
	KolOP = 0; SumOP = $0; kolp_B_OP = 0; kolp_E_OP = 0; sump_B_OP = $0; sump_E_OP = $0;
	oper2 = oper1;
end;
    if((otdel2 != otdel1) and (otdel2 !=0))

/*		[├───────┴──────────────────────┴───────┼─────────────┼──────────────────────┼─────────┼──────┤*/
	  if((VidHranS != "Бумажный") and (VidHranS != "Электронно"))  
		[│                                      │       ##### │       ############## │   RUR   │  Б   │
		 │ ИТОГО ПО ОТДЕЛУ ######               ├─────────────┼──────────────────────┼─────────┼──────┤
		 │                                      │       ##### │       ############## │   RUR   │  Э   │
	         ├───────┬──────────────────────┬───────┼─────────────┼──────────────────────┼─────────┼──────┤](int(kolp_B_O),sump_B_O,otdel2,int(kolp_E_O),sump_E_O);
	  elif(VidHranS == "Бумажный") 
	      if(kolp_B_O != 0)
		[│ ИТОГО ПО ОТДЕЛУ ######               │       ##### │       ############## │   RUR   │  Б   │
	         ├───────┬──────────────────────┬───────┼─────────────┼──────────────────────┼─────────┼──────┤](otdel2,int(kolp_B_O),sump_B_O);
	      end;
	  elif(VidHranS == "Электронно") 
	      if(kolp_E_O != 0)
		[│ ИТОГО ПО ОТДЕЛУ ######               │       ##### │       ############## │   RUR   │  Э   │
	         ├───────┬──────────────────────┬───────┼─────────────┼──────────────────────┼─────────┼──────┤](otdel2,int(kolp_E_O),sump_E_O);
	      end;

	  end;
	  kolp_B_O = 0; sump_B_O = $0; kolp_E_O = 0; sump_E_O = $0;
	else
	  tabl.printseparator();
	end;

	otdel2 = otdel1;
	oper2  = oper1;
	KolP   = KolP + 1;
	SumP   = SumP + money(Data.Value("SumRUR"));
	end;
     if ((Vid_HranS == "Б") and (substr(data.value("accDeb"),1,5) != "90901")and (substr(data.value("accDeb"),1,5) != "90902")and (substr(data.value("accKr"),1,5) != "90901")and (substr(data.value("accKr"),1,5) != "90902"))
	KolP_B    = KolP_B    + 1; SumP_B    = SumP_B    + Data.Value("SumRUR");
	Kolp_B_O  = kolp_B_O  + 1; sump_B_O  = sump_B_O  + Data.Value("SumRUR"); 
	kolp_B_OP = kolp_B_OP + 1; sump_B_OP = sump_B_OP + Data.Value("SumRUR"); 
     else
        KolP_E    = KolP_E    + 1; SumP_E    = SumP_E    + Data.Value("SumRUR");
	kolp_E_O  = kolp_E_O  + 1; sump_E_O  = sump_E_O  + Data.Value("SumRUR"); 
 	kolp_E_OP = kolp_E_OP + 1; sump_E_OP = sump_E_OP + Data.Value("SumRUR"); 
     end;

    end;
       end;

/* ==>> */if((kontr == 1) and (otchetbank))
        Select = select+
"          order by t_oper, AccDeb, SUMRUR                                                                                                              ";
		Data = ExecSQLSelect(Select);
		while(Data.moveNext())
		oper1     = data.value("t_oper");
		otdel1    = data.value("otdel");
                StoreKind = data.value("vid_hran");
               if(StoreKind != 0)
                StoreKind = 1;
               end;
	payment_id = data.value("t_paymentid");
	StoreKind = kateg_vid_hran(payment_id,StoreKind,chapter);
        Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
           if (Flag_pechati_provodkiS == 1)
	    if (oper1 != oper2)
             if(VidHranS == "Электр+Бум")
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
               │  Итого по отчету (Б+Э)   ##### ###############                                                         │ ############## │       │       │                                          │ Б+Э  │
               │  Документов               #######                                                                      │                │       │       │                                          │      │
               └────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────────────┴───────┴───────┴──────────────────────────────────────────┴──────┘](
                                         oper2,GetShortName(GetOperName(oper2)),                                              SumOP,  
                                           kolOP);
             elif(VidHranS == "Бумажный")
              if(kolOP != 0)        
               [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
                │  Итого по отчету (Б)       ##### ###############                                                       │ ############## │       │       │                                          │  Б   │
                │  Документов бумажного вида: #######                                                                    │                │       │       │                                          │      │
                └────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────────────┴───────┴───────┴──────────────────────────────────────────┴──────┘](
                                          oper2,GetShortName(GetOperName(oper2)),                                              SumOP,  
                                            kolOP);
	      end;
	     elif(VidHranS == "Электронно")
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
               │  Итого по отчету (Э)          ##### ###############                                                    │ ############## │       │       │                                          │  Э   │
               │  Документов электронного вида: #######                                                                 │                │       │       │                                          │      │
               └────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────────────┴───────┴───────┴──────────────────────────────────────────┴──────┘](
                                         oper2,GetShortName(GetOperName(oper2)),                                              SumOP,  
                                           kolOP);
             end;
	      if (otdel1 != otdel2)      /*следующий отдел отдел*/
	        [Всего документов по подразделению ################# на сумму #################   


	         ##############################################################################
                ](int(kolp),sump,"отдел " + data.value("otdel"));

                SumP   = $0; kolP = 0;
		otdel2 = otdel1;
              end;
		SumOP = $0; kolOP = 0;
		tabl = ctablereport();
		tabl.addcolumn("№ Док.",      10,AL_CENTER); 
		tabl.addcolumn("Счет дебет",  20,AL_CENTER);
		tabl.addcolumn("Наименование",20,AL_CENTER); 
		tabl.addcolumn("Счет кредит", 20,AL_CENTER); 
		tabl.addcolumn("Наименование",20,AL_CENTER); 
		tabl.addcolumn("Сумма",       14,AL_RIGHT);
		tabl.addcolumn("Шифр|/вид",    5,AL_CENTER); 
		tabl.addcolumn("Опер",         5,AL_CENTER); 
		tabl.addcolumn("Основание",   40,AL_LEFT); 
		tabl.addcolumn("Вид|хран",     4,AL_CENTER);
		tabl.printhead(" \n"+data.value("t_Oper") + " " + GetOperName(data.Value("t_oper")));
		oper2 = oper1;		
	    end;
		tabl.printseparator();
		tabl.printStringTransferByWord(data.value("NumDoc"),data.value("AccDeb"),data.value("name1"),data.value("AccKr"),data.value("name2"),data.value("Sum"),   /*data.value(9)*/
		data.value("sh"),data.value("t_oper"),data.value("Ground"),vid_hran);
		kolOP = kolOP + 1; sumOP = sumOP + money(data.value("sumRUR"));
		KolP  = KolP  + 1; SumP  = SumP  + money(Data.Value("sumRUR"));
		Kol   = Kol   + 1; Sum   = Sum   + money(Data.Value("sumRUR"));
 	   end;	
        	end;	
        end;  
/* ==>> */if(kontr == 3)

	Select = select+
"          order by t_oper, AccDeb, SUMRUR                                                                                                            ";
		Data = ExecSQLSelect(Select);
	while (Data.moveNext())
	   tabl.printseparator();
                StoreKind = data.value("vid_hran");
               if(StoreKind != 0)
                StoreKind = 1;
               end;
	   payment_id = data.value("t_paymentid");
	   StoreKind = kateg_vid_hran(payment_id,StoreKind,chapter);
                Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
              if (Flag_pechati_provodkiS == 1)
		tabl.printStringTransferByWord(data.value("NumDoc"),
					       data.value("AccDeb"),
					       data.value("AccKr"),
					       data.value("SumRUR"),
					       data.value("Ground"),
					       data.value("Sh"),
         				string(data.value("t_Oper") + " " +GetoperName(data.value("t_Oper"))),
					       data.value("otdel"),vid_hran);
		Kol = Kol + 1; Sum = Sum + money(Data.Value("sumRUR"));
	      end;
	end;	
     end;
end;
/**/
        if ((flag_pechati_GetOperName==1) AND (kontr != 2))
//		tabl.printbottom();
        end;
	if(kontr == 3)
	  tabl.printbottom();
	end;
            if(kontr!=2)
               tabl = ctablereport();
            end;
	if((flag_pechati_GetOperName==1) and (kontr == 1))
if(VidHranS == "Электр+Бум")
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
               │  Итого по отчету (Б+Э)   ##### ###############                                                         │ ############## │       │       │                                          │ Б+Э  │
               │  Документов               #######                                                                      │                │       │       │                                          │      │
               └────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────────────┴───────┴───────┴──────────────────────────────────────────┴──────┘](
                                         oper2,GetShortName(GetOperName(oper2)),                                              SumOP,  
                                           kolOP);
elif(VidHranS == "Бумажный")
        if(kolOP != 0)        
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
               │  Итого по отчету (Б)       ##### ###############                                                       │ ############## │       │       │                                          │  Б   │
               │  Документов бумажного вида: #######                                                                    │                │       │       │                                          │      │
               └────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────────────┴───────┴───────┴──────────────────────────────────────────┴──────┘](
                                         oper2,GetShortName(GetOperName(oper2)),                                              SumOP,  
                                           kolOP);
	end;
elif(VidHranS == "Электронно")
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
               │  Итого по отчету (Э)          ##### ###############                                                    │ ############## │       │       │                                          │  Э   │
               │  Документов электронного вида: #######                                                                 │                │       │       │                                          │      │
               └────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────────────┴───────┴───────┴──────────────────────────────────────────┴──────┘](
                                         oper2,GetShortName(GetOperName(oper2)),                                              SumOP,  
                                           kolOP);
end;

	end;

if(kontr == 2)
	if(VidHranS == "Бумажный")   
		if(Kolp_B_OP !=0)
                tabl.printStringTransferByWord (oper2,
					        GetShortName(GetOperName(oper2)),
						otdel2,
						Kolp_B_OP,
						Sump_B_OP,
						"RUR",
						"Б");
		tabl.printseparator();
		end;
	elif(VidHranS == "Электронно")
		if(Kolp_E_OP !=0)
                tabl.printStringTransferByWord (oper2,
						GetShortName(GetOperName(oper2)),
						otdel2,
						Kolp_E_OP,
						Sump_E_OP,
						"RUR",
						vid_hranS);
		tabl.printseparator();
		end;	
        else
		[│       │                      │       │       ##### │       ############## │   RUR   │  Б   │
		 │ ##### │ #################### │ ##### ├─────────────┼──────────────────────┼─────────┼──────┤
		 │       │                      │       │       ##### │       ############## │   RUR   │  Э   │](kolp_B_OP,sump_B_OP,oper2,GetShortName(GetOperName(oper2)),otdel2,kolp_E_OP,sump_E_OP);
		[├───────┼──────────────────────┼───────┼─────────────┼──────────────────────┼─────────┼──────┤]
	end;
 		
//   if((VidHranS != "Бумажный") or (kolp_B_O != 0))
//      [├───────┴──────────────────────┴───────┼─────────────┼──────────────────────┼─────────┼──────┤


	if((VidHranS != "Бумажный") and (VidHranS != "Электронно"))  
		[│                                      │       ##### │       ############## │   RUR   │  Б   │
		 │ ИТОГО ПО ОТДЕЛУ ######               ├─────────────┼──────────────────────┼─────────┼──────┤
		 │                                      │       ##### │       ############## │   RUR   │  Э   │](int(kolp_B_O),sump_B_O,otdel2,int(kolp_E_O),sump_E_O);
//	         ├───────┬──────────────────────┬───────┼─────────────┼──────────────────────┼─────────┼──────┤
	elif(VidHranS == "Бумажный") 
	      if(kolp_B_O != 0)
		[│ ИТОГО ПО ОТДЕЛУ ######               │       ##### │       ############## │   RUR   │  Б   │](otdel2,int(kolp_B_O),sump_B_O);
              end;
	elif(VidHranS == "Электронно") 
	      if(kolp_E_O != 0)
		[│ ИТОГО ПО ОТДЕЛУ ######               │       ##### │       ############## │   RUR   │  Э   │](otdel2,int(kolp_E_O),sump_E_O);
//	         ├───────┬──────────────────────┬───────┼─────────────┼──────────────────────┼─────────┼──────┤
	      end;
	end;

NumOtdel1 = "";
if(NumOtdel != "")NumOtdel1 = NumOtdel + "." + NumPodOtdel end; 
      [├──────────────────────────────────────┼─────────────┼──────────────────────┼─────────┼──────┤];
      [│                                      │############ │##################### │   RUR   │  Б   │](int(kolp_B),sump_B);
      [│ ИТОГО ПО ПОДРАЗДЕЛЕНИЮ #####         ├─────────────┼──────────────────────┼─────────┼──────┤](NumOtdel1);//(substr(NameDepart,1,5));
      [│    (по видам хранения)               │############ │##################### │   RUR   │  Э   │](int(kolp_E),sump_E);
      [└──────────────────────────────────────┴─────────────┴──────────────────────┴─────────┴──────┘];
end;

if(kontr == 1)
if(OperSelect == 0) 
else
                [Всего по операционисту ______________ ##################### документов:
                                                                             бумажного вида    ##### на сумму(руб.экв) ##############
                                                                             электронного вида ##### на сумму(руб.экв) ##############
                                                                             всего документов  ##### на сумму(руб.экв) ##############
		](getShortName(GetOpername(oper2)),kolP_B_O,sumP_B_O,kolP_E_O,sumP_E_O,kolP_B_O+kolP_E_O,sumP_B_O+sumP_E_O);
end;
end;
//	if ((kontr == 2) or ((kontr == 3) and (not(otchetbank))))	
if(not(otchetbank))
	if ((kontr == 3) and (not(otchetbank)))	
      [
           Всего документов по подразделению ################# на сумму #################   


      ](int(kolp),sump);
        end;


if (kontr == 2)
   if(VidHranS == "Бумажный")
      [
           Всего документов по отчету ################# на сумму(руб) #################   

      ](int(kolp_B),sump_B);
   elif(VidHranS == "Электронно")
      [
           Всего документов по отчету ################# на сумму(руб) #################   

      ](int(kolp_E),sump_E);
   else
      [
           Всего документов по отчету ################# на сумму(руб) #################   

      ](int(kolp_E + kolp_B),sump_E + sump_B);
   end;
end;



  [  ____________________________________________________________________________

   Руководитель подразделения    ############################### __________________ 

   Контролёр                     ############################### __________________ 
                                                                         
   Отчет подготовил              ############################### __________________ 
  ]      (HeaderName, ControlName, getShortName(GetOperName({oper})));
	end;
	if(((kontr == 1) or (kontr == 3)) and (otchetbank))


  [
     ____________________________________________________________________________

     Всего документов по Банку ############    на сумму ##########################]
  (int(Kol),Sum);
  [  ____________________________________________________________________________

      Главный бухгалтер_________________________________

      Контролер____________________________

      Отчет подготовил  #############################################################
  ]    (getShortName(GetOperName({oper})));
        end;                               
end;

/* ------------------------------------------------------------------------ */
macro Report_vnutr_doc_val(Mode:string,Chapter:integer, Oper_new:integer, kontr:integer, otchetbank:bool, nbalanse1:string, nbalanse2:string)  
//msgbox("Report_vnutr_doc_val");                                                                                          /*otchetbank:false - по подразделению, true - по банку*/
	var tabl=ctablereport(), type_report:string="";                                                                  /*kontr:true - контрольная ведомость, false - сводный реестр*/
	var Select, select_oper, Data, StoreKind, pechat_hran,kolp_B,sump_B,kolp_E,sump_E,SumRP_E,SumRP_B,podr2,podr1,Kol_B,Sum_B,Kol_E,Sum_E;
	var Kol, Sum, KolP, SumP, Op, Office, podrazdel,kolOP, sumOP, SumR, SumROP, KolVOP, SumVOP, SumR_P,SumRP, SumRVOP,flag_separator;
        var oper1, oper2, OperSelect, flag_pechati_GetOperName, CodeVal1, CodeVal2,vid_hran, Vid_HranS, Flag_pechati_provodkiS;
        var nameval1, nameval2, kolVOP_B, kolVOP_E, SumVOP_B, SumVOP_E, SumRVOP_E, SumRVOP_B,sumRVOP_B_O,sumRVOP_E_O,kolVOP_E_O,kolVOP_B_O;
	var kolp_B_O, sump_B_O, kolp_E_O, sump_E_O,NumOtdel1;
	OperSelect = Oper_new;
      pechat_hran = "";
  if   (kontr == 2)                                                                                            /* ------------------------------------------------------------------------ */
      type_report = "КОНТРОЛЬНАЯ ВЕДОМОСТЬ ПОДРАЗДЕЛЕНИЯ";
  elif (kontr == 1)
      type_report = "СВОДНЫЙ РЕЕСТР ВНУТРЕННИХ ОПЕРАЦИЙ";
  elif (kontr == 3)
      type_report = "РЕЕСТР ОПЕРАЦИЙ        ";
  end;
//  if   (kontr != 2)
     if(VidHranS == "Бумажный")
      pechat_hran = "на документы бумажного вида хранения";
     elif(VidHranS == "Электронно")
      pechat_hran = "на документы электронного вида хранения";
     elif(VidHranS == "Электр+Бум")
      pechat_hran = "на документы бумажного+электронного вида хранения";
     end;
//  end;
    if((otchetbank) and(kontr !=2))

	[ ##########################

        	                     ######################################  по Банку
                                                в иностранной валюте 

                                    ##################################################
                                                                                      ]({Name_Bank},type_report:r,pechat_hran);
  if (pachkaS != "") //and (substr(RepTypes,1,26) == "Баланс -> Внутриклиентские"))
        [
                              по номерам пачек:  #](string(pachkaS));
  end;
        [
            	                                  за  ##########

          Отчет: ###################################################################

	]  (DateDocum,Mode);
    else	
	[ ##########################

                 	              ######################################
                                               в иностранной валюте

                                 ##################################################

                          по подразделению: ##################################################################]({Name_Bank},type_report:r,pechat_hran, NameDepart);
  if(OperSelect!=0)
        [              по операционисту: ##### - ##############################################](operselect,GetOperName(operselect))                
  end;

  if (pachkaS != "") //and (substr(RepTypes,1,26) == "Баланс -> Внутриклиентские"))
        [
                              по номерам пачек:  #](string(pachkaS));
  end;
        [
            	                                 за  ##########

          Отчет: ###################################################################

	](DateDocum,Mode);
    end;

        kol    = 0; Sum    = $0;	kolp_B_O   = 0; sump_B_O    = $0;	SumRP_E = $0; 
	kolP   = 0; SumP   = $0;	kolp_E_O   = 0; sump_E_O    = $0;	SumRP_B = $0;
        kolOP  = 0; SumOP  = $0;	kolVOP_B   = 0; SumVOP_B    = $0;	SumR    = $0; 
        kol_B  = 0; Sum_B  = $0;	kolVOP_E   = 0; SumVOP_E    = $0;	SumROP  = $0;
	kol_E  = 0; Sum_E  = $0;	kolVOP_B_O = 0; SumRVOP_B_O = $0;	SumR_P  = $0;
        kolp_B = 0; sump_B = $0;	kolVOP_E_O = 0; SumRVOP_E_O = $0;	SumRP   = $0; 
	kolVOP = 0; SumVOP = $0;	                SumRVOP_E   = $0;	SumRVOP = $0;
	kolp_E = 0; sump_E = $0;	                SumRVOP_B   = $0;

	Select = " ";
	oper2 = 0;//I-00219670-2
/* ==>> */if(kontr == 2)// and (not(otchetbank)))     /*контрольная ведомость по отделу*/
        Select = select+
"       SELECT  b.t_oper, T_name, chislo, sum,sumRUR, t_ccy, T_FIID_PAYER, vid_hran,T_CODE1,T_CODE2                                               "+
"       FROM                                                                                                                                         "+
"       (select   c.t_oper, count(1) as chislo, sum(c.SUM) as sum,sum(c.sumRUR) sumRUR, c.t_ccy, c.T_FIID_PAYER, c.vid_hran,c.T_CODE1,c.T_CODE2   "+
"        from (select a.t_oper, a.sum, a.sumRUR, a.t_code1, a.t_code2, a.t_ccy, a.T_FIID_PAYER, (SELECT storeKind FROM TABLE(USER_EA.Get_dev_prop  "+  
"        (a.dockind, a.origin, a.paymkind, a.shifr_oper, a.numb_pack, a.chapter, a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))) vid_hran       "+
"       from                                                                                                                                         ";
/* ==>> */elif((kontr == 1) and (not(otchetbank)))    /*сводный реестр по отделу*/
        Select = select+
"       SELECT   a.NumDoc, a.AccDeb, a.name1, a.AccKr, a.name2, a.SUM,a.sumRUR, a.sh, a.t_Oper, a.Ground, a.AppKey, T_CODE1||'.'||T_CODE2||' '||name_otdel as otdel, a.t_ccy, T_FIID_PAYER, a.t_code1, a.t_code2,"+
"       (SELECT storeKind FROM TABLE(USER_EA.Get_dev_prop                                                                                            "+
"        (a.dockind, a.origin, a.paymkind, a.shifr_oper, a.numb_pack, a.chapter, a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))) vid_hran,nameval       "+
"       FROM                                                                                                                                         ";
/* ==>> */elif((kontr == 1) and (otchetbank))         /*сводный реестр по банку*/
        Select = select+
"       select t_code1,t_code2,name_otdel,t_oper,numdoc,accdeb,name1,acckr,name2,SUM, sumRUR, sh,ground,t_ccy,T_FIID_PAYER,AppKey, (SELECT storeKind FROM TABLE(USER_EA.Get_dev_prop     "+  //| 30.07.12 Glushin S.P. добавлено поле AppKey
"        (a.dockind, a.origin, a.paymkind, a.shifr_oper, a.numb_pack, a.chapter, a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))) vid_hran,nameval       "+
"       from                                                                                                                                         ";
/* ==>> */elif((kontr == 3))         /* реестр операций*/
        Select = select+
"       select t_code1,t_code2,name_otdel,t_oper,numdoc,accdeb,name1,acckr,name2,SUM,sumRUR, sh,ground,t_ccy,T_FIID_PAYER,(SELECT storeKind FROM TABLE(USER_EA.Get_dev_prop     "+  
"        (a.dockind, a.origin, a.paymkind, a.shifr_oper, a.numb_pack, a.chapter, a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))) vid_hran       "+
"       from                                                                                                                                         ";
       end;

        Select = select+   /*основной запрос - начало*/
"       (select distinct DOTDELS_DBT.T_CODE1,DOTDELS_DBT.T_CODE2,DOTDELS_DBT.T_NAME as NAME_OTDEL, arh.t_oper,                                       "+
"                arh.t_numb_document AS NumDoc, arh.t_account_payer AS AccDeb, acc1.t_nameaccount name1, arh.t_account_receiver AS AccKr,            "+
"                acc2.t_nameaccount name2, arh.T_SUM_PAYER AS SUM, arh.T_SUM_NATCUR sumRUR, arh.t_shifr_oper||'/'||t_kind_oper sh, arh.t_ground AS Ground,                          "+   
"                arh.T_ACCTRNID AppKey,dfininstr_dbt.t_ccy, arh.T_FIID_PAYER, arh.T_FIID_RECEIVER ,dfininstr_dbt.t_name nameval,"+
"                prop.T_PAYMENTKIND paymkind, user_ea.GetOrigin ( paym.t_dockind, paym.t_paymentid) origin, arh.T_CHAPTER chapter, paym.T_DOCKIND dockind, arh.T_NUMBER_PACK numb_pack,     "+
"                arh.T_SHIFR_OPER shifr_oper, paym.T_FIID cred_fiid, paym.T_PAYFIID deb_fiid,arh.t_typedocument                                 "+
"           FROM dacctrn_dbt arh,dpmdocs_dbt docs,dpmpaym_dbt paym,daccount_dbt acc1,daccount_dbt acc2,DOTDELS_DBT,dfininstr_dbt,dpmrmprop_dbt prop,"+
"                (select * from DOP_OTDEL_DBT where (T_oper,t_datebegin) in (select T_oper,max(t_datebegin) t_datebegin                              "+                    
"                   from DOP_OTDEL_DBT where t_datebegin<=TO_DATE ('"+ DateDocum + "', 'DD.MM.YYYY')                                                 "+
"                        and (t_dateend >= TO_DATE ('"+ DateDocum + "', 'DD.MM.YYYY') OR t_dateend  = TO_DATE ('01.01.0001', 'DD.MM.YYYY'))                "+                                                                 
"                        group by T_oper)) DOP_OTDEL_DBT                                                                                             "+
"	   WHERE arh.t_date_carry = to_date('" + DateDocum +"','DD.MM.YYYY')                                                                         "+ 
"            and (DOP_OTDEL_DBT.t_dateend >=to_date('"+ DateDocum + "','DD.MM.YYYY') or t_dateend = to_date('01.01.0001','DD.MM.YYYY'))              "+
"            and t_datebegin <=to_date('"+ DateDocum + "','DD.MM.YYYY')                                                                              "+
"            AND dfininstr_dbt.t_fiid = arh.T_FIID_PAYER                                                                                             "+
"	     AND acc1.t_account(+) = arh.t_account_payer	                                                                                             "+
"	     AND acc2.t_account(+) = arh.t_account_receiver                                                                                             ";
if (pachkaS != "")                                                                   //C-17070-6
select = select+ 
"            AND arh.T_NUMBER_PACK in (" + pachkaS + ")";
end;
select = select+ 
"	     AND arh.t_chapter = "+ Chapter                                                                                                           ;
if(substr(RepTypes,1,9) != "Баланс ->")
Select = Select +
"            AND arh.t_result_carry <> 14                                                                                                            ";
end;
Select = Select +
"	     AND arh.T_ACCTRNID = docs.T_ACCTRNID(+)                                                                                     "+
"            AND docs.T_PAYMENTID = paym.T_PAYMENTID(+)                                                                                              "+
"            AND paym.t_paymentid = prop.t_paymentid(+)                                                                                              "+
"            AND substr(arh.T_ACCOUNT_PAYER,6,3) = substr(arh.T_ACCOUNT_RECEIVER,6,3)                                                                "+
"            AND substr(arh.T_ACCOUNT_PAYER,6,3) <> '810'                                                                                            "+
"            AND substr(arh.T_ACCOUNT_RECEIVER,6,3) <> '810'                                                                                            "+
"	     AND SUBSTR (arh.t_account_payer, 1, 5) NOT IN ('20202','20203','20207','00000')                                                         "+
"	     AND SUBSTR (arh.t_account_receiver, 1, 5) NOT IN ('20202','20203','20207','00000')                                                      "+
"            and arh.T_OPER = DOP_OTDEL_DBT.T_oper                                                                                                   "+
"            and DOP_OTDEL_DBT.T_CODE1 = DOTDELS_DBT.T_CODE1                                                                                         "+
"            and DOP_OTDEL_DBT.T_CODE2 = DOTDELS_DBT.T_CODE2                                                                                         ";
if(substr(RepTypes,1,9) == "Баланс ->")
        Select = select+
"            and (exists (select 1 from dpmprop_dbt  deb,dpmprop_dbt cred                                                                            "+
"            where cred.T_PAYMENTID = docs.T_PAYMENTID                                                                                               "+
"            and deb.T_PAYMENTID = docs.T_PAYMENTID                                                                                                  "+
"            and deb.T_PAYMENTID = cred.T_PAYMENTID                                                                                                  "+
"            and deb.t_debetcredit = 0 and cred.t_debetcredit = 1                                                                                    "+
"            and cred.t_group <>"+ PAYMENTS_GROUP_EXTERNAL + " and deb.t_group <>"+ PAYMENTS_GROUP_EXTERNAL+  ")  /*условие для внутренних*/         "+                      
"            or docs.t_paymentid is null)                                                                                                            "; 
end;
        Select = select+
             nbalanse1 + ")" + "\n" + nbalanse2 + ")" + "\n                                                                                          ";
	if ((OperSelect!=0) and (kontr !=2))     /*если выбран опер, то запрос по одному оперу*/
       Select = select +
"	     AND arh.T_OPER =" + OperSelect;       
           procedura_message_oper_otdel(OperSelect, NumOtdel, NumPodOtdel);
	end;
       Select = select + ") a";
                          /*основной запрос - конец*/
/* ==>> */if(kontr == 2) 
        Select = select+
"        ) c";
 if(not(otchetbank))
        Select = select+
"          where c.T_CODE1 = "+ NumOtdel;
    if(NumPodOtdel !=0)
        Select = select+
"            and c.T_CODE2 = "+ NumPodOtdel;
    end;
 end;
        Select = select+
"          group by c.t_oper,c.t_code1,c.t_code2,c.t_ccy,c.T_FIID_PAYER, c.vid_hran) b, dperson_dbt                                                         "+
"          WHERE b.T_OPER = dperson_dbt.T_oper                                                                                                       "+
"          order by b.t_code1,b.t_code2,b.t_oper,T_FIID_PAYER                                                                                                         ";
	Data = ExecSQLSelect(Select);
	tabl.addcolumn("Код |опер.",             5,AL_CENTER);  
	tabl.addcolumn("Операционист",          20,AL_LEFT); 
	tabl.addcolumn("Отдел",                  5,AL_RIGHT);
	tabl.addcolumn("Количество |документов",11,AL_RIGHT);
	tabl.addcolumn("Сумма|в валюте",        14,AL_RIGHT);  
	tabl.addcolumn("Валюта",                 7,AL_CENTER); 
	tabl.addcolumn("Сумма|в в рублях",      14,AL_RIGHT); 
	tabl.addcolumn("Вид|хран",               4,AL_CENTER);
	tabl.printhead();
	KolP   = 0; SumP =$0;
	oper2  = 0;
	otdel2 = 0;
	flag_separator = 0;
/* ==>> */elif((kontr == 1) and (not(otchetbank)))
        Select = select+
"          where a.T_CODE1 = "+ NumOtdel;
    if(NumPodOtdel !=0)
        Select = select+
"            and a.T_CODE2 = "+ NumPodOtdel;
    end;
        Select = select+
"          order by a.t_code1, a.t_code2, a.t_Oper, T_FIID_PAYER, AccDeb, SUM                                                                                           ";
	Data = ExecSQLSelect(Select);
	tabl.addcolumn("№ Док.",        10,AL_CENTER); 
	tabl.addcolumn("Счет дебет",    20,AL_CENTER);
	tabl.addcolumn("Наименование",  20,AL_CENTER); 
	tabl.addcolumn("Счет кредит",   20,AL_CENTER);
	tabl.addcolumn("Наименование",  20,AL_CENTER); 
	tabl.addcolumn("Валюта",         6,AL_CENTER); 
	tabl.addcolumn("Сумма|в валюте",14,AL_right); 
	tabl.addcolumn("Сумма|в рублях",14,AL_right);
	tabl.addcolumn("Шифр|/вид",      5,AL_CENTER); 
	tabl.addcolumn("Опер",           5,AL_CENTER); 
	tabl.addcolumn("Основание",     40,AL_LEFT); 
	tabl.addcolumn("Вид|хран",       4,AL_CENTER);
        if(Data.MoveNext());
              SumR = Data.value("sumRUR");
                StoreKind = data.value("vid_hran");
               if(StoreKind != 0)
                StoreKind = 1;
               end;
                Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
 if(Vid_HranS == "Б")
		kolVOP_B   = kolVOP_B   + 1; sumRVOP_B   = sumRVOP_B   + SumR;
					     sumVOP_B    = sumVOP_B    + data.value("sum");
		kolVOP_B_O = kolVOP_B_O + 1; sumRVOP_B_O = sumRVOP_B_O + SumR;
	        KolP_B     = KolP_B     + 1; SumRP_B     = SumRP_B     + SumR;
 else
		kolVOP_E   = kolVOP_E   + 1; sumRVOP_E   = sumRVOP_E   + SumR;
					     sumVOP_E    = sumVOP_E    + data.value("sum");
		kolVOP_E_O = kolVOP_E_O + 1; sumRVOP_E_O = sumRVOP_E_O + SumR;
	        KolP_E     = KolP_E     + 1; SumRP_E     = SumRP_E     + SumR;
 end;
           if (Flag_pechati_provodkiS == 1)
	tabl.printhead("отдел "+ data.value("otdel") + " \n"+data.value("t_Oper") + " " + GetOperName(data.Value("t_oper")));
	tabl.printStringTransferByWord (data.value("NumDoc"),
					data.value("AccDeb"),
					data.value("name1"),
					data.value("AccKr"),
					data.value("name2"),
					data.value("t_ccy"),
					data.value("SUM"),
					SumR,
					data.value("sh"),
					data.value("t_Oper"),
					data.value("Ground"),
					vid_hranS);
	kolOP   = 1;
	SumVOP  = data.value("sum");
	KolVOP  = 1;
	SumROP  = data.value("sumRUR");
        SumRVOP = SumROP;
        kolp    = 1; 
	sump    = data.value("sum");
        SumRP   = SumROP;
           end;
        oper1 = data.value("t_oper");                            /*первую запись в сводном выводим вместе с шапкой таблицы*/
	oper2 = oper1;
        CodeVal1 = data.value("t_ccy");
        CodeVal2 = CodeVal1;
        nameval1 = data.value("nameval");
        nameval2 = nameval1;
	otdel1 = data.value("otdel");
	otdel2 = otdel1;
        flag_pechati_GetOperName = 1;
	end;

/* ==>> */elif((kontr == 1) and (otchetbank))
        Select = select+
"          order by a.t_code1, a.t_code2, a.t_oper, a.T_FIID_PAYER, AccDeb, SUM                                                                                      ";
	Data = ExecSQLSelect(Select);
	tabl.addcolumn("№ Док.",        10,AL_CENTER); 
	tabl.addcolumn("Счет дебет",    20,AL_CENTER);
	tabl.addcolumn("Наименование",  20,AL_CENTER); 
	tabl.addcolumn("Счет кредит",   20,AL_CENTER); 
	tabl.addcolumn("Наименование",  20,AL_CENTER); 
	tabl.addcolumn("Валюта",         6,AL_CENTER); 
	tabl.addcolumn("Сумма|в валюте",14,AL_right); 
	tabl.addcolumn("Сумма|в рублях",14,AL_right);
	tabl.addcolumn("Шифр|/вид",      5,AL_CENTER); 
	tabl.addcolumn("Опер",           5,AL_CENTER); 
	tabl.addcolumn("Основание",     40,AL_LEFT); 
	tabl.addcolumn("Вид|хран",       4,AL_CENTER);
      if(Data.MoveNext());
              SumR = Data.value("sumRUR");
              StoreKind = data.value("vid_hran");
               if(StoreKind != 0)
                StoreKind = 1;
               end;
                Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
           if (Flag_pechati_provodkiS == 1)
	tabl.printhead("отдел " +  data.value("t_code1") +"." + data.value("t_code2") + data.value("name_otdel") + " \n"+data.value("t_Oper") + " " + GetOperName(data.Value("t_oper")));

	tabl.printStringTransferByWord (data.value("NumDoc"),
					data.value("AccDeb"),
					data.value("name1"),
					data.value("AccKr"),
					data.value("name2"),
					data.value("t_ccy"),
					data.value("SUM"),
					SumR,
					data.value("sh"),
					data.value("t_Oper"),
					data.value("Ground"),
					vid_hranS);

	kolOP  = 1; SumVOP = data.value("sum");
        KolVOP = 1; SumROP = Data.value("sumRUR");
	kol    = 1; Sum    = money(data.value("sum")); 
        kolp   = 1; sump   = data.value("sum");
	   end;
        oper1  = data.value("t_oper");
	otdel1 = data.value("name_otdel");
	otdel2 = otdel1;
	oper2  = oper1;
        CodeVal1 = data.value("t_ccy");
        CodeVal2 = CodeVal1;
        nameval1 = data.value("nameval");
        nameval2 = nameval1;
        podr1 = data.value("t_code1");
        podr2 = podr1;
        flag_pechati_GetOperName = 1;
 if(Vid_HranS == "Б")
		kolVOP_B   = kolVOP_B   + 1; sumRVOP_B   = sumRVOP_B   + SumR;
					     sumVOP_B    = sumVOP_B    + data.value("sum");
		kolVOP_B_O = kolVOP_B_O + 1; sumRVOP_B_O = sumRVOP_B_O + SumR;
	        KolP_B     = KolP_B     + 1; SumRP_B     = SumRP_B     + SumR;
	        Kol_B      = Kol_B      + 1; Sum_B       = Sum_B       + SumR;
 else
		kolVOP_E   = kolVOP_E   + 1; sumRVOP_E   = sumRVOP_E   + SumR;
					     sumVOP_E    = sumVOP_E    + data.value("sum");
		kolVOP_E_O = kolVOP_E_O + 1; sumRVOP_E_O = sumRVOP_E_O + SumR;
	        KolP_E     = KolP_E     + 1; SumRP_E     = SumRP_E     + SumR;
	        Kol_E      = Kol_E      + 1; Sum_E       = Sum_E       + SumR;
 end;
	end;
/* ==>> */elif((kontr == 3))
         if (not(otchetbank))
          Select = select+
"         where a.T_CODE1 = "+ NumOtdel;
           if(NumPodOtdel !=0)
            Select = select+
"           and a.T_CODE2 = "+ NumPodOtdel;
           end;
         end;
        Select = select+
"          order by a.t_code1, a.t_code2, a.t_oper, a.T_FIID_PAYER, AccDeb, SUM                                                                                      ";
	Data = ExecSQLSelect(Select);
	tabl.addcolumn("№ Док.",        10,AL_CENTER); 
	tabl.addcolumn("Счет дебет",    20,AL_CENTER); 
	tabl.addcolumn("Счет кредит",   20,AL_CENTER); 
	tabl.addcolumn("Код|вал",        4,AL_right); 
	tabl.addcolumn("Сумма",         14,AL_right); 
	tabl.addcolumn("Сумма|в рублях",14,AL_right);
	tabl.addcolumn("Основание",     30,AL_LEFT);
	tabl.addcolumn("Шифр|/вид",      5,AL_CENTER); 
	tabl.addcolumn("Опер",          10,AL_CENTER); 
	tabl.addcolumn("Отдел",          5,AL_CENTER); 
	tabl.addcolumn("Вид|хр",         3,AL_CENTER);
	tabl.printhead();
       end;
//	KolP = 0;SumP =$0;
debugbreak;
debugbreak;
        while(Data.MoveNext())//and(ValType(Data.Value("Sum"))!= 26))

/* ==>> */if(kontr == 2) //and (not(otchetbank)))   /*11*/
                StoreKind = data.value("vid_hran");
		oper1     = data.value("t_oper");
		otdel1    = data.value("t_code1") + "." + data.value("t_code2");
               if(StoreKind != 0)
                StoreKind = 1;
               end;
                Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
		SumR = data.value("sumRUR");
           if (Flag_pechati_provodkiS == 1)
	if(oper1 == oper2)
	        [│       │                      │       ├─────────────┼────────────────┼─────────┼────────────────┼──────┤
	         │       │                      │       │ ########### │ ############## │   ###   │ ############## │  #   │](/*string(*/data.value("chislo"):0:0/*:r:0:0)*/,money(data.value("sum"):0:2),data.value("t_ccy"),money(SumR:0:2),Vid_HranS);

	else
	if((otdel2 != otdel1) and (otdel2 !=0))

		[├───────┴──────────────────────┴───────┼─────────────┼────────────────┼─────────┼────────────────┼──────┤
		 │                                      │       ##### │       -        │    -    │ ############## │  Б   │
		 │ ИТОГО ПО ОТДЕЛУ ######               ├─────────────┼────────────────┼─────────┼────────────────┼──────┤
		 │   (в руб.экв)                        │       ##### │       -        │    -    │ ############## │  Э   │
	         ├───────┬──────────────────────┬───────┼─────────────┼────────────────┼─────────┼────────────────┼──────┤](int(kolp_B_O),sump_B_O,otdel2,int(kolp_E_O),sump_E_O);
	kolp_B_O = 0; sump_B_O = $0; kolp_E_O = 0; sump_E_O = $0;
	else
		tabl.printseparator();
	end;
                tabl.printStringTransferByWord(data.value(0),GetShortName(data.value(1)),data.value("t_code1") + "." + data.value("t_code2"),int(data.value("chislo")),money(data.value("sum"):0:2),data.value("t_ccy"),money(SumR:0:2),Vid_HranS);
	end;
		oper2  = oper1;
		otdel2 = otdel1;
	        KolP   = KolP   + data.value("chislo");
		SumP   = SumP   + Data.Value("Sum");
		SumR_P = SumR_P + SumR;
          end;
if(Vid_HranS == "Б")
	        KolP_B   = KolP_B   + data.value("chislo"); SumP_B   = SumP_B   + SumR;
		kolp_B_O = kolp_B_O + data.value("chislo"); sump_B_O = sump_B_O + SumR; 
else
	        KolP_E   = KolP_E   + data.value("chislo"); SumP_E   = SumP_E   + SumR;
		kolp_E_O = kolp_E_O + data.value("chislo"); sump_E_O = sump_E_O + SumR;
end;


/* ==>> */elif((kontr == 1) and (not(otchetbank)))
	        oper1     = data.value("t_oper");
                CodeVal1  = data.value("t_ccy");
                nameval1  = data.value("nameval");
                StoreKind = data.value("vid_hran");
		otdel1    = data.value("otdel");
               if(StoreKind != 0)
                StoreKind = 1;
               end;
                Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);

	    if ((CodeVal1 != CodeVal2)and(oper1 == oper2))

if(VidHranS == "Электр+Бум")
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │  Итого по валюте: ################################                                                     │        │ ############## │ ############## │       │       │                                          │  Б   │
               │  Документов бумаж.  вида: #######                                                                      │  ##### ├────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │             электр. вида: #######                                                                      │        │ ############## │ ############## │       │       │                                          │  Э   │
               ├────────────┬──────────────────────┬──────────────────────┬──────────────────────┬──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤](
                                   nameval2,                                                                                        sumVOP_B,        sumRVOP_B,  
                                           kolVOP_B,                                                                     CodeVal2,
                                           kolVOP_E,                                                                                sumVOP_E,        sumRVOP_E);
elif(VidHranS == "Бумажный")
        if(kolVOP_B != 0)        
//	      [│            │                      │                      │                      │                      │        │ ############## │ ############## │       │       │                                          │  Б   │](0,0);
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │  Итого по валюте: ################################                                                     │  ##### │ ############## │ ############## │       │       │                                          │  Б   │
               │  Документов бумаж.  вида: #######                                                                      │        │                │                │       │       │                                          │      │
               ├────────────┬──────────────────────┬──────────────────────┬──────────────────────┬──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤](
                                   nameval2,                                                                             CodeVal2,  sumVOP_B,        sumRVOP_B,  
                                           kolVOP_B);
	end;
elif(VidHranS == "Электронно")
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │  Итого по валюте: ################################                                                     │  ##### │ ############## │ ############## │       │       │                                          │  Э   │
               │  Документов электр. вида: #######                                                                      │        │                │                │       │       │                                          │      │
               ├────────────┬──────────────────────┬──────────────────────┬──────────────────────┬──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤](
                                   nameval2,                                                                             CodeVal2,  sumVOP_E,        sumRVOP_E,  
                                           kolVOP_E);
end;
	        CodeVal2 = CodeVal1;
                nameval2 = nameval1;
                KolVOP   = 0; SumVOP   = $0; SumRVOP   = $0;
                kolVOP_B = 0; SumVOP_B = $0; SumRVOP_B = $0;
                kolVOP_E = 0; SumVOP_E = $0; SumRVOP_E = $0;
                	
            elif((CodeVal1 == CodeVal2)and(oper1 == oper2))
                tabl.printseparator;
	    end;
	    if (oper1 != oper2)                       /*если опер изменился*/
//		tabl.printbottom();
if(VidHranS == "Электр+Бум")
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │  Итого по валюте: ################################                                                     │        │ ############## │ ############## │       │       │                                          │  Б   │
               │  Документов бумаж. вида:  #######                                                                      │  ##### ├────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │             электр. вида: #######                                                                      │        │ ############## │ ############## │       │       │                                          │  Э   │
               ├────────────────────────────────────────────────────────────────────────────────────────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
               │  Итого по отчету (Б+Э)   ##### ###############                                                         │   -    │       -        │ ############## │       │       │                                          │ Б+Э  │
               │  Документов               #######                                                                      │        │                │                │       │       │                                          │      │
               └────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────┴────────────────┴────────────────┴───────┴───────┴──────────────────────────────────────────┴──────┘](
                                   nameval2,                                                                                        sumVOP_B,        sumRVOP_B,  
                                           kolVOP_B,                                                                     CodeVal2,
                                           kolVOP_E,                                                                                sumVOP_E,        sumRVOP_E,oper2,GetShortName(GetOperName(oper2)),SumROP,kolOP);
elif(VidHranS == "Бумажный")
        if(kolVOP_B != 0)        
//	      [│            │                      │                      │                      │                      │        │ ############## │ ############## │       │       │                                          │  Б   │](0,0);
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │  Итого по валюте: ################################                                                     │  ##### │ ############## │ ############## │       │       │                                          │  Б   │
               │  Документов бумаж. вида:  #######                                                                      │        │                │                │       │       │                                          │      │
               ├────────────────────────────────────────────────────────────────────────────────────────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
               │  Итого по отчету (Б)       ##### ###############                                                       │   -    │       -        │ ############## │       │       │                                          │  Б   │
               │  Документов бумажного вида: #######                                                                    │        │                │                │       │       │                                          │      │
               └────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────┴────────────────┴────────────────┴───────┴───────┴──────────────────────────────────────────┴──────┘](
                                   nameval2,                                                                             CodeVal2,  sumVOP_B,        sumRVOP_B,  
                                           kolVOP_B,oper2,GetShortName(GetOperName(oper2)),SumROP,kolOP);
	end;
elif(VidHranS == "Электронно")
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │  Итого по валюте: ################################                                                     │  ##### │ ############## │ ############## │       │       │                                          │  Э   │
               │  Документов бумаж. вида:  #######                                                                      │        │                │                │       │       │                                          │      │
               ├────────────────────────────────────────────────────────────────────────────────────────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
               │  Итого по отчету (Э)     ##### ###############                                                         │   -    │       -        │ ############## │       │       │                                          │  Э   │
               │  Документов электр. вида: #######                                                                      │        │                │                │       │       │                                          │      │
               └────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────┴────────────────┴────────────────┴───────┴───────┴──────────────────────────────────────────┴──────┘](
                                   nameval2,                                                                             CodeVal2,  sumVOP_E,        sumRVOP_E,  
                                           kolVOP_E,oper2,GetShortName(GetOperName(oper2)),SumROP,kolOP);
end;
	        CodeVal2 = CodeVal1;
		nameval2 = nameval1;/////////////////////
                KolVOP     = 0; SumVOP      = $0; SumRVOP   = $0;
                kolVOP_B   = 0; SumVOP_B    = $0; SumRVOP_B = $0;
                kolVOP_E   = 0; SumVOP_E    = $0; SumRVOP_E = $0; 
		kolVOP_B_O = 0; SumRVOP_B_O = $0;
		kolVOP_E_O = 0; SumRVOP_E_O = $0;
                SumROP    = $0;
                  
if(OperSelect == 0) 
       if(kolVOP_B_O != 0)
		[  ___________________________________#################################################################################

		] (GetOperName(oper2));
       end;
else
                [Всего по операционисту ______________ ##################### документов:
                                                                             бумажного вида    ##### на сумму(руб.экв) ##############
                                                                             электронного вида ##### на сумму(руб.экв) ##############
                                                                             всего документов  ##### на сумму(руб.экв) ##############
		](getShortName(oper2),kolVOP_B_O,sumRVOP_B_O,kolVOP_E_O,sumRVOP_E_O,kolVOP_B_O+kolVOP_E_O,sumRVOP_B_O+sumRVOP_E_O);
end;
           if (Flag_pechati_provodkiS == 1)
	    if (otdel1 != otdel2)      /*следующий отдел отдел*/
	        [                          ];
	        [###########################################################################################
                ]("отдел "+  otdel1);
		otdel2 = otdel1;
            end;
           end;
                SumOP = $0; kolOP = 0;
                tabl = ctablereport();
		tabl.addcolumn("№ Док.",        10,AL_CENTER); 
		tabl.addcolumn("Счет дебет",    20,AL_CENTER);
		tabl.addcolumn("Наименование",  20,AL_CENTER); 
		tabl.addcolumn("Счет кредит",   20,AL_CENTER); 
		tabl.addcolumn("Наименование",  20,AL_CENTER); 
		tabl.addcolumn("Валюта",         6,AL_CENTER);
		tabl.addcolumn("Сумма|в валюте",14,AL_right); 
		tabl.addcolumn("Сумма|в рублях",14,AL_right);
		tabl.addcolumn("Шифр|/вид",      5,AL_CENTER); 
		tabl.addcolumn("Опер",           5,AL_CENTER); 
		tabl.addcolumn("Основание",     40,AL_LEFT); 
		tabl.addcolumn("Вид|хран",       4,AL_CENTER);
           if (Flag_pechati_provodkiS == 1)
                [            ];
		tabl.printhead(/*"отдел " + data.value("otdel") + " \n"+*/data.value("t_Oper") + " " + GetOperName(data.Value("t_oper")));
           end;
		oper2 = oper1;		
	    end;	      
              SumR = Data.value("sumRUR");
 if(Vid_HranS == "Б")
		kolVOP_B   = kolVOP_B   + 1; sumRVOP_B   = sumRVOP_B   + SumR;
					     sumVOP_B    = sumVOP_B    + data.value("sum");
		kolVOP_B_O = kolVOP_B_O + 1; sumRVOP_B_O = sumRVOP_B_O + SumR;
	        KolP_B     = KolP_B     + 1; SumRP_B     = SumRP_B     + SumR;
	        Kol_B      = Kol_B      + 1; Sum_B       = Sum_B       + SumR;
 else
		kolVOP_E   = kolVOP_E   + 1; sumRVOP_E   = sumRVOP_E   + SumR;
					     sumVOP_E    = sumVOP_E    + data.value("sum");
		kolVOP_E_O = kolVOP_E_O + 1; sumRVOP_E_O = sumRVOP_E_O + SumR;
	        KolP_E     = KolP_E     + 1; SumRP_E     = SumRP_E     + SumR;
	        Kol_E      = Kol_E      + 1; Sum_E       = Sum_E       + SumR;
 end;
           if (Flag_pechati_provodkiS == 1)

		tabl.printStringTransferByWord (data.value(0),
						data.value(1),
						data.value(2),
						data.value(3),
						data.value(4), 
						data.value("t_ccy"),
						data.value(5),
						SumR,
						data.value(7),  //LVV 6.11.14  I-00527641 увеличил индекс на 1 
						data.value(8),  //LVV 6.11.14  I-00527641 увеличил индекс на 1 
						data.value(9),  //LVV 6.11.14  I-00527641 увеличил индекс на 1 
						vid_hranS);

		kolOP  = kolOP  + 1; sumOP  = sumOP  + data.value("sum"); SumROP  = SumROP  + SumR;
                KolVOP = KolVOP + 1; sumVOP = sumVOP + data.value("sum"); SumRVOP = SumRVOP + SumR; 
	        KolP   = KolP   + 1; SumP   = SumP   + Data.Value("sum"); SumRP   = SumRP   + SumR;
	   end;

/* ==>> */elif((kontr == 1) and (otchetbank))
		oper1     = data.value("t_oper");
                CodeVal1  = data.value("t_ccy");
                nameval1  = data.value("nameval");
		otdel1    = data.value("name_otdel");
                StoreKind = data.value("vid_hran");
	        podr1     = data.value("t_code1");
               if(StoreKind != 0)
                StoreKind = 1;
               end;
                Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
	    if ((CodeVal1 != CodeVal2)and(oper1 == oper2))

if(VidHranS == "Электр+Бум")
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │  Итого по валюте: ################################                                                     │        │ ############## │ ############## │       │       │                                          │  Б   │
               │  Документов бумаж.  вида: #######                                                                      │  ##### ├────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │             электр. вида: #######                                                                      │        │ ############## │ ############## │       │       │                                          │  Э   │
               ├────────────┬──────────────────────┬──────────────────────┬──────────────────────┬──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤](
                                   nameval2,                                                                                        sumVOP_B,        sumRVOP_B,  
                                           kolVOP_B,                                                                     CodeVal2,
                                           kolVOP_E,                                                                                sumVOP_E,        sumRVOP_E);
elif(VidHranS == "Бумажный")
        if(kolVOP_B != 0)        

              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │  Итого по валюте: ################################                                                     │  ##### │ ############## │ ############## │       │       │                                          │  Б   │
               │  Документов бумаж.  вида: #######                                                                      │        │                │                │       │       │                                          │      │
               ├────────────┬──────────────────────┬──────────────────────┬──────────────────────┬──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤](
                                   nameval2,                                                                             CodeVal2,  sumVOP_B,        sumRVOP_B,  
                                           kolVOP_B);
	end;
elif(VidHranS == "Электронно")
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │  Итого по валюте: ################################                                                     │  ##### │ ############## │ ############## │       │       │                                          │  Э   │
               │  Документов электр. вида: #######                                                                      │        │                │                │       │       │                                          │      │
               ├────────────┬──────────────────────┬──────────────────────┬──────────────────────┬──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤](
                                   nameval2,                                                                             CodeVal2,  sumVOP_E,        sumRVOP_E,  
                                           kolVOP_E);
end;
	        CodeVal2 = CodeVal1;
		nameval2 = nameval1;
                KolVOP   = 0; SumVOP   = $0; SumRVOP   = $0;
                kolVOP_B = 0; SumVOP_B = $0; SumRVOP_B = $0;
		kolVOP_E = 0; SumVOP_E = $0; SumRVOP_E = $0; 
                          
            elif((CodeVal1 == CodeVal2)and(oper1 == oper2))
                tabl.printseparator;
	    end;
	    if (oper1 != oper2)                       /*если опер изменился*/

if(VidHranS == "Электр+Бум")
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │  Итого по валюте: ################################                                                     │        │ ############## │ ############## │       │       │                                          │  Б   │
               │  Документов бумаж.  вида: #######                                                                      │  ##### ├────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │             электр. вида: #######                                                                      │        │ ############## │ ############## │       │       │                                          │  Э   │
               ├────────────────────────────────────────────────────────────────────────────────────────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
               │  Итого по отчету (Б+Э)   ##### ###############                                                         │   -    │       -        │ ############## │       │       │                                          │ Б+Э  │
               │  Документов:              #######                                                                      │        │                │                │       │       │                                          │      │
               └────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────┴────────────────┴────────────────┴───────┴───────┴──────────────────────────────────────────┴──────┘](
                                   nameval2,                                                                                        sumVOP_B,        sumRVOP_B,  
                                           kolVOP_B,                                                                     CodeVal2,
                                           kolVOP_E,                                                                                sumVOP_E,        sumRVOP_E,oper2,GetShortName(GetOperName(oper2)),SumROP,kolOP);
elif(VidHranS == "Бумажный")
        if(kolVOP_B != 0)        
//	      [│            │                      │                      │                      │                      │        │ ############## │ ############## │       │       │                                          │  Б   │](0,0);
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │  Итого по валюте: ################################                                                     │  ##### │ ############## │ ############## │       │       │                                          │  Б   │
               │  Документов бумаж.  вида: #######                                                                      │        │                │                │       │       │                                          │      │
               ├────────────────────────────────────────────────────────────────────────────────────────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
               │  Итого по отчету (Б)     ##### ###############                                                         │   -    │       -        │ ############## │       │       │                                          │  Б   │
               │  Документов бумаж.  вида: #######                                                                      │        │                │                │       │       │                                          │      │
               └────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────┴────────────────┴────────────────┴───────┴───────┴──────────────────────────────────────────┴──────┘](
                                   nameval2,                                                                             CodeVal2,  sumVOP_B,        sumRVOP_B,  
                                           kolVOP_B,oper2,GetShortName(GetOperName(oper2)),SumROP,kolOP);
	end;
elif(VidHranS == "Электронно")
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │  Итого по валюте: ################################                                                     │  ##### │ ############## │ ############## │       │       │                                          │  Э   │
               │  Документов электр. вида: #######                                                                      │        │                │                │       │       │                                          │      │
               ├────────────────────────────────────────────────────────────────────────────────────────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
               │  Итого по отчету (Э)     ##### ###############                                                         │   -    │       -        │ ############## │       │       │                                          │  Э   │
               │  Документов электр. вида: #######                                                                      │        │                │                │       │       │                                          │      │
               └────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────┴────────────────┴────────────────┴───────┴───────┴──────────────────────────────────────────┴──────┘](
                                   nameval2,                                                                             CodeVal2,  sumVOP_E,        sumRVOP_E,  
                                           kolVOP_E,oper2,GetShortName(GetOperName(oper2)),SumROP,kolOP);
end;
	        CodeVal2 = CodeVal1;
		nameval2 = nameval1;
                KolVOP     = 0; SumVOP      = $0; SumRVOP = $0;
                kolVOP_B   = 0; SumVOP_B    = $0; SumRVOP_B = $0;
                kolVOP_E   = 0; SumVOP_E    = $0; SumRVOP_E = $0; 
		kolVOP_B_O = 0; SumRVOP_B_O = $0;
		kolVOP_E_O = 0; SumRVOP_E_O = $0; 
                SumROP    = $0;
                           

           if (Flag_pechati_provodkiS == 1)
		[ ___________________________________#################################################################################
		] (GetOperName(oper2));
           end;
  if(podr2 != podr1)
           if(not((VidHranS == "Бумажный") and (kolVOP_B == 0)))
        [
	 Всего по подразделению ##.0 
                                                 документов:  бумажного вида    ##### на сумму(руб.экв) ##############
                                                              электронного вида ##### на сумму(руб.экв) ##############
                                                              всего документов  ##### на сумму(руб.экв) ##############
        ](podr2,kolP_B,sumRP_B,kolP_E,sumRP_E,kolP_B+kolP_E,sumRP_B+sumRP_E);
        kolP_B =0; kolP_E = 0; SumRP_E = $0; SumRP_B = $0;

           end;
        podr2 = podr1;
end;
           if (Flag_pechati_provodkiS == 1)
	    if (otdel1 != otdel2)      /*следующий отдел отдел*/
	        [                          ];
	        [###########################################################################################
                ]("отдел "+  data.value("t_code1") +"." + data.value("t_code2") + " " + otdel1);

                SumP = $0; kolP = 0;
		otdel2 = otdel1;
            end;
            end;

		SumOP = $0; kolOP = 0;
		tabl = ctablereport();
		tabl.addcolumn("№ Док.",        10,AL_CENTER); 
		tabl.addcolumn("Счет дебет",    20,AL_CENTER);
		tabl.addcolumn("Наименование",  20,AL_CENTER); 
		tabl.addcolumn("Счет кредит",   20,AL_CENTER); 
		tabl.addcolumn("Наименование",  20,AL_CENTER); 
		tabl.addcolumn("Валюта",         6,AL_CENTER); 
		tabl.addcolumn("Сумма|в валюте",14,AL_right); 
		tabl.addcolumn("Сумма|в рублях",14,AL_right);
		tabl.addcolumn("Шифр|/вид",      5,AL_CENTER); 
		tabl.addcolumn("Опер",           5,AL_CENTER); 
		tabl.addcolumn("Основание",     40,AL_LEFT); 
		tabl.addcolumn("Вид|хран",       4,AL_CENTER);

           if (Flag_pechati_provodkiS == 1)
		[           ];
		tabl.printhead(/*"отдел "+  data.value("t_code1") +"." + data.value("t_code2") + data.value("name_otdel") + " \n"+*/data.value("t_Oper") + " " + GetOperName(data.Value("t_oper")));
           end;
		oper2 = oper1;		
	    end;
              SumR = Data.value("sumRUR");
 if(Vid_HranS == "Б")
		kolVOP_B   = kolVOP_B   + 1; sumRVOP_B   = sumRVOP_B   + SumR;
					     sumVOP_B    = sumVOP_B    + data.value("sum");
		kolVOP_B_O = kolVOP_B_O + 1; sumRVOP_B_O = sumRVOP_B_O + SumR;
	        KolP_B     = KolP_B     + 1; SumRP_B     = SumRP_B     + SumR;
	        Kol_B      = Kol_B      + 1; Sum_B       = Sum_B       + SumR;
 else
		kolVOP_E   = kolVOP_E   + 1; sumRVOP_E   = sumRVOP_E   + SumR;
					     sumVOP_E    = sumVOP_E    + data.value("sum");
		kolVOP_E_O = kolVOP_E_O + 1; sumRVOP_E_O = sumRVOP_E_O + SumR;
	        KolP_E     = KolP_E     + 1; SumRP_E     = SumRP_E     + SumR;
	        Kol_E      = Kol_E      + 1; Sum_E       = Sum_E       + SumR;
 end;
           if (Flag_pechati_provodkiS == 1)

	tabl.printStringTransferByWord (data.value("NumDoc"),
					data.value("AccDeb"),
					data.value("name1"),
					data.value("AccKr"),
					data.value("name2"),
					data.value("t_ccy"),
					data.value("SUM"),
					SumR,
					data.value("sh"),
					data.value("t_Oper"),
					data.value("Ground"),
					vid_hranS);

		kolOP  = kolOP  + 1; sumOP  = sumOP  + data.value("sum");
		KolVOP = KolVOP + 1; sumVOP = sumVOP + data.value("sum"); SumROP = SumROP + SumR; 
		KolP   = KolP   + 1; SumP   = SumP   + Data.Value("sum");
		Kol    = Kol    + 1; Sum    = Sum    + Data.Value("sum");
	end;	
/* ==>> */elif((kontr == 3))
		tabl.printseparator();
 /*!*/          SumR = data.value("SumRUR");
                StoreKind = data.value("vid_hran");
               if(StoreKind != 0)
                StoreKind = 1;
               end;
                Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
           if (Flag_pechati_provodkiS == 1)
		tabl.printStringTransferByWord (data.value("NumDoc"),
						data.value("AccDeb"),
						data.value("AccKr"),
						data.value("t_ccy"),
						data.value("Sum"),
						SumR,
						data.value("Ground"),
						data.value("Sh"),   
					 string(data.value("t_Oper") + " " + GetOperName(data.value("t_Oper"))),
					 string(data.value("t_Code1") + "." + data.value("t_Code2")),
						vid_hranS);
                Kol = Kol + 1; kolp = kolp + 1;
           end;
        end;  /*11*/
        flag_pechati_GetOperName = 1;
     end; /*while*/

        Select = "";
/* ==>> */       if((kontr == 2) and (otchetbank))        /*контрольная ведомость по банку*/
        Select = select+
"       SELECT  b.t_oper, T_name, chislo, sum, sumRUR, t_ccy, T_FIID_PAYER, vid_hran                                                                      "+
"       FROM                                                                                                                                         "+
"       (select   c.t_oper, count(1) as chislo, sum(c.SUM) as sum,sum(c.SUMRUR) SUMRUR, c.t_ccy, c.T_FIID_PAYER, c.vid_hran                        "+
"        from (select a.t_oper, a.sum,a.SUMRUR, a.t_ccy, a.T_FIID_PAYER, (SELECT storeKind FROM TABLE(USER_EA.Get_dev_prop           "+  
"        (a.dockind, a.origin, a.paymkind, a.shifr_oper, a.numb_pack, a.chapter, a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))) vid_hran       "+
"       from                                                                                                                                         ";
/* ==>> */       elif((kontr == 1) and (otchetbank))         /*сводный реестр по банку*/
        Select = select+
"       select '1000 Неизвестное подразделение' as otdel,t_oper,NumDoc,AccDeb,name1,AccKr,name2,SUM,sumRUR,sh,Ground,AppKey,t_ccy,T_FIID_PAYER,nameval,  "+
"       (SELECT storeKind FROM TABLE(USER_EA.Get_dev_prop                                                                                            "+
"        (a.dockind, a.origin, a.paymkind, a.shifr_oper, a.numb_pack, a.chapter, a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))) vid_hran       "+
"       FROM                                                                                                                                         ";
/* ==>> */       elif((kontr == 3) and (otchetbank))         /*сводный реестр по банку*/
        Select = select+
"       select '1000' as otdel,t_oper,NumDoc,AccDeb,name1,AccKr,name2,SUM,sumRUR,sh,Ground,AppKey,t_ccy,T_FIID_PAYER,                                    "+
"       (SELECT storeKind FROM TABLE(USER_EA.Get_dev_prop                                                                                            "+
"        (a.dockind, a.origin, a.paymkind, a.shifr_oper, a.numb_pack, a.chapter, a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))) vid_hran       "+
"       FROM                                                                                                                                         ";
       end;
        Select = select+   /*основной запрос - начало*/
"       (select distinct arh.t_oper,                                       "+
"                arh.t_numb_document AS NumDoc, arh.t_account_payer AS AccDeb, acc1.t_nameaccount name1, arh.t_account_receiver AS AccKr,            "+
"                acc2.t_nameaccount name2, arh.t_sum_payer AS SUM,arh.t_sum_natcur sumRUR, arh.t_shifr_oper||'/'||t_kind_oper sh, arh.t_ground AS Ground,                          "+   
"                arh.t_acctrnid AppKey,dfininstr_dbt.t_ccy,arh.T_FIID_PAYER,arh.T_FIID_RECEIVER,dfininstr_dbt.t_name nameval,"+
"                prop.T_PAYMENTKIND paymkind, user_ea.GetOrigin ( paym.t_dockind, paym.t_paymentid) origin, arh.T_CHAPTER chapter, paym.T_DOCKIND dockind, arh.T_NUMBER_PACK numb_pack,     "+
"                arh.T_SHIFR_OPER shifr_oper, arh.t_typedocument                                                                                     "+
"           FROM dacctrn_dbt arh, dpmdocs_dbt docs, dpmpaym_dbt paym, daccount_dbt acc1, daccount_dbt acc2, dfininstr_dbt, dpmrmprop_dbt prop       "+
"	   WHERE arh.t_date_carry = to_date('" + DateDocum +"','DD.MM.YYYY')                                                                         "+ 
"            AND arh.t_oper not in (select dop_otdel_dbt.T_oper from dop_otdel_dbt                                                                   "+
"            where (dop_otdel_dbt.t_dateend >= TO_DATE ('" + DateDocum +"', 'DD.MM.YYYY')                                                            "+
"            or t_dateend  = TO_DATE ('01.01.0001', 'DD.MM.YYYY'))                                                                                   "+
"            and t_datebegin <= TO_DATE ('" + DateDocum +"', 'DD.MM.YYYY'))                                                                          "+
"            AND dfininstr_dbt.t_fiid = arh.T_FIID_PAYER                                                                                          "+
"	     AND acc1.t_account(+) = arh.t_account_payer	                                                                                             "+
"	     AND acc2.t_account(+) = arh.t_account_receiver                                                                                             "+
//"	     AND arh.t_chapter = acc1.t_chapter                                                                                                      "+ 
//"	     AND acc1.t_chapter = acc2.t_chapter                                                                                                     "+ 
"	     AND arh.t_chapter = "+ Chapter                                                                                                           ;
if(substr(RepTypes,1,9) != "Баланс ->")
Select = Select +
"            AND arh.t_result_carry <> 14                                                                                                            ";
end;
Select = Select +
//"            AND arh.t_result_carry <> 14                                                                                                            "+
"	     AND arh.T_acctrnid = docs.T_acctrnid(+)                                                                                     "+
"            AND docs.T_PAYMENTID = paym.T_PAYMENTID                                                                                                 "+
"            AND prop.T_PAYMENTID = paym.T_PAYMENTID                                                                                                 "+
"            AND substr(arh.T_ACCOUNT_PAYER,6,3) = substr(arh.T_ACCOUNT_RECEIVER,6,3)                                                                "+
"            AND substr(arh.T_ACCOUNT_PAYER,6,3) <> '810'                                                                                            "+
"            AND substr(arh.T_ACCOUNT_RECEIVER,6,3) <> '810'                                                                                         "+
"            AND paym.T_PAYERBANKID = paym.T_RECEIVERBANKID                                                                                          "+
"	     AND SUBSTR (arh.t_account_payer, 1, 5) NOT IN ('20202','20203','20207','00000')                                                         "+
"	     AND SUBSTR (arh.t_account_receiver, 1, 5) NOT IN ('20202','20203','20207','00000')                                                      "+
"            AND arh.t_account_payer <> 'ОВП'"+
"            AND arh.t_account_receiver <> 'ОВП'";
if(substr(RepTypes,1,9) == "Баланс ->")
        Select = select+
"             and (exists (select 1 from dpmprop_dbt  deb,dpmprop_dbt cred                                                                           "+
"            where cred.T_PAYMENTID = docs.T_PAYMENTID                                                                                               "+
"            and deb.T_PAYMENTID = docs.T_PAYMENTID                                                                                                  "+
"            and deb.T_PAYMENTID = cred.T_PAYMENTID                                                                                                  "+
"            and deb.t_debetcredit = 0 and cred.t_debetcredit = 1                                                                                    "+
"            and cred.t_group <>"+ PAYMENTS_GROUP_EXTERNAL + " and deb.t_group <>"+ PAYMENTS_GROUP_EXTERNAL+  ")  /*условие для внутренних*/         "+                      
"            or docs.t_paymentid is null)                                                                                                            "; 
end;
        Select = select+
             nbalanse1 + ")" + "\n" + nbalanse2 + ")" + "\n"    + ") a                                                                               ";

/* ==>> */       if((kontr == 2) and (otchetbank))
        Select = select+
"                )c"+
"          group by c.t_oper,c.t_ccy,c.T_FIID_PAYER, c.vid_hran) b, dperson_dbt                                                                   "+
"          WHERE b.T_OPER = dperson_dbt.T_oper                                                                                                       "+
"          order by b.t_oper,T_FIID_PAYER                                                                                                         ";
debugbreak;
debugbreak;
	Data = ExecSQLSelect(Select);
	while (Data.moveNext())
		oper1 = data.value("t_oper");
                StoreKind = data.value("vid_hran");
		otdel1 = 1000;
               if(StoreKind != 0)
                StoreKind = 1;
               end;
                Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
                SumR = data.value("sumRUR");
//              SumR = summa_pokritia(Data.value("AppKey"));
//		SumR = СуммаРуб(data.value("sum") , data.value("T_CODE_CURRENCY"), DateDocum );
           if (Flag_pechati_provodkiS == 1)
	if(oper1 == oper2)
      [│       │                      │       ├─────────────┼────────────────┼─────────┼────────────────┼──────┤
       │       │                      │       │ ########### │ ############## │   ###   │ ############## │  #   │](/*string(*/data.value(2):0:0/*:r:0:0)*/,data.value(3):0:2,data.value(4),SumR,Vid_HranS);
//	flag_separator = 1;
	else
	if((otdel2 != otdel1) and (otdel2 !=0))
//msgbox(kolp_E_O);
		[├───────┴──────────────────────┴───────┼─────────────┼────────────────┼─────────┼────────────────┼──────┤
		 │                                      │       ##### │       -        │    -    │ ############## │  Б   │
		 │ ИТОГО ПО ОТДЕЛУ ######               ├─────────────┼────────────────┼─────────┼────────────────┼──────┤
		 │   (в руб.экв)                        │       ##### │       -        │    -    │ ############## │  Э   │
	         ├───────┬──────────────────────┬───────┼─────────────┼────────────────┼─────────┼────────────────┼──────┤](int(kolp_B_O),sump_B_O,otdel2,int(kolp_E_O),sump_E_O);
	kolp_B_O = 0; sump_B_O = $0; kolp_E_O = 0; sump_E_O = $0;
//		flag_separator = 1;
	else
		tabl.printseparator();
	end;
//		tabl.printseparator();
                tabl.printStringTransferByWord (data.value(0),
						data.value(1),
						"1000",
					 string(data.value(2):0:0),
					 string(data.value(3):0:2),
						data.value(4),
					 string(SumR:a),
						Vid_HranS);
	end;
		oper2 = oper1;
		otdel2 = otdel1;
	        KolP = KolP + data.value(2); SumP = SumP + money(Data.Value("Sum"));
         end;
if(Vid_HranS == "Б")
	        KolP_B   = KolP_B   + data.value(2); SumP_B   = SumP_B   + SumR;
		kolp_B_O = kolp_B_O + data.value(2); sump_B_O = sump_B_O + SumR; 
else
	        KolP_E   = KolP_E   + data.value(2); SumP_E   = SumP_E   + SumR;
		kolp_E_O = kolp_E_O + data.value(2); sump_E_O = sump_E_O + SumR; 
end;
		SumR_P = SumR_P + SumR;

        end;
       end; 

/* ==>> */if((kontr == 1) and (otchetbank))
        Select = select+
"          order by a.t_oper, a.T_FIID_PAYER, AccDeb, SUM                                                                                         ";
	Data = ExecSQLSelect(Select);
debugbreak;
debugbreak;
	  while(data.movenext())
		oper1     = data.value("t_oper");
                CodeVal1  = data.value("t_ccy");
                nameVal1  = data.value("nameval");
		otdel1    = data.value("otdel");
                StoreKind = data.value("vid_hran");
                podr1     = 1000;
               if(StoreKind != 0)
                StoreKind = 1;
               end;
                Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
//           if (Flag_pechati_provodkiS == 1)
	    if ((CodeVal1 != CodeVal2)and(oper1 == oper2))
if(VidHranS == "Электр+Бум")
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │  Итого по валюте: ################################                                                     │        │ ############## │ ############## │       │       │                                          │  Б   │
               │  Документов бумаж.  вида: #######                                                                      │  ##### ├────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │             электр. вида: #######                                                                      │        │ ############## │ ############## │       │       │                                          │  Э   │
               ├────────────┬──────────────────────┬──────────────────────┬──────────────────────┬──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤](
                                   nameval2,                                                                                        sumVOP_B,        sumRVOP_B,  
                                           kolVOP_B,                                                                     CodeVal2,
                                           kolVOP_E,                                                                                sumVOP_E,        sumRVOP_E);
elif(VidHranS == "Бумажный")
        if(kolVOP_B != 0)        
//	      [│            │                      │                      │                      │                      │        │ ############## │ ############## │       │       │                                          │  Б   │](0,0);
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │  Итого по валюте: ################################                                                     │  ##### │ ############## │ ############## │       │       │                                          │  Б   │
               │  Документов бумаж.  вида: #######                                                                      │        │                │                │       │       │                                          │      │
               ├────────────┬──────────────────────┬──────────────────────┬──────────────────────┬──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤](
                                   nameval2,                                                                             CodeVal2,  sumVOP_B,        sumRVOP_B,  
                                           kolVOP_B);
	end;
elif(VidHranS == "Электронно")
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │  Итого по валюте: ################################                                                     │  ##### │ ############## │ ############## │       │       │                                          │  Э   │
               │  Документов электр. вида: #######                                                                      │        │                │                │       │       │                                          │      │
               ├────────────┬──────────────────────┬──────────────────────┬──────────────────────┬──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤](
                                   nameval2,                                                                             CodeVal2,  sumVOP_E,        sumRVOP_E,  
                                           kolVOP_E);
end;
	        CodeVal2 = CodeVal1;
                nameval2 = nameval1;
                KolVOP   = 0; SumVOP   = $0; SumRVOP   = $0;
                kolVOP_E = 0; SumVOP_E = $0; SumRVOP_E = $0;
                kolVOP_B = 0; SumVOP_B = $0; SumRVOP_B = $0;
        
            elif((CodeVal1 == CodeVal2)and(oper1 == oper2))
		tabl.printseparator();
	    end;
	    if (oper1 != oper2)                       /*если опер изменился*/
if(VidHranS == "Электр+Бум")
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │  Итого по валюте: ################################                                                     │        │ ############## │ ############## │       │       │                                          │  Б   │
               │  Документов бумаж.  вида: #######                                                                      │  ##### ├────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │             электр. вида: #######                                                                      │        │ ############## │ ############## │       │       │                                          │  Э   │
               ├────────────────────────────────────────────────────────────────────────────────────────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
               │  Итого по отчету (Б+Э)   ##### ###############                                                         │   -    │       -        │ ############## │       │       │                                          │ Б+Э  │
               │  Документов:              #######                                                                      │        │                │                │       │       │                                          │      │
               └────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────┴────────────────┴────────────────┴───────┴───────┴──────────────────────────────────────────┴──────┘](
                                   nameval2,                                                                                        sumVOP_B,        sumRVOP_B,  
                                           kolVOP_B,                                                                     CodeVal2,
                                           kolVOP_E,                                                                                sumVOP_E,        sumRVOP_E,oper2,GetShortName(GetOperName(oper2)),SumROP,kolOP);
elif(VidHranS == "Бумажный")
        if(kolVOP_B != 0)        
//	      [│            │                      │                      │                      │                      │        │ ############## │ ############## │       │       │                                          │  Б   │](0,0);
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │  Итого по валюте: ################################                                                     │  ##### │ ############## │ ############## │       │       │                                          │  Б   │
               │  Документов бумаж.  вида: #######                                                                      │        │                │                │       │       │                                          │      │
               ├────────────────────────────────────────────────────────────────────────────────────────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
               │  Итого по отчету (Б)     ##### ###############                                                         │   -    │       -        │ ############## │       │       │                                          │  Б   │
               │  Документов бумаж.  вида: #######                                                                      │        │                │                │       │       │                                          │      │
               └────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────┴────────────────┴────────────────┴───────┴───────┴──────────────────────────────────────────┴──────┘](
                                   nameval2,                                                                             CodeVal2,  sumVOP_B,        sumRVOP_B,  
                                           kolVOP_B,oper2,GetShortName(GetOperName(oper2)),SumROP,kolOP);
	end;
elif(VidHranS == "Электронно")
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │  Итого по валюте: ################################                                                     │  ##### │ ############## │ ############## │       │       │                                          │  Э   │
               │  Документов электр. вида: #######                                                                      │        │                │                │       │       │                                          │      │
               ├────────────────────────────────────────────────────────────────────────────────────────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
               │  Итого по отчету (Э)     ##### ###############                                                         │   -    │       -        │ ############## │       │       │                                          │  Э   │
               │  Документов электр. вида: #######                                                                      │        │                │                │       │       │                                          │      │
               └────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────┴────────────────┴────────────────┴───────┴───────┴──────────────────────────────────────────┴──────┘](
                                   nameval2,                                                                             CodeVal2,  sumVOP_E,        sumRVOP_E,  
                                           kolVOP_E,oper2,GetShortName(GetOperName(oper2)),SumROP,kolOP);
end;
	        CodeVal2 = CodeVal1;
		nameval2 = nameval1;
                KolVOP     = 0; SumVOP      = $0; SumRVOP   = $0;
                kolVOP_E   = 0; SumVOP_E    = $0; SumRVOP_E = $0;
                kolVOP_B   = 0; SumVOP_B    = $0; SumRVOP_B = $0;
		kolVOP_E_O = 0; SumRVOP_E_O = $0;
		kolVOP_B_O = 0; SumRVOP_B_O = $0;
                SumROP    = $0;
                
           if (Flag_pechati_provodkiS == 1)
		[  ___________________________________#################################################################################

 		] (GetOperName(oper2));
           end;	

  if(podr2 != podr1)
           if(not((VidHranS == "Бумажный") and (kolVOP_B == 0)))
        [
	 Всего по подразделению ##.0 
                                                 документов:  бумажного вида    ##### на сумму(руб.экв) ##############
                                                              электронного вида ##### на сумму(руб.экв) ##############
                                                              всего документов  ##### на сумму(руб.экв) ##############
        ](podr2,kolP_B,sumRP_B,kolP_E,sumRP_E,kolP_B+kolP_E,sumRP_B+sumRP_E);

        kolP_B =0; kolP_E = 0; SumRP_E = $0; SumRP_B = $0;

           end;
        podr2 = podr1;
  end;

           if (Flag_pechati_provodkiS == 1)
	    if (otdel1 != otdel2)      /*следующий отдел отдел*/
	        [###########################################################################################
                ](data.value("otdel"));

                SumP = $0; kolP = 0;
		otdel2 = otdel1;
            end;
            end;
		SumOP = $0; kolOP = 0;
		tabl = ctablereport();
		tabl.addcolumn("№ Док.",10,AL_CENTER); tabl.addcolumn("Счет дебет",20,AL_CENTER);tabl.addcolumn("Наименование",20,AL_CENTER); 
		tabl.addcolumn("Счет кредит",20,AL_CENTER); tabl.addcolumn("Наименование",20,AL_CENTER); tabl.addcolumn("Валюта",6,AL_CENTER); tabl.addcolumn("Сумма|в валюте",14,AL_right); tabl.addcolumn("Сумма|в рублях",14,AL_right);
		tabl.addcolumn("Шифр|/вид",5,AL_CENTER); tabl.addcolumn("Опер",5,AL_CENTER); tabl.addcolumn("Основание",40,AL_LEFT); tabl.addcolumn("Вид|хран",4,AL_CENTER);
           if (Flag_pechati_provodkiS == 1)
		[                             ];
		tabl.printhead(/*"отдел "+ data.value("otdel") + " \n"+*/data.value("t_Oper") + " " + GetOperName(data.Value("t_oper")));
	end;	
		oper2 = oper1;				
	      end;
               SumR = data.value("sumRUR");
//		tabl.printseparator();
//              SumR = summa_pokritia(Data.value("AppKey"));
// /*!*/       SumR = СуммаРуб( data.value("Sum"), data.value("T_CODE_CURRENCY"), DateDocum );
 if(Vid_HranS == "Б")
		kolVOP_B = kolVOP_B + 1; sumRVOP_B = sumRVOP_B + SumR;sumVOP_B = sumVOP_B + money(data.value("sum"));
		kolVOP_B_O = kolVOP_B_O + 1; sumRVOP_B_O = sumRVOP_B_O + SumR;
	        KolP_B = KolP_B + 1; SumRP_B = SumRP_B + SumR;
	        Kol_B = Kol_B + 1; Sum_B = Sum_B + SumR;
 else
		kolVOP_E = kolVOP_E + 1; sumRVOP_E = sumRVOP_E + SumR;sumVOP_E = sumVOP_E + money(data.value("sum"));
		kolVOP_E_O = kolVOP_E_O + 1; sumRVOP_E_O = sumRVOP_E_O + SumR;
	        KolP_E = KolP_E + 1; SumRP_E = SumRP_E + SumR;
	        Kol_E = Kol_E + 1; Sum_E = Sum_E + SumR;
 end;

           if (Flag_pechati_provodkiS == 1)

	tabl.printStringTransferByWord(data.value("NumDoc"),data.value("AccDeb"),data.value("name1"),data.value("AccKr"),data.value("name2"),data.value("t_ccy"),data.value("SUM"),SumR,
	data.value("sh"),data.value("t_Oper"),data.value("Ground"),vid_hranS);
		kolOP = kolOP + 1; sumOP = sumOP + money(data.value("sum"));
		KolVOP = KolVOP +1; sumVOP = sumVOP + money(data.value("sum")); SumROP = SumROP + SumR; 
		KolP = KolP + 1;SumP = SumP + money(Data.Value("sum"));
		Kol = Kol + 1;Sum = Sum + money(Data.Value("sum"));
	end;
	end;/*while*/	
/* ==>> */end;  

/* ==>> */if((kontr == 3) and (otchetbank))
        Select = select+
"          order by a.t_oper, a.T_FIID_PAYER, AccDeb, SUM                                                                                      ";
	Data = ExecSQLSelect(Select);
	   while(data.movenext())
	  	tabl.printseparator();
                SumR = data.value("sumRUR");
//              SumR = summa_pokritia(Data.value("AppKey"));
//              SumR = СуммаРуб( data.value("Sum"), data.value("T_CODE_CURRENCY"), DateDocum );
                StoreKind = data.value("vid_hran");
               if(StoreKind != 0)
                StoreKind = 1;
               end;
                Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
           if (Flag_pechati_provodkiS == 1)
		tabl.printStringTransferByWord(data.value("NumDoc"),data.value("AccDeb"),data.value("AccKr"),data.value("t_ccy"),data.value("Sum"),SumR,data.value("Ground"),data.value("Sh"),    /*data.value(9)*/
		string(data.value("t_Oper") + " " + GetOperName(data.value("t_Oper"))),string(data.value("t_Code1") + "." + data.value("t_Code2")),vid_hranS);
                Kol = Kol + 1; kolp = kolp + 1;
           end;
           end;/*while*/
/* ==>> */end;

        if ((flag_pechati_GetOperName==1) and (kontr == 3))
		tabl.printbottom();
	end;
                tabl = ctablereport();

	if((flag_pechati_GetOperName==1) and (kontr == 1))

if(VidHranS == "Электр+Бум")
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │  Итого по валюте: ################################                                                     │        │ ############## │ ############## │       │       │                                          │  Б   │
               │  Документов бумаж.  вида: #######                                                                      │  ##### ├────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │             электр. вида: #######                                                                      │        │ ############## │ ############## │       │       │                                          │  Э   │
               ├────────────────────────────────────────────────────────────────────────────────────────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
               │  Итого по отчету (Б+Э)   ##### ###############                                                         │   -    │       -        │ ############## │       │       │                                          │ Б+Э  │
               │  Документов:              #######                                                                      │        │                │                │       │       │                                          │      │
               └────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────┴────────────────┴────────────────┴───────┴───────┴──────────────────────────────────────────┴──────┘](
                                   nameval2,                                                                                        sumVOP_B,        sumRVOP_B,  
                                           kolVOP_B,                                                                     CodeVal2,
                                           kolVOP_E,                                                                                sumVOP_E,        sumRVOP_E,oper2,GetShortName(GetOperName(oper2)),SumROP,kolOP);
elif(VidHranS == "Бумажный")
        if(kolVOP_B != 0)        
//	      [│            │                      │                      │                      │                      │        │ ############## │ ############## │       │       │                                          │  Б   │](0,0);
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │  Итого по валюте: ################################                                                     │  ##### │ ############## │ ############## │       │       │                                          │  Б   │
               │  Документов бумаж.  вида: #######                                                                      │        │                │                │       │       │                                          │      │
               ├────────────────────────────────────────────────────────────────────────────────────────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
               │  Итого по отчету (Б)     ##### ###############                                                         │   -    │       -        │ ############## │       │       │                                          │  Б   │
               │  Документов бумаж.  вида: #######                                                                      │        │                │                │       │       │                                          │      │
               └────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────┴────────────────┴────────────────┴───────┴───────┴──────────────────────────────────────────┴──────┘](
                                   nameval2,                                                                             CodeVal2,  sumVOP_B,        sumRVOP_B,  
                                           kolVOP_B,oper2,GetShortName(GetOperName(oper2)),SumROP,kolOP);
	end;
elif(VidHranS == "Электронно")
              [├────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
	       │  Итого по валюте: ################################                                                     │  ##### │ ############## │ ############## │       │       │                                          │  Э   │
               │  Документов электр. вида: #######                                                                      │        │                │                │       │       │                                          │      │
               ├────────────────────────────────────────────────────────────────────────────────────────────────────────┼────────┼────────────────┼────────────────┼───────┼───────┼──────────────────────────────────────────┼──────┤
               │  Итого по отчету (Э)     ##### ###############                                                         │   -    │       -        │ ############## │       │       │                                          │  Э   │
               │  Документов электр. вида: #######                                                                      │        │                │                │       │       │                                          │      │
               └────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────┴────────────────┴────────────────┴───────┴───────┴──────────────────────────────────────────┴──────┘](
                                   nameval2,                                                                             CodeVal2,  sumVOP_E,        sumRVOP_E,  
                                           kolVOP_E,oper2,GetShortName(GetOperName(oper2)),SumROP,kolOP);
end;


/*
	      [  Всего документов по валюте ###:##### на сумму:##############
                 Всего документов в рублях     :##### на сумму:##############
              ](string(CodeVal2),int(KolVOP),money(SumVOP),int(KolVOP),money(SumRVOP));	
	        CodeVal2 = CodeVal1;
                KolVOP = 0;
                SumVOP = $0;

		[  Всего документов  #################### на сумму в рублях: ###################### 
		   ___________________________________#################################################################################

		] (kolOP,SumROP,GetOperName(oper2));*/
	end;
if(kontr == 2)
   if((VidHranS != "Бумажный") or (kolp_B_O != 0))
      [├───────┴──────────────────────┴───────┼─────────────┼────────────────┼─────────┼────────────────┼──────┤
       │                                      │       ##### │       -        │    -    │ ############## │  Б   │
       │ ИТОГО ПО ОТДЕЛУ ######               ├─────────────┼────────────────┼─────────┼────────────────┼──────┤
       │   (в руб.экв)                        │       ##### │       -        │    -    │ ############## │  Э   │](int(kolp_B_O),sump_B_O,otdel2,int(kolp_E_O),sump_E_O);
//       ├───────┬──────────────────────┬───────┼─────────────┼────────────────┼─────────┼────────────────┼──────┤
//	kolp_B_O = 0; sump_B_O = $0; kolp_E_O = 0; sump_E_O = $0;
   end;
NumOtdel1 = "";
if(NumOtdel != "")NumOtdel1 = NumOtdel + "." + NumPodOtdel end; 
      [├───────┴──────────────────────┴───────┼─────────────┼────────────────┼─────────┼────────────────┼──────┤];
      [│                                      │############ │       -        │    -    │############### │  Б   │](int(kolp_B),sump_B);
      [│ ИТОГО ПО ПОДРАЗДЕЛЕНИЮ #####         ├─────────────┼────────────────┼─────────┼────────────────┼──────┤](NumOtdel1);
      [│   (по видам хранения)                │############ │       -        │    -    │############### │  Э   │](int(kolp_E),sump_E);
      [└──────────────────────────────────────┴─────────────┴────────────────┴─────────┴────────────────┴──────┘];
end;
if((kontr != 3) or ((kontr == 3) and (not(otchetbank))))	
if(kontr == 2)
      [
           Всего документов по отчету #################  на сумму(руб): ###################
      ](int(kolp),SumR_P);
else
if(not(kontr ==1))
      [
           Всего документов по подразделению #################  на сумму в рублях: ###################  
      ](int(kolp),SumRP);
end;
end;

if(OperSelect == 0)
        if(kolOP!=0)
	[  ___________________________________#################################################################################

	] (GetOperName(oper2));
	end;
if((not(otchetbank)) and (kontr !=2))
	[Всего по подразделению ###################################################################################### 
                                        документов:  бумажного вида    ##### на сумму(руб.экв) ##############
                                                     электронного вида ##### на сумму(руб.экв) ##############
                                                     всего документов  ##### на сумму(руб.экв) ##############
        ](NameDepart,kolP_B,sumRP_B,kolP_E,sumRP_E,kolP_B+kolP_E,sumRP_B+sumRP_E);

/*	        [###########################################################################################

                ]("отдел "+  data.value("t_code1") +"." + data.value("t_code2") + " " +otdel2);*/
elif(kontr != 2)
           if(not((VidHranS == "Бумажный") and (kolVOP_B == 0)))
	[Всего по подразделению ####.0 
                                        документов:  бумажного вида    ##### на сумму(руб.экв) ##############
                                                     электронного вида ##### на сумму(руб.экв) ##############
                                                     всего документов  ##### на сумму(руб.экв) ##############

        ](string(podr2),kolP_B,sumRP_B,kolP_E,sumRP_E,kolP_B+kolP_E,sumRP_B+sumRP_E);
end;
	[  Всего по Банку               документов:  бумажного вида    ##### на сумму(руб.экв) ##############
                                                     электронного вида ##### на сумму(руб.экв) ##############
                                                     всего документов  ##### на сумму(руб.экв) ##############
        ](kol_B,sum_B,kol_E,sum_E,kol_B+kol_E,sum_B+sum_E);
end
else
        [Всего по операционисту ______________ ##################### документов:
                                                                     бумажного вида    ##### на сумму(руб.экв) ##############
                                                                     электронного вида ##### на сумму(руб.экв) ##############
                                                                     всего документов  ##### на сумму(руб.экв) ##############
	](getShortName(GetOperName(oper2)),kolVOP_B_O,sumRVOP_B_O,kolVOP_E_O,sumRVOP_E_O,kolVOP_B_O+kolVOP_E_O,sumRVOP_B_O+sumRVOP_E_O);
end;

  [________________________________________________________________________________

   Руководитель подразделения    ############################### __________________ 

   Контролёр                     ############################### __________________ 
                                                                         
   Отчет подготовил              ############################### __________________ 
  ]      (HeaderName, ControlName, getShortName(GetOperName({oper})));
end;
	if((kontr == 3) and (otchetbank))

  [
     ____________________________________________________________________________

     Всего документов по Банку ############                                          ]
  (int(Kol));
  [  ____________________________________________________________________________

      Главный бухгалтер_________________________________

      Контролер____________________________

      Отчет подготовил  #############################################################]
      (getShortName(GetOperName({oper})));
       end;                        
end;
/*------------------------------------------------------------------------------------------------------------*/
macro Report_vnutr_doc_konv(Mode:string,Chapter:integer, Oper_new:integer, kontr:integer, otchetbank:bool, nbalanse1:string, nbalanse2:string)  
	var tabl=ctablereport(), type_report:string="";                                                                   /*kontr: 1 - контрольная ведомость, 2 - сводный реестр, 3 - Реестр операций*/
	var Select, select_oper, Data, vid_hran, selectRUR, dataRUR, StoreKind, Data_val, Select_val,otdel;
	var Kol, Sum, KolP, SumP, Op, kolOP, sumOP, SumRRF_op, SumRRF_p, SumRRF, pechat_hran;   /*счетчики*/
	VAR Kol_B, Sum_B, KolP_B, SumP_B, Op_B, kolOP_B, sumOP_B, SumRRF_op_B, SumRRF_p_B, SumRRF_B;
	VAR Kol_E, Sum_E, KolP_E, SumP_E, Op_E, kolOP_E, sumOP_E, SumRRF_op_E, SumRRF_p_E, SumRRF_E;
        var oper1, oper2, OperSelect, flag_pechati_GetOperName, paymentID1, paymentID2, perv, Vid_HranS, Flag_pechati_provodkiS, firstRowToPrint;//:string="";   /*флаги для IFов*/
	var номер_документа, счет_дебет, счет_кредит, сумма_дебет, валюта_дебет, сумма_кредит, платеж, сумма, валюта_кредит,        // переменные для временного хранения
	    сумма_в_рублях, сумма_в_рублях2, шифр_документа, операционист, основание, отдел, вид_хранения;           // данных по предыдущей проводке при сворачивании ОВП
	var kolp_B_O, sumpR_B_O, kolp_E_O,sumpR_E_O,sumpV_B_O,sumpV_E_O,NumOtdel1;
	OperSelect = Oper_new;
      pechat_hran = "";
  if   (kontr == 2)                                                                                            /* ------------------------------------------------------------------------ */
      type_report = "КОНТРОЛЬНАЯ ВЕДОМОСТЬ ПОДРАЗДЕЛЕНИЯ";
  elif (kontr == 1)
      type_report = "СВОДНЫЙ РЕЕСТР ВНУТРЕННИХ ОПЕРАЦИЙ";
  elif (kontr == 3)
      type_report = "РЕЕСТР ОПЕРАЦИЙ        ";
  end;
     if(VidHranS   == "Бумажный")
      pechat_hran  =  "на документы бумажного вида хранения";
     elif(VidHranS == "Электронно")
      pechat_hran  =  "на документы электронного вида хранения";
     elif(VidHranS == "Электр+Бум")
      pechat_hran  =  "на документы бумажного+электронного вида хранения";
     end;

    if((otchetbank) and(kontr !=2))

	[ ##########################

        	                              ######################################  по Банку
                                                               Конверсионные

                                             ##################################################]({Name_Bank},type_report:r,pechat_hran);
    if (pachkaS != "") 
        [
                              по номерам пачек:  #](pachkaS);
    end;
        [
            	                                              за  ##########

          Отчет: ###################################################################

	](DateDocum,Mode);
    else	
	[ ##########################

        	                                  ######################################
                                                               Конверсионные

                                            ##################################################

                                 по подразделению: ##################################################################]({Name_Bank},type_report:r,pechat_hran, NameDepart);
  if(OperSelect!=0)
        [                    по операционисту: ##### - ##############################################](operselect,GetOperName(operselect))                
  end;

    if (pachkaS != "") 
        [
                              по номерам пачек:  #](pachkaS);
    end;
        [      	                                              за  ##########

          Отчет: ###################################################################

	](DateDocum,Mode);
    end;

	kol = 0; KolP = 0; kolOP = 0;                        /*кол-во док.                   *//*счетчики в порядке: Банк; Подразделение; Операционист*/
	Sum = $0; SumP = $0; SumOP = $0;                     /*суммы в вал. эквив.           */
	SumRRF = $0; SumRRF_p = $0; SumRRF_op = $0;          /*суммы в рублях (фин.результат)*/
	kol_B = 0; KolP_B = 0; kolOP_B = 0;                  /*кол-во док.                   *//*счетчики в порядке: Банк; Подразделение; Операционист*/
	Sum_B = $0; SumP_B = $0; SumOP_B = $0;               /*суммы в вал. эквив.           */
	SumRRF_B = $0; SumRRF_p_B = $0; SumRRF_op_B = $0;    /*суммы в рублях (фин.результат)*/
	kol_E = 0; KolP_E = 0; kolOP_E = 0;                  /*кол-во док.                   *//*счетчики в порядке: Банк; Подразделение; Операционист*/
	Sum_E = $0; SumP_E = $0; SumOP_E = $0;               /*суммы в вал. эквив.           */
	SumRRF_E = $0; SumRRF_p_E = $0; SumRRF_op_E = $0;    /*суммы в рублях (фин.результат)*/
	kolp_B_O = 0; sumpR_B_O = $0;sumpV_B_O = $0; kolp_E_O = 0; sumpR_E_O = $0; sumpV_E_O = $0;
	oper2 = 0;//I-00219670-2
        firstRowToPrint = 1;
       номер_документа = "";            //  -|
            Счет_дебет = "";            //   |
           Счет_кредит = "";            //   |
           Сумма_дебет = $0;            //   |
          Валюта_дебет = "";            //   |
          Сумма_кредит = $0;            //   | /*обнуляем переменные для реестров операций*/
         Валюта_кредит = "";            //   | 
        Сумма_в_рублях = $0;            //   |
        Шифр_документа = "";            //   |
          Операционист = 0 ;            //   |
                 отдел = "";            //   |
             Основание = "";            //  -|
	Select = " ";
/* ==>> */       if(kontr == 2) //and (not(otchetbank)))     /*контрольная ведомость по отделу   */
        Select = select+                                    /*                                  */                                                                                       
"       select t_code1,t_code2,name_otdel,t_oper,numdoc,accdeb,name1,acckr,name2,SUM,T_SUM_PAYER,T_SUM_RECEIVER,sh,ground,t_paymentid,T_FIID_PAYER,(SELECT storeKind FROM TABLE(USER_EA.Get_dev_prop     "+  
"        (a.dockind, a.origin, a.paymkind, a.shifr_oper, a.numb_pack, a.chapter, a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))) vid_hran, T_RESULT_CARRY       "+
"       from                                                                                                                                         ";
/* ==>> */       elif((kontr == 1) and (not(otchetbank)))   /*сводный реестр по отделу          */
        Select = select+                                    /*                                  */
"       select t_code1,t_code2,name_otdel,t_oper,numdoc,accdeb,name1,acckr,name2,SUM,T_SUM_PAYER,T_SUM_RECEIVER,sh,ground,t_paymentid,find,finc,T_SUM_PAYER,T_SUM_RECEIVER,(SELECT storeKind FROM TABLE(USER_EA.Get_dev_prop     "+  
"        (a.dockind, a.origin, a.paymkind, a.shifr_oper, a.numb_pack, a.chapter, a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))) vid_hran, T_RESULT_CARRY       "+
"       from                                                                                                                                         ";
/* ==>> */       elif((kontr == 1) and (otchetbank))        /*сводный реестр по банку           */
        Select = select+                                    /*                                  */
"       select t_code1,t_code2,name_otdel,t_oper,numdoc,accdeb,name1,acckr,name2,SUM,T_SUM_PAYER,T_SUM_RECEIVER,sh,ground,t_paymentid,find,finc,T_FIID_PAYER,(SELECT storeKind FROM TABLE(USER_EA.Get_dev_prop     "+  
"        (a.dockind, a.origin, a.paymkind, a.shifr_oper, a.numb_pack, a.chapter, a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))) vid_hran,T_RESULT_CARRY       "+
"       from                                                                                                                                         ";
/* ==>> */       elif(kontr == 3)                           /*реестр операций                   */
        Select = select+
"       select t_code1,t_code2,name_otdel,t_oper,numdoc,accdeb,name1,acckr,name2,SUM,T_SUM_PAYER,T_SUM_RECEIVER,sh,ground,t_paymentid,find,finc,T_FIID_PAYER,(SELECT storeKind FROM TABLE(USER_EA.Get_dev_prop     "+  
"        (a.dockind, a.origin, a.paymkind, a.shifr_oper, a.numb_pack, a.chapter, a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))) vid_hran, T_RESULT_CARRY       "+
"       from                                                                                                                                         ";
       end;
        Select = select+   /*основной запрос - начало*/
"        (select distinct DOTDELS_DBT.T_CODE1,DOTDELS_DBT.T_CODE2,DOTDELS_DBT.T_NAME as NAME_OTDEL, arh.t_oper,                                      "+
"                arh.t_numb_document AS NumDoc, arh.t_account_payer AS AccDeb, acc1.t_nameaccount name1, arh.t_account_receiver AS AccKr,            "+
"                acc2.t_nameaccount name2, arh.T_SUM_NATCUR AS SUM, arh.t_shifr_oper||'/'||t_kind_oper sh, arh.t_ground AS Ground,                          "+   
"                arh.T_SUM_PAYER,arh.T_SUM_RECEIVER,findeb.t_ccy find,finCr.t_ccy finc,                                                               "+
"                arh.T_ACCTRNID AppKey, paym.t_paymentid, arh.T_FIID_PAYER, arh.T_FIID_RECEIVER,                                  "+
"                prop.T_PAYMENTKIND paymkind, user_ea.GetOrigin ( paym.t_dockind, paym.t_paymentid) origin, arh.T_CHAPTER chapter, paym.T_DOCKIND dockind, arh.T_NUMBER_PACK numb_pack,     "+
"                prop.T_SHIFROPER shifr_oper, paym.T_FIID cred_fiid, paym.T_PAYFIID deb_fiid, arh.T_RESULT_CARRY,arh.t_typedocument             "+
"           FROM dacctrn_dbt arh,dpmdocs_dbt docs,dpmpaym_dbt paym,daccount_dbt acc1,daccount_dbt acc2,DOTDELS_DBT,dfininstr_dbt findeb,dfininstr_dbt finCr, dpmrmprop_dbt prop,"+
"                (select * from DOP_OTDEL_DBT where (T_oper,t_datebegin) in (select T_oper,max(t_datebegin) t_datebegin                              "+                    
"                   from DOP_OTDEL_DBT where t_datebegin<=TO_DATE ('"+ DateDocum + "', 'DD.MM.YYYY')                                                 "+
"                        and (t_dateend >= TO_DATE ('"+ DateDocum + "', 'DD.MM.YYYY') OR t_dateend  = TO_DATE ('01.01.0001', 'DD.MM.YYYY'))                "+                                                                 
"                        group by T_oper)) DOP_OTDEL_DBT                                                                                             "+
"	   WHERE arh.t_date_carry = to_date('" + DateDocum +"','DD.MM.YYYY')                                                                         "+ 
"            and (DOP_OTDEL_DBT.t_dateend >=to_date('"+ DateDocum + "','DD.MM.YYYY') or t_dateend = to_date('01.01.0001','DD.MM.YYYY'))              "+
"            and t_datebegin <=to_date('"+ DateDocum + "','DD.MM.YYYY')                                                                              "+
"            AND findeb.t_fiid = arh.T_FIID_PAYER                                                                                                    "+
"            AND finCr.t_fiid = arh.T_FIID_RECEIVER                                                                                                  "+
"	     AND acc1.t_account(+) = arh.t_account_payer	                                                                                     "+
"	     AND acc2.t_account(+) = arh.t_account_receiver                                                                                          ";
if (pachkaS != "")                                                                   //C-17070-6
select = select+ 
"            AND arh.T_NUMBER_PACK in (" + pachkaS + ")";
end;
select = select+ 
"	     AND arh.t_chapter = "+ Chapter                                                                                                           ;
if(substr(RepTypes,1,9) != "Баланс ->")
Select = Select +
"            AND arh.t_result_carry <> 14                                                                                                            ";
end;
Select = Select +
"	     AND arh.T_ACCTRNID = docs.T_ACCTRNID(+)                                                                                                 "+
"            AND docs.T_PAYMENTID = paym.T_PAYMENTID(+)                                                                                              "+
"            AND prop.T_PAYMENTID(+) = paym.T_PAYMENTID                                                                                              "+
"	     AND (SUBSTR (arh.t_account_payer, 1, 5)    NOT IN ('20202','20203','20207') or arh.T_RESULT_CARRY in (18,82,83))                        "+
"	     AND (SUBSTR (arh.t_account_receiver, 1, 5) NOT IN ('20202','20203','20207') or arh.T_RESULT_CARRY in (18,82,83))                        "+
"            and arh.t_account_payer <> 'ОВП'                                                                                                        "+
"            and arh.t_account_receiver <> 'ОВП'                                                                                                     "+
"            AND substr(arh.T_ACCOUNT_PAYER,6,3) <> substr(arh.T_ACCOUNT_RECEIVER,6,3)                                                               "+
"            and arh.T_OPER = DOP_OTDEL_DBT.T_oper(+)                                                                                                "+
"            and DOP_OTDEL_DBT.T_CODE1 = DOTDELS_DBT.T_CODE1                                                                                         "+
"            and DOP_OTDEL_DBT.T_CODE2 = DOTDELS_DBT.T_CODE2                                                                                         ";
if(substr(RepTypes,1,9) == "Баланс ->")
       Select = select +               
"            and (exists (select 1 from dpmprop_dbt  deb,dpmprop_dbt cred                                                                            "+
"            where cred.T_PAYMENTID = docs.T_PAYMENTID                                                                                               "+
"            and deb.T_PAYMENTID = docs.T_PAYMENTID                                                                                                  "+
"            and deb.T_PAYMENTID = cred.T_PAYMENTID                                                                                                  "+
"            and deb.t_debetcredit = 0 and cred.t_debetcredit = 1                                                                                    "+
"            and cred.t_group <>"+ PAYMENTS_GROUP_EXTERNAL + " and deb.t_group <>"+ PAYMENTS_GROUP_EXTERNAL+  ")  /*условие для внутренних*/         "+                      
"            or docs.t_paymentid is null)                                                                                                            "; 
end;
       Select = select +
             nbalanse1 + ")" + "\n" + nbalanse2 + ")" + "\n                                                                                          ";
	if ((OperSelect!=0) and (kontr !=2))                       /*если выбран опер, то запрос по одному оперу*/
       Select = select +
"	     AND arh.T_OPER =" + OperSelect;       
           procedura_message_oper_otdel(OperSelect, NumOtdel, NumPodOtdel);
	end;

/*после объединения таблиц*/
       Select = select + ") a";
                          /*основной запрос - конец*/
/* ==>> */if(kontr == 2)  
 if(not(otchetbank))
        Select = select+
"          where a.T_CODE1 = "+ NumOtdel;
    if(NumPodOtdel !=0)
        Select = select+
"            and a.T_CODE2 = "+ NumPodOtdel;
    end;
 end;
        Select = select+
"          order by a.t_code1,a.t_code2,a.t_Oper, t_paymentid, a.numdoc, AccDeb, SUM                                                                 ";

debugbreak;
	Data = ExecSQLSelect(Select);
	tabl.addcolumn("Код |опер.",5,AL_CENTER);     tabl.addcolumn("Операционист",20,AL_LEFT); tabl.addcolumn("отдел",5,AL_RIGHT);     tabl.addcolumn("Количество |документов",11,AL_RIGHT);
	tabl.addcolumn("Сумма в|Руб.РФ",20,AL_RIGHT); tabl.addcolumn("Сумма в|руб.экв",20,AL_RIGHT); tabl.addcolumn("ИТОГО",20,AL_RIGHT);
        tabl.addcolumn("Вид|хран",4,AL_CENTER);
	tabl.printhead();
/*--------------------------------------------------------------------------------------------*/
  if(Data.movenext())
     paymentID1 = data.value("t_paymentid");
                StoreKind = data.value("vid_hran");
               if(StoreKind != 0)
                StoreKind = 1;
               end;
                Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
           if (Flag_pechati_provodkiS == 1)
  if((substr(data.value("AccKr"),14,5) == "21010") or (substr(data.value("AccKr"),14,5) == "22010") or (substr(data.value("AccDeb"),14,5) == "21010") or (substr(data.value("AccDeb"),14,5) == "22010") or (data.value("T_RESULT_CARRY") == 18))
//      if(Vid_HranS == "Б")
      if(StoreKind == 0)
     kolOP_B = kolOP_B + 1;KolP_B = KolP_B + 1;Kol_B = Kol_B + 1; SumRRF_op_B = SumRRF_op_B + data.value("Sum"); SumRRF_p_B = SumRRF_p_B + data.value("Sum"); SumRRF_B = SumRRF_B + data.value("Sum");
     KolP_B_O = KolP_B_O + 1; sumpR_B_O = sumpR_B_O + data.value("Sum");
      else
     kolOP_E = kolOP_E + 1;KolP_E = KolP_E + 1;Kol_E = Kol_E + 1; SumRRF_op_E = SumRRF_op_E + data.value("Sum"); SumRRF_p_E = SumRRF_p_E + data.value("Sum"); SumRRF_E = SumRRF_E + data.value("Sum");
     KolP_E_O = KolP_E_O + 1; sumpR_E_O = sumpR_E_O + data.value("Sum");
      end;
  else
//      if(Vid_HranS == "Б")
      if(StoreKind == 0)
     kolOP_B = kolOP_B + 1;KolP_B = KolP_B + 1;Kol_B = Kol_B + 1; sumOP_B = sumOP_B + data.value("Sum"); sumP_B = sumP_B + data.value("Sum"); sum_B = sum_B + data.value("Sum");
     KolP_B_O = KolP_B_O + 1; sumpV_B_O = sumpV_B_O + data.value("Sum");
      else
     kolOP_E = kolOP_E + 1;KolP_E = KolP_E + 1;Kol_E = Kol_E + 1; sumOP_E = sumOP_E + data.value("Sum"); sumP_E = sumP_E + data.value("Sum"); sum_E = sum_E + data.value("Sum");
     KolP_E_O = KolP_E_O + 1; sumpV_E_O = sumpV_E_O + data.value("Sum");
      end;
  end;
	  end;
        oper1 = data.value("t_oper");
	oper2 = oper1;
	otdel1 = data.value("t_code1") + "." + data.value("t_code2");
        otdel2= otdel1;
	perv = 0;
     paymentID2 = paymentID1;
//	kolp_B_O = 0; sump_B_O = $0; kolp_E_O = 0; sump_E_O = $0;
 end;
/* ==>> */elif((kontr == 1) and (not(otchetbank)))
        Select = select+
"          where a.T_CODE1 = "+ NumOtdel;
    if(NumPodOtdel !=0)
       Select = select+
       "            and a.T_CODE2 = "+ NumPodOtdel;
    end;
       Select = select+
       "          order by a.t_Oper, t_paymentid, a.numdoc, AccDeb, SUM                                                                                                            ";
	Data = ExecSQLSelect(Select);
	Tabl.addcolumn("№ Док.",10,AL_RIGHT); tabl.addcolumn("Счет дебет",20,AL_CENTER); tabl.addcolumn("Счет кредит",20,AL_CENTER); 
	tabl.addcolumn("Сумма Дт",14,AL_right); tabl.addcolumn("Валюта|дебет",5,AL_CENTER);
	tabl.addcolumn("Сумма Кт",14,AL_right); tabl.addcolumn("Валюта|кредит",5,AL_CENTER); tabl.addcolumn("Сумма в|валюте РФ",14,AL_right);
	tabl.addcolumn("Шифр|/вид",4,AL_CENTER); tabl.addcolumn("Опер",4,AL_CENTER); tabl.addcolumn("Основание",50,AL_LEFT); tabl.addcolumn("Вид|хр",3,AL_CENTER);
  if(Data.MoveNext())

/*--------------------------------------------------------------------------------------------*/
     paymentID1 = data.value("t_paymentid");
       номер_документа = "";             // -|
            Счет_дебет = "";             //  | 
           Счет_кредит = "";             //  |
           Сумма_дебет = $0;             //  |
          Валюта_дебет = "";             //  |- Обнуляем переменные
          Сумма_кредит = $0;             //  |
         Валюта_кредит = "";             //  | 
        Сумма_в_рублях = $0;             //  |
        Шифр_документа = "";             //  |
          Операционист = 0 ;             //  |
             Основание = "";             // -|
     paymentID2 = paymentID1;

     StoreKind = data.value("vid_hran");
     if(StoreKind != 0)
        StoreKind = 1;
     end;
     Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
     if((substr(data.value("AccKr"),14,5) == "21010") or (substr(data.value("AccKr"),14,5) == "22010") or (substr(data.value("AccDeb"),14,5) == "21010") or (substr(data.value("AccDeb"),14,5) == "22010") or (data.value("T_RESULT_CARRY") == 18))
//        if(Vid_HranS == "Б")
        if(StoreKind == 0)
           kolOP_B = kolOP_B + 1;KolP_B = KolP_B + 1;Kol_B = Kol_B + 1; SumRRF_op_B = SumRRF_op_B + data.value("Sum"); SumRRF_p_B = SumRRF_p_B + data.value("Sum"); SumRRF_B = SumRRF_B + data.value("Sum");
        else
           kolOP_E = kolOP_E + 1;KolP_E = KolP_E + 1;Kol_E = Kol_E + 1; SumRRF_op_E = SumRRF_op_E + data.value("Sum"); SumRRF_p_E = SumRRF_p_E + data.value("Sum"); SumRRF_E = SumRRF_E + data.value("Sum");
        end;
     else
//        if(Vid_HranS == "Б")
        if(StoreKind == 0)
           kolOP_B = kolOP_B + 1;KolP_B = KolP_B + 1;Kol_B = Kol_B + 1; sumOP_B = sumOP_B + data.value("Sum"); sumP_B = sumP_B + data.value("Sum"); sum_B = sum_B + data.value("Sum");
        else
           kolOP_E = kolOP_E + 1;KolP_E = KolP_E + 1;Kol_E = Kol_E + 1; sumOP_E = sumOP_E + data.value("Sum"); sumP_E = sumP_E + data.value("Sum"); sum_E = sum_E + data.value("Sum");
        end;
     end;
     if (Flag_pechati_provodkiS == 1)
        tabl.printhead("отдел "+ data.value("t_code1")+"."+data.value("t_code2")+" "+data.value("name_otdel") + " \n"+data.value("t_Oper") + " " + GetOperName(data.Value("t_oper")));
        if((substr(data.value("AccKr"),14,5) == "21010") or (substr(data.value("AccKr"),14,5) == "22010") or (substr(data.value("AccDeb"),14,5) == "21010") or (substr(data.value("AccDeb"),14,5) == "22010") or (data.value("T_RESULT_CARRY") == 18))
           tabl.printStringTransferByWord(data.value("NumDoc"), data.value("AccDeb"), data.value("AccKr"), "-", "RUR", "-", "RUR", data.value("Sum"), data.value("Sh"), data.value("t_Oper"), data.value("Ground"), vid_hranS); 
           kolOP = kolOP + 1;KolP = KolP + 1;Kol = Kol + 1; SumRRF_op = SumRRF_op+ data.value("Sum"); SumRRF_p = SumRRF_p+ data.value("Sum"); SumRRF = SumRRF+ data.value("Sum");
        else
           счет_кредит = data.value("AccKr");
           счет_дебет  = data.value("AccDeb");
           if(data.value("t_paymentid"))
              платеж = data.value("t_paymentid");
           else
              платеж = 0;
           end;
           сумма = data.value("Sum");
//           poluchenie_summ_v_valute(счет_дебет,счет_кредит, платеж, сумма, сумма_дебет, валюта_дебет, сумма_кредит, валюта_кредит);
           сумма_дебет   = checkZeroSum(data.value("T_SUM_PAYER"),платеж,true);
           валюта_дебет  = data.value("find"); 
           сумма_кредит  = checkZeroSum(data.value("T_SUM_RECEIVER"),платеж,false); 
           валюта_кредит = data.value("finc");
           tabl.printStringTransferByWord(data.value("NumDoc"), data.value("AccDeb"), data.value("AccKr"), сумма_дебет, валюта_дебет, сумма_кредит, валюта_кредит/* сумма_дебет, валюта_дебет, data.value("Sum"), data.value("t_ccy")*/, data.value("Sum"), data.value("Sh"), data.value("t_Oper"), data.value("Ground"), vid_hranS); 
           kolOP = kolOP + 1;KolP = KolP + 1;Kol = Kol + 1; sumOP = sumOP + data.value("Sum"); sumP = sumP + data.value("Sum"); sum = sum + data.value("Sum");
        end;  
     end;
        oper1 = data.value("t_oper");
	oper2 = oper1;
  end;

/* ==>> */elif((kontr == 1) and (otchetbank))
        Select = select+
"          order by a.t_code1, a.t_code2, a.t_oper, t_paymentid, a.numdoc, AccDeb, SUM                                                                                      ";
	Data = ExecSQLSelect(Select);
	Tabl.addcolumn("№ Док.",10,AL_RIGHT); tabl.addcolumn("Счет дебет",20,AL_CENTER); tabl.addcolumn("Счет кредит",20,AL_CENTER); 
	tabl.addcolumn("Сумма Дт",14,AL_right); tabl.addcolumn("Валюта|дебет",5,AL_CENTER);
	tabl.addcolumn("Сумма Кт",14,AL_right); tabl.addcolumn("Валюта|кредит",5,AL_CENTER); tabl.addcolumn("Сумма в|валюте РФ",14,AL_right);
	tabl.addcolumn("Шифр|/вид",4,AL_CENTER); tabl.addcolumn("Опер",4,AL_CENTER); tabl.addcolumn("Основание",50,AL_LEFT); tabl.addcolumn("Вид|хр",3,AL_CENTER);
        if(Data.MoveNext())
	tabl.printhead("отдел " +  data.value("t_code1") +"." + data.value("t_code2") + data.value("name_otdel") + " \n"+data.value("t_Oper") + " " + GetOperName(data.Value("t_oper")));
/*--------------------------------------------------------------------------------------------*/
     paymentID1 = data.value("t_paymentid");
       номер_документа = "";
            Счет_дебет = "";
           Счет_кредит = "";
           Сумма_дебет = $0;
          Валюта_дебет = "";
          Сумма_кредит = $0; 
         Валюта_кредит = "";                /*обнуляем переменные*/
        Сумма_в_рублях = $0;
        Шифр_документа = "";
          Операционист = 0 ;
             Основание = "";
     paymentID2 = paymentID1;
                StoreKind = data.value("vid_hran");
               if(StoreKind != 0)
                StoreKind = 1;
               end;
                Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
           if (Flag_pechati_provodkiS == 1)
//  if((substr(data.value("AccKr"),1,5) == "70601") or (substr(data.value("AccKr"),1,5) == "70606") or (substr(data.value("AccDeb"),1,5) == "70601") or (substr(data.value("AccDeb"),1,5) == "70606"))
  if((substr(data.value("AccKr"),14,5) == "21010") or (substr(data.value("AccKr"),14,5) == "22010") or (substr(data.value("AccDeb"),14,5) == "21010") or (substr(data.value("AccDeb"),14,5) == "22010"))
     tabl.printStringTransferByWord(data.value("NumDoc"), data.value("AccDeb"), data.value("AccKr"), "-", "-", "-", "-", data.value("Sum"), data.value("Sh"), data.value("t_Oper"), data.value("Ground"), vid_hranS); 
     kolOP = kolOP + 1;KolP = KolP + 1;Kol = Kol + 1; SumRRF_op = SumRRF_op+ data.value("Sum"); SumRRF_p = SumRRF_p+ data.value("Sum"); SumRRF = SumRRF+ data.value("Sum");
  else
счет_кредит = data.value("AccKr");
счет_дебет  = data.value("AccDeb");
if(data.value("t_paymentid"))
платеж = data.value("t_paymentid");
else
платеж = 0;
end;
сумма = data.value("Sum");
//poluchenie_summ_v_valute(счет_дебет,счет_кредит, платеж, сумма, сумма_дебет, валюта_дебет, сумма_кредит, валюта_кредит);
           сумма_дебет   = checkZeroSum(data.value("T_SUM_PAYER"),платеж,true);
           валюта_дебет  = data.value("find"); 
           сумма_кредит  = checkZeroSum(data.value("T_SUM_RECEIVER"),платеж,false); 
           валюта_кредит = data.value("finc");
     tabl.printStringTransferByWord(data.value("NumDoc"), data.value("AccDeb"), data.value("AccKr"), сумма_дебет, валюта_дебет, сумма_кредит, валюта_кредит/* сумма_дебет, валюта_дебет, data.value("Sum"), data.value("t_ccy")*/, data.value("Sum"), data.value("Sh"), data.value("t_Oper"), data.value("Ground"), vid_hranS); 
     kolOP = kolOP + 1;KolP = KolP + 1;Kol = Kol + 1; sumOP = sumOP + data.value("Sum"); sumP = sumP + data.value("Sum"); sum = sum + data.value("Sum");
  end;
         end;
        oper1 = data.value("t_oper");
	otdel1 = data.value("name_otdel");
	oper2 = oper1;
	otdel2 = otdel1;

//        flag_pechati_GetOperName = 1;
	end;

/* ==>> */elif(kontr == 3)
         if (not(otchetbank))
          Select = select+
"         where a.T_CODE1 = "+ NumOtdel;
           if(NumPodOtdel !=0)
            Select = select+
"           and a.T_CODE2 = "+ NumPodOtdel;
           end;
         end;
        Select = select+
"          order by a.t_code1, a.t_code2, a.t_oper, t_paymentid, a.numdoc, AccDeb, SUM                                                                                      ";
	Data = ExecSQLSelect(Select);
	Tabl.addcolumn("№ Док.",10,AL_RIGHT);    tabl.addcolumn("Счет дебет",20,AL_CENTER);        tabl.addcolumn("Счет кредит",20,AL_CENTER); 
	tabl.addcolumn("Сумма Дт",10,AL_CENTER); tabl.addcolumn("Вал|Дт.",3,AL_CENTER);            tabl.addcolumn("Сумма Кт",10,AL_CENTER);
	tabl.addcolumn("Вал|Кт.",5,AL_CENTER);   tabl.addcolumn("Сумма в|валюте РФ",14,AL_CENTER); tabl.addcolumn("Основание",50,AL_LEFT);
	tabl.addcolumn("Шифр|/вид",5,AL_CENTER); tabl.addcolumn("Опер",10,AL_CENTER);              tabl.addcolumn("Отдел",6,AL_CENTER);
	tabl.addcolumn("Вид|хр",3,AL_CENTER);

        if(Data.MoveNext())
	tabl.printhead();
/*--------------------------------------------------------------------------------------------*/
     paymentID1 = data.value("t_paymentid");
       номер_документа = "";
            Счет_дебет = "";
           Счет_кредит = "";
           Сумма_дебет = $0;
          Валюта_дебет = "";
          Сумма_кредит = $0; 
         Валюта_кредит = "";                /*обнуляем переменные*/
        Сумма_в_рублях = $0;
        Шифр_документа = "";
          Операционист = 0 ;
             Основание = "";
     paymentID2 = paymentID1;
                StoreKind = data.value("vid_hran");
               if(StoreKind != 0)
                StoreKind = 1;
               end;
                Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
           if (Flag_pechati_provodkiS == 1)
//  if((substr(data.value("AccKr"),1,5) == "70601") or (substr(data.value("AccKr"),1,5) == "70606") or (substr(data.value("AccDeb"),1,5) == "70601") or (substr(data.value("AccDeb"),1,5) == "70606"))
  if((substr(data.value("AccKr"),14,5) == "21010") or (substr(data.value("AccKr"),14,5) == "22010") or (substr(data.value("AccDeb"),14,5) == "21010") or (substr(data.value("AccDeb"),14,5) == "22010"))
     tabl.printStringTransferByWord(data.value("NumDoc"), data.value("AccDeb"), data.value("AccKr"), "-", "-", "-", "-", data.value("Sum"), data.value("Ground"), data.value("Sh"), data.value("t_Oper"), string(data.value("t_Code1")) + "." + string(data.value("t_Code2")),vid_hranS); 
     kolOP = kolOP + 1;KolP = KolP + 1;Kol = Kol + 1; SumRRF_op = SumRRF_op+ data.value("Sum"); SumRRF_p = SumRRF_p+ data.value("Sum"); SumRRF = SumRRF+ data.value("Sum");
  else
счет_кредит = data.value("AccKr");
счет_дебет  = data.value("AccDeb");
if(data.value("t_paymentid"))
платеж = data.value("t_paymentid");
else
платеж = 0;
end;
сумма = data.value("Sum");
//poluchenie_summ_v_valute(счет_дебет,счет_кредит, платеж, сумма, сумма_дебет, валюта_дебет, сумма_кредит, валюта_кредит);
           сумма_дебет   = checkZeroSum(data.value("T_SUM_PAYER"),платеж,true);
           валюта_дебет  = data.value("find"); 
           сумма_кредит  = checkZeroSum(data.value("T_SUM_RECEIVER"),платеж,false); 
           валюта_кредит = data.value("finc");
     tabl.printStringTransferByWord(data.value("NumDoc"), data.value("AccDeb"), data.value("AccKr"), сумма_дебет, валюта_дебет, сумма_кредит, валюта_кредит, data.value("Sum"), data.value("Ground"), data.value("Sh"), data.value("t_Oper"), string(data.value("t_Code1")) + "." + string(data.value("t_Code2")),vid_hranS);
     kolOP = kolOP + 1;KolP = KolP + 1;Kol = Kol + 1; sumOP = sumOP + data.value("Sum"); sumP = sumP + data.value("Sum"); sum = sum + data.value("Sum");
  end;
           end;
        oper1 = data.value("t_oper");
	otdel1 = data.value("name_otdel");
	oper2 = oper1;
	otdel2 = otdel1;

        flag_pechati_GetOperName = 1;
	end;
       end; /*подотчеты*/
        debugbreak;
	debugbreak;

        while(Data.MoveNext())//and(ValType(Data.Value("Sum"))!= 26))
/* ==>> */if(kontr == 2)   /*условия по подотчетам*/
	        oper1 = data.value("t_oper");
                paymentID1 = data.value("t_paymentid");
                StoreKind = data.value("vid_hran");
                otdel1 = data.value("t_code1") + "." + data.value("t_code2");
               if(StoreKind != 0)
                StoreKind = 1;
               end;
                Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
           if (Flag_pechati_provodkiS == 1)
/*-------------------------------------------------------------------------------------------------------------------------------*/
  if (paymentID1 != paymentID2)// or (substr(data.value("AccKr"),1,5) == "60309"))         /*если изменился ID платежа, к которому относится проводка*/
    if((oper1 == oper2) and (otdel2 == otdel1))
//	tabl.printseparator();
    end;	
  end;
/*-------------------------------------------------------------------------------------------------------------------------------*/
	    if ((oper1 != oper2) and oper2 != 0)                       /*если опер изменился*/
	tabl.printStringTransferByWord(oper2,GetShortName(GetOperName(Oper2)),otdel2,kolOP_B,sumRRF_op_B,SumOP_B,string(sumRRF_op_B + SumOP_B),"Б");
        [│       │                      │       ├─────────────┼──────────────────────┼──────────────────────┼──────────────────────┼──────┤];
	tabl.printStringTransferByWord("","","",kolOP_E,sumRRF_op_E,SumOP_E,string(sumRRF_op_E + SumOP_E),"Э");
       	if((otdel2 != otdel1) and (otdel2 !=0))
	[├───────┴──────────────────────┴───────┼─────────────┼──────────────────────┼──────────────────────┼──────────────────────┼──────┤
	 │                                      │       ##### │    ################# │    ################# │    ################# │  Б   │
	 │ ИТОГО ПО ОТДЕЛУ ######               ├─────────────┼──────────────────────┼──────────────────────┼──────────────────────┼──────┤
	 │   (в руб.экв)                        │       ##### │    ################# │    ################# │    ################# │  Э   │
         ├───────┬──────────────────────┬───────┼─────────────┼──────────────────────┼──────────────────────┼──────────────────────┼──────┤](int(kolp_B_O),sumpR_B_O,sumpV_B_O,sumpR_B_O + sumpV_B_O,otdel2,int(kolp_E_O),sumpR_E_O,sumpV_E_O,sumpR_E_O + sumpV_E_O);
	kolp_B_O = 0; sumpR_B_O = $0;sumpV_B_O = $0; kolp_E_O = 0; sumpR_E_O = $0; sumpV_E_O = $0;
//		flag_separator = 1;
	otdel2 = otdel1;
	else
		tabl.printseparator();
	end;
/*???????*/
//	tabl.printseparator();
	       KolOP_B = 0; SumOP_B = $0; SumRRF_OP_B = $0;KolOP_E = 0; SumOP_E = $0; SumRRF_OP_E = $0;
		oper2 = oper1;		
		otdel2= otdel1;
	end;	
  if((substr(data.value("AccKr"),14,5) == "21010") or (substr(data.value("AccKr"),14,5) == "22010") or (substr(data.value("AccDeb"),14,5) == "21010") or (substr(data.value("AccDeb"),14,5) == "22010") or (data.value("T_RESULT_CARRY") == 18))
      if(Vid_HranS == "Б")
     kolOP_B = kolOP_B + 1;KolP_B = KolP_B + 1;Kol_B = Kol_B + 1; SumRRF_op_B = SumRRF_op_B + data.value("Sum"); SumRRF_p_B = SumRRF_p_B + data.value("Sum"); SumRRF_B = SumRRF_B + data.value("Sum");
     KolP_B_O = KolP_B_O + 1; sumpR_B_O = sumpR_B_O + data.value("Sum");
      else
     kolOP_E = kolOP_E + 1;KolP_E = KolP_E + 1;Kol_E = Kol_E + 1; SumRRF_op_E = SumRRF_op_E + data.value("Sum"); SumRRF_p_E = SumRRF_p_E + data.value("Sum"); SumRRF_E = SumRRF_E + data.value("Sum");
     KolP_E_O = KolP_E_O + 1; sumpR_E_O = sumpR_E_O + data.value("Sum");
      end;
  else
      if(Vid_HranS == "Б")
     kolOP_B = kolOP_B + 1;KolP_B = KolP_B + 1;Kol_B = Kol_B + 1; sumOP_B = sumOP_B + data.value("Sum"); sumP_B = sumP_B + data.value("Sum"); sum_B = sum_B + data.value("Sum");
     KolP_E_O = KolP_E_O + 1; sumpV_E_O = sumpV_E_O + data.value("Sum");
      else
     kolOP_E = kolOP_E + 1;KolP_E = KolP_E + 1;Kol_E = Kol_E + 1; sumOP_E = sumOP_E + data.value("Sum"); sumP_E = sumP_E + data.value("Sum"); sum_E = sum_E + data.value("Sum");
     KolP_E_O = KolP_E_O + 1; sumpV_E_O = sumpV_E_O + data.value("Sum");
      end;
  end;

          end;
/* ==>> */elif((kontr == 1) and (not(otchetbank)))
        oper1 = data.value("t_oper");
        paymentID1 = data.value("t_paymentid");
        StoreKind = data.value("vid_hran");
        if(StoreKind != 0)
           StoreKind = 1;
        end;
        Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
        if(Flag_pechati_provodkiS == 1)
/*-------------------------------------------------------------------------------------------------------------------------------*/
           if(paymentID1 != paymentID2)// or (substr(data.value("AccKr"),1,5) == "60309"))         /*если изменился ID платежа, к которому относится проводка*/
              paymentID2 = paymentID1;
              if(oper1 == oper2)
                 tabl.printseparator();
              end;	
           end;
/*-------------------------------------------------------------------------------------------------------------------------------*/
	   if((oper1 != oper2) and (oper2 != 0) )                       /*если опер изменился*/
//	      tabl.printbottom();
              if(firstRowToPrint == 0)
                 if(VidHranS == "Бумажный")
                    [├────────────┴──────────────────────┴──────────────────────┴────────────────┴────────┴────────────────┴────────┼────────────────┼──────┼──────┼────────────────────────────────────────────────────┼─────┤
                     │ Итого по операционисту ################### документов бумажного вида: ######                                 │ ############## │      │      │                                                    │  Б  │
                     └──────────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────────────┴──────┴──────┴────────────────────────────────────────────────────┴─────┘](
                                              GetShortName(GetOperName(oper2)),kolOP,sumOP + SumRRF_op);
                 elif(VidHranS == "Электронно")
                    [├────────────┴──────────────────────┴──────────────────────┴────────────────┴────────┴────────────────┴────────┼────────────────┼──────┼──────┼────────────────────────────────────────────────────┼─────┤
                     │ Итого по операционисту ################### документов электронного вида: ######                              │ ############## │      │      │                                                    │  Э  │
                     └──────────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────────────┴──────┴──────┴────────────────────────────────────────────────────┴─────┘](
                                              GetShortName(GetOperName(oper2)),kolOP,sumOP + SumRRF_op);
                 else
                    [├────────────┴──────────────────────┴──────────────────────┴────────────────┴────────┴────────────────┴────────┼────────────────┼──────┼──────┼────────────────────────────────────────────────────┼─────┤
                     │ Итого по операционисту ################### документов (Б+Э) вида: ######                                     │ ############## │      │      │                                                    │ Б+Э │
                     └──────────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────────────┴──────┴──────┴────────────────────────────────────────────────────┴─────┘](
                                              GetShortName(GetOperName(oper2)),kolOP,sumOP + SumRRF_op);
                 end;
                 if(operselect == 0)
                    [___________________________________#################################################################################](GetOperName(oper2));
                    [                                                                                                                    ]
                 end;
              end;
              SumOP = $0; kolOP = 0; SumRRF_op = $0;
              tabl = ctablereport();
              Tabl.addcolumn("№ Док.",10,AL_RIGHT);        tabl.addcolumn("Счет дебет",20,AL_CENTER);        tabl.addcolumn("Счет кредит",20,AL_CENTER); 
              tabl.addcolumn("Сумма Дт",14,AL_right);      tabl.addcolumn("Валюта|дебет",5,AL_CENTER);       tabl.addcolumn("Сумма Кт",14,AL_right);
              tabl.addcolumn("Валюта|кредит",5,AL_CENTER); tabl.addcolumn("Сумма в|валюте РФ",14,AL_right);  tabl.addcolumn("Шифр|/вид",4,AL_CENTER);
              tabl.addcolumn("Опер",4,AL_CENTER);          tabl.addcolumn("Основание",50,AL_LEFT);           tabl.addcolumn("Вид|хр",3,AL_CENTER);
              tabl.printhead("отдел "+  data.value("t_code1") +"." + data.value("t_code2") + data.value("name_otdel") + " \n"+data.value("t_Oper") + " " + GetOperName(data.Value("t_oper")));
              oper2 = oper1;		
           end;
/*-------------------------------------------------------------------------------------------------------------*/
        end;
        if((substr(data.value("AccKr"),14,5) == "21010") or (substr(data.value("AccKr"),14,5) == "22010") or (substr(data.value("AccDeb"),14,5) == "21010") or (substr(data.value("AccDeb"),14,5) == "22010") or (data.value("T_RESULT_CARRY") == 18))
           if(Vid_HranS == "Б")
              kolOP_B = kolOP_B + 1;KolP_B = KolP_B + 1;Kol_B = Kol_B + 1; SumRRF_op_B = SumRRF_op_B + data.value("Sum"); SumRRF_p_B = SumRRF_p_B + data.value("Sum"); SumRRF_B = SumRRF_B + data.value("Sum");
           else
              kolOP_E = kolOP_E + 1;KolP_E = KolP_E + 1;Kol_E = Kol_E + 1; SumRRF_op_E = SumRRF_op_E + data.value("Sum"); SumRRF_p_E = SumRRF_p_E + data.value("Sum"); SumRRF_E = SumRRF_E + data.value("Sum");
           end;
        else
           if(Vid_HranS == "Б")
              kolOP_B = kolOP_B + 1;KolP_B = KolP_B + 1;Kol_B = Kol_B + 1; sumOP_B = sumOP_B + data.value("Sum"); sumP_B = sumP_B + data.value("Sum"); sum_B = sum_B + data.value("Sum");
           else
              kolOP_E = kolOP_E + 1;KolP_E = KolP_E + 1;Kol_E = Kol_E + 1; sumOP_E = sumOP_E + data.value("Sum"); sumP_E = sumP_E + data.value("Sum"); sum_E = sum_E + data.value("Sum");
           end;
        end;
        if(Flag_pechati_provodkiS == 1)
           if((substr(data.value("AccKr"),14,5) == "21010") or (substr(data.value("AccKr"),14,5) == "22010") or (substr(data.value("AccDeb"),14,5) == "21010") or (substr(data.value("AccDeb"),14,5) == "22010") or (data.value("T_RESULT_CARRY") == 18))
              tabl.printStringTransferByWord(data.value("NumDoc"), data.value("AccDeb"), data.value("AccKr"), "-", "RUR", "-", "RUR", data.value("Sum"), data.value("Sh"), data.value("t_Oper"), data.value("Ground"), vid_hranS); 
              kolOP = kolOP + 1;KolP = KolP + 1;Kol = Kol + 1; SumRRF_op = SumRRF_op+ data.value("Sum"); SumRRF_p = SumRRF_p+ data.value("Sum");SumRRF = SumRRF+ data.value("Sum");
           else
              счет_кредит = data.value("AccKr");
              счет_дебет  = data.value("AccDeb");
              if(data.value("t_paymentid"))
                 платеж = data.value("t_paymentid");
              else
                 платеж = 0;
              end;
              сумма = data.value("Sum");
//              poluchenie_summ_v_valute(счет_дебет,счет_кредит, платеж, сумма, сумма_дебет, валюта_дебет, сумма_кредит, валюта_кредит);
              сумма_дебет   = checkZeroSum(data.value("T_SUM_PAYER"),платеж,true);
              валюта_дебет  = data.value("find"); 
              сумма_кредит  = checkZeroSum(data.value("T_SUM_RECEIVER"),платеж,false); 
              валюта_кредит = data.value("finc");
              tabl.printStringTransferByWord(data.value("NumDoc"), data.value("AccDeb"), data.value("AccKr"), сумма_дебет, валюта_дебет, сумма_кредит, валюта_кредит/* сумма_дебет, валюта_дебет, data.value("Sum"), data.value("t_ccy")*/, data.value("Sum"), data.value("Sh"), data.value("t_Oper"), data.value("Ground"), vid_hranS); 
              kolOP = kolOP + 1;KolP = KolP + 1;Kol = Kol + 1; sumOP = sumOP + data.value("Sum"); sumP = sumP + data.value("Sum"); sum = sum + data.value("Sum");
    FirstRowToPrint = 0;
           end;
        end;
/* ==>> */elif((kontr == 1) and (otchetbank))
                paymentID1 = data.value("t_paymentid"); 
		oper1 = data.value("t_oper");
		otdel1 = data.value("name_otdel");
                StoreKind = data.value("vid_hran");
               if(StoreKind != 0)
                StoreKind = 1;
               end;
                Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
           if (Flag_pechati_provodkiS == 1)
/*-------------------------------------------------------------------------------------------------------------------------------*/
  if (paymentID1 != paymentID2)

     paymentID2 = paymentID1;
    if(oper1 == oper2)
	tabl.printseparator();
    end;	
  end;
/*-------------------------------------------------------------------------------------------------------------------------------*/
              if (oper1 != oper2)
		tabl.printbottom();
		[  всего документов  ####### на сумму (в рублях РФ) ################# Итого в валюте РФ #################
		                                      (в рубл. экв) #################
		  ___________________________________#################################################################################

		] (kolOP,string(SumRRF_op),string(sumOP + SumRRF_op),string(sumOP),GetOperName(oper2));

	    if (otdel1 != otdel2)      /*следующий отдел отдел*/
                [Всего документов по подразделению ####### на сумму (в рублях РФ) ################# Итого в валюте РФ #################
		                                                    (в рубл. экв) #################   

                ](int(kolp),string(sumRRF_p),string(SumP + sumRRF_p),string(SumP));

	        [  ____________________________________________________________________________

	        Руководитель подразделения    ############################### __________________ 

	        Контролёр                     ############################### __________________ 
                                                                         
	        Отчет подготовил              ############################### __________________ 

	        ]      (HeaderName, ControlName, getShortName(GetOperName({oper})));
                SumP = $0; kolP = 0; SumRRF_p = $0; 
		otdel2 = otdel1;
            end;
		SumOP = $0; kolOP = 0; SumRRF_op = $0;
		tabl = ctablereport();
	Tabl.addcolumn("№ Док.",10,AL_RIGHT);        tabl.addcolumn("Счет дебет",20,AL_CENTER);        tabl.addcolumn("Счет кредит",20,AL_CENTER); 
	tabl.addcolumn("Сумма Дт",14,AL_right);      tabl.addcolumn("Валюта|дебет",5,AL_CENTER);       tabl.addcolumn("Сумма Кт",14,AL_right);
	tabl.addcolumn("Валюта|кредит",5,AL_CENTER); tabl.addcolumn("Сумма в|валюте РФ",14,AL_right);  tabl.addcolumn("Шифр|/вид",4,AL_CENTER);
	tabl.addcolumn("Опер",4,AL_CENTER);          tabl.addcolumn("Основание",50,AL_LEFT);           tabl.addcolumn("Вид|хр",3,AL_CENTER);
	tabl.printhead("отдел "+  data.value("t_code1") +"." + data.value("t_code2") + data.value("name_otdel") + " \n"+data.value("t_Oper") + " " + GetOperName(data.Value("t_oper")));
		oper2 = oper1;		
	      end;
/*-------------------------------------------------------------------------------------------------------------*/
//  if((substr(data.value("AccKr"),1,5) == "70601") or (substr(data.value("AccKr"),1,5) == "70606") or (substr(data.value("AccDeb"),1,5) == "70601") or (substr(data.value("AccDeb"),1,5) == "70606"))
  if((substr(data.value("AccKr"),14,5) == "21010") or (substr(data.value("AccKr"),14,5) == "22010") or (substr(data.value("AccDeb"),14,5) == "21010") or (substr(data.value("AccDeb"),14,5) == "22010"))
     tabl.printStringTransferByWord(data.value("NumDoc"), data.value("AccDeb"), data.value("AccKr"), "-", "-", "-", "-", data.value("Sum"), data.value("Sh"), data.value("t_Oper"), data.value("Ground"), vid_hranS); 
     kolOP = kolOP + 1;KolP = KolP + 1;Kol = Kol + 1; SumRRF_op = SumRRF_op+ data.value("Sum"); SumRRF_p = SumRRF_p+ data.value("Sum");SumRRF = SumRRF+ data.value("Sum");
  else
счет_кредит = data.value("AccKr");
счет_дебет  = data.value("AccDeb");
if(data.value("t_paymentid"))
платеж = data.value("t_paymentid");
else
платеж = 0;
end;
сумма = data.value("Sum");
//poluchenie_summ_v_valute(счет_дебет,счет_кредит, платеж, сумма, сумма_дебет, валюта_дебет, сумма_кредит, валюта_кредит);
           сумма_дебет   = checkZeroSum(data.value("T_SUM_PAYER"),платеж,true);
           валюта_дебет  = data.value("find"); 
           сумма_кредит  = checkZeroSum(data.value("T_SUM_RECEIVER"),платеж,false); 
           валюта_кредит = data.value("finc");
     tabl.printStringTransferByWord(data.value("NumDoc"), data.value("AccDeb"), data.value("AccKr"), сумма_дебет, валюта_дебет, сумма_кредит, валюта_кредит/* сумма_дебет, валюта_дебет, data.value("Sum"), data.value("t_ccy")*/, data.value("Sum"), data.value("Sh"), data.value("t_Oper"), data.value("Ground"), vid_hranS); 
    FirstRowToPrint = 0;
     kolOP = kolOP + 1;KolP = KolP + 1;Kol = Kol + 1; sumOP = sumOP + data.value("Sum"); sumP = sumP + data.value("Sum"); sum = sum + data.value("Sum");
  end;
         end;
/*-------------------------------------------------------------------------------------------------------------*/
/* ==>> */     	elif(kontr == 3)
        paymentID1 = data.value("t_paymentid"); 
                StoreKind = data.value("vid_hran");
               if(StoreKind != 0)
                StoreKind = 1;
               end;
                Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
           if (Flag_pechati_provodkiS == 1)
	if (paymentID1 != paymentID2)
        paymentID2 = paymentID1;
	tabl.printseparator();
	end;
//  if((substr(data.value("AccKr"),1,5) == "70601") or (substr(data.value("AccKr"),1,5) == "70606") or (substr(data.value("AccDeb"),1,5) == "70601") or (substr(data.value("AccDeb"),1,5) == "70606"))
  if((substr(data.value("AccKr"),14,5) == "21010") or (substr(data.value("AccKr"),14,5) == "22010") or (substr(data.value("AccDeb"),14,5) == "21010") or (substr(data.value("AccDeb"),14,5) == "22010"))
     tabl.printStringTransferByWord(data.value("NumDoc"), data.value("AccDeb"), data.value("AccKr"), "-", "-", "-", "-", data.value("Sum"), data.value("Ground"), data.value("Sh"), string(data.value("t_Oper") + " " + GetOperName(data.value("t_Oper"))), string(data.value("t_Code1") + "." + data.value("t_Code2")), vid_hranS); 
     kolOP = kolOP + 1;KolP = KolP + 1;Kol = Kol + 1; SumRRF_op = SumRRF_op+ data.value("Sum"); SumRRF_p = SumRRF_p+ data.value("Sum");SumRRF = SumRRF+ data.value("Sum");
  else
счет_кредит = data.value("AccKr");
счет_дебет  = data.value("AccDeb");
if(data.value("t_paymentid"))
платеж = data.value("t_paymentid");
else
платеж = 0;
end;
сумма = data.value("Sum");
//poluchenie_summ_v_valute(счет_дебет,счет_кредит, платеж, сумма, сумма_дебет, валюта_дебет, сумма_кредит, валюта_кредит);
           сумма_дебет   = checkZeroSum(data.value("T_SUM_PAYER"),платеж,true);
           валюта_дебет  = data.value("find"); 
           сумма_кредит  = checkZeroSum(data.value("T_SUM_RECEIVER"),платеж,false); 
           валюта_кредит = data.value("finc");
     tabl.printStringTransferByWord(data.value("NumDoc"), data.value("AccDeb"), data.value("AccKr"), сумма_дебет, валюта_дебет, сумма_кредит, валюта_кредит, data.value("Sum"), data.value("Ground"), data.value("Sh"), data.value("t_Oper"), string(data.value("t_Code1")) + "." + string(data.value("t_Code2")),vid_hranS);
     kolOP = kolOP + 1;KolP = KolP + 1;Kol = Kol + 1; sumOP = sumOP + data.value("Sum"); sumP = sumP + data.value("Sum"); sum = sum + data.value("Sum");
  end;
           end;
        end;  /*условия по подотчетам*/
        flag_pechati_GetOperName = 1;
     end; /*while*/
if(kontr == 2)
	tabl.printStringTransferByWord(oper2,GetOperName(Oper2),otdel1,kolOP_B,sumRRF_op_B,SumOP_B,string(sumRRF_op_B + SumOP_B),"Б");
       [│       │                      │       ├─────────────┼──────────────────────┼──────────────────────┼──────────────────────┼──────┤];
	tabl.printStringTransferByWord("","","",kolOP_E,sumRRF_op_E,SumOP_E,string(sumRRF_op_E + SumOP_E),"Э");
//       	if((otdel2 != otdel1) and (otdel2 !=0))
	[├───────┴──────────────────────┴───────┼─────────────┼──────────────────────┼──────────────────────┼──────────────────────┼──────┤
	 │                                      │       ##### │    ################# │    ################# │    ################# │  Б   │
	 │ ИТОГО ПО ОТДЕЛУ ######               ├─────────────┼──────────────────────┼──────────────────────┼──────────────────────┼──────┤
	 │   (в руб.экв)                        │       ##### │    ################# │    ################# │    ################# │  Э   │
         ├───────┬──────────────────────┬───────┼─────────────┼──────────────────────┼──────────────────────┼──────────────────────┼──────┤](int(kolp_B_O),sumpR_B_O,sumpV_B_O,sumpR_B_O + sumpV_B_O,otdel2,int(kolp_E_O),sumpR_E_O,sumpV_E_O,sumpR_E_O + sumpV_E_O);
	kolp_B_O = 0; sumpR_B_O = $0;sumpV_B_O = $0; kolp_E_O = 0; sumpR_E_O = $0; sumpV_E_O = $0;
	       KolOP_B = 0; SumOP_B = $0; SumRRF_OP_B = $0;KolOP_E = 0; SumOP_E = $0; SumRRF_OP_E = $0;
//		flag_separator = 1;
	otdel2 = otdel1;
//	else
//		tabl.printseparator();
//	end;
//	tabl.printseparator();
end;
if(kontr == 2)          //|
oper1 = 0;              //| 30.07.12 Glushin S.P.
//oper2 = 0;            //|
end;                    //|
       select = "";
/* ==>> */ if((kontr == 2) and (otchetbank))
        Select = select+
"       select t_oper,numdoc,accdeb,name1,acckr,name2,SUM,sh,ground,t_paymentid,T_FIID_PAYER,(SELECT storeKind FROM TABLE(USER_EA.Get_dev_prop     "+  
"        (a.dockind, a.origin, a.paymkind, a.shifr_oper, a.numb_pack, a.chapter, a.t_typedocument, a.accdeb, a.t_fiid_payer, a.acckr, a.t_fiid_receiver, null ))) vid_hran, T_RESULT_CARRY       "+
"       from                                                                                                                                         ";
/* ==>> */ elif((kontr != 2) and (otchetbank))         /*сводный реестр по банку*/
        Select = select+
"      select distinct '1000 Неизвестное подразделение' as otdel,t_oper,NumDoc,AccDeb,name1,AccKr,name2,SUM,T_SUM_PAYER,T_SUM_RECEIVER,sh,Ground,AppKey,find,finc,t_fiid_payer,t_paymentid, "+
"     (SELECT storeKind FROM TABLE(USER_EA.Get_dev_prop"+  
"        (a.dockind, a.origin, a.paymkind, a.shifr_oper, a.numb_pack, a.chapter, a.t_typedocument, a.accdeb, a.t_fiid_payer, a.acckr, a.t_fiid_receiver, null ))) vid_hran from ";
       end;
        Select = select+   /*основной запрос - начало*/
"        (select distinct arh.t_result_carry, arh.t_oper,               "+
"                arh.t_numb_document AS NumDoc, arh.t_account_payer AS AccDeb, acc1.t_nameaccount name1, arh.t_account_receiver AS AccKr,            "+
"                acc2.t_nameaccount name2,arh.t_sum_natcur SUM,arh.T_SUM_PAYER,arh.T_SUM_RECEIVER, arh.t_shifr_oper||'/'||t_kind_oper sh, arh.t_ground AS Ground,                          "+   
"                arh.t_acctrnid AppKey, paym.t_paymentid,findeb.t_ccy find,finCr.t_ccy finc, arh.T_FIID_PAYER, arh.T_FIID_RECEIVER,          "+
"                prop.T_PAYMENTKIND paymkind, user_ea.GetOrigin ( paym.t_dockind, paym.t_paymentid) origin, arh.T_CHAPTER chapter, paym.T_DOCKIND dockind, arh.T_NUMBER_PACK numb_pack,     "+
"                arh.T_SHIFR_OPER shifr_oper, arh.t_typedocument                                 "+
"           FROM dacctrn_dbt arh,dpmdocs_dbt docs,dpmpaym_dbt paym,daccount_dbt acc1,daccount_dbt acc2,dfininstr_dbt findeb,dfininstr_dbt finCr,dpmrmprop_dbt prop"+
"	   WHERE arh.t_date_carry = to_date('" + DateDocum +"','DD.MM.YYYY')                                                                         "+ 
"            AND arh.t_oper not in (select dop_otdel_dbt.T_oper from dop_otdel_dbt                                                                   "+
"            where (dop_otdel_dbt.t_dateend >= TO_DATE ('" + DateDocum +"', 'DD.MM.YYYY')                                                            "+
"            or t_dateend  = TO_DATE ('01.01.0001', 'DD.MM.YYYY'))                                                                                   "+
"            and t_datebegin <= TO_DATE ('" + DateDocum +"', 'DD.MM.YYYY'))                                                                          "+
"            AND findeb.t_fiid = arh.T_FIID_PAYER                                                                                                    "+
"            AND finCr.t_fiid = arh.T_FIID_RECEIVER                                                                                                  "+
"	     AND acc1.t_account(+) = arh.t_account_payer	                                                                                             "+
"	     AND acc2.t_account(+) = arh.t_account_receiver                                                                                             "+
//"	     AND arh.t_chapter = acc1.t_chapter                                                                                                      "+ 
//"	     AND acc1.t_chapter = acc2.t_chapter                                                                                                     "+ 
"	     AND arh.t_chapter = "+ Chapter                                                                                                           ;
if(substr(RepTypes,1,9) != "Баланс ->")
Select = Select +
"            AND arh.t_result_carry <> 14                                                                                                            ";
end;
Select = Select +
"	     AND arh.T_acctrnid = docs.T_acctrnid(+)                                                                                     "+
"            AND docs.T_PAYMENTID = paym.T_PAYMENTID(+)                                                                                              "+
"            AND prop.T_PAYMENTID(+) = paym.T_PAYMENTID                                                                                              "+
"	     AND (SUBSTR (paym.t_payeraccount, 1, 5)    NOT IN ('20202','20203','20207') or arh.T_RESULT_CARRY = 18)                                 "+
"	     AND (SUBSTR (paym.t_receiveraccount, 1, 5) NOT IN ('20202','20203','20207') or arh.T_RESULT_CARRY = 18)                                 "+
"            and arh.t_account_payer <> 'ОВП'                                                                                                        "+
"            and arh.t_account_receiver <> 'ОВП'                                                                                                     "+
"            AND substr(arh.T_ACCOUNT_PAYER,6,3) <> substr(arh.T_ACCOUNT_RECEIVER,6,3)                                                               ";
if(substr(RepTypes,1,9) == "Баланс ->")
       Select = select +
"            and (exists (select 1 from dpmprop_dbt  deb,dpmprop_dbt cred                                                                            "+
"            where cred.T_PAYMENTID = docs.T_PAYMENTID                                                                                               "+
"            and deb.T_PAYMENTID = docs.T_PAYMENTID                                                                                                  "+
"            and deb.T_PAYMENTID = cred.T_PAYMENTID                                                                                                  "+
"            and deb.t_debetcredit = 0 and cred.t_debetcredit = 1                                                                                    "+
"            and cred.t_group <>"+ PAYMENTS_GROUP_EXTERNAL + " and deb.t_group <>"+ PAYMENTS_GROUP_EXTERNAL+  ")  /*условие для внутренних*/         "+                      
"            or docs.t_paymentid is null)                                                                                                            "; 
end;
       Select = select +
             nbalanse1 + ")" + "\n" + nbalanse2 + ")" + "\n ) a                                                                                         ";
/* ==>> */       if((kontr == 2) and (otchetbank))
        Select = select+
"          order by a.t_Oper, t_paymentid, a.numdoc, AccDeb, SUM ";
	Data = ExecSQLSelect(Select);
oper2 = 0;
     while(data.movenext())

	        oper1 = data.value("t_oper");
                paymentID1 = data.value("t_paymentid");
                StoreKind = data.value("vid_hran");
  //              otdel1 = data.value("t_code1") + "." + data.value("t_code2");
               if(StoreKind != 0)
                StoreKind = 1;
               end;
                Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
 //          if (Flag_pechati_provodkiS == 1)
/*-------------------------------------------------------------------------------------------------------------------------------*/
  if (paymentID1 != paymentID2)// or (substr(data.value("AccKr"),1,5) == "60309"))         /*если изменился ID платежа, к которому относится проводка*/
    if(oper1 == oper2)
	tabl.printseparator();
    end;	
  end;
/*-------------------------------------------------------------------------------------------------------------------------------*/
	    if ((oper1 != oper2) and (oper2 != 0))                       /*если опер изменился*/
	tabl.printStringTransferByWord(oper2,GetOperName(Oper2),"1000",kolOP_B,sumRRF_op_B,SumOP_B,string(sumRRF_op_B + SumOP_B),"Б");
       [│       │                      │       ├─────────────┼──────────────────────┼──────────────────────┼──────────────────────┼──────┤];
	tabl.printStringTransferByWord("","","",kolOP_E,sumRRF_op_E,SumOP_E,string(sumRRF_op_E + SumOP_E),"Э");
	tabl.printseparator();
	       KolOP_B = 0; SumOP_B = $0; SumRRF_OP_B = $0;KolOP_E = 0; SumOP_E = $0; SumRRF_OP_E = $0;
		oper2 = oper1;		
		otdel2= otdel1;
	end;	
  if((substr(data.value("AccKr"),14,5) == "21010") or (substr(data.value("AccKr"),14,5) == "22010") or (substr(data.value("AccDeb"),14,5) == "21010") or (substr(data.value("AccDeb"),14,5) == "22010") or (data.value("T_RESULT_CARRY") == 18))
      if(Vid_HranS == "Б")
     kolOP_B = kolOP_B + 1;KolP_B = KolP_B + 1;Kol_B = Kol_B + 1; SumRRF_op_B = SumRRF_op_B + data.value("Sum"); SumRRF_p_B = SumRRF_p_B + data.value("Sum"); SumRRF_B = SumRRF_B + data.value("Sum");
      else
     kolOP_E = kolOP_E + 1;KolP_E = KolP_E + 1;Kol_E = Kol_E + 1; SumRRF_op_E = SumRRF_op_E + data.value("Sum"); SumRRF_p_E = SumRRF_p_E + data.value("Sum"); SumRRF_E = SumRRF_E + data.value("Sum");
      end;
  else
      if(Vid_HranS == "Б")
     kolOP_B = kolOP_B + 1;KolP_B = KolP_B + 1;Kol_B = Kol_B + 1; sumOP_B = sumOP_B + data.value("Sum"); sumP_B = sumP_B + data.value("Sum"); sum_B = sum_B + data.value("Sum");
      else
     kolOP_E = kolOP_E + 1;KolP_E = KolP_E + 1;Kol_E = Kol_E + 1; sumOP_E = sumOP_E + data.value("Sum"); sumP_E = sumP_E + data.value("Sum"); sum_E = sum_E + data.value("Sum");
      end;
  end;

      end;
oper2 = oper1;
	tabl.printStringTransferByWord(oper2,GetOperName(Oper2),"1000",kolOP_B,sumRRF_op_B,SumOP_B,string(sumRRF_op_B + SumOP_B),"Б");
       [│       │                      │       ├─────────────┼──────────────────────┼──────────────────────┼──────────────────────┼──────┤];
	tabl.printStringTransferByWord("","","",kolOP_E,sumRRF_op_E,SumOP_E,string(sumRRF_op_E + SumOP_E),"Э");
        KolOP_B = 0; SumOP_B = $0; SumRRF_OP_B = $0;KolOP_E = 0; SumOP_E = $0; SumRRF_OP_E = $0;
       end;	
                                                                                   
/* ==>> */	if((kontr == 1) and (otchetbank))
        Select = select+
"          order by a.t_oper, t_paymentid, AccDeb, SUM                                                                                      ";
debugbreak;
debugbreak;
	Data = ExecSQLSelect(Select);
	  while (data.movenext())
                paymentID1 = data.value("t_paymentid"); 
		oper1 = data.value("t_oper");
		otdel1 = data.value("otdel");
                StoreKind = data.value("vid_hran");
               if(StoreKind != 0)
                StoreKind = 1;
               end;
                Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
           if (Flag_pechati_provodkiS == 1)
/*-------------------------------------------------------------------------------------------------------------------------------*/
  if (paymentID1 != paymentID2)
     paymentID2 = paymentID1;
    if(oper1 == oper2)
	tabl.printseparator();
    end;	
  end;
/*-------------------------------------------------------------------------------------------------------------------------------*/
              if (oper1 != oper2)
		tabl.printbottom();
		[  всего документов  ####### на сумму (в рублях РФ) ################# Итого в валюте РФ #################
		                                      (в рубл. экв) #################
		  ___________________________________#################################################################################

		] (kolOP,string(SumRRF_op),string(sumOP + SumRRF_op),string(sumOP),GetOperName(oper2));

	    if (otdel1 != otdel2)      /*следующий отдел отдел*/
                [Всего документов по подразделению ####### на сумму (в рублях РФ) ################# Итого в валюте РФ #################
		                                                    (в рубл. экв) #################   

                ](int(kolp),string(sumRRF_p),string(SumP + sumRRF_p),string(SumP));

	        [  ____________________________________________________________________________

	        Руководитель подразделения    ############################### __________________ 

	        Контролёр                     ############################### __________________ 
                                                                         
	        Отчет подготовил              ############################### __________________ 

	        ]      (HeaderName, ControlName, getShortName(GetOperName({oper})));
                SumP = $0; kolP = 0; SumRRF_p = $0; 
		otdel2 = otdel1;
            end;
		SumOP = $0; kolOP = 0; SumRRF_op = $0;
		tabl = ctablereport();
	Tabl.addcolumn("№ Док.",10,AL_RIGHT);        tabl.addcolumn("Счет дебет",20,AL_CENTER);        tabl.addcolumn("Счет кредит",20,AL_CENTER); 
	tabl.addcolumn("Сумма Дт",14,AL_right);      tabl.addcolumn("Валюта|дебет",5,AL_CENTER);       tabl.addcolumn("Сумма Кт",14,AL_right);
	tabl.addcolumn("Валюта|кредит",5,AL_CENTER); tabl.addcolumn("Сумма в|валюте РФ",14,AL_right);  tabl.addcolumn("Шифр|/вид",4,AL_CENTER);
	tabl.addcolumn("Опер",4,AL_CENTER);          tabl.addcolumn("Основание",50,AL_LEFT);           tabl.addcolumn("Вид|хр",3,AL_CENTER);
		tabl.printhead("отдел "+ data.value("otdel") + " \n"+data.value("t_Oper") + " " + GetOperName(data.Value("t_oper")));
		oper2 = oper1;		
	      end;
/*-------------------------------------------------------------------------------------------------------------*/
//  if((substr(data.value("AccKr"),1,5) == "70601") or (substr(data.value("AccKr"),1,5) == "70606") or (substr(data.value("AccDeb"),1,5) == "70601") or (substr(data.value("AccDeb"),1,5) == "70606"))
  if((substr(data.value("AccKr"),14,5) == "21010") or (substr(data.value("AccKr"),14,5) == "22010") or (substr(data.value("AccDeb"),14,5) == "21010") or (substr(data.value("AccDeb"),14,5) == "22010"))
     tabl.printStringTransferByWord(data.value("NumDoc"), data.value("AccDeb"), data.value("AccKr"), "-", "-", "-", "-", data.value("Sum"), data.value("Sh"), data.value("t_Oper"), data.value("Ground"), vid_hranS); 
     kolOP = kolOP + 1;KolP = KolP + 1;Kol = Kol + 1; SumRRF_op = SumRRF_op+ data.value("Sum"); SumRRF_p = SumRRF_p+ data.value("Sum");SumRRF = SumRRF+ data.value("Sum");
  else
счет_кредит = data.value("AccKr");
счет_дебет  = data.value("AccDeb");
if(data.value("t_paymentid"))
платеж = data.value("t_paymentid");
else
платеж = 0;
end;
сумма = data.value("Sum");
//poluchenie_summ_v_valute(счет_дебет,счет_кредит, платеж, сумма, сумма_дебет, валюта_дебет, сумма_кредит, валюта_кредит);
           сумма_дебет   = checkZeroSum(data.value("T_SUM_PAYER"),платеж,true);
           валюта_дебет  = data.value("find"); 
           сумма_кредит  = checkZeroSum(data.value("T_SUM_RECEIVER"),платеж,false); 
           валюта_кредит = data.value("finc");
     tabl.printStringTransferByWord(data.value("NumDoc"), data.value("AccDeb"), data.value("AccKr"), сумма_дебет, валюта_дебет, сумма_кредит, валюта_кредит/* сумма_дебет, валюта_дебет, data.value("Sum"), data.value("t_ccy")*/, data.value("Sum"), data.value("Sh"), data.value("t_Oper"), data.value("Ground"), vid_hranS); 
     kolOP = kolOP + 1;KolP = KolP + 1;Kol = Kol + 1; sumOP = sumOP + data.value("Sum"); sumP = sumP + data.value("Sum"); sum = sum + data.value("Sum");
  end;
  end;
 end; /*while*/
/* ==>> */end;
/* ==>> */if((kontr == 3) and (otchetbank))
        Select = select+
"          order by a.t_oper, t_paymentid, a.numdoc, AccDeb, SUM                                                                                      ";
	Data = ExecSQLSelect(Select);
	Tabl.addcolumn("№ Док.",10,AL_RIGHT);    tabl.addcolumn("Счет дебет",20,AL_CENTER);        tabl.addcolumn("Счет кредит",20,AL_CENTER); 
	tabl.addcolumn("Сумма Дт",10,AL_right);  tabl.addcolumn("Вал|Дт.",3,AL_CENTER);            tabl.addcolumn("Сумма Кт",10,AL_right);
	tabl.addcolumn("Вал|Кт.",5,AL_CENTER);   tabl.addcolumn("Сумма в|валюте РФ",14,AL_right);  tabl.addcolumn("Основание",50,AL_LEFT);
	tabl.addcolumn("Шифр|/вид",5,AL_CENTER); tabl.addcolumn("Опер",10,AL_CENTER);              tabl.addcolumn("Отдел",6,AL_CENTER);
	tabl.addcolumn("Вид|хр",3,AL_CENTER);
	tabl.printhead;
    while(data.movenext())	
        paymentID1 = data.value("t_paymentid"); 
               if(StoreKind != 0)
                StoreKind = 1;
               end;
                Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
           if (Flag_pechati_provodkiS == 1)
	if ((paymentID1 != paymentID2) and (paymentID2 != ""))
        paymentID2 = paymentID1;
	tabl.printseparator();
	end;
//  if((substr(data.value("AccKr"),1,5) == "70601") or (substr(data.value("AccKr"),1,5) == "70606") or (substr(data.value("AccDeb"),1,5) == "70601") or (substr(data.value("AccDeb"),1,5) == "70606"))
  if((substr(data.value("AccKr"),14,5) == "21010") or (substr(data.value("AccKr"),14,5) == "22010") or (substr(data.value("AccDeb"),14,5) == "21010") or (substr(data.value("AccDeb"),14,5) == "22010"))
     tabl.printStringTransferByWord(data.value("NumDoc"), data.value("AccDeb"), data.value("AccKr"), "-", "-", "-", "-", data.value("Sum"), data.value("Ground"), data.value("Sh"), string(data.value("t_Oper") + " " + GetOperName(data.value("t_Oper"))),"1000", vid_hranS); 
     kolOP = kolOP + 1;KolP = KolP + 1;Kol = Kol + 1; SumRRF_op = SumRRF_op+ data.value("Sum"); SumRRF_p = SumRRF_p+ data.value("Sum");SumRRF = SumRRF+ data.value("Sum");
  else
счет_кредит = data.value("AccKr");
счет_дебет  = data.value("AccDeb");
if(data.value("t_paymentid"))
платеж = data.value("t_paymentid");
else
платеж = 0;
end;
сумма = data.value("Sum");
//poluchenie_summ_v_valute(счет_дебет,счет_кредит, платеж, сумма, сумма_дебет, валюта_дебет, сумма_кредит, валюта_кредит);
           сумма_дебет   = checkZeroSum(data.value("T_SUM_PAYER"),платеж,true);
           валюта_дебет  = data.value("find"); 
           сумма_кредит  = checkZeroSum(data.value("T_SUM_RECEIVER"),платеж,false); 
           валюта_кредит = data.value("finc");
     tabl.printStringTransferByWord(data.value("NumDoc"), data.value("AccDeb"), data.value("AccKr"), сумма_дебет, валюта_дебет, сумма_кредит, валюта_кредит, data.value("Sum"), data.value("Ground"), data.value("Sh"), data.value("t_Oper"),"1000",vid_hranS);
     kolOP = kolOP + 1;KolP = KolP + 1;Kol = Kol + 1; sumOP = sumOP + data.value("Sum"); sumP = sumP + data.value("Sum"); sum = sum + data.value("Sum");
  end;
       end;
    end; /*while*/
/* ==>> */end;
        if (flag_pechati_GetOperName==1)
          if(kontr == 1)
//     tabl.printStringTransferByWord(номер_документа, счет_дебет, счет_кредит, сумма_дебет, валюта_дебет, сумма_кредит, валюта_кредит, сумма_в_рублях, шифр_документа, операционист, основание);     
//     kolOP = kolOP + 1;KolP = KolP + 1;Kol = Kol + 1;sumOP = sumOP + money(сумма_в_рублях); sumP = sumP + money(сумма_в_рублях);sum = sum + money(сумма_в_рублях);
          elif(kontr == 3)
//     tabl.printStringTransferByWord(номер_документа, счет_дебет, счет_кредит, сумма_дебет, валюта_дебет, сумма_кредит, валюта_кредит, сумма_в_рублях,  основание, шифр_документа, операционист, отдел, вид_хранения);
//     kolOP = kolOP + 1;KolP = KolP + 1;Kol = Kol + 1;sumOP = sumOP + money(сумма_в_рублях); sumP = sumP + money(сумма_в_рублях);sum = sum + money(сумма_в_рублях);
          elif(kontr == 2)
debugbreak;
debugbreak;
//          if(vid_hranS == "Б")
//	tabl.printStringTransferByWord(oper2,GetOperName(Oper2),otdel1,kolOP_B,sumRRF_op_B,SumOP_B,string(sumRRF_op_B + SumOP_B),"Б");
//       [│       │                      │       ├─────────────┼──────────────────────┼──────────────────────┼──────────────────────┼──────┤];
//	tabl.printStringTransferByWord("","","",kolOP_E,sumRRF_op_E,SumOP_E,string(sumRRF_op_E + SumOP_E),"Э");
if(kontr != 2)
	tabl.printStringTransferByWord(oper2,GetOperName(Oper2),kolOP,sumRRF_op,SumOP,string(sumRRF_op + SumOP),ViD_HranS);
end;
          end;
             if(kontr ==3)
        if (VidHranS != "Бумажный")
		tabl.printbottom();
        end;
	end;	
	end;
                tabl = ctablereport();

	if((flag_pechati_GetOperName==1) and (kontr == 1)/* and (OperSelect == 0)*/)
  if (VidHranS == "Бумажный")
[├────────────┴──────────────────────┴──────────────────────┴────────────────┴────────┴────────────────┴────────┼────────────────┼──────┼──────┼────────────────────────────────────────────────────┼─────┤
 │ Итого по операционисту ################### документов бумажного вида: ######                                 │ ############## │      │      │                                                    │  Б  │
 └──────────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────────────┴──────┴──────┴────────────────────────────────────────────────────┴─────┘](
                          GetShortName(GetOperName(oper2)),kolOP,sumOP + SumRRF_op);
  elif(VidHranS == "Электронно")
[├────────────┴──────────────────────┴──────────────────────┴────────────────┴────────┴────────────────┴────────┼────────────────┼──────┼──────┼────────────────────────────────────────────────────┼─────┤
 │ Итого по операционисту ################### документов электронного вида: ######                              │ ############## │      │      │                                                    │  Э  │
 └──────────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────────────┴──────┴──────┴────────────────────────────────────────────────────┴─────┘](
                          GetShortName(GetOperName(oper2)),kolOP,sumOP + SumRRF_op);
  else
[├────────────┴──────────────────────┴──────────────────────┴────────────────┴────────┴────────────────┴────────┼────────────────┼──────┼──────┼────────────────────────────────────────────────────┼─────┤
 │ Итого по операционисту ################### документов (Б+Э) вида: ######                                     │ ############## │      │      │                                                    │ Б+Э │
 └──────────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────────────┴──────┴──────┴────────────────────────────────────────────────────┴─────┘](
                          GetShortName(GetOperName(oper2)),kolOP,sumOP + SumRRF_op);
  end;
/*		[  всего документов  ####### на сумму (в рублях РФ) ################# Итого в валюте РФ #################
		                                      (в рубл. экв) #################   

		](kolOP,string(SumRRF_op),string(sumOP + SumRRF_op),string(sumOP),GetOperName(oper2));*/
if(operselect == 0)
	  [___________________________________#################################################################################](GetOperName(oper2));
	[             ];
end;
	end;
if((kontr == 1) and (operselect))

		[  всего по операционисту ______________ #################### документов:
                                          бумажного вида    ###### на сумму (в рублях РФ) #################  Итого в валюте РФ #################
		                                                            (в рубл. экв) #################   
                                          электронного вида ###### на сумму (в рублях РФ) #################  Итого в валюте РФ #################
		                                                            (в рубл. экв) #################   
                                          Всего документов  ###### на сумму (в рублях РФ) #################  Итого в валюте РФ #################
		                                                            (в рубл. экв) #################   		 
		](GetShortName(GetOperName(Oper2)),kolOP_B,SumRRF_op_B,SumRRF_op_B+sumOP_B,sumOP_B,kolOP_E,SumRRF_op_E,SumRRF_op_E+sumOP_E,sumOP_B, 
                  kolOP_B+kolOP_E,SumRRF_op_B+SumRRF_op_E,SumRRF_op_B+SumRRF_op_E+sumOP_B+sumOP_E,sumOP_B+sumOP_E);
end;
if(kontr == 2)
NumOtdel1 = "";
if(NumOtdel != "")NumOtdel1 = NumOtdel + "." + NumPodOtdel end; 
      [├───────┴──────────────────────┴───────┼─────────────┼──────────────────────┼──────────────────────┼──────────────────────┼──────┤];
      [│                                      │############ │   ################## │   ################## │   ################## │  Б   │](int(kolp_B),sumRRF_p_B,SumP_B,sumRRF_p_B+SumP_B);
      [│ ИТОГО ПО ПОДРАЗДЕЛЕНИЮ #####         ├─────────────┼──────────────────────┼──────────────────────┼──────────────────────┼──────┤](NumOtdel1);
      [│    (по видам хранения)               │############ │   ################## │   ################## │   ################## │  Э   │](int(kolp_E),sumRRF_p_E,SumP_E,sumRRF_p_E+SumP_E);
      [└──────────────────────────────────────┴─────────────┴──────────────────────┴──────────────────────┴──────────────────────┴──────┘];
end;
if ((OperSelect == 0) and (kontr == 2))
                [Всего документов по отчету ####### на сумму    (в рублях РФ) ################# Итого в валюте РФ #################
		                                                (в рубл. экв) #################   

                ](int(kolp_B + kolp_E),string(sumRRF_p_B+sumRRF_p_E),string(SumP_B+ SumP_E + sumRRF_p_B + sumRRF_p_E),string(SumP_B + SumP_E));
elif((kontr != 1) or (operselect == 0))
                [Всего документов по отчету ####### на сумму    (в рублях РФ) ################# Итого в валюте РФ #################
		                                                (в рубл. экв) #################   

                ](int(kolp),string(sumRRF_p),string(SumP + sumRRF_p),string(SumP));
end;
if ((OperSelect == 0)or(kontr == 1))
  [________________________________________________________________________________

   Руководитель подразделения    ############################### __________________ 

   Контролёр                     ############################### __________________ 
                                                                         
   Отчет подготовил              ############################### __________________ 
  ](HeaderName, ControlName, getShortName(GetOperName({oper})));

	if((kontr == 1) and (otchetbank))
  [
     ____________________________________________________________________________

     Всего документов по банку ####### на сумму (в рублях РФ) ################# Итого в валюте РФ #################
                                                (в рубл. экв) #################   

  ](int(kol),string(sumRRF),string(Sum + sumRRF),string(Sum));
  [  ____________________________________________________________________________

      Главный бухгалтер_________________________________

      Контролер____________________________

      Отчет подготовил  #############################################################]
      (getShortName(GetOperName({oper})));
        end;                               
end;
end;

MACRO report_vnesh_doc_rub(Mode:string,operselect:integer,otchetbank:bool,VidHran:string,glava:integer)
//msgbox("report_vnesh_doc_rub");
    var tabl=ctablereport(), type_report:string="";                                                        /* ------------------------------------------------------------------------ */
    var Select, select_oper, Data, StoreKind, razdelS,Data_BIC,Select_BIC,BIC_our_Bank;                    /* otchetbank:false - по подразделению, true - по банку                     */
    var Kol, Sum, KolP, SumP, Op, Office, podrazdel,kolOP, sumOP, SumRub;                                                                              
    var oper1, oper2, Oper_New, flag_pechati_GetOperName, Vid_Hran, Vid_HranS, Flag_pechati_provodkiS;   
    var OperuKol, NostroKol, MfrKol, ProchieKol, OperuSum, NostroSum, MfrSum, ProchieSum;
    var Select_otdel, Data_otdel,otdel, chapter,pechat_hran,pechat_val,paymid;

	OperuKol   = 0;
	NostroKol  = 0;
        MfrKol     = 0;
	ProchieKol = 0;
	OperuSum   =$0;
	NostroSum  =$0;	
	MfrSum     =$0;
	ProchieSum =$0;
        chapter = glava;

    if  (VidHranS == "Бумажный")
       pechat_hran = "на документы бумажного вида хранения";
    elif(VidHranS == "Электронно")
       pechat_hran = "на документы электронного вида хранения";
    elif(VidHranS == "Электр+Бум")
       pechat_hran = "на документы бумажного+электронного вида хранения";
    end;

    if(valuta_otchetaS == "Рубли")
       pechat_val = "в рублях РФ"
    elif(valuta_otchetaS == "Валюта") 
       pechat_val = "в иностранной валюте"
    end;
    if(otchetbank)
	[ ##########################

        	                 РЕЕСТР   ВНЕШНИХ   ПЛАТЕЖЕЙ
        	                  ####################
        	                    ПО ОПЕРАЦИЯМ БАНКА
		        #################################################]({Name_Bank},pechat_val,pechat_hran);
       if (pachkaS != "") 
          [
                                по номерам пачек:  #](pachkaS);
       end;
        [
            	                 за  ##########
        
          Отчет: ###################################################################

	]  (DateDocum,Mode);
    else	
	[ ##########################

        	                 РЕЕСТР   ВНЕШНИХ   ПЛАТЕЖЕЙ
        	                        ####################
        	 ПО ОПЕРАЦИЯМ ПОДРАЗДЕЛЕНИЯ: ##################################################################
		        #################################################]({Name_Bank},pechat_val, NameDepart,pechat_hran);
       if (pachkaS != "") 
           [
                                 по номерам пачек:  #](pachkaS);
       end;
        [
            	                 за  ##########

          Отчет: ###################################################################
        ]  (DateDocum,Mode);
    end;


	[┌────────────┬─────────────────────────────────────────────┬─────────────────────────────────────┬────────┬──────┬───────────────────────────────────┬──────────────────────────────────────────┬────────┬────────┬─────┐
	 │ № докум.   │     Корреспонденция счетов в балансе        │      Реквизиты корреспондента       │ Вид    │ Код  │          Сумма операции           │                                          │ № Опер │ № Подр │ Вид │
	 │	      │ 	                                    │      плательщика/получателя         │ отчета │ ВАл. │                                   │      Назначение платежа документа        │        │        │ Хр. │
	 │            ├──────────────────────┬──────────────────────┼──────────────┬──────────────────────┤        │      ├────────────────┬──────────────────┤                                          │        │        │     │
         │            │  Счет Дт.            │      Счет Кт.        │ Бик банка    │     Счет             │        │      │ Сумма в валюте │  Сумма руб экв   │                                          │        │        │     │
         │            │                      │                      │              │                      │        │      │  операции      │                  │                                          │        │        │     │
	 ├────────────┼──────────────────────┼──────────────────────┼──────────────┼──────────────────────┼────────┼──────┼────────────────┼──────────────────┼──────────────────────────────────────────┼────────┼────────┼─────┤
	];
	tabl.addcolumn("",10,AL_CENTER); tabl.addcolumn("",20,AL_CENTER); tabl.addcolumn("",20,AL_CENTER); 
	tabl.addcolumn("",12,AL_CENTER); tabl.addcolumn("",20,AL_CENTER); tabl.addcolumn("",6,AL_CENTER);
	tabl.addcolumn("",4,AL_CENTER);  tabl.addcolumn("",14,AL_right);  tabl.addcolumn("",16,AL_right); 
        tabl.addcolumn("",40,AL_CENTER); tabl.addcolumn("",6,AL_CENTER);  tabl.addcolumn("",6,AL_CENTER); tabl.addcolumn("",3,AL_CENTER);

    Select_BIC = " select dcode.t_code BIC from dobjcode_dbt dcode, ddp_dep_dbt ddp "+
                 "  where dcode.t_objectid = ddp.T_PARTYID                          "+
                 "    and ddp.T_PARENTCODE = 0 "; 
    if (Mode == "Баланс - Рубли - Внешние документы")
       select_BIC = select_BIC + " and dcode.T_CODEKIND = 3";
    elif (Mode == "Баланс - Валюта - Внешние документы")
       select_BIC = select_BIC + " and dcode.T_CODEKIND = 6";
    end;
    Data_BIC = ExecSQLSelect(Select_BIC);
    Data_BIC.movenext;
    BIC_our_Bank = data_BIC.value("BIC");

    select = "";
    select = select +        
" select distinct a.numdoc, a.accdeb, a.acckr, a.Kor_acc_pay, a.Kor_acc_rec, a.t_oper, a.sum, a.sumRUR, a.t_ccy, a.T_FIID_PAYER, a.GROUND, a.BIC_pay, a.BIC_rec, a.DbCr, a.CS, a.t_paymentid, (SELECT storekind "+ "\n" +
"               FROM TABLE (user_ea.get_dev_prop (a.dockind,a.origin,a.paymkind,a.shifr_oper,a.numb_pack,a.chapter,a.t_typedocument,a.accdeb,a.T_FIID_PAYER,a.acckr,a.T_FIID_RECEIVER,NULL))) vid_hran, appkey   "+ "\n" +                           
"    from(            SELECT DISTINCT arh.t_oper, arh.t_numb_document AS numdoc, arh.T_SUM_PAYER SUM,                                                      "+ "\n" +                           
"                                arh.t_account_payer AS accdeb,arh.t_account_receiver AS acckr,paym.T_RECEIVERACCOUNT AS Kor_acc_rec,paym.T_PAYERACCOUNT AS Kor_acc_pay,arh.T_SUM_NATCUR AS sumRUR, pm.T_CORSCHEM CS,  "+ "\n" +
"                                arh.t_shifr_oper || '/' || t_kind_oper sh,arh.t_ground AS ground,arh.T_ACCTRNID appkey,arh.t_typedocument,paym.t_paymentid,arh.T_FIID_RECEIVER,                                 "+ "\n" +                           
"                                dfininstr_dbt.t_ccy, arh.T_FIID_PAYER,prop.t_paymentkind paymkind,user_ea.GetOrigin ( paym.t_dockind, paym.t_paymentid) origin,arh.t_chapter chapter,pm.T_DEBETCREDIT DbCr,    "+ "\n" +                           
"                                paym.t_dockind dockind,dcode1.T_CODE BIC_pay,dcode2.T_CODE BIC_rec,arh.t_number_pack numb_pack,arh.t_shifr_oper shifr_oper,paym.t_fiid cred_fiid,paym.t_payfiid deb_fiid           "+ "\n" +
"                           FROM dacctrn_dbt arh, dpmdocs_dbt docs,dpmpaym_dbt paym,                                                                                             "+ "\n" +                           
"                                dfininstr_dbt,dobjcode_dbt dcode1,dobjcode_dbt dcode2,dpmrmprop_dbt prop,dpmprop_dbt pm,dpmprop_dbt pm1                                         "+ "\n" ;                           
       if (Mode == "Баланс - Рубли - Внешние документы")
          select = select +                                                                                                                                                     
"                          WHERE dcode1.T_CODEKIND = 3                                                                                                                           "+ "\n" +
"                                and dcode2.T_CODEKIND = 3                                                                                                                       "+ "\n" +
"                                AND SUBSTR (arh.t_account_payer, 6, 3) = '810' 		                                                                                 "+ "\n" +
"                                AND SUBSTR (arh.t_account_receiver, 6, 3)  = '810' 		                                                                                 "+ "\n" ;
     elif (Mode == "Баланс - Валюта - Внешние документы")
          select = select +        
"                          WHERE dcode1.T_CODEKIND = 6                                                                                                                           "+ "\n" +
"                                and dcode2.T_CODEKIND = 6                                                                                                                       "+ "\n" +
"                                AND SUBSTR (arh.t_account_payer, 6, 3) = SUBSTR (arh.t_account_receiver, 6, 3)    		                                                 "+ "\n" +
"                                AND SUBSTR (arh.t_account_payer, 6, 3) <> '810' 		                                                                                 "+ "\n" +
"                                AND SUBSTR (arh.t_account_receiver, 6, 3) <> '810' 		                                                                                 "+ "\n" ;
      end;
          select = select +                                                                                                                                                       
"			         and (dcode1.T_BANKCLOSEDATE > to_date('" + DateDocum +"','DD.MM.YYYY') or dcode1.T_BANKCLOSEDATE = to_date('01.01.0001'))                      "+ "\n" +  /* 02.08.2013 joy I-00408066-2 Дата зыкрытия кода должна быть строго больше */
"			         and (dcode2.T_BANKCLOSEDATE > to_date('" + DateDocum +"','DD.MM.YYYY') or dcode2.T_BANKCLOSEDATE = to_date('01.01.0001'))                      "+ "\n" +  /* аналогично*/
"                                and dcode2.T_BANKDATE <= to_date('" + DateDocum +"','DD.MM.YYYY')                                                                               "+ "\n" +
"                                and dcode1.T_BANKDATE <= to_date('" + DateDocum +"','DD.MM.YYYY')                                                                               "+ "\n" +
"                                and arh.t_date_carry = to_date('" + DateDocum +"','DD.MM.YYYY')                                                                                 "+ "\n" +
"                                AND dfininstr_dbt.t_fiid = arh.T_FIID_PAYER                                                                                                     "+ "\n" +                           
"                                AND dcode1.t_objectid = paym.T_PAYERBANKID                                                                                                      "+ "\n" +                           
"                                AND dcode2.t_objectid = paym.T_RECEIVERBANKID                                                                                                   "+ "\n" +                           
"                                AND ARH.t_STATE = 1                                                                                                                             "+ "\n" + //GSP 28.04.2014
"                                AND arh.t_chapter = " + chapter                                                                                                                  + "\n" ;
if (pachkaS != "")
          select = select +                                                                                                                                                       
"                                AND arh.T_NUMBER_PACK in (" + pachkaS + ") "                                                                                                     + "\n" ; //GSP по C-17070
end;
          select = select +                                                                                                                                                       
"                                AND arh.T_ACCTRNID = docs.T_ACCTRNID(+)                                                                                                         "+ "\n" +
"                                AND docs.t_paymentid = paym.t_paymentid                                                                                                         "+ "\n" +
"                                AND paym.t_paymentid = prop.t_paymentid                                                                                                         "+ "\n" +
"                                AND paym.t_paymentid = pm.t_paymentid                                                                                                           "+ "\n" +
"                                AND paym.t_paymentid = pm1.t_paymentid                                                                                                          "+ "\n" +
"                                AND pm.t_paymentid = pm1.t_paymentid                                                                                                            "+ "\n" +
"                                AND SUBSTR (arh.t_account_payer, 1, 5) NOT IN ('20202', '20203', '20207')                                                                       "+ "\n" +
"                                AND SUBSTR (arh.t_account_receiver, 1, 5) NOT IN ('20202', '20203', '20207')                                                                    "+ "\n" +
"                                and pm.T_GROUP = 1                                                                                                                              "+ "\n" +
"                                and pm.T_DEBETCREDIT = 0                                                                                                                        "+ "\n" +
"                                and pm1.T_GROUP <> 1                                                                                                                            "+ "\n" +
"                                and pm1.T_DEBETCREDIT = 1                                                                                                                       "+ "\n" +
"                                ) a                                                                                                                                             "+ "\n" ;
    if(not(otchetbank))
        Select = select+
",(select * from DOP_OTDEL_DBT where (T_oper,t_datebegin) in (select T_oper,max(t_datebegin) t_datebegin                              "+                    
"                   from DOP_OTDEL_DBT where t_datebegin<=TO_DATE ('"+ DateDocum + "', 'DD.MM.YYYY')                                                 "+
"                        and (t_dateend >= TO_DATE ('"+ DateDocum + "', 'DD.MM.YYYY') OR t_dateend  = TO_DATE ('01.01.0001', 'DD.MM.YYYY'))                "+                                                                 
"                        group by T_oper)) DOP_OTDEL_DBT                                                                                             "+
"          where dop_otdel_dbt.T_CODE1 = "+ NumOtdel  +
"            AND a.t_oper = dop_otdel_dbt.t_oper     "; 
    if(NumPodOtdel !=0)
        Select = select+
"            and dop_otdel_dbt.T_CODE2 = "+ NumPodOtdel;
    end;
    end;
        Select = select+
"			ORDER BY a.t_oper, a.sum                                                                                                                        "+ "\n" ;
	Data = ExecSQLSelect(Select);
//debugbreak;
//debugbreak;                                                                                                                  
    [├────────────┴──────────────────────┴──────────────────────┴──────────────┴──────────────────────┴────────┴──────┴────────────────┴──────────────────┴──────────────────────────────────────────┴────────┴────────┴─────┤];
    [│    Входящие документы                                                                                                                                                                                                 │];
    [├────────────┬──────────────────────┬──────────────────────┬──────────────┬──────────────────────┬────────┬──────┬────────────────┬──────────────────┬──────────────────────────────────────────┬────────┬────────┬─────┤];
    while(data.movenext())
       StoreKind = data.value("vid_hran");
       paymid = data.value("t_paymentid");
       if(StoreKind != 0)
          StoreKind = 1;                                                                                	
       end;
       StoreKind = kateg_vid_hran(paymid,StoreKind,chapter);
       Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
       if(Flag_pechati_provodkiS == 1)
          razdelS = opredelenie_razdela_vneshnih(data.value("accdeb"),data.value("acckr"),data.value("CS"));
          if(otchetbank)
             Select_otdel = "Select t_code1,t_code2 from dop_otdel_dbt                                   "+ 
                            " where t_oper = "+ data.value("t_oper")                                      +
                            "   and (DOP_OTDEL_DBT.t_dateend >=to_date('"+ DateDocum + "','DD.MM.YYYY')  "+
                            "    or t_dateend = to_date('01.01.0001','DD.MM.YYYY'))                      "+
                            "   and t_datebegin <=to_date('"+ DateDocum + "','DD.MM.YYYY')               ";                     
             Data_otdel = ExecSQLSelect(Select_otdel);
             if(Data_otdel.movenext())
                otdel = Data_otdel.value("t_code1") + "." +  Data_otdel.value("t_code2");
             else
                otdel = "1000";     
             end;
          end;
          tabl.printseparator();
          if(Mode == "Баланс - Рубли - Внешние документы")
             tabl.printStringTransferByWord(data.value("numdoc"),
                                            data.value("accdeb"),
                                            data.value("acckr"),
                                            data.value("bic_pay"),
                                            data.value("kor_acc_pay"),
                                            razdelS,
                                            data.value("t_ccy"),
                                            data.value("SumRUR"),
                                            " -      ",
                                            data.value("ground"),                        
                                            data.value("t_oper") + " " + GetShortName(GetOperName(data.value("t_oper"))),
                                            otdel,Vid_HranS);
          elif(Mode == "Баланс - Валюта - Внешние документы")
             tabl.printStringTransferByWord(data.value("numdoc"),
                                            data.value("accdeb"),
                                            data.value("acckr"),
                                            data.value("bic_pay"),
                                            data.value("kor_acc_pay"),
                                            razdelS,
                                            data.value("t_ccy"),
                                            data.value("sum"),
                                            data.value("SumRUR"),
                                            data.value("ground"),                        
                                            data.value("t_oper"),
                                            otdel,Vid_HranS);
          end;
          if(razdelS == "ОПЕРУ")
             OperuKol = OperuKol + 1;     OperuSum = OperuSum + data.value("SumRUR");
          elif(razdelS == "НОСТРО")
             nostroKol = NostroKol + 1;   NostroSum = NostroSum + data.value("SumRUR");
          elif(razdelS == "МФР")
             MfrKol = MfrKol + 1;         MfrSum = MfrSum + data.value("SumRUR");
          elif(razdelS == "ПРОЧИЕ")
             ProchieKol = ProchieKol + 1; ProchieSum = ProchieSum + data.value("SumRUR");
          end;
       end;
    end;
	

        select = "";
        select = select +        
" select distinct a.numdoc, a.accdeb, a.acckr, a.Kor_acc_pay, a.Kor_acc_rec, a.t_oper, a.sum, a.sumRUR, a.t_ccy, a.T_FIID_PAYER, a.GROUND, a.BIC_pay, a.BIC_rec, a.DbCr, a.CS, a.t_paymentid, (SELECT storekind      "+ "\n" +
"               FROM TABLE (user_ea.get_dev_prop (a.dockind,a.origin,a.paymkind,a.shifr_oper,a.numb_pack,a.chapter,a.t_typedocument,a.accdeb,a.T_FIID_PAYER,a.acckr,a.T_FIID_RECEIVER,NULL))) vid_hran,appkey      "+ "\n" +                           
"    from(            SELECT DISTINCT arh.t_oper, arh.t_numb_document AS numdoc, arh.T_SUM_NATCUR sumRUR,                                 "+ "\n" +                           
"                                arh.t_account_payer AS accdeb,arh.t_account_receiver AS acckr,paym.T_RECEIVERACCOUNT AS Kor_acc_rec,paym.T_PAYERACCOUNT AS Kor_acc_pay,arh.T_SUM_PAYER AS SUM, pm.T_CORSCHEM CS, "+ "\n" +
"                                arh.t_shifr_oper || '/' || t_kind_oper sh,arh.t_ground AS ground,arh.T_ACCTRNID appkey,arh.t_typedocument, paym.t_paymentid,               "+ "\n" +                           
"                                dfininstr_dbt.t_ccy, arh.T_FIID_PAYER, arh.T_FIID_RECEIVER,prop.t_paymentkind paymkind,user_ea.GetOrigin ( paym.t_dockind, paym.t_paymentid) origin,arh.t_chapter chapter,pm.T_DEBETCREDIT DbCr,         "+ "\n" +                           
"                                paym.t_dockind dockind,objcode.BIC_pay,objcode.BIC_rec,arh.t_number_pack numb_pack,arh.t_shifr_oper shifr_oper,paym.t_fiid cred_fiid,paym.t_payfiid deb_fiid   "+ "\n" +
"                           FROM dacctrn_dbt arh, dpmdocs_dbt docs,dpmpaym_dbt paym,/*daccount_dbt acc1,daccount_dbt acc2,dop_otdel_dbt,*/                                           "+ "\n" +                           
"                               /* dotdels_dbt*/dfininstr_dbt,dpmrmprop_dbt prop,dpmprop_dbt pm,dpmprop_dbt pm1,                             "+ "\n" ;                           
       if (Mode == "Баланс - Рубли - Внешние документы")
          select = select +                                                                                                                                                     
" (select o1.t_code BIC_rec,o2.t_code BIC_pay, p.T_PAYMENTID from dpmpaym_dbt p,     "+ "\n" +
"  (select * from dobjcode_dbt                                                       "+ "\n" +
"    where T_CODEKIND = 3                                                            "+ "\n" +
"      and (T_BANKCLOSEDATE >  '"+ DateDocum + "' or T_BANKCLOSEDATE = '01.01.0001') "+ "\n" + /* 02.08.2013 joy I-00408066-2 Дата зыкрытия кода должна быть строго больше */
"      and  T_BANKDATE <= '"+ DateDocum + "') o1,                                    "+ "\n" +
"  (select * from dobjcode_dbt                                                       "+ "\n" +
"    where T_CODEKIND = 3                                                            "+ "\n" +
"      and (T_BANKCLOSEDATE >  '"+ DateDocum + "' or T_BANKCLOSEDATE = '01.01.0001') "+ "\n" + /* 02.08.2013 joy I-00408066-2 Дата зыкрытия кода должна быть строго больше */
"      and  T_BANKDATE <= '"+ DateDocum + "') o2                                     "+ "\n" +
"   where p.T_RECEIVERbankid = o1.T_OBJECTID(+)                                      "+ "\n" +
"     and p.T_payerbankid = o2.T_OBJECTID(+)) objcode                                "+ "\n" +
"                              WHERE SUBSTR (arh.t_account_payer, 6, 3) = '810'      "+ "\n" +
"                                AND SUBSTR (arh.t_account_receiver, 6, 3)  = '810'  "+ "\n" ;
     elif (Mode == "Баланс - Валюта - Внешние документы")
          select = select +        
" (select o1.t_code BIC_rec,o2.t_code BIC_pay, p.T_PAYMENTID from dpmpaym_dbt p,     "+ "\n" +
"  (select * from dobjcode_dbt                                                       "+ "\n" +
"    where T_CODEKIND = 6                                                            "+ "\n" +
"      and (T_BANKCLOSEDATE >= '"+ DateDocum + "' or T_BANKCLOSEDATE = '01.01.0001') "+ "\n" +
"      and  T_BANKDATE <= '"+ DateDocum + "') o1,                                    "+ "\n" +
"  (select * from dobjcode_dbt                                                       "+ "\n" +
"    where T_CODEKIND = 6                                                            "+ "\n" +
"      and (T_BANKCLOSEDATE >= '"+ DateDocum + "' or T_BANKCLOSEDATE = '01.01.0001') "+ "\n" +
"      and  T_BANKDATE <= '"+ DateDocum + "') o2                                     "+ "\n" +
"   where p.T_RECEIVERbankid = o1.T_OBJECTID(+)                                      "+ "\n" +
"     and p.T_payerbankid = o2.T_OBJECTID(+)) objcode                                "+ "\n" +
"                          WHERE SUBSTR (arh.t_account_payer, 6, 3) = SUBSTR (arh.t_account_receiver, 6, 3) "+
"                            AND SUBSTR (arh.t_account_payer, 6, 3) <> '810'         "+ "\n" +
"                            AND SUBSTR (arh.t_account_receiver, 6, 3) <> '810'      "+ "\n" ;
      end;
          select = select +                                                                                                                                                       
"                                and arh.t_date_carry = to_date('" + DateDocum +"','DD.MM.YYYY')                                                              "+ "\n" +
"                                and objcode.t_paymentid = paym.t_paymentid                                                                                   "+ "\n" +
"                                AND dfininstr_dbt.t_fiid = arh.T_FIID_PAYER                                                                                  "+ "\n" +                           
"                                AND ARH.t_STATE = 1                                                                                                          "+ "\n" + //GSP 28.04.2014
"                                AND arh.t_chapter = "+ chapter                                                                                                + "\n" ;
if (pachkaS != "")
          select = select +                                                                                                                                                       
"                                AND arh.T_NUMBER_PACK in (" + pachkaS + ") "                                                                                                     + "\n" ; //GSP по C-17070
end;
          select = select +                                                                                                                                                       
"                                AND arh.T_ACCTRNID = docs.T_ACCTRNID(+)                                                                                      "+ "\n" +
"                                AND docs.t_paymentid = paym.t_paymentid                                                                                      "+ "\n" +
"                                AND paym.t_paymentid = prop.t_paymentid                                                                                      "+ "\n" +
"                                AND paym.t_paymentid = pm.t_paymentid                                                                                        "+ "\n" +
"                                AND paym.t_paymentid = pm1.t_paymentid                                                                                       "+ "\n" +
"                                AND pm.t_paymentid = pm1.t_paymentid                                                                                         "+ "\n" +
"                                AND SUBSTR (arh.t_account_payer, 1, 5) NOT IN ('20202', '20203', '20207')                                                    "+ "\n" +
"                                AND SUBSTR (arh.t_account_receiver, 1, 5) NOT IN ('20202', '20203', '20207')                                                 "+ "\n" +
"                                and pm.T_GROUP = 1                                                                                                           "+ "\n" +
"                                and pm.T_DEBETCREDIT = 1                                                                                                     "+ "\n" +
"                                and pm1.T_GROUP <> 1                                                                                                         "+ "\n" +
"                                and pm1.T_DEBETCREDIT = 0                                                                                                    "+ "\n" +
"                                ) a                                                                                                                          "+ "\n" ;
    if(not(otchetbank))
        Select = select+
",(select * from DOP_OTDEL_DBT where (T_oper,t_datebegin) in (select T_oper,max(t_datebegin) t_datebegin                              "+                    
"                   from DOP_OTDEL_DBT where t_datebegin<=TO_DATE ('"+ DateDocum + "', 'DD.MM.YYYY')                                                 "+
"                        and (t_dateend >= TO_DATE ('"+ DateDocum + "', 'DD.MM.YYYY') OR t_dateend  = TO_DATE ('01.01.0001', 'DD.MM.YYYY'))                "+                                                                 
"                        group by T_oper)) DOP_OTDEL_DBT                                                                                             "+
"          where dop_otdel_dbt.T_CODE1 = "+ NumOtdel  +
"            AND a.t_oper = dop_otdel_dbt.t_oper     "; 
    if(NumPodOtdel !=0)
        Select = select+
"            and dop_otdel_dbt.T_CODE2 = "+ NumPodOtdel;
    end;
    end;
        Select = select+
"			ORDER BY a.sum                                                                                                                        "+ "\n" ;
//debugbreak;
//debugbreak;
	Data = ExecSQLSelect(Select);

    [├────────────┴──────────────────────┴──────────────────────┴──────────────┴──────────────────────┴────────┴──────┴────────────────┴──────────────────┴──────────────────────────────────────────┴────────┴────────┴─────┤];
    [│    Исходящие документы                                                                                                                                                                                                │];
    [├────────────┬──────────────────────┬──────────────────────┬──────────────┬──────────────────────┬────────┬──────┬────────────────┬──────────────────┬──────────────────────────────────────────┬────────┬────────┬─────┤];
    while(data.movenext())
       StoreKind = data.value("vid_hran");
       paymid = data.value("t_paymentid");
       if(StoreKind != 0)
          StoreKind = 1;
       end;
       StoreKind = kateg_vid_hran(paymid,StoreKind,chapter);
       Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
       if(Flag_pechati_provodkiS == 1)
          razdelS = opredelenie_razdela_vneshnih(data.value("accdeb"),data.value("acckr"),data.value("CS"));
          if(otchetbank)
             Select_otdel = " Select t_code1,t_code2 from dop_otdel_dbt                                   "+ 
                            " where t_oper = "+ data.value("t_oper")                                      +
                            "   and (DOP_OTDEL_DBT.t_dateend >=to_date('"+ DateDocum + "','DD.MM.YYYY')  "+
                            "    or t_dateend = to_date('01.01.0001','DD.MM.YYYY'))                      "+
                            "   and t_datebegin <=to_date('"+ DateDocum + "','DD.MM.YYYY')               ";                     
             Data_otdel = ExecSQLSelect(Select_otdel);
             if(Data_otdel.movenext())
                otdel = Data_otdel.value("t_code1") + "." +  Data_otdel.value("t_code2");
             else
                otdel = "1000";     
             end;
          end;
          tabl.printseparator();
          if(Mode == "Баланс - Рубли - Внешние документы")
             tabl.printStringTransferByWord(data.value("numdoc"),
                                            data.value("accdeb"),
                                            data.value("acckr"),
                                            data.value("bic_rec"),
                                            data.value("kor_acc_rec"),
                                            razdelS,
                                            data.value("t_ccy"),
                                            data.value("SumRUR"),
                                            " -      ",
                                            data.value("ground"),                        
                                            data.value("t_oper"),
                                            otdel,Vid_HranS);
          elif(Mode == "Баланс - Валюта - Внешние документы")
             tabl.printStringTransferByWord(data.value("numdoc"),
                                            data.value("accdeb"),
                                            data.value("acckr"),
                                            data.value("bic_rec"),
                                            data.value("kor_acc_rec"),
                                            razdelS,
                                            data.value("t_ccy"),
                                            data.value("sum"),
                                            data.value("SumRUR"),
                                            data.value("ground"),                        
                                            data.value("t_oper"),
                                            otdel,Vid_HranS);
          end;
          if(razdelS == "ОПЕРУ")
             OperuKol = OperuKol + 1;     OperuSum = OperuSum + data.value("SumRUR");
          elif(razdelS == "НОСТРО")
             nostroKol = NostroKol + 1;   NostroSum = NostroSum + data.value("SumRUR");
          elif(razdelS == "МФР")
             MfrKol = MfrKol + 1;         MfrSum = MfrSum + data.value("SumRUR");
          elif(razdelS == "ПРОЧИЕ")
             ProchieKol = ProchieKol + 1; ProchieSum = ProchieSum + data.value("SumRUR");
          end;
       end;
    end;


Select = 
" select distinct a.numdoc, a.accdeb, a.acckr, a.Kor_acc_pay, a.Kor_acc_rec, a.t_oper, a.sum, a.sumRUR, a.t_ccy, a.T_FIID_PAYER, a.GROUND, a.BIC_pay, a.BIC_rec, a.DbCr, a.CS, a.t_paymentid, (SELECT storekind      "+ "\n" +
"               FROM TABLE (user_ea.get_dev_prop (a.dockind,a.origin,a.paymkind,a.shifr_oper,a.numb_pack,a.chapter,a.t_typedocument,a.accdeb,a.T_FIID_PAYER,a.acckr,a.T_FIID_RECEIVER,NULL))) vid_hran,appkey    "+ "\n" +                           
"    from(            SELECT DISTINCT /*dotdels_dbt.t_code1, dotdels_dbt.t_code2,dotdels_dbt.t_name AS name_otdel,*/arh.t_oper, arh.t_numb_document AS numdoc, arh.T_SUM_NATCUR sumRUR,                                      "+ "\n" +                           
"                                arh.t_account_payer AS accdeb,arh.t_account_receiver AS acckr,paym.T_RECEIVERACCOUNT AS Kor_acc_rec,paym.T_PAYERACCOUNT AS Kor_acc_pay,arh.T_SUM_PAYER AS SUM, pm.T_CORSCHEM CS,         "+ "\n" +
"                                arh.t_shifr_oper || '/' || t_kind_oper sh,arh.t_ground AS ground,arh.T_ACCTRNID appkey,arh.t_typedocument,paym.t_paymentid,                "+ "\n" +                           
"                                dfininstr_dbt.t_ccy, arh.T_FIID_PAYER, arh.T_FIID_RECEIVER,prop.t_paymentkind paymkind,user_ea.GetOrigin ( paym.t_dockind, paym.t_paymentid) origin,arh.t_chapter chapter,pm.T_DEBETCREDIT DbCr,    "+ "\n" +                           
"                                paym.t_dockind dockind,dcode1.T_CODE BIC_pay,dcode2.T_CODE BIC_rec,arh.t_number_pack numb_pack,arh.t_shifr_oper shifr_oper,paym.t_fiid cred_fiid,paym.t_payfiid deb_fiid           "+ "\n" +
"                           FROM dacctrn_dbt arh, dpmdocs_dbt docs,dpmpaym_dbt paym,                                                                             "+ "\n" +                           
"                                dfininstr_dbt,dobjcode_dbt dcode1,dobjcode_dbt dcode2,dpmrmprop_dbt prop,dpmprop_dbt pm,dpmprop_dbt pm1                         "+ "\n" ;                           
       if (Mode == "Баланс - Рубли - Внешние документы")
          select = select +                                                                                                                                                     
"                          WHERE dcode1.T_CODEKIND = 3                                                                                                                           "+ "\n" +
"                                and dcode2.T_CODEKIND = 3                                                                                                                       "+ "\n" +
"                                AND SUBSTR (arh.t_account_payer, 6, 3) = '810' 		                                                                                 "+ "\n" +
"                                AND SUBSTR (arh.t_account_receiver, 6, 3)  = '810' 		                                                                                 "+ "\n" ;
     elif (Mode == "Баланс - Валюта - Внешние документы")
          select = select +        
"                          WHERE dcode1.T_CODEKIND = 6                                                                                                                           "+ "\n" +
"                                and dcode2.T_CODEKIND = 6                                                                                                                       "+ "\n" +
"                                AND SUBSTR (arh.t_account_payer, 6, 3) = SUBSTR (arh.t_account_receiver, 6, 3)    		                                                 "+ "\n" +
"                                AND SUBSTR (arh.t_account_payer, 6, 3) <> '810' 		                                                                                 "+ "\n" +
"                                AND SUBSTR (arh.t_account_receiver, 6, 3) <> '810' 		                                                                                 "+ "\n" ;
      end;
          select = select +                                                                                                                                                       
"			         and (dcode1.T_BANKCLOSEDATE >= to_date('" + DateDocum +"','DD.MM.YYYY') or dcode1.T_BANKCLOSEDATE = to_date('01.01.0001'))                      "+ "\n" +
"			         and (dcode2.T_BANKCLOSEDATE >= to_date('" + DateDocum +"','DD.MM.YYYY') or dcode2.T_BANKCLOSEDATE = to_date('01.01.0001'))                      "+ "\n" +
"                                and dcode2.T_BANKDATE <= to_date('" + DateDocum +"','DD.MM.YYYY')                                                                               "+ "\n" +
"                                and dcode1.T_BANKDATE <= to_date('" + DateDocum +"','DD.MM.YYYY')                                                                               "+ "\n" +
"                                and arh.t_date_carry = to_date('" + DateDocum +"','DD.MM.YYYY')                                                                                 "+ "\n" +
"                                AND dfininstr_dbt.t_fiid = arh.T_FIID_PAYER                                                                                                  "+ "\n" +                           
"                                AND dcode1.t_objectid = paym.T_PAYERBANKID                                                                                                      "+ "\n" +                           
"                                AND dcode2.t_objectid = paym.T_RECEIVERBANKID                                                                                                   "+ "\n" +                           
"                                AND ARH.t_STATE = 1                                                                                                                             "+ "\n" + //GSP 28.04.2014
"                                AND arh.t_chapter = "+ chapter                                                                                                                   + "\n" ;
if (pachkaS != "")
          select = select +                                                                                                                                                       
"                                AND arh.T_NUMBER_PACK in (" + pachkaS + ") "                                                                                                     + "\n" ; //GSP по C-17070
end;
          select = select +                                                                                                                                                       
"                                AND arh.T_ACCTRNID = docs.T_ACCTRNID(+)                                                                                                         "+ "\n" +
"                                AND docs.t_paymentid = paym.t_paymentid                                                                                                         "+ "\n" +
"                                AND paym.t_paymentid = prop.t_paymentid                                                                                                         "+ "\n" +
"                                AND paym.t_paymentid = pm.t_paymentid                                                                                                           "+ "\n" +
"                                AND paym.t_paymentid = pm1.t_paymentid                                                                                                          "+ "\n" +
"                                AND SUBSTR (arh.t_account_payer, 1, 5) NOT IN ('20202', '20203', '20207')                                                                       "+ "\n" +
"                                AND SUBSTR (arh.t_account_receiver, 1, 5) NOT IN ('20202', '20203', '20207')                                                                    "+ "\n" +
"                                and pm.T_GROUP = 1                                                                                                                              "+ "\n" +
"                                and pm.T_DEBETCREDIT = 0                                                                                                                        "+ "\n" +
"                                and pm1.T_GROUP = 1                                                                                                                             "+ "\n" +
"                                and pm1.T_DEBETCREDIT = 1                                                                                                                       "+ "\n" +
"                                ) a                                                                                                                                             "+ "\n" ;
    if(not(otchetbank))
        Select = select+
//"                                ,dop_otdel_dbt"+
",(select * from DOP_OTDEL_DBT where (T_oper,t_datebegin) in (select T_oper,max(t_datebegin) t_datebegin                              "+                    
"                   from DOP_OTDEL_DBT where t_datebegin<=TO_DATE ('"+ DateDocum + "', 'DD.MM.YYYY')                                                 "+
"                        and (t_dateend >= TO_DATE ('"+ DateDocum + "', 'DD.MM.YYYY') OR t_dateend  = TO_DATE ('01.01.0001', 'DD.MM.YYYY'))                "+                                                                 
"                        group by T_oper)) DOP_OTDEL_DBT                                                                                             "+
"          where dop_otdel_dbt.T_CODE1 = "+ NumOtdel  +
"            AND a.t_oper = dop_otdel_dbt.t_oper     "; 
    if(NumPodOtdel !=0)
        Select = select+
"            and dop_otdel_dbt.T_CODE2 = "+ NumPodOtdel;
    end;
    end;

        Select = select+
"			ORDER BY a.sum "  + "\n" ;
	Data = ExecSQLSelect(Select);
//debugbreak;
//debugbreak;

    [├────────────┴──────────────────────┴──────────────────────┴──────────────┴──────────────────────┴────────┴──────┴────────────────┴──────────────────┴──────────────────────────────────────────┴────────┴────────┴─────┤];
    [│    Транзитные документы                                                                                                                                                                                               │];
    [├────────────┬──────────────────────┬──────────────────────┬──────────────┬──────────────────────┬────────┬──────┬────────────────┬──────────────────┬──────────────────────────────────────────┬────────┬────────┬─────┤];
    while(data.movenext())
       StoreKind = data.value("vid_hran");
       paymid = data.value("t_paymentid");
       if(StoreKind != 0)
          StoreKind = 1;
       end;
       StoreKind = kateg_vid_hran(paymid,StoreKind,chapter);
       Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
       if(Flag_pechati_provodkiS == 1)
          razdelS = opredelenie_razdela_vneshnih(data.value("accdeb"),data.value("acckr"),data.value("CS"));
          if(otchetbank)
             Select_otdel = " Select t_code1,t_code2 from dop_otdel_dbt                                   "+ 
                            "  where t_oper = "+ data.value("t_oper")                                      +
                            "    and (DOP_OTDEL_DBT.t_dateend >=to_date('"+ DateDocum + "','DD.MM.YYYY')  "+
                            "     or t_dateend = to_date('01.01.0001','DD.MM.YYYY'))                      "+
                            "    and t_datebegin <=to_date('"+ DateDocum + "','DD.MM.YYYY')               ";                     
             Data_otdel = ExecSQLSelect(Select_otdel);
             if(Data_otdel.movenext())
                otdel = Data_otdel.value("t_code1") + "." +  Data_otdel.value("t_code2");
             else
                otdel = "1000";     
             end;
          end;
          tabl.printseparator();
          SumRub = data.value("SumRUR");
          if(Mode == "Баланс - Рубли - Внешние документы")
             tabl.printStringTransferByWord(data.value("numdoc"),data.value("accdeb"),data.value("acckr"),string(data.value("bic_pay"))+"\n"+string(data.value("bic_rec")),string(data.value("kor_acc_pay"))+string(data.value("kor_acc_rec")),razdelS,
             data.value("t_ccy"), data.value("sum")," ",data.value("ground"),data.value("t_oper"),otdel,Vid_HranS);
          elif (Mode == "Баланс - Валюта - Внешние документы")
             tabl.printStringTransferByWord(data.value("numdoc"),data.value("accdeb"),data.value("acckr"),string(data.value("bic_pay"))+"\n"+string(data.value("bic_rec")),string(data.value("kor_acc_pay"))+string(data.value("kor_acc_rec")),razdelS,
             data.value("t_ccy"), data.value("sum"),SumRub,data.value("ground"),data.value("t_oper"),otdel,Vid_HranS);
          end;
          if  (razdelS == "ОПЕРУ")
             OperuKol = OperuKol + 1;     OperuSum = OperuSum + SumRub;
          elif(razdelS == "НОСТРО")
             nostroKol = NostroKol + 1;   NostroSum = NostroSum + SumRub;
          elif(razdelS == "МФР")
             MfrKol = MfrKol + 1;         MfrSum = MfrSum + SumRub;
          elif(razdelS == "ПРОЧИЕ")
             ProchieKol = ProchieKol + 1; ProchieSum = ProchieSum + SumRub;
          end;
       end;
    end;
    tabl.printbottom();
    [ Документов по виду ОПЕРУ  - ###### на сумму в рублях: ################
      Документов по виду НОСТРО - ###### на сумму в рублях: ################
      Документов по виду МФР    - ###### на сумму в рублях: ################
      Документов по виду ПРОЧИЕ - ###### на сумму в рублях: ################

        ](OperuKol,OperuSum,nostroKol,NostroSum,MfrKol,MfrSum,ProchieKol,ProchieSum);
     if(not(otchetbank))
	[  Начальник Подразделения ############################### ______________________

	](HeaderName);     	
     elif(otchetbank)	
  	[  Главный бухгалтер________________________

  	];
     end;	
	[  Отв. исполнитель__________________________

	  М.П.

	  Документ подготовлен ############################### __________________ 

	](getShortName(GetOperName({oper})));

END;

MACRO report_vnutr_vse(Mode:string,VidHran:string,glava:integer,nbalanse1:string,nbalanse2:string)
 var podotchetS, отдел1,отдел2,отдел3,отдел4,отдел5,отдел6,otdel1,otdel2,select,Data,подразделение1,подразделение2,perv = 1,дебет,кредит, chapter,Data_otdels,Select_otdels;
 var StoreKind,Flag_pechati_provodkiS, Vid_HranS,SumR, paymentid1,paymentid2 = 0, DataRUR, SelectRUR, Сумма_в_рублях,Select_1000_1,Select_1000_2,Select_1000_3,pechat_valut;
 var pechat_podotchet,payment_id;
//------------------------------------------------------------------------------------------------//|---------------------|
 var O_Kol_nostro_B = 0,O_Sum_RRF_nostro_B = $0,O_Sum_EKV_nostro_B = $0,O_Sum_ITOG_nostro_B = $0, //|                     |
     O_Kol_nostro_E = 0,O_Sum_RRF_nostro_E = $0,O_Sum_EKV_nostro_E = $0,O_Sum_ITOG_nostro_E = $0, //|                     |
     O_Kol_mfr_B    = 0,O_Sum_RRF_mfr_B    = $0,O_Sum_EKV_mfr_B    = $0,O_Sum_ITOG_mfr_B    = $0, //|                     |
     O_Kol_mfr_E    = 0,O_Sum_RRF_mfr_E    = $0,O_Sum_EKV_mfr_E    = $0,O_Sum_ITOG_mfr_E    = $0, //|СЧЕТЧИКИ ПО ОТДЕЛАМ  |
     O_Kol_vnkl_B   = 0,O_Sum_RRF_vnkl_B   = $0,O_Sum_EKV_vnkl_B   = $0,O_Sum_ITOG_vnkl_B   = $0, //|(порядок расположения|
     O_Kol_vnkl_E   = 0,O_Sum_RRF_vnkl_E   = $0,O_Sum_EKV_vnkl_E   = $0,O_Sum_ITOG_vnkl_E   = $0, //|соответствует        |
     O_Kol_vnpl_B   = 0,O_Sum_RRF_vnpl_B   = $0,O_Sum_EKV_vnpl_B   = $0,O_Sum_ITOG_vnpl_B   = $0, //|очередности вывода   |
     O_Kol_vnpl_E   = 0,O_Sum_RRF_vnpl_E   = $0,O_Sum_EKV_vnpl_E   = $0,O_Sum_ITOG_vnpl_E   = $0, //|на печать)           |
     O_Kol_vnor_B   = 0,O_Sum_RRF_vnor_B   = $0,O_Sum_EKV_vnor_B   = $0,O_Sum_ITOG_vnor_B   = $0, //|                     |
     O_Kol_vnor_E   = 0,O_Sum_RRF_vnor_E   = $0,O_Sum_EKV_vnor_E   = $0,O_Sum_ITOG_vnor_E   = $0, //|                     |
     O_Kol_itog1_B  = 0,O_Sum_RRF_itog1_B  = $0,O_Sum_EKV_itog1_B  = $0,O_Sum_ITOG_itog1_B  = $0, //|                     |
     O_Kol_itog1_E  = 0,O_Sum_RRF_itog1_E  = $0,O_Sum_EKV_itog1_E  = $0,O_Sum_ITOG_itog1_E  = $0; //|                     |
//------------------------------------------------------------------------------------------------//|---------------------|
 var P_Kol_nostro_B = 0,P_Sum_RRF_nostro_B = $0,P_Sum_EKV_nostro_B = $0,P_Sum_ITOG_nostro_B = $0, //|                     |
     P_Kol_nostro_E = 0,P_Sum_RRF_nostro_E = $0,P_Sum_EKV_nostro_E = $0,P_Sum_ITOG_nostro_E = $0, //|                     |
     P_Kol_mfr_B    = 0,P_Sum_RRF_mfr_B    = $0,P_Sum_EKV_mfr_B    = $0,P_Sum_ITOG_mfr_B    = $0, //|                     |
     P_Kol_mfr_E    = 0,P_Sum_RRF_mfr_E    = $0,P_Sum_EKV_mfr_E    = $0,P_Sum_ITOG_mfr_E    = $0, //|СЧЕТЧИКИ ПО ПОДРАЗД-М|
     P_Kol_vnkl_B   = 0,P_Sum_RRF_vnkl_B   = $0,P_Sum_EKV_vnkl_B   = $0,P_Sum_ITOG_vnkl_B   = $0, //|(порядок расположения|
     P_Kol_vnkl_E   = 0,P_Sum_RRF_vnkl_E   = $0,P_Sum_EKV_vnkl_E   = $0,P_Sum_ITOG_vnkl_E   = $0, //|соответствует        |
     P_Kol_vnpl_B   = 0,P_Sum_RRF_vnpl_B   = $0,P_Sum_EKV_vnpl_B   = $0,P_Sum_ITOG_vnpl_B   = $0, //|очередности вывода   |
     P_Kol_vnpl_E   = 0,P_Sum_RRF_vnpl_E   = $0,P_Sum_EKV_vnpl_E   = $0,P_Sum_ITOG_vnpl_E   = $0, //|на печать)           |
     P_Kol_vnor_B   = 0,P_Sum_RRF_vnor_B   = $0,P_Sum_EKV_vnor_B   = $0,P_Sum_ITOG_vnor_B   = $0, //|                     |
     P_Kol_vnor_E   = 0,P_Sum_RRF_vnor_E   = $0,P_Sum_EKV_vnor_E   = $0,P_Sum_ITOG_vnor_E   = $0, //|                     |
     P_Kol_itog1_B  = 0,P_Sum_RRF_itog1_B  = $0,P_Sum_EKV_itog1_B  = $0,P_Sum_ITOG_itog1_B  = $0, //|                     |
     P_Kol_itog1_E  = 0,P_Sum_RRF_itog1_E  = $0,P_Sum_EKV_itog1_E  = $0,P_Sum_ITOG_itog1_E  = $0; //|                     |
//------------------------------------------------------------------------------------------------//|---------------------|
 var B_Kol_nostro_B = 0,B_Sum_RRF_nostro_B = $0,B_Sum_EKV_nostro_B = $0,B_Sum_ITOG_nostro_B = $0, //|                     |
     B_Kol_nostro_E = 0,B_Sum_RRF_nostro_E = $0,B_Sum_EKV_nostro_E = $0,B_Sum_ITOG_nostro_E = $0, //|                     |
     B_Kol_mfr_B    = 0,B_Sum_RRF_mfr_B    = $0,B_Sum_EKV_mfr_B    = $0,B_Sum_ITOG_mfr_B    = $0, //|                     |
     B_Kol_mfr_E    = 0,B_Sum_RRF_mfr_E    = $0,B_Sum_EKV_mfr_E    = $0,B_Sum_ITOG_mfr_E    = $0, //|СЧЕТЧИКИ ПО БАНКУ    |
     B_Kol_vnkl_B   = 0,B_Sum_RRF_vnkl_B   = $0,B_Sum_EKV_vnkl_B   = $0,B_Sum_ITOG_vnkl_B   = $0, //|(порядок расположения|
     B_Kol_vnkl_E   = 0,B_Sum_RRF_vnkl_E   = $0,B_Sum_EKV_vnkl_E   = $0,B_Sum_ITOG_vnkl_E   = $0, //|соответствует        |
     B_Kol_vnpl_B   = 0,B_Sum_RRF_vnpl_B   = $0,B_Sum_EKV_vnpl_B   = $0,B_Sum_ITOG_vnpl_B   = $0, //|очередности вывода   |
     B_Kol_vnpl_E   = 0,B_Sum_RRF_vnpl_E   = $0,B_Sum_EKV_vnpl_E   = $0,B_Sum_ITOG_vnpl_E   = $0, //|на печать)           |
     B_Kol_vnor_B   = 0,B_Sum_RRF_vnor_B   = $0,B_Sum_EKV_vnor_B   = $0,B_Sum_ITOG_vnor_B   = $0, //|                     |
     B_Kol_vnor_E   = 0,B_Sum_RRF_vnor_E   = $0,B_Sum_EKV_vnor_E   = $0,B_Sum_ITOG_vnor_E   = $0, //|                     |
     B_Kol_itog1_B  = 0,B_Sum_RRF_itog1_B  = $0,B_Sum_EKV_itog1_B  = $0,B_Sum_ITOG_itog1_B  = $0, //|                     |
     B_Kol_itog1_E  = 0,B_Sum_RRF_itog1_E  = $0,B_Sum_EKV_itog1_E  = $0,B_Sum_ITOG_itog1_E  = $0; //|                     |
//------------------------------------------------------------------------------------------------//|---------------------|
   chapter = glava;
   pechat_valut = "";
//msgbox(chapter);
/* podotchetS = opredelenie_podotcheta("30110","40702");
 msgbox(podotchetS);
 podotchetS = opredelenie_podotcheta("70606","30110");
 msgbox(podotchetS);*/
//    otdel = "0123456789абвгд";

 подразделение2 = 0;
select = "";
select = select +
"       select distinct t_code1,t_code2,name_otdel,t_oper,numdoc,accdeb,name1,acckr,name2,SUM,sumRUR,sh,ground,T_FIID_PAYER,nvl(paymentid,-1) paymentid,  "+  
"       case when a.docKind not in (15,70) and a.chapter <> 1 then 1 else to_number(NVL((SELECT storeKind FROM TABLE (USER_EA.Get_dev_prop ";
if(substr(RepTypes,1,9) == "Баланс ->")
select = select +
"        (a.dockind, a.origin, a.paymkind, a.shifr_oper, a.numb_pack, a.chapter, a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))),1)) end vid_hran,AppKey       "+
"       from                                                                                                                                         ";
else
select = select +
"        (null, a.origin,null, a.shifr_oper, a.numb_pack, a.chapter, a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))),1)) end vid_hran,AppKey       "+
"       from                                                                                                                                         ";
end;
select = select +
"        (select distinct DOTDELS_DBT.T_CODE1,DOTDELS_DBT.T_CODE2,DOTDELS_DBT.T_NAME as NAME_OTDEL, arh.t_oper,                                      "+
"                arh.t_numb_document AS NumDoc, arh.t_account_payer AS AccDeb, acc1.t_nameaccount name1, arh.t_account_receiver AS AccKr,            "+
"                acc2.t_nameaccount name2, arh.T_SUM_PAYER AS SUM, arh.T_SUM_NATCUR sumRUR, arh.t_shifr_oper||'/'||t_kind_oper sh, arh.t_ground AS Ground,                          "+   
"                arh.T_ACCTRNID AppKey,arh.t_typedocument,                                             "+
"                prop.T_PAYMENTKIND paymkind, user_ea.GetOrigin ( paym.t_dockind, paym.t_paymentid) origin, arh.T_CHAPTER chapter, paym.T_DOCKIND dockind, arh.T_NUMBER_PACK numb_pack,     "+
"                arh.T_SHIFR_OPER shifr_oper, paym.T_FIID cred_fiid, paym.T_PAYFIID deb_fiid, arh.T_FIID_PAYER, arh.T_FIID_RECEIVER, paym.t_paymentid paymentid        "+
"           FROM dacctrn_dbt arh,dpmdocs_dbt docs,dpmpaym_dbt paym,daccount_dbt acc1,daccount_dbt acc2,DOTDELS_DBT,dpmrmprop_dbt prop,              "+
"                (select * from DOP_OTDEL_DBT where (T_oper,t_datebegin) in (select T_oper,max(t_datebegin) t_datebegin                              "+                    
"                   from DOP_OTDEL_DBT where t_datebegin<=TO_DATE ('"+ DateDocum + "', 'DD.MM.YYYY')                                                 "+
"                        and (t_dateend >= TO_DATE ('"+ DateDocum + "', 'DD.MM.YYYY') OR t_dateend  = TO_DATE ('01.01.0001', 'DD.MM.YYYY'))          "+                                                                 
"                        group by T_oper)) DOP_OTDEL_DBT                                                                                             "+
"	   WHERE arh.t_date_carry = to_date('" + DateDocum +"','DD.MM.YYYY')                                                                         "+ 
"            and (DOP_OTDEL_DBT.t_dateend >=to_date('"+ DateDocum + "','DD.MM.YYYY') or t_dateend = to_date('01.01.0001','DD.MM.YYYY'))              "+
"            and t_datebegin <=to_date('"+ DateDocum + "','DD.MM.YYYY')                                                                              "+
"	     AND acc1.t_account(+) = arh.t_account_payer	                                                                                     "+
"	     AND acc2.t_account(+) = arh.t_account_receiver                                                                                          "+
"	     AND arh.t_chapter = "+ Chapter;
if(substr(RepTypes,1,9) != "Баланс ->")
Select = Select +
"            AND arh.t_result_carry <> 14                                                                                                            ";
end;
Select = Select +
"	     AND arh.T_ACCTRNID = docs.T_ACCTRNID(+)                                                                                     "+
"            AND docs.T_PAYMENTID = paym.T_PAYMENTID(+)                                                                                              "+
"            AND prop.t_paymentid(+) = paym.t_paymentid                                                                                              ";
   if (Valuta_otchetaS == "Рубли")
	if(RepTypes != "Внебаланс")
select = select +
"            AND SUBSTR (arh.t_account_payer, 6, 3) = '810' and SUBSTR (arh.t_account_receiver, 6,3) = '810'                                         ";
	else
select = select +
"            AND ((SUBSTR (arh.t_account_payer, 6, 3) = '810' and SUBSTR (arh.t_account_receiver, 6,3) = '810')                                      "+
"                 OR (SUBSTR (arh.t_account_payer, 6, 3) <> SUBSTR (arh.t_account_receiver, 6,3)))                                                   ";
	end;
  elif(Valuta_otchetaS == "Валюта")
select = select +
"            AND SUBSTR (arh.t_account_payer, 6, 3) = SUBSTR (arh.t_account_receiver, 6,3)                                                           "+
"            AND SUBSTR (arh.t_account_payer, 6, 3) <> '810' and SUBSTR (arh.t_account_receiver, 6,3) <> '810'                                       ";
   end;
select = select +
"	     AND SUBSTR (arh.t_account_payer, 1, 5) NOT IN ('20202','20203','20207')                                                                 "+
"	     AND SUBSTR (arh.t_account_receiver, 1, 5) NOT IN ('20202','20203','20207')                                                              "+
"            and arh.T_OPER = DOP_OTDEL_DBT.T_oper(+)                                                                                                "+
"            and DOP_OTDEL_DBT.T_CODE1 = DOTDELS_DBT.T_CODE1(+)                                                                                      "+
"            and DOP_OTDEL_DBT.T_CODE2 = DOTDELS_DBT.T_CODE2(+)                                                                                      ";
if(not((NumOtdel == 0) or (NumOtdel == "")))
Select = Select +
"	     AND DOP_OTDEL_DBT.T_CODE1 = " + NumOtdel;  
    if(NumPodOtdel !=0)
        Select = select+
"            and dop_otdel_dbt.T_CODE2 = "+ NumPodOtdel;
    end;
end;
if(RepTypes != "Внебаланс")
Select = Select +
"            and (exists (select 1 from dpmprop_dbt  deb,dpmprop_dbt cred                                                                            "+
"            where cred.T_PAYMENTID = docs.T_PAYMENTID                                                                                               "+
"            and deb.T_PAYMENTID = docs.T_PAYMENTID                                                                                                  "+
"            and deb.T_PAYMENTID = cred.T_PAYMENTID                                                                                                  "+
"            and deb.t_debetcredit = 0 and cred.t_debetcredit = 1                                                                                    "+
"            and cred.t_group <>"+ PAYMENTS_GROUP_EXTERNAL + " and deb.t_group <>"+ PAYMENTS_GROUP_EXTERNAL+  ")                                     "+
"            or docs.t_paymentid is null)                                                                                                         "; 
end;
Select = Select +
             nbalanse1 + ")" + "\n" + nbalanse2 + ")" + "\n" + ") a                                                                                       "+
"	     Order by t_code1, t_code2                                                                                                               ";
//           nbalanse1 + ")" + "\n" + nbalanse2 + ")" + "\n                                                                                          ";



/*------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
   if (Mode == "Баланс - Конверсионные - Все")
select = 
"       select distinct t_code1,t_code2,name_otdel,t_oper,numdoc,accdeb,name1,acckr,name2,SUM,sh,ground,T_FIID_PAYER,nvl(paymentid,-1) paymentid,(SELECT storeKind FROM TABLE(USER_EA.Get_dev_prop     "+  
"        (a.dockind, a.origin, a.paymkind, a.shifr_oper, a.numb_pack, a.chapter, a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))) vid_hran,a.t_result_carry,AppKey       "+
"       from                                                                                                                                         "+
"        (select distinct DOTDELS_DBT.T_CODE1,DOTDELS_DBT.T_CODE2,DOTDELS_DBT.T_NAME as NAME_OTDEL, arh.t_oper,                                      "+
"                arh.t_numb_document AS NumDoc, arh.t_account_payer AS AccDeb, acc1.t_nameaccount name1, arh.t_account_receiver AS AccKr,            "+
"                acc2.t_nameaccount name2, arh.T_SUM_NATCUR AS SUM, arh.t_shifr_oper||'/'||t_kind_oper sh, arh.t_ground AS Ground,                          "+   
"                arh.T_ACCTRNID AppKey,arh.t_typedocument,arh.T_FIID_PAYER, arh.T_FIID_RECEIVER,                                                     "+
"                prop.T_PAYMENTKIND paymkind, user_ea.GetOrigin ( paym.t_dockind, paym.t_paymentid) origin, arh.T_CHAPTER chapter, paym.T_DOCKIND dockind, arh.T_NUMBER_PACK numb_pack,     "+
"                prop.T_SHIFROPER shifr_oper, paym.T_FIID cred_fiid, paym.T_PAYFIID deb_fiid,paym.t_paymentid paymentid,arh.t_result_carry         "+
"           FROM dacctrn_dbt arh,dpmdocs_dbt docs,dpmpaym_dbt paym,daccount_dbt acc1,daccount_dbt acc2,DOTDELS_DBT,dpmrmprop_dbt prop,               "+
"                (select * from DOP_OTDEL_DBT where (T_oper,t_datebegin) in (select T_oper,max(t_datebegin) t_datebegin                              "+                    
"                   from DOP_OTDEL_DBT where t_datebegin<=TO_DATE ('"+ DateDocum + "', 'DD.MM.YYYY')                                                 "+
"                        and (t_dateend >= TO_DATE ('"+ DateDocum + "', 'DD.MM.YYYY') OR t_dateend  = TO_DATE ('01.01.0001', 'DD.MM.YYYY'))                "+                                                                 
"                        group by T_oper)) DOP_OTDEL_DBT                                                                                             "+
"	   WHERE arh.t_date_carry = to_date('" + DateDocum +"','DD.MM.YYYY')                                                                         "+ 
"            and (DOP_OTDEL_DBT.t_dateend >=to_date('"+ DateDocum + "','DD.MM.YYYY') or t_dateend = to_date('01.01.0001','DD.MM.YYYY'))              "+
"            and t_datebegin <=to_date('"+ DateDocum + "','DD.MM.YYYY')                                                                              "+
"	     AND acc1.t_account(+) = arh.t_account_payer	                                                                                             "+
"	     AND acc2.t_account(+) = arh.t_account_receiver                                                                                             "+
"	     AND arh.t_chapter = "+ Chapter;
if(substr(RepTypes,1,9) != "Баланс ->")
Select = Select +
"            AND arh.t_result_carry <> 14                                                                                                            ";
end;
Select = Select +
"	     AND arh.T_ACCTRNID = docs.T_ACCTRNID(+)                                                                                                 "+
"            AND docs.T_PAYMENTID = paym.T_PAYMENTID(+)                                                                                              "+
"            AND prop.t_paymentid(+) = paym.t_paymentid                                                                                              "+
"            AND SUBSTR (arh.t_account_payer, 6, 3) <> SUBSTR (arh.t_account_receiver, 6,3)                                                          "+
"	     AND (SUBSTR (arh.t_account_payer, 1, 5) NOT IN ('20202','20203','20207') or arh.T_RESULT_CARRY in (18,82))                              "+
"	     AND (SUBSTR (arh.t_account_receiver, 1, 5) NOT IN ('20202','20203','20207') or arh.T_RESULT_CARRY in (18,82))                           "+
"            and arh.t_account_payer <> 'ОВП'                                                                                                        "+
"            and arh.t_account_receiver <> 'ОВП'                                                                                                     "+
"            and arh.T_OPER = DOP_OTDEL_DBT.T_oper                                                                                                   "+
"            and DOP_OTDEL_DBT.T_CODE1 = DOTDELS_DBT.T_CODE1                                                                                         "+
"            and DOP_OTDEL_DBT.T_CODE2 = DOTDELS_DBT.T_CODE2                                                                                         ";
if(not((NumOtdel == 0) or (NumOtdel == "")))
Select = Select +
"	     AND DOP_OTDEL_DBT.T_CODE1 = " + NumOtdel;  
    if(NumPodOtdel !=0)
        Select = select+
"            and dop_otdel_dbt.T_CODE2 = "+ NumPodOtdel;
    end;
end;
        Select = select+
"            and (exists (select 1 from dpmprop_dbt  deb,dpmprop_dbt cred                                                                            "+
"            where cred.T_PAYMENTID = docs.T_PAYMENTID                                                                                               "+
"            and deb.T_PAYMENTID = docs.T_PAYMENTID                                                                                                  "+
"            and deb.T_PAYMENTID = cred.T_PAYMENTID                                                                                                  "+
"            and deb.t_debetcredit = 0 and cred.t_debetcredit = 1                                                                                    "+
"            and cred.t_group <>"+ PAYMENTS_GROUP_EXTERNAL + " and deb.t_group <>"+ PAYMENTS_GROUP_EXTERNAL+  ")                                     "+
"            or docs.t_paymentid is null)) a                                                                                                         "+ 
"	     Order by t_code1, t_code2, paymentid                                                                                                    ";
    end;
/*------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
//debugbreak;
//debugbreak;
	Data = ExecSQLSelect(Select);
debugbreak;
debugbreak;
if(Valuta_otchetaS == "Рубли")
pechat_valut = "В рублях РФ";
elif(Valuta_otchetaS == "Валюта")
pechat_valut = "В иностранной валюте";
elif(Valuta_otchetaS == "Конверсионные")
pechat_valut = "Конверсионные";                      	
end;
      [   ##########################

        	              		     КОНТРОЛЬНАЯ ВЕДОМОСТЬ БАНКА
	        	  	     БУХГАЛТЕРСКИЕ ДОКУМЕНТЫ ВНУТРЕННИХ ОПЕРАЦИЙ
	 			             ПО  ОТДЕЛАМ  ПОДРАЗДЕЛЕНИЙ
	 		                           ####################                      ]({Name_Bank},pechat_valut);
if(not((NumOtdel == 0) or (NumOtdel == "")))
Select_otdels = 
" select t_name from dotdels_dbt          " + "\n" + 
" where t_code2 = "+ NumPodOtdel            + "\n" +
"   and t_code1 = "+ NumOtdel               + "\n" ;
Data_otdels = ExecSQLSelect(Select_otdels);
Data_otdels.movenext();
if(NumPodOtdel == 0)
      [           по подразделению: ###########################################################################](string(NumOtdel)+"."+string(NumPodOtdel)+ " " +string(Data_otdels.value("t_name")));
else
      [                  по отделу: ###########################################################################](string(NumOtdel)+"."+string(NumPodOtdel)+ " " +string(Data_otdels.value("t_name")));
end;
end;
      [      	                                 за  ##########

          Отчет: ###################################################################

      ]  (DateDocum,Mode);

      [  ┌───────────────────────┬────────────┬───┬────────────┬───────────────────────────────────────────────┐
         │ № / Наименование      │ Вид отчета │вид│ Кол-во     │                Сумма документов               │
	 │подразделения/отдела   │            │хр.│ документов ├───────────────┬───────────────┬───────────────┤
	 │                       │            │   │            │  В рублях РФ  │   В руб. экв. │     ИТОГО     │
         ├───────────────────────┴────────────┴───┴────────────┴───────────────┴───────────────┴───────────────┤];
/*        if(data.movenext())
         подразделение2 = string(Data.value("t_code1")) + ".0 ";
         otdel2 = string(Data.value("t_code1")) + "." + string(Data.value("t_code2")) + string(Data.value("name_otdel"));
         perv = 1;
      [  │                                                                                                     │
         │         ################################################################################            │
         ├───────────────────────┬────────────┬───┬────────────┬───────────────┬───────────────┬───────────────┤](подразделение2);
        end;*/
     otdel2 = "";

        while(Data.movenext())
Select_otdels = 
" select t_code1, t_name from dotdels_dbt " + "\n" + 
" where t_code2 = 0                       " + "\n" +
" and t_code1 = "+ int(Data.value("t_code1")) +
" order by t_code1 asc                    " + "\n" ;

Data_otdels = ExecSQLSelect(Select_otdels);
Data_otdels.movenext();
         подразделение1 = string(Data.value("t_code1")) + ".0  " + string(Data_otdels.value("t_name"))/*+ string(Data.value("name_otdel"))*/;
//msgbox(подразделение1);
         otdel1 = string(Data.value("t_code1")) + "." + string(Data.value("t_code2")) + " " + string(Data.value("name_otdel"));
       if (perv == 1)
          perv = 0;
         подразделение2 = подразделение1;//string(Data.value("t_code1")) + ".0 " /*+ string(Data.value("name_otdel"))*/;
//msgbox(подразделение2);
         otdel2 = string(Data.value("t_code1")) + "." + string(Data.value("t_code2")) + " " + string(Data.value("name_otdel"));
      [  │                                                                                                     │
         │         ################################################################################            │
         ├───────────────────────┬────────────┬───┬────────────┬───────────────┬───────────────┬───────────────┤](подразделение2);
       end;
    дебет  = substr(Data.value("AccDeb"),1,5);
    кредит = substr(Data.value("AccKr"),1,5);
                StoreKind = data.value("vid_hran");
               if(StoreKind != 0)
                StoreKind = 1;
               end;
	StoreKind = data.value("vid_hran");
	payment_id = data.value("paymentid");
	StoreKind = kateg_vid_hran(payment_id,StoreKind,chapter);
   if (Mode == "Баланс - Конверсионные - Все")
     paymentid1 = data.value("paymentid");
  end;
         if(otdel1 != otdel2) //and (otdel2 != ""))

    отдел1 = substr(otdel2,1 ,20);отдел2 = substr(otdel2,21,20);отдел3 = substr(otdel2,41,20);    
    отдел4 = substr(otdel2,61,20);отдел5 = substr(otdel2,81,20);отдел6 = substr(otdel2,101,20);
        perv = 0;
if(Mode == "Баланс - Конверсионные - Все")
      [  │ ##################### │ Итого по   │ Б │############│###############│###############│###############│
         │ ##################### │ конверсион ├───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ ##################### │ ным        │ Э │############│###############│###############│###############│
         ├───────────────────────┼────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤](
          отдел1,                             O_Kol_itog1_B,  O_Sum_RRF_itog1_B,O_Sum_EKV_itog1_B,O_Sum_ITOG_itog1_B,
          отдел2,  
          отдел3,                             O_Kol_itog1_E,  O_Sum_RRF_itog1_E,O_Sum_EKV_itog1_E,O_Sum_ITOG_itog1_E);
elif ((Mode == "Баланс - Рубли - Все") or (Mode == "Баланс - Валюта - Все"))
      [  │ ##################### │            │ Б │############│###############│###############│###############│
         │ ##################### │ БР/НОСТРО  ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │ ##################### │            │ Э │############│###############│###############│###############│
	 │ ##################### ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ ##################### │            │ Б │############│###############│###############│###############│
         │ ##################### │ БР/МФР     ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │ БР/Кл      ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
	 │                       │ БР/Пл      ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │ БР/МО      ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │ Итого по   │ Б │############│###############│###############│###############│
         │                       │ отчетам    ├───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Э │############│###############│###############│###############│
         ├───────────────────────┼────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤](
          отдел1,                             O_Kol_nostro_B,O_Sum_RRF_nostro_B,O_Sum_EKV_nostro_B,O_Sum_ITOG_nostro_B,
          отдел2,
          отдел3,                             O_Kol_nostro_E,O_Sum_RRF_nostro_E,O_Sum_EKV_nostro_E,O_Sum_ITOG_nostro_E, 
          отдел4,                                        
          отдел5,                             O_Kol_mfr_B,    O_Sum_RRF_mfr_B,  O_Sum_EKV_mfr_B,  O_Sum_ITOG_mfr_B, 
          отдел6,                             O_Kol_mfr_E,    O_Sum_RRF_mfr_E,  O_Sum_EKV_mfr_E,  O_Sum_ITOG_mfr_E, 
                                              O_Kol_vnkl_B,   O_Sum_RRF_vnkl_B, O_Sum_EKV_vnkl_B, O_Sum_ITOG_vnkl_B,
                                              O_Kol_vnkl_E,   O_Sum_RRF_vnkl_E, O_Sum_EKV_vnkl_E, O_Sum_ITOG_vnkl_E,
                                              O_Kol_vnpl_B,   O_Sum_RRF_vnpl_B, O_Sum_EKV_vnpl_B, O_Sum_ITOG_vnpl_B,
                                              O_Kol_vnpl_E,   O_Sum_RRF_vnpl_E, O_Sum_EKV_vnpl_E, O_Sum_ITOG_vnpl_E,
                                              O_Kol_vnor_B,   O_Sum_RRF_vnor_B, O_Sum_EKV_vnor_B, O_Sum_ITOG_vnor_B,
                                              O_Kol_vnor_E,   O_Sum_RRF_vnor_E, O_Sum_EKV_vnor_E, O_Sum_ITOG_vnor_E,
                                              O_Kol_itog1_B,  O_Sum_RRF_itog1_B,O_Sum_EKV_itog1_B,O_Sum_ITOG_itog1_B,
                                              O_Kol_itog1_E,  O_Sum_RRF_itog1_E,O_Sum_EKV_itog1_E,O_Sum_ITOG_itog1_E);
else
      if(podotchetS == "НОСТРО") pechat_podotchet = "БР/НОСТРО";
    elif(podotchetS == "МФР") pechat_podotchet = "БР/МФР";
    elif(podotchetS == "Внутриклиентские") pechat_podotchet = "БР/Кл";
    elif(podotchetS == "Внутрибанковские") pechat_podotchet = "БР/Пл";
    elif(podotchetS == "Внутренние ордера") pechat_podotchet = "БР/МО";
     end;
      [  │ ##################### │            │ Б │############│###############│###############│###############│
         │ ##################### │ ########## ├───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ ##################### │            │ Э │############│###############│###############│###############│
         ├───────────────────────┼────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤](
          отдел1,                             O_Kol_itog1_B,  O_Sum_RRF_itog1_B,O_Sum_EKV_itog1_B,O_Sum_ITOG_itog1_B,
          отдел2,                  pechat_podotchet,
          отдел3,                             O_Kol_itog1_E,  O_Sum_RRF_itog1_E,O_Sum_EKV_itog1_E,O_Sum_ITOG_itog1_E);
end;
	 otdel2 = otdel1;
//------------------------------------------------------------------------------------------------//|---------------------|
     O_Kol_nostro_B = 0;O_Sum_RRF_nostro_B = $0;O_Sum_EKV_nostro_B = $0;O_Sum_ITOG_nostro_B = $0; //|                     |
     O_Kol_nostro_E = 0;O_Sum_RRF_nostro_E = $0;O_Sum_EKV_nostro_E = $0;O_Sum_ITOG_nostro_E = $0; //|                     |
     O_Kol_mfr_B    = 0;O_Sum_RRF_mfr_B    = $0;O_Sum_EKV_mfr_B    = $0;O_Sum_ITOG_mfr_B    = $0; //|                     |
     O_Kol_mfr_E    = 0;O_Sum_RRF_mfr_E    = $0;O_Sum_EKV_mfr_E    = $0;O_Sum_ITOG_mfr_E    = $0; //|СЧЕТЧИКИ ПО ОТДЕЛАМ  |
     O_Kol_vnkl_B   = 0;O_Sum_RRF_vnkl_B   = $0;O_Sum_EKV_vnkl_B   = $0;O_Sum_ITOG_vnkl_B   = $0; //|(порядок расположения|
     O_Kol_vnkl_E   = 0;O_Sum_RRF_vnkl_E   = $0;O_Sum_EKV_vnkl_E   = $0;O_Sum_ITOG_vnkl_E   = $0; //|соответствует        |
     O_Kol_vnpl_B   = 0;O_Sum_RRF_vnpl_B   = $0;O_Sum_EKV_vnpl_B   = $0;O_Sum_ITOG_vnpl_B   = $0; //|очередности вывода   |
     O_Kol_vnpl_E   = 0;O_Sum_RRF_vnpl_E   = $0;O_Sum_EKV_vnpl_E   = $0;O_Sum_ITOG_vnpl_E   = $0; //|на печать)           |
     O_Kol_vnor_B   = 0;O_Sum_RRF_vnor_B   = $0;O_Sum_EKV_vnor_B   = $0;O_Sum_ITOG_vnor_B   = $0; //|                     |
     O_Kol_vnor_E   = 0;O_Sum_RRF_vnor_E   = $0;O_Sum_EKV_vnor_E   = $0;O_Sum_ITOG_vnor_E   = $0; //|                     |
     O_Kol_itog1_B  = 0;O_Sum_RRF_itog1_B  = $0;O_Sum_EKV_itog1_B  = $0;O_Sum_ITOG_itog1_B  = $0; //|                     |
     O_Kol_itog1_E  = 0;O_Sum_RRF_itog1_E  = $0;O_Sum_EKV_itog1_E  = $0;O_Sum_ITOG_itog1_E  = $0; //|                     |
//------------------------------------------------------------------------------------------------//|---------------------|
	 end;	
//	 otdel2 = otdel1;
         if(подразделение2 != подразделение1)
if((Mode == "Баланс - Конверсионные - Все") and ((NumPodOtdel == 0) or (NumOtdel == 0) or (NumOtdel == "")))
      [  │ПОДР. ########                      │ Б │############│###############│###############│###############│
         │                                    ├───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ИТОГО ПО ВИДАМ ХРАНЕНИЯ             │ Э │############│###############│###############│###############│
         ├────────────────────────────────────┴───┴────────────┴───────────────┴───────────────┴───────────────┤
         │                                                                                                     │
         │         ################################################################################            │
         ├───────────────────────┬────────────┬───┬────────────┬───────────────┬───────────────┬───────────────┤](
               substr(подразделение2,1,5),    P_Kol_itog1_B,  P_Sum_RRF_itog1_B,P_Sum_EKV_itog1_B,P_Sum_ITOG_itog1_B,
                                              P_Kol_itog1_E,  P_Sum_RRF_itog1_E,P_Sum_EKV_itog1_E,P_Sum_ITOG_itog1_E,
                   подразделение1);
elif (((Mode == "Баланс - Рубли - Все") or (Mode == "Баланс - Валюта - Все")) and ((NumPodOtdel == 0) or (NumOtdel == 0) or (NumOtdel == "")))
      [  │ПОДР. ########         │            │ Б │############│###############│###############│###############│
         │ИТОГО ПО ВИДАМ ОТЧЕТОВ │ БР/НОСТРО  ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │ БР/МФР     ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │ БР/Кл      ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
	 │                       │ БР/Пл      ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │ БР/МО      ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
         ├───────────────────────┴────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ПОДР. ########                      │ Б │############│###############│###############│###############│
         │                                    ├───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ИТОГО ПО ВИДАМ ХРАНЕНИЯ             │ Э │############│###############│###############│###############│
         ├────────────────────────────────────┴───┴────────────┴───────────────┴───────────────┴───────────────┤
         │                                                                                                     │
         │         ################################################################################            │
         ├───────────────────────┬────────────┬───┬────────────┬───────────────┬───────────────┬───────────────┤](
               substr(подразделение2,1,5),    P_Kol_nostro_B,P_Sum_RRF_nostro_B,P_Sum_EKV_nostro_B,P_Sum_ITOG_nostro_B,
                                              P_Kol_nostro_E,P_Sum_RRF_nostro_E,P_Sum_EKV_nostro_E,P_Sum_ITOG_nostro_E, 
                                              P_Kol_mfr_B,    P_Sum_RRF_mfr_B,  P_Sum_EKV_mfr_B,  P_Sum_ITOG_mfr_B, 
                                              P_Kol_mfr_E,    P_Sum_RRF_mfr_E,  P_Sum_EKV_mfr_E,  P_Sum_ITOG_mfr_E, 
                                              P_Kol_vnkl_B,   P_Sum_RRF_vnkl_B, P_Sum_EKV_vnkl_B, P_Sum_ITOG_vnkl_B,
                                              P_Kol_vnkl_E,   P_Sum_RRF_vnkl_E, P_Sum_EKV_vnkl_E, P_Sum_ITOG_vnkl_E,
                                              P_Kol_vnpl_B,   P_Sum_RRF_vnpl_B, P_Sum_EKV_vnpl_B, P_Sum_ITOG_vnpl_B,
                                              P_Kol_vnpl_E,   P_Sum_RRF_vnpl_E, P_Sum_EKV_vnpl_E, P_Sum_ITOG_vnpl_E,
                                              P_Kol_vnor_B,   P_Sum_RRF_vnor_B, P_Sum_EKV_vnor_B, P_Sum_ITOG_vnor_B,
                                              P_Kol_vnor_E,   P_Sum_RRF_vnor_E, P_Sum_EKV_vnor_E, P_Sum_ITOG_vnor_E,
               substr(подразделение2,1,5),    P_Kol_itog1_B,  P_Sum_RRF_itog1_B,P_Sum_EKV_itog1_B,P_Sum_ITOG_itog1_B,
                                              P_Kol_itog1_E,  P_Sum_RRF_itog1_E,P_Sum_EKV_itog1_E,P_Sum_ITOG_itog1_E,
                   подразделение1);
elif ((NumPodOtdel == 0) or (NumOtdel == 0) or (NumOtdel == ""))
      [  │ПОДР. ########                      │ Б │############│###############│###############│###############│
         │                                    ├───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ИТОГО ПО ВИДАМ ХРАНЕНИЯ             │ Э │############│###############│###############│###############│
         ├────────────────────────────────────┴───┴────────────┴───────────────┴───────────────┴───────────────┤
         │                                                                                                     │
         │         ################################################################################            │
         ├───────────────────────┬────────────┬───┬────────────┬───────────────┬───────────────┬───────────────┤](
               substr(подразделение2,1,5),    P_Kol_itog1_B,  P_Sum_RRF_itog1_B,P_Sum_EKV_itog1_B,P_Sum_ITOG_itog1_B,
                                              P_Kol_itog1_E,  P_Sum_RRF_itog1_E,P_Sum_EKV_itog1_E,P_Sum_ITOG_itog1_E,
                   подразделение1);
end;
	 подразделение2 = подразделение1;
//------------------------------------------------------------------------------------------------//|---------------------|
     P_Kol_nostro_B = 0;P_Sum_RRF_nostro_B = $0;P_Sum_EKV_nostro_B = $0;P_Sum_ITOG_nostro_B = $0; //|                     |
     P_Kol_nostro_E = 0;P_Sum_RRF_nostro_E = $0;P_Sum_EKV_nostro_E = $0;P_Sum_ITOG_nostro_E = $0; //|                     |
     P_Kol_mfr_B    = 0;P_Sum_RRF_mfr_B    = $0;P_Sum_EKV_mfr_B    = $0;P_Sum_ITOG_mfr_B    = $0; //|                     |
     P_Kol_mfr_E    = 0;P_Sum_RRF_mfr_E    = $0;P_Sum_EKV_mfr_E    = $0;P_Sum_ITOG_mfr_E    = $0; //|СЧЕТЧИКИ ПО ПОДРАЗД-М|
     P_Kol_vnkl_B   = 0;P_Sum_RRF_vnkl_B   = $0;P_Sum_EKV_vnkl_B   = $0;P_Sum_ITOG_vnkl_B   = $0; //|(порядок расположения|
     P_Kol_vnkl_E   = 0;P_Sum_RRF_vnkl_E   = $0;P_Sum_EKV_vnkl_E   = $0;P_Sum_ITOG_vnkl_E   = $0; //|соответствует        |
     P_Kol_vnpl_B   = 0;P_Sum_RRF_vnpl_B   = $0;P_Sum_EKV_vnpl_B   = $0;P_Sum_ITOG_vnpl_B   = $0; //|очередности вывода   |
     P_Kol_vnpl_E   = 0;P_Sum_RRF_vnpl_E   = $0;P_Sum_EKV_vnpl_E   = $0;P_Sum_ITOG_vnpl_E   = $0; //|на печать)           |
     P_Kol_vnor_B   = 0;P_Sum_RRF_vnor_B   = $0;P_Sum_EKV_vnor_B   = $0;P_Sum_ITOG_vnor_B   = $0; //|                     |
     P_Kol_vnor_E   = 0;P_Sum_RRF_vnor_E   = $0;P_Sum_EKV_vnor_E   = $0;P_Sum_ITOG_vnor_E   = $0; //|                     |
     P_Kol_itog1_B  = 0;P_Sum_RRF_itog1_B  = $0;P_Sum_EKV_itog1_B  = $0;P_Sum_ITOG_itog1_B  = $0; //|                     |
     P_Kol_itog1_E  = 0;P_Sum_RRF_itog1_E  = $0;P_Sum_EKV_itog1_E  = $0;P_Sum_ITOG_itog1_E  = $0; //|                     |
//------------------------------------------------------------------------------------------------//|---------------------|
         end;


 StoreKind = kateg_vid_hran(payment_id,StoreKind,chapter);
 Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
 podotchetS = opredelenie_podotcheta(дебет,кредит);
        if (Valuta_otchetaS == "Рубли")
     if(Vid_HranS == "Б")// and (substr(data.value("accDeb"),1,5) != "90901")and (substr(data.value("accDeb"),1,5) != "90902")and (substr(data.value("accKr"),1,5) != "90901")and (substr(data.value("accKr"),1,5) != "90902"))
      	if(podotchetS == "НОСТРО")
           O_Kol_nostro_B = O_Kol_nostro_B + 1; O_Sum_RRF_nostro_B = O_Sum_RRF_nostro_B + Data.value("SumRUR"); O_Sum_EKV_nostro_B = ""; O_Sum_ITOG_nostro_B = O_Sum_RRF_nostro_B;
           P_Kol_nostro_B = P_Kol_nostro_B + 1; P_Sum_RRF_nostro_B = P_Sum_RRF_nostro_B + Data.value("SumRUR"); P_Sum_EKV_nostro_B = ""; P_Sum_ITOG_nostro_B = P_Sum_RRF_nostro_B;
           B_Kol_nostro_B = B_Kol_nostro_B + 1; B_Sum_RRF_nostro_B = B_Sum_RRF_nostro_B + Data.value("SumRUR"); B_Sum_EKV_nostro_B = ""; B_Sum_ITOG_nostro_B = B_Sum_RRF_nostro_B;
        elif(podotchetS == "МФР")
           O_Kol_mfr_B    = O_Kol_mfr_B    + 1; O_Sum_RRF_mfr_B    = O_Sum_RRF_mfr_B    + Data.value("SumRUR"); O_Sum_EKV_mfr_B    = ""; O_Sum_ITOG_mfr_B    = O_Sum_RRF_mfr_B;
           P_Kol_mfr_B    = P_Kol_mfr_B    + 1; P_Sum_RRF_mfr_B    = P_Sum_RRF_mfr_B    + Data.value("SumRUR"); P_Sum_EKV_mfr_B    = ""; P_Sum_ITOG_mfr_B    = P_Sum_RRF_mfr_B;
           B_Kol_mfr_B    = B_Kol_mfr_B    + 1; B_Sum_RRF_mfr_B    = B_Sum_RRF_mfr_B    + Data.value("SumRUR"); B_Sum_EKV_mfr_B    = ""; B_Sum_ITOG_mfr_B    = B_Sum_RRF_mfr_B;
        elif(podotchetS == "Внутриклиентские")
           O_Kol_vnkl_B   = O_Kol_vnkl_B   + 1; O_Sum_RRF_vnkl_B   = O_Sum_RRF_vnkl_B   + Data.value("SumRUR"); O_Sum_EKV_vnkl_B   = ""; O_Sum_ITOG_vnkl_B   = O_Sum_RRF_vnkl_B;
           P_Kol_vnkl_B   = P_Kol_vnkl_B   + 1; P_Sum_RRF_vnkl_B   = P_Sum_RRF_vnkl_B   + Data.value("SumRUR"); P_Sum_EKV_vnkl_B   = ""; P_Sum_ITOG_vnkl_B   = P_Sum_RRF_vnkl_B;
           B_Kol_vnkl_B   = B_Kol_vnkl_B   + 1; B_Sum_RRF_vnkl_B   = B_Sum_RRF_vnkl_B   + Data.value("SumRUR"); B_Sum_EKV_vnkl_B   = ""; B_Sum_ITOG_vnkl_B   = B_Sum_RRF_vnkl_B;
        elif(podotchetS == "Внутрибанковские")
           O_Kol_vnpl_B   = O_Kol_vnpl_B   + 1; O_Sum_RRF_vnpl_B   = O_Sum_RRF_vnpl_B   + Data.value("SumRUR"); O_Sum_EKV_vnpl_B   = ""; O_Sum_ITOG_vnpl_B   = O_Sum_RRF_vnpl_B;
           P_Kol_vnpl_B   = P_Kol_vnpl_B   + 1; P_Sum_RRF_vnpl_B   = P_Sum_RRF_vnpl_B   + Data.value("SumRUR"); P_Sum_EKV_vnpl_B   = ""; P_Sum_ITOG_vnpl_B   = P_Sum_RRF_vnpl_B;
           B_Kol_vnpl_B   = B_Kol_vnpl_B   + 1; B_Sum_RRF_vnpl_B   = B_Sum_RRF_vnpl_B   + Data.value("SumRUR"); B_Sum_EKV_vnpl_B   = ""; B_Sum_ITOG_vnpl_B   = B_Sum_RRF_vnpl_B;
        elif(podotchetS == "Внутренние ордера")
           O_Kol_vnor_B   = O_Kol_vnor_B   + 1; O_Sum_RRF_vnor_B   = O_Sum_RRF_vnor_B   + Data.value("SumRUR"); O_Sum_EKV_vnor_B   = ""; O_Sum_ITOG_vnor_B   = O_Sum_RRF_vnor_B;
           P_Kol_vnor_B   = P_Kol_vnor_B   + 1; P_Sum_RRF_vnor_B   = P_Sum_RRF_vnor_B   + Data.value("SumRUR"); P_Sum_EKV_vnor_B   = ""; P_Sum_ITOG_vnor_B   = P_Sum_RRF_vnor_B;
           B_Kol_vnor_B   = B_Kol_vnor_B   + 1; B_Sum_RRF_vnor_B   = B_Sum_RRF_vnor_B   + Data.value("SumRUR"); B_Sum_EKV_vnor_B   = ""; B_Sum_ITOG_vnor_B   = B_Sum_RRF_vnor_B;
        end;
           O_Kol_itog1_B  = O_Kol_itog1_B  + 1; O_Sum_RRF_itog1_B  = O_Sum_RRF_itog1_B  + Data.value("SumRUR"); O_Sum_EKV_itog1_B  = ""; O_Sum_ITOG_itog1_B  = O_Sum_RRF_itog1_B;
           P_Kol_itog1_B  = P_Kol_itog1_B  + 1; P_Sum_RRF_itog1_B  = P_Sum_RRF_itog1_B  + Data.value("SumRUR"); P_Sum_EKV_itog1_B  = ""; P_Sum_ITOG_itog1_B  = P_Sum_RRF_itog1_B;
           B_Kol_itog1_B  = B_Kol_itog1_B  + 1; B_Sum_RRF_itog1_B  = B_Sum_RRF_itog1_B  + Data.value("SumRUR"); B_Sum_EKV_itog1_B  = ""; B_Sum_ITOG_itog1_B  = B_Sum_RRF_itog1_B;
     else
      	if(podotchetS == "НОСТРО")
           O_Kol_nostro_E = O_Kol_nostro_E + 1; O_Sum_RRF_nostro_E = O_Sum_RRF_nostro_E + Data.value("SumRUR"); O_Sum_EKV_nostro_E = ""; O_Sum_ITOG_nostro_E = O_Sum_RRF_nostro_E;
           P_Kol_nostro_E = P_Kol_nostro_E + 1; P_Sum_RRF_nostro_E = P_Sum_RRF_nostro_E + Data.value("SumRUR"); P_Sum_EKV_nostro_E = ""; P_Sum_ITOG_nostro_E = P_Sum_RRF_nostro_E;
           B_Kol_nostro_E = B_Kol_nostro_E + 1; B_Sum_RRF_nostro_E = B_Sum_RRF_nostro_E + Data.value("SumRUR"); B_Sum_EKV_nostro_E = ""; B_Sum_ITOG_nostro_E = B_Sum_RRF_nostro_E;
        elif(podotchetS == "МФР")
           O_Kol_mfr_E    = O_Kol_mfr_E    + 1; O_Sum_RRF_mfr_E    = O_Sum_RRF_mfr_E    + Data.value("SumRUR"); O_Sum_EKV_mfr_E    = ""; O_Sum_ITOG_mfr_E    = O_Sum_RRF_mfr_E;
           P_Kol_mfr_E    = P_Kol_mfr_E    + 1; P_Sum_RRF_mfr_E    = P_Sum_RRF_mfr_E    + Data.value("SumRUR"); P_Sum_EKV_mfr_E    = ""; P_Sum_ITOG_mfr_E    = P_Sum_RRF_mfr_E;
           B_Kol_mfr_E    = B_Kol_mfr_E    + 1; B_Sum_RRF_mfr_E    = B_Sum_RRF_mfr_E    + Data.value("SumRUR"); B_Sum_EKV_mfr_E    = ""; B_Sum_ITOG_mfr_E    = B_Sum_RRF_mfr_E;
        elif(podotchetS == "Внутриклиентские")
           O_Kol_vnkl_E   = O_Kol_vnkl_E   + 1; O_Sum_RRF_vnkl_E   = O_Sum_RRF_vnkl_E   + Data.value("SumRUR"); O_Sum_EKV_vnkl_E   = ""; O_Sum_ITOG_vnkl_E   = O_Sum_RRF_vnkl_E;
           P_Kol_vnkl_E   = P_Kol_vnkl_E   + 1; P_Sum_RRF_vnkl_E   = P_Sum_RRF_vnkl_E   + Data.value("SumRUR"); P_Sum_EKV_vnkl_E   = ""; P_Sum_ITOG_vnkl_E   = P_Sum_RRF_vnkl_E;
           B_Kol_vnkl_E   = B_Kol_vnkl_E   + 1; B_Sum_RRF_vnkl_E   = B_Sum_RRF_vnkl_E   + Data.value("SumRUR"); B_Sum_EKV_vnkl_E   = ""; B_Sum_ITOG_vnkl_E   = B_Sum_RRF_vnkl_E;
        elif(podotchetS == "Внутрибанковские")
           O_Kol_vnpl_E   = O_Kol_vnpl_E   + 1; O_Sum_RRF_vnpl_E   = O_Sum_RRF_vnpl_E   + Data.value("SumRUR"); O_Sum_EKV_vnpl_E   = ""; O_Sum_ITOG_vnpl_E   = O_Sum_RRF_vnpl_E;
           P_Kol_vnpl_E   = P_Kol_vnpl_E   + 1; P_Sum_RRF_vnpl_E   = P_Sum_RRF_vnpl_E   + Data.value("SumRUR"); P_Sum_EKV_vnpl_E   = ""; P_Sum_ITOG_vnpl_E   = P_Sum_RRF_vnpl_E;
           B_Kol_vnpl_E   = B_Kol_vnpl_E   + 1; B_Sum_RRF_vnpl_E   = B_Sum_RRF_vnpl_E   + Data.value("SumRUR"); B_Sum_EKV_vnpl_E   = ""; B_Sum_ITOG_vnpl_E   = B_Sum_RRF_vnpl_E;
        elif(podotchetS == "Внутренние ордера")
           O_Kol_vnor_E   = O_Kol_vnor_E   + 1; O_Sum_RRF_vnor_E   = O_Sum_RRF_vnor_E   + Data.value("SumRUR"); O_Sum_EKV_vnor_E   = ""; O_Sum_ITOG_vnor_E   = O_Sum_RRF_vnor_E;
           P_Kol_vnor_E   = P_Kol_vnor_E   + 1; P_Sum_RRF_vnor_E   = P_Sum_RRF_vnor_E   + Data.value("SumRUR"); P_Sum_EKV_vnor_E   = ""; P_Sum_ITOG_vnor_E   = P_Sum_RRF_vnor_E;
           B_Kol_vnor_E   = B_Kol_vnor_E   + 1; B_Sum_RRF_vnor_E   = B_Sum_RRF_vnor_E   + Data.value("SumRUR"); B_Sum_EKV_vnor_E   = ""; B_Sum_ITOG_vnor_E   = B_Sum_RRF_vnor_E;
        end;
           O_Kol_itog1_E  = O_Kol_itog1_E  + 1; O_Sum_RRF_itog1_E  = O_Sum_RRF_itog1_E  + Data.value("SumRUR"); O_Sum_EKV_itog1_E  = ""; O_Sum_ITOG_itog1_E  = O_Sum_RRF_itog1_E;
           P_Kol_itog1_E  = P_Kol_itog1_E  + 1; P_Sum_RRF_itog1_E  = P_Sum_RRF_itog1_E  + Data.value("SumRUR"); P_Sum_EKV_itog1_E  = ""; P_Sum_ITOG_itog1_E  = P_Sum_RRF_itog1_E;
           B_Kol_itog1_E  = B_Kol_itog1_E  + 1; B_Sum_RRF_itog1_E  = B_Sum_RRF_itog1_E  + Data.value("SumRUR"); B_Sum_EKV_itog1_E  = ""; B_Sum_ITOG_itog1_E  = B_Sum_RRF_itog1_E;
     end;
  elif(Valuta_otchetaS == "Валюта")
//              SumR = summa_pokritia(Data.value("AppKey"));
              SumR = Data.value("sumRUR");
     if(Vid_HranS == "Б")
      	if(podotchetS == "НОСТРО")
           O_Kol_nostro_B = O_Kol_nostro_B + 1; O_Sum_RRF_nostro_B = ""; O_Sum_EKV_nostro_B = O_Sum_EKV_nostro_B + SumR; O_Sum_ITOG_nostro_B = O_Sum_EKV_nostro_B;
           P_Kol_nostro_B = P_Kol_nostro_B + 1; P_Sum_RRF_nostro_B = ""; P_Sum_EKV_nostro_B = P_Sum_EKV_nostro_B + SumR; P_Sum_ITOG_nostro_B = P_Sum_EKV_nostro_B;
           B_Kol_nostro_B = B_Kol_nostro_B + 1; B_Sum_RRF_nostro_B = ""; B_Sum_EKV_nostro_B = B_Sum_EKV_nostro_B + SumR; B_Sum_ITOG_nostro_B = B_Sum_EKV_nostro_B;
        elif(podotchetS == "МФР")
           O_Kol_mfr_B    = O_Kol_mfr_B    + 1; O_Sum_RRF_mfr_B    = ""; O_Sum_EKV_mfr_B    = O_Sum_EKV_mfr_B    + SumR; O_Sum_ITOG_mfr_B    = O_Sum_EKV_mfr_B;
           P_Kol_mfr_B    = P_Kol_mfr_B    + 1; P_Sum_RRF_mfr_B    = ""; P_Sum_EKV_mfr_B    = P_Sum_EKV_mfr_B    + SumR; P_Sum_ITOG_mfr_B    = P_Sum_EKV_mfr_B;
           B_Kol_mfr_B    = B_Kol_mfr_B    + 1; B_Sum_RRF_mfr_B    = ""; B_Sum_EKV_mfr_B    = B_Sum_EKV_mfr_B    + SumR; B_Sum_ITOG_mfr_B    = B_Sum_EKV_mfr_B;
        elif(podotchetS == "Внутриклиентские")
           O_Kol_vnkl_B   = O_Kol_vnkl_B   + 1; O_Sum_RRF_vnkl_B   = ""; O_Sum_EKV_vnkl_B   = O_Sum_EKV_vnkl_B   + SumR; O_Sum_ITOG_vnkl_B   = O_Sum_EKV_vnkl_B;
           P_Kol_vnkl_B   = P_Kol_vnkl_B   + 1; P_Sum_RRF_vnkl_B   = ""; P_Sum_EKV_vnkl_B   = P_Sum_EKV_vnkl_B   + SumR; P_Sum_ITOG_vnkl_B   = P_Sum_EKV_vnkl_B;
           B_Kol_vnkl_B   = B_Kol_vnkl_B   + 1; B_Sum_RRF_vnkl_B   = ""; B_Sum_EKV_vnkl_B   = B_Sum_EKV_vnkl_B   + SumR; B_Sum_ITOG_vnkl_B   = B_Sum_EKV_vnkl_B;
        elif(podotchetS == "Внутрибанковские")
           O_Kol_vnpl_B   = O_Kol_vnpl_B   + 1; O_Sum_RRF_vnpl_B   = ""; O_Sum_EKV_vnpl_B   = O_Sum_EKV_vnpl_B   + SumR; O_Sum_ITOG_vnpl_B   = O_Sum_EKV_vnpl_B;
           P_Kol_vnpl_B   = P_Kol_vnpl_B   + 1; P_Sum_RRF_vnpl_B   = ""; P_Sum_EKV_vnpl_B   = P_Sum_EKV_vnpl_B   + SumR; P_Sum_ITOG_vnpl_B   = P_Sum_EKV_vnpl_B;
           B_Kol_vnpl_B   = B_Kol_vnpl_B   + 1; B_Sum_RRF_vnpl_B   = ""; B_Sum_EKV_vnpl_B   = B_Sum_EKV_vnpl_B   + SumR; B_Sum_ITOG_vnpl_B   = B_Sum_EKV_vnpl_B;
        elif(podotchetS == "Внутренние ордера")
           O_Kol_vnor_B   = O_Kol_vnor_B   + 1; O_Sum_RRF_vnor_B   = ""; O_Sum_EKV_vnor_B   = O_Sum_EKV_vnor_B   + SumR; O_Sum_ITOG_vnor_B   = O_Sum_EKV_vnor_B;
           P_Kol_vnor_B   = P_Kol_vnor_B   + 1; P_Sum_RRF_vnor_B   = ""; P_Sum_EKV_vnor_B   = P_Sum_EKV_vnor_B   + SumR; P_Sum_ITOG_vnor_B   = P_Sum_EKV_vnor_B;
           B_Kol_vnor_B   = B_Kol_vnor_B   + 1; B_Sum_RRF_vnor_B   = ""; B_Sum_EKV_vnor_B   = B_Sum_EKV_vnor_B   + SumR; B_Sum_ITOG_vnor_B   = B_Sum_EKV_vnor_B;
        end;
           O_Kol_itog1_B  = O_Kol_itog1_B  + 1; O_Sum_RRF_itog1_B  = ""; O_Sum_EKV_itog1_B  = O_Sum_EKV_itog1_B  + SumR; O_Sum_ITOG_itog1_B  = O_Sum_EKV_itog1_B;
           P_Kol_itog1_B  = P_Kol_itog1_B  + 1; P_Sum_RRF_itog1_B  = ""; P_Sum_EKV_itog1_B  = P_Sum_EKV_itog1_B  + SumR; P_Sum_ITOG_itog1_B  = P_Sum_EKV_itog1_B;
           B_Kol_itog1_B  = B_Kol_itog1_B  + 1; B_Sum_RRF_itog1_B  = ""; B_Sum_EKV_itog1_B  = B_Sum_EKV_itog1_B  + SumR; B_Sum_ITOG_itog1_B  = B_Sum_EKV_itog1_B;
     else
      	if(podotchetS == "НОСТРО")
           O_Kol_nostro_E = O_Kol_nostro_E + 1; O_Sum_RRF_nostro_E = ""; O_Sum_EKV_nostro_E = O_Sum_EKV_nostro_E + SumR; O_Sum_ITOG_nostro_E = O_Sum_EKV_nostro_E;
           P_Kol_nostro_E = P_Kol_nostro_E + 1; P_Sum_RRF_nostro_E = ""; P_Sum_EKV_nostro_E = P_Sum_EKV_nostro_E + SumR; P_Sum_ITOG_nostro_E = P_Sum_EKV_nostro_E;
           B_Kol_nostro_E = B_Kol_nostro_E + 1; B_Sum_RRF_nostro_E = ""; B_Sum_EKV_nostro_E = B_Sum_EKV_nostro_E + SumR; B_Sum_ITOG_nostro_E = B_Sum_EKV_nostro_E;
        elif(podotchetS == "МФР")
           O_Kol_mfr_E    = O_Kol_mfr_E    + 1; O_Sum_RRF_mfr_E    = ""; O_Sum_EKV_mfr_E    = O_Sum_EKV_mfr_E    + SumR; O_Sum_ITOG_mfr_E    = O_Sum_EKV_mfr_E;
           P_Kol_mfr_E    = P_Kol_mfr_E    + 1; P_Sum_RRF_mfr_E    = ""; P_Sum_EKV_mfr_E    = P_Sum_EKV_mfr_E    + SumR; P_Sum_ITOG_mfr_E    = P_Sum_EKV_mfr_E;
           B_Kol_mfr_E    = B_Kol_mfr_E    + 1; B_Sum_RRF_mfr_E    = ""; B_Sum_EKV_mfr_E    = B_Sum_EKV_mfr_E    + SumR; B_Sum_ITOG_mfr_E    = B_Sum_EKV_mfr_E;
        elif(podotchetS == "Внутриклиентские")
           O_Kol_vnkl_E   = O_Kol_vnkl_E   + 1; O_Sum_RRF_vnkl_E   = ""; O_Sum_EKV_vnkl_E   = O_Sum_EKV_vnkl_E   + SumR; O_Sum_ITOG_vnkl_E   = O_Sum_EKV_vnkl_E;
           P_Kol_vnkl_E   = P_Kol_vnkl_E   + 1; P_Sum_RRF_vnkl_E   = ""; P_Sum_EKV_vnkl_E   = P_Sum_EKV_vnkl_E   + SumR; P_Sum_ITOG_vnkl_E   = P_Sum_EKV_vnkl_E;
           B_Kol_vnkl_E   = B_Kol_vnkl_E   + 1; B_Sum_RRF_vnkl_E   = ""; B_Sum_EKV_vnkl_E   = B_Sum_EKV_vnkl_E   + SumR; B_Sum_ITOG_vnkl_E   = B_Sum_EKV_vnkl_E;
        elif(podotchetS == "Внутрибанковские")
           O_Kol_vnpl_E   = O_Kol_vnpl_E   + 1; O_Sum_RRF_vnpl_E   = ""; O_Sum_EKV_vnpl_E   = O_Sum_EKV_vnpl_E   + SumR; O_Sum_ITOG_vnpl_E   = O_Sum_EKV_vnpl_E;
           P_Kol_vnpl_E   = P_Kol_vnpl_E   + 1; P_Sum_RRF_vnpl_E   = ""; P_Sum_EKV_vnpl_E   = P_Sum_EKV_vnpl_E   + SumR; P_Sum_ITOG_vnpl_E   = P_Sum_EKV_vnpl_E;
           B_Kol_vnpl_E   = B_Kol_vnpl_E   + 1; B_Sum_RRF_vnpl_E   = ""; B_Sum_EKV_vnpl_E   = B_Sum_EKV_vnpl_E   + SumR; B_Sum_ITOG_vnpl_E   = B_Sum_EKV_vnpl_E;
        elif(podotchetS == "Внутренние ордера")
           O_Kol_vnor_E   = O_Kol_vnor_E   + 1; O_Sum_RRF_vnor_E   = ""; O_Sum_EKV_vnor_E   = O_Sum_EKV_vnor_E   + SumR; O_Sum_ITOG_vnor_E   = O_Sum_EKV_vnor_E;
           P_Kol_vnor_E   = P_Kol_vnor_E   + 1; P_Sum_RRF_vnor_E   = ""; P_Sum_EKV_vnor_E   = P_Sum_EKV_vnor_E   + SumR; P_Sum_ITOG_vnor_E   = P_Sum_EKV_vnor_E;
           B_Kol_vnor_E   = B_Kol_vnor_E   + 1; B_Sum_RRF_vnor_E   = ""; B_Sum_EKV_vnor_E   = B_Sum_EKV_vnor_E   + SumR; B_Sum_ITOG_vnor_E   = B_Sum_EKV_vnor_E;
        end;
           O_Kol_itog1_E  = O_Kol_itog1_E  + 1; O_Sum_RRF_itog1_E  = ""; O_Sum_EKV_itog1_E  = O_Sum_EKV_itog1_E  + SumR; O_Sum_ITOG_itog1_E  = O_Sum_EKV_itog1_E;
           P_Kol_itog1_E  = P_Kol_itog1_E  + 1; P_Sum_RRF_itog1_E  = ""; P_Sum_EKV_itog1_E  = P_Sum_EKV_itog1_E  + SumR; P_Sum_ITOG_itog1_E  = P_Sum_EKV_itog1_E;
           B_Kol_itog1_E  = B_Kol_itog1_E  + 1; B_Sum_RRF_itog1_E  = ""; B_Sum_EKV_itog1_E  = B_Sum_EKV_itog1_E  + SumR; B_Sum_ITOG_itog1_E  = B_Sum_EKV_itog1_E;
     end;
  elif (Mode == "Баланс - Конверсионные - Все")
/*-------------------------------------------------------------------------------------------------------------------------------*/
  if((substr(data.value("AccKr"),14,5) == "21010") or (substr(data.value("AccKr"),14,5) == "22010") or (substr(data.value("AccDeb"),14,5) == "21010") or (substr(data.value("AccDeb"),14,5) == "22010") or (data.value("T_RESULT_CARRY") == 18))
//     if(StoreKind == 0)
     if(Vid_HranS == "Б")
        O_Kol_itog1_B  = O_Kol_itog1_B  + 1; O_Sum_RRF_itog1_B  = O_Sum_RRF_itog1_B + data.value("sum");   O_Sum_ITOG_itog1_B  = O_Sum_ITOG_itog1_B  + data.value("sum");
        P_Kol_itog1_B  = P_Kol_itog1_B  + 1; P_Sum_RRF_itog1_B  = P_Sum_RRF_itog1_B + data.value("sum");   P_Sum_ITOG_itog1_B  = P_Sum_ITOG_itog1_B  + data.value("sum");
        B_Kol_itog1_B  = B_Kol_itog1_B  + 1; B_Sum_RRF_itog1_B  = B_Sum_RRF_itog1_B + data.value("sum");   B_Sum_ITOG_itog1_B  = B_Sum_ITOG_itog1_B  + data.value("sum");
     else                                                                                                                                           
        O_Kol_itog1_E  = O_Kol_itog1_E  + 1; O_Sum_RRF_itog1_E  = O_Sum_RRF_itog1_E + data.value("sum");   O_Sum_ITOG_itog1_E  = O_Sum_ITOG_itog1_E  + data.value("sum");
        P_Kol_itog1_E  = P_Kol_itog1_E  + 1; P_Sum_RRF_itog1_E  = P_Sum_RRF_itog1_E + data.value("sum");   P_Sum_ITOG_itog1_E  = P_Sum_ITOG_itog1_E  + data.value("sum");
        B_Kol_itog1_E  = B_Kol_itog1_E  + 1; B_Sum_RRF_itog1_E  = B_Sum_RRF_itog1_E + data.value("sum");   B_Sum_ITOG_itog1_E  = B_Sum_ITOG_itog1_E  + data.value("sum");
     end;                                                                                                
  else
//    if(StoreKind == 0)
     if(Vid_HranS == "Б")
        O_Kol_itog1_B  = O_Kol_itog1_B  + 1; O_Sum_EKV_itog1_B  = O_Sum_EKV_itog1_B + data.value("sum");   O_Sum_ITOG_itog1_B  = O_Sum_ITOG_itog1_B  +  data.value("sum");
        P_Kol_itog1_B  = P_Kol_itog1_B  + 1; P_Sum_EKV_itog1_B  = P_Sum_EKV_itog1_B + data.value("sum");   P_Sum_ITOG_itog1_B  = P_Sum_ITOG_itog1_B  +  data.value("sum");
        B_Kol_itog1_B  = B_Kol_itog1_B  + 1; B_Sum_EKV_itog1_B  = B_Sum_EKV_itog1_B + data.value("sum");   B_Sum_ITOG_itog1_B  = B_Sum_ITOG_itog1_B  +  data.value("sum");
       else                                                                                                                                                               
        O_Kol_itog1_E  = O_Kol_itog1_E  + 1; O_Sum_EKV_itog1_E  = O_Sum_EKV_itog1_E + data.value("sum");   O_Sum_ITOG_itog1_E  = O_Sum_ITOG_itog1_E  +  data.value("sum");
        P_Kol_itog1_E  = P_Kol_itog1_E  + 1; P_Sum_EKV_itog1_E  = P_Sum_EKV_itog1_E + data.value("sum");   P_Sum_ITOG_itog1_E  = P_Sum_ITOG_itog1_E  +  data.value("sum");
        B_Kol_itog1_E  = B_Kol_itog1_E  + 1; B_Sum_EKV_itog1_E  = B_Sum_EKV_itog1_E + data.value("sum");   B_Sum_ITOG_itog1_E  = B_Sum_ITOG_itog1_E  +  data.value("sum");
       end;
  end;                                                                                                     

/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/


  end;
	 END;/*while*/
    отдел1 = substr(otdel2,1 ,20);отдел2 = substr(otdel2,21,20);отдел3 = substr(otdel2,41,20);    
    отдел4 = substr(otdel2,61,20);отдел5 = substr(otdel2,81,20);отдел6 = substr(otdel2,101,20);
        perv = 0;
if(Mode == "Баланс - Конверсионные - Все")
      [  │ ##################### │ Итого по   │ Б │############│###############│###############│###############│
         │ ##################### │ конверсион ├───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ ##################### │ ным        │ Э │############│###############│###############│###############│
         ├───────────────────────┴────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤](
          отдел1,                             O_Kol_itog1_B,  O_Sum_RRF_itog1_B,O_Sum_EKV_itog1_B,O_Sum_ITOG_itog1_B,
          отдел2,  
          отдел3,                             O_Kol_itog1_E,  O_Sum_RRF_itog1_E,O_Sum_EKV_itog1_E,O_Sum_ITOG_itog1_E);
elif ((Mode == "Баланс - Рубли - Все") or (Mode == "Баланс - Валюта - Все"))                            
      [  │ ##################### │            │ Б │############│###############│###############│###############│
         │ ##################### │ БР/НОСТРО  ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │ ##################### │            │ Э │############│###############│###############│###############│
	 │ ##################### ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ ##################### │            │ Б │############│###############│###############│###############│
         │ ##################### │ БР/МФР     ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │ БР/Кл      ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
	 │                       │ БР/Пл      ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │ БР/МО      ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │ Итого по   │ Б │############│###############│###############│###############│
         │                       │ отчетам    ├───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Э │############│###############│###############│###############│
         ├───────────────────────┼────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤](
          отдел1,                             O_Kol_nostro_B,O_Sum_RRF_nostro_B,O_Sum_EKV_nostro_B,O_Sum_ITOG_nostro_B,
          отдел2,
          отдел3,                             O_Kol_nostro_E,O_Sum_RRF_nostro_E,O_Sum_EKV_nostro_E,O_Sum_ITOG_nostro_E, 
          отдел4,                                        
          отдел5,                             O_Kol_mfr_B,    O_Sum_RRF_mfr_B,  O_Sum_EKV_mfr_B,  O_Sum_ITOG_mfr_B, 
          отдел6,                             O_Kol_mfr_E,    O_Sum_RRF_mfr_E,  O_Sum_EKV_mfr_E,  O_Sum_ITOG_mfr_E, 
                                              O_Kol_vnkl_B,   O_Sum_RRF_vnkl_B, O_Sum_EKV_vnkl_B, O_Sum_ITOG_vnkl_B,
                                              O_Kol_vnkl_E,   O_Sum_RRF_vnkl_E, O_Sum_EKV_vnkl_E, O_Sum_ITOG_vnkl_E,
                                              O_Kol_vnpl_B,   O_Sum_RRF_vnpl_B, O_Sum_EKV_vnpl_B, O_Sum_ITOG_vnpl_B,
                                              O_Kol_vnpl_E,   O_Sum_RRF_vnpl_E, O_Sum_EKV_vnpl_E, O_Sum_ITOG_vnpl_E,
                                              O_Kol_vnor_B,   O_Sum_RRF_vnor_B, O_Sum_EKV_vnor_B, O_Sum_ITOG_vnor_B,
                                              O_Kol_vnor_E,   O_Sum_RRF_vnor_E, O_Sum_EKV_vnor_E, O_Sum_ITOG_vnor_E,
                                              O_Kol_itog1_B,  O_Sum_RRF_itog1_B,O_Sum_EKV_itog1_B,O_Sum_ITOG_itog1_B,
                                              O_Kol_itog1_E,  O_Sum_RRF_itog1_E,O_Sum_EKV_itog1_E,O_Sum_ITOG_itog1_E);
else
      if(podotchetS == "НОСТРО") pechat_podotchet = "БР/НОСТРО";
    elif(podotchetS == "МФР") pechat_podotchet = "БР/МФР";
    elif(podotchetS == "Внутриклиентские") pechat_podotchet = "БР/Кл";
    elif(podotchetS == "Внутрибанковские") pechat_podotchet = "БР/Пл";
    elif(podotchetS == "Внутренние ордера") pechat_podotchet = "БР/МО";
     end;
      [  │ ##################### │            │ Б │############│###############│###############│###############│
         │ ##################### │ ########## ├───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ ##################### │            │ Э │############│###############│###############│###############│
         ├───────────────────────┼────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤](
          отдел1,                             O_Kol_itog1_B,  O_Sum_RRF_itog1_B,O_Sum_EKV_itog1_B,O_Sum_ITOG_itog1_B,
          отдел2,                  pechat_podotchet,
          отдел3,                             O_Kol_itog1_E,  O_Sum_RRF_itog1_E,O_Sum_EKV_itog1_E,O_Sum_ITOG_itog1_E);
end;
if((Mode == "Баланс - Конверсионные - Все") and ((NumPodOtdel == 0) or (NumOtdel == 0) or (NumOtdel == "")))
      [  │ПОДР. ########                      │ Б │############│###############│###############│###############│
         │                                    ├───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ИТОГО ПО ВИДАМ ХРАНЕНИЯ             │ Э │############│###############│###############│###############│
         ├────────────────────────────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤](
               substr(подразделение2,1,5),    P_Kol_itog1_B,  P_Sum_RRF_itog1_B,P_Sum_EKV_itog1_B,P_Sum_ITOG_itog1_B,
                                              P_Kol_itog1_E,  P_Sum_RRF_itog1_E,P_Sum_EKV_itog1_E,P_Sum_ITOG_itog1_E);
elif (((Mode == "Баланс - Рубли - Все") or (Mode == "Баланс - Валюта - Все")) and ((NumPodOtdel == 0) or (NumOtdel == 0) or (NumOtdel == "")))
      [  │ПОДР. ########         │            │ Б │############│###############│###############│###############│
         │ИТОГО ПО ВИДАМ ОТЧЕТОВ │ БР/НОСТРО  ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │ БР/МФР     ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │ БР/Кл      ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
	 │                       │ БР/Пл      ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │ БР/МО      ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
         ├───────────────────────┴────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ПОДР. ########                      │ Б │############│###############│###############│###############│
         │                                    ├───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ИТОГО ПО ВИДАМ ХРАНЕНИЯ             │ Э │############│###############│###############│###############│
         ├───────────────────────┬────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤](
               substr(подразделение2,1,5),    P_Kol_nostro_B,P_Sum_RRF_nostro_B,P_Sum_EKV_nostro_B,P_Sum_ITOG_nostro_B,
                                              P_Kol_nostro_E,P_Sum_RRF_nostro_E,P_Sum_EKV_nostro_E,P_Sum_ITOG_nostro_E, 
                                              P_Kol_mfr_B,    P_Sum_RRF_mfr_B,  P_Sum_EKV_mfr_B,  P_Sum_ITOG_mfr_B, 
                                              P_Kol_mfr_E,    P_Sum_RRF_mfr_E,  P_Sum_EKV_mfr_E,  P_Sum_ITOG_mfr_E, 
                                              P_Kol_vnkl_B,   P_Sum_RRF_vnkl_B, P_Sum_EKV_vnkl_B, P_Sum_ITOG_vnkl_B,
                                              P_Kol_vnkl_E,   P_Sum_RRF_vnkl_E, P_Sum_EKV_vnkl_E, P_Sum_ITOG_vnkl_E,
                                              P_Kol_vnpl_B,   P_Sum_RRF_vnpl_B, P_Sum_EKV_vnpl_B, P_Sum_ITOG_vnpl_B,
                                              P_Kol_vnpl_E,   P_Sum_RRF_vnpl_E, P_Sum_EKV_vnpl_E, P_Sum_ITOG_vnpl_E,
                                              P_Kol_vnor_B,   P_Sum_RRF_vnor_B, P_Sum_EKV_vnor_B, P_Sum_ITOG_vnor_B,
                                              P_Kol_vnor_E,   P_Sum_RRF_vnor_E, P_Sum_EKV_vnor_E, P_Sum_ITOG_vnor_E,
               substr(подразделение2,1,5),    P_Kol_itog1_B,  P_Sum_RRF_itog1_B,P_Sum_EKV_itog1_B,P_Sum_ITOG_itog1_B,
                                              P_Kol_itog1_E,  P_Sum_RRF_itog1_E,P_Sum_EKV_itog1_E,P_Sum_ITOG_itog1_E);
elif ((NumPodOtdel == 0) or (NumOtdel == 0) or (NumOtdel == ""))
      [  │ПОДР. ########                      │ Б │############│###############│###############│###############│
         │                                    ├───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ИТОГО ПО ВИДАМ ХРАНЕНИЯ             │ Э │############│###############│###############│###############│
         ├────────────────────────────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤](
//         │                                                                                                     │
//         │         ################################################################################            │
//         ├───────────────────────┬────────────┬───┬────────────┬───────────────┬───────────────┬───────────────┤
               substr(подразделение2,1,5),    P_Kol_itog1_B,  P_Sum_RRF_itog1_B,P_Sum_EKV_itog1_B,P_Sum_ITOG_itog1_B,
                                              P_Kol_itog1_E,  P_Sum_RRF_itog1_E,P_Sum_EKV_itog1_E,P_Sum_ITOG_itog1_E);
                  /* подразделение1*///);
end;
/*----------------------------------------------------------*/
/*          отбор по неизвестному подразделению             */
/*----------------------------------------------------------*/
//------------------------------------------------------------------------------------------------//|---------------------|
     P_Kol_nostro_B = 0;P_Sum_RRF_nostro_B = $0;P_Sum_EKV_nostro_B = $0;P_Sum_ITOG_nostro_B = $0; //|                     |
     P_Kol_nostro_E = 0;P_Sum_RRF_nostro_E = $0;P_Sum_EKV_nostro_E = $0;P_Sum_ITOG_nostro_E = $0; //|                     |
     P_Kol_mfr_B    = 0;P_Sum_RRF_mfr_B    = $0;P_Sum_EKV_mfr_B    = $0;P_Sum_ITOG_mfr_B    = $0; //|                     |
     P_Kol_mfr_E    = 0;P_Sum_RRF_mfr_E    = $0;P_Sum_EKV_mfr_E    = $0;P_Sum_ITOG_mfr_E    = $0; //|СЧЕТЧИКИ ПО ПОДРАЗД-М|
     P_Kol_vnkl_B   = 0;P_Sum_RRF_vnkl_B   = $0;P_Sum_EKV_vnkl_B   = $0;P_Sum_ITOG_vnkl_B   = $0; //|(порядок расположения|
     P_Kol_vnkl_E   = 0;P_Sum_RRF_vnkl_E   = $0;P_Sum_EKV_vnkl_E   = $0;P_Sum_ITOG_vnkl_E   = $0; //|соответствует        |
     P_Kol_vnpl_B   = 0;P_Sum_RRF_vnpl_B   = $0;P_Sum_EKV_vnpl_B   = $0;P_Sum_ITOG_vnpl_B   = $0; //|очередности вывода   |
     P_Kol_vnpl_E   = 0;P_Sum_RRF_vnpl_E   = $0;P_Sum_EKV_vnpl_E   = $0;P_Sum_ITOG_vnpl_E   = $0; //|на печать)           |
     P_Kol_vnor_B   = 0;P_Sum_RRF_vnor_B   = $0;P_Sum_EKV_vnor_B   = $0;P_Sum_ITOG_vnor_B   = $0; //|                     |
     P_Kol_vnor_E   = 0;P_Sum_RRF_vnor_E   = $0;P_Sum_EKV_vnor_E   = $0;P_Sum_ITOG_vnor_E   = $0; //|                     |
     P_Kol_itog1_B  = 0;P_Sum_RRF_itog1_B  = $0;P_Sum_EKV_itog1_B  = $0;P_Sum_ITOG_itog1_B  = $0; //|                     |
     P_Kol_itog1_E  = 0;P_Sum_RRF_itog1_E  = $0;P_Sum_EKV_itog1_E  = $0;P_Sum_ITOG_itog1_E  = $0; //|                     |
//------------------------------------------------------------------------------------------------//|---------------------|
if((NumOtdel == 0) or (NumOtdel == ""))
select_1000_1 =  " select distinct accdeb,acckr,SUM,sumRUR, nvl(paymentid,-1) paymentid, (SELECT storeKind FROM TABLE(USER_EA.Get_dev_prop           "+  
"        (a.dockind, a.origin, a.paymkind, a.shifr_oper, a.numb_pack, a.chapter, a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))) vid_hran,a.T_RESULT_CARRY,AppKey       "+
"       from                                                                                                                                         "+
"        (select  arh.t_oper,                                                                                                                        "+
"                arh.t_numb_document AS NumDoc, arh.t_account_payer AS AccDeb, arh.t_account_receiver AS AccKr,arh.T_SUM_PAYER AS SUM, arh.T_SUM_NATCUR sumRUR,            "+
"                arh.t_acctrnid AppKey,arh.t_typedocument,                                                                     "+
"                prop.T_PAYMENTKIND paymkind, user_ea.GetOrigin ( paym.t_dockind, paym.t_paymentid) origin, arh.T_CHAPTER chapter, paym.T_DOCKIND dockind, arh.T_NUMBER_PACK numb_pack,     "+
"                arh.T_SHIFR_OPER shifr_oper, arh.T_FIID_PAYER, arh.T_FIID_RECEIVER, paym.t_paymentid paymentid, arh.T_RESULT_CARRY      "+
"           FROM dpmdocs_dbt docs,dpmpaym_dbt paym,dpmrmprop_dbt prop,                                           ";
select_1000_2 = "    AND arh.t_date_carry = TO_DATE ('" + DateDocum +"', 'DD.MM.YYYY')                                                               "+
"                    AND arh.t_chapter = "+ chapter ;
if(substr(RepTypes,1,9) != "Баланс ->")
select_1000_2 = select_1000_2 +
"                    AND arh.t_result_carry <> 14                                                                                                    ";
end;
select_1000_2 = select_1000_2 +
"                    AND arh.t_acctrnid = docs.t_acctrnid(+)                                                                             "+
"                    AND docs.t_paymentid = paym.t_paymentid(+)                                                                                      "+
"                    AND paym.t_paymentid = prop.t_paymentid(+)                                                                                      ";
Select_1000_3 = "    AND arh.t_oper not in (select dop_otdel_dbt.T_oper from dop_otdel_dbt                                                           "+        
"                        where (dop_otdel_dbt.t_dateend >= TO_DATE ('" + DateDocum +"', 'DD.MM.YYYY')                                                "+      
"                        or t_dateend  = TO_DATE ('01.01.0001', 'DD.MM.YYYY'))                                                                       "+            
"                        and t_datebegin <= TO_DATE ('" + DateDocum +"', 'DD.MM.YYYY'))                                                              ";
if(RepTypes != "Внебаланс")
Select_1000_3 = Select_1000_3 +
"                    AND (   EXISTS (                                                                                                                "+
"                               SELECT 1                                                                                                             "+
"                                 FROM dpmprop_dbt deb, dpmprop_dbt cred                                                                             "+
"                                WHERE cred.t_paymentid = docs.t_paymentid                                                                           "+
"                                  AND deb.t_paymentid = docs.t_paymentid                                                                            "+
"                                  AND deb.t_paymentid = cred.t_paymentid                                                                            "+
"            and deb.t_debetcredit = 0 and cred.t_debetcredit = 1                                                                                    "+
"                                  AND cred.t_group <> 1                                                                                             "+
"                                  AND deb.t_group <> 1)                                                                                             "+
"                         OR docs.t_paymentid IS NULL )                                                                                              ";
end;
if((Valuta_otchetaS == "Рубли") or (Valuta_otchetaS == "Валюта"))
Select_1000_3 = Select_1000_3 +
             nbalanse1 + ")" + "\n" + nbalanse2 + ")" + "\n" + ") a                                                                                  ";	                                                                                                                                             
end;
if(Valuta_otchetaS == "Рубли")
	if(RepTypes != "Внебаланс")
	   Select = Select_1000_1 + "dacctrn_dbt arh  Where substr(arh.T_ACCOUNT_PAYER,6,3) = '810' and substr(arh.T_ACCOUNT_RECEIVER,6,3) = '810' " ; 
	else
           Select = Select_1000_1 + "dacctrn_dbt arh  Where ((SUBSTR (arh.t_account_payer, 6, 3) = '810' and SUBSTR (arh.t_account_receiver, 6,3) = '810') "+
	      "  OR (SUBSTR (arh.t_account_payer, 6, 3) <> SUBSTR (arh.t_account_receiver, 6,3)))                                                   ";
        end;
           Select = Select +
              select_1000_2 + " AND SUBSTR (arh.t_account_receiver, 1, 5) NOT IN ('20202','20203','20207')"+ 	
              " AND SUBSTR (arh.t_account_payer, 1, 5) NOT IN ('20202','20203','20207') "+ select_1000_3;
elif(Valuta_otchetaS == "Валюта")
	Select = Select_1000_1 + "dacctrn_dbt arh  Where substr(arh.T_ACCOUNT_PAYER,6,3) = substr(arh.T_ACCOUNT_RECEIVER,6,3) " + select_1000_2 +
              " AND SUBSTR (arh.t_account_receiver, 1, 5) NOT IN ('20202','20203','20207')"+ 	
              " AND SUBSTR (arh.t_account_payer, 1, 5) NOT IN ('20202','20203','20207') "+ select_1000_3;
elif(Mode == "Баланс - Конверсионные - Все")
	select = select_1000_1 + " dacctrn_dbt arh  where substr(arh.T_ACCOUNT_PAYER,6,3) <> substr(arh.T_ACCOUNT_RECEIVER,6,3) " + select_1000_2 +
              " AND (SUBSTR (arh.t_account_receiver, 1, 5) NOT IN ('20202','20203','20207') or arh.T_RESULT_CARRY in (18,82))"+ 	
              " AND (SUBSTR (arh.t_account_payer, 1, 5) NOT IN ('20202','20203','20207') or arh.T_RESULT_CARRY in (18,82))"+ select_1000_3 + " )a "; 
end;
	Data = ExecSQLSelect(Select);

while(Data.movenext())
    дебет  = substr(Data.value("AccDeb"),1,5);
    кредит = substr(Data.value("AccKr"),1,5);
                StoreKind = data.value("vid_hran");
               if(StoreKind != 0)
                StoreKind = 1;
               end;
	payment_id = data.value("paymentid");
	StoreKind = kateg_vid_hran(payment_id,StoreKind,chapter);
   if (Mode == "Баланс - Конверсионные - Все")
     paymentid1 = data.value("paymentid");
  end;
 Pechat_po_vidu_hranenia(StoreKind,VidHranS,Flag_pechati_provodkiS, Vid_HranS);
 podotchetS = opredelenie_podotcheta(дебет,кредит);
        if (Valuta_otchetaS == "Рубли")
     if(Vid_HranS == "Б") //and (substr(data.value("accDeb"),1,5) != "90901")and (substr(data.value("accDeb"),1,5) != "90902")and (substr(data.value("accKr"),1,5) != "90901")and (substr(data.value("accKr"),1,5) != "90902"))
      	if(podotchetS == "НОСТРО")
           P_Kol_nostro_B = P_Kol_nostro_B + 1; P_Sum_RRF_nostro_B = P_Sum_RRF_nostro_B + Data.value("SumRUR"); P_Sum_EKV_nostro_B = ""; P_Sum_ITOG_nostro_B = P_Sum_RRF_nostro_B;
           B_Kol_nostro_B = B_Kol_nostro_B + 1; B_Sum_RRF_nostro_B = B_Sum_RRF_nostro_B + Data.value("SumRUR"); B_Sum_EKV_nostro_B = ""; B_Sum_ITOG_nostro_B = B_Sum_RRF_nostro_B;
        elif(podotchetS == "МФР")
           P_Kol_mfr_B    = P_Kol_mfr_B    + 1; P_Sum_RRF_mfr_B    = P_Sum_RRF_mfr_B    + Data.value("SumRUR"); P_Sum_EKV_mfr_B    = ""; P_Sum_ITOG_mfr_B    = P_Sum_RRF_mfr_B;
           B_Kol_mfr_B    = B_Kol_mfr_B    + 1; B_Sum_RRF_mfr_B    = B_Sum_RRF_mfr_B    + Data.value("SumRUR"); B_Sum_EKV_mfr_B    = ""; B_Sum_ITOG_mfr_B    = B_Sum_RRF_mfr_B;
        elif(podotchetS == "Внутриклиентские")
           P_Kol_vnkl_B   = P_Kol_vnkl_B   + 1; P_Sum_RRF_vnkl_B   = P_Sum_RRF_vnkl_B   + Data.value("SumRUR"); P_Sum_EKV_vnkl_B   = ""; P_Sum_ITOG_vnkl_B   = P_Sum_RRF_vnkl_B;
           B_Kol_vnkl_B   = B_Kol_vnkl_B   + 1; B_Sum_RRF_vnkl_B   = B_Sum_RRF_vnkl_B   + Data.value("SumRUR"); B_Sum_EKV_vnkl_B   = ""; B_Sum_ITOG_vnkl_B   = B_Sum_RRF_vnkl_B;
        elif(podotchetS == "Внутрибанковские")
           P_Kol_vnpl_B   = P_Kol_vnpl_B   + 1; P_Sum_RRF_vnpl_B   = P_Sum_RRF_vnpl_B   + Data.value("SumRUR"); P_Sum_EKV_vnpl_B   = ""; P_Sum_ITOG_vnpl_B   = P_Sum_RRF_vnpl_B;
           B_Kol_vnpl_B   = B_Kol_vnpl_B   + 1; B_Sum_RRF_vnpl_B   = B_Sum_RRF_vnpl_B   + Data.value("SumRUR"); B_Sum_EKV_vnpl_B   = ""; B_Sum_ITOG_vnpl_B   = B_Sum_RRF_vnpl_B;
        elif(podotchetS == "Внутренние ордера")
           P_Kol_vnor_B   = P_Kol_vnor_B   + 1; P_Sum_RRF_vnor_B   = P_Sum_RRF_vnor_B   + Data.value("SumRUR"); P_Sum_EKV_vnor_B   = ""; P_Sum_ITOG_vnor_B   = P_Sum_RRF_vnor_B;
           B_Kol_vnor_B   = B_Kol_vnor_B   + 1; B_Sum_RRF_vnor_B   = B_Sum_RRF_vnor_B   + Data.value("SumRUR"); B_Sum_EKV_vnor_B   = ""; B_Sum_ITOG_vnor_B   = B_Sum_RRF_vnor_B;
        end;
           P_Kol_itog1_B  = P_Kol_itog1_B  + 1; P_Sum_RRF_itog1_B  = P_Sum_RRF_itog1_B  + Data.value("SumRUR"); P_Sum_EKV_itog1_B  = ""; P_Sum_ITOG_itog1_B  = P_Sum_RRF_itog1_B;
           B_Kol_itog1_B  = B_Kol_itog1_B  + 1; B_Sum_RRF_itog1_B  = B_Sum_RRF_itog1_B  + Data.value("SumRUR"); B_Sum_EKV_itog1_B  = ""; B_Sum_ITOG_itog1_B  = B_Sum_RRF_itog1_B;
     else
      	if(podotchetS == "НОСТРО")
           P_Kol_nostro_E = P_Kol_nostro_E + 1; P_Sum_RRF_nostro_E = P_Sum_RRF_nostro_E + Data.value("SumRUR"); P_Sum_EKV_nostro_E = ""; P_Sum_ITOG_nostro_E = P_Sum_RRF_nostro_E;
           B_Kol_nostro_E = B_Kol_nostro_E + 1; B_Sum_RRF_nostro_E = B_Sum_RRF_nostro_E + Data.value("SumRUR"); B_Sum_EKV_nostro_E = ""; B_Sum_ITOG_nostro_E = B_Sum_RRF_nostro_E;
        elif(podotchetS == "МФР")
           P_Kol_mfr_E    = P_Kol_mfr_E    + 1; P_Sum_RRF_mfr_E    = P_Sum_RRF_mfr_E    + Data.value("SumRUR"); P_Sum_EKV_mfr_E    = ""; P_Sum_ITOG_mfr_E    = P_Sum_RRF_mfr_E;
           B_Kol_mfr_E    = B_Kol_mfr_E    + 1; B_Sum_RRF_mfr_E    = B_Sum_RRF_mfr_E    + Data.value("SumRUR"); B_Sum_EKV_mfr_E    = ""; B_Sum_ITOG_mfr_E    = B_Sum_RRF_mfr_E;
        elif(podotchetS == "Внутриклиентские")
           P_Kol_vnkl_E   = P_Kol_vnkl_E   + 1; P_Sum_RRF_vnkl_E   = P_Sum_RRF_vnkl_E   + Data.value("SumRUR"); P_Sum_EKV_vnkl_E   = ""; P_Sum_ITOG_vnkl_E   = P_Sum_RRF_vnkl_E;
           B_Kol_vnkl_E   = B_Kol_vnkl_E   + 1; B_Sum_RRF_vnkl_E   = B_Sum_RRF_vnkl_E   + Data.value("SumRUR"); B_Sum_EKV_vnkl_E   = ""; B_Sum_ITOG_vnkl_E   = B_Sum_RRF_vnkl_E;
        elif(podotchetS == "Внутрибанковские")
           P_Kol_vnpl_E   = P_Kol_vnpl_E   + 1; P_Sum_RRF_vnpl_E   = P_Sum_RRF_vnpl_E   + Data.value("SumRUR"); P_Sum_EKV_vnpl_E   = ""; P_Sum_ITOG_vnpl_E   = P_Sum_RRF_vnpl_E;
           B_Kol_vnpl_E   = B_Kol_vnpl_E   + 1; B_Sum_RRF_vnpl_E   = B_Sum_RRF_vnpl_E   + Data.value("SumRUR"); B_Sum_EKV_vnpl_E   = ""; B_Sum_ITOG_vnpl_E   = B_Sum_RRF_vnpl_E;
        elif(podotchetS == "Внутренние ордера")
           P_Kol_vnor_E   = P_Kol_vnor_E   + 1; P_Sum_RRF_vnor_E   = P_Sum_RRF_vnor_E   + Data.value("SumRUR"); P_Sum_EKV_vnor_E   = ""; P_Sum_ITOG_vnor_E   = P_Sum_RRF_vnor_E;
           B_Kol_vnor_E   = B_Kol_vnor_E   + 1; B_Sum_RRF_vnor_E   = B_Sum_RRF_vnor_E   + Data.value("SumRUR"); B_Sum_EKV_vnor_E   = ""; B_Sum_ITOG_vnor_E   = B_Sum_RRF_vnor_E;
        end;
           P_Kol_itog1_E  = P_Kol_itog1_E  + 1; P_Sum_RRF_itog1_E  = P_Sum_RRF_itog1_E  + Data.value("SumRUR"); P_Sum_EKV_itog1_E  = ""; P_Sum_ITOG_itog1_E  = P_Sum_RRF_itog1_E;
           B_Kol_itog1_E  = B_Kol_itog1_E  + 1; B_Sum_RRF_itog1_E  = B_Sum_RRF_itog1_E  + Data.value("SumRUR"); B_Sum_EKV_itog1_E  = ""; B_Sum_ITOG_itog1_E  = B_Sum_RRF_itog1_E;
     end;
       elif(Valuta_otchetaS == "Валюта")
              SumR = Data.value("SumRUR");
/*              SumR = summa_pokritia(Data.value("AppKey"));
         if(SumR == -1)
              SumR = СуммаРуб( data.value("Sum"), data.value("T_CODE_CURRENCY"), DateDocum );
         end;*/
     if(Vid_HranS == "Б")
      	if(podotchetS == "НОСТРО")
           P_Kol_nostro_B = P_Kol_nostro_B + 1; P_Sum_RRF_nostro_B = ""; P_Sum_EKV_nostro_B = P_Sum_EKV_nostro_B + SumR; P_Sum_ITOG_nostro_B = P_Sum_EKV_nostro_B;
           B_Kol_nostro_B = B_Kol_nostro_B + 1; B_Sum_RRF_nostro_B = ""; B_Sum_EKV_nostro_B = B_Sum_EKV_nostro_B + SumR; B_Sum_ITOG_nostro_B = B_Sum_EKV_nostro_B;
        elif(podotchetS == "МФР")
           P_Kol_mfr_B    = P_Kol_mfr_B    + 1; P_Sum_RRF_mfr_B    = ""; P_Sum_EKV_mfr_B    = P_Sum_EKV_mfr_B    + SumR; P_Sum_ITOG_mfr_B    = P_Sum_EKV_mfr_B;
           B_Kol_mfr_B    = B_Kol_mfr_B    + 1; B_Sum_RRF_mfr_B    = ""; B_Sum_EKV_mfr_B    = B_Sum_EKV_mfr_B    + SumR; B_Sum_ITOG_mfr_B    = B_Sum_EKV_mfr_B;
        elif(podotchetS == "Внутриклиентские")
           P_Kol_vnkl_B   = P_Kol_vnkl_B   + 1; P_Sum_RRF_vnkl_B   = ""; P_Sum_EKV_vnkl_B   = P_Sum_EKV_vnkl_B   + SumR; P_Sum_ITOG_vnkl_B   = P_Sum_EKV_vnkl_B;
           B_Kol_vnkl_B   = B_Kol_vnkl_B   + 1; B_Sum_RRF_vnkl_B   = ""; B_Sum_EKV_vnkl_B   = B_Sum_EKV_vnkl_B   + SumR; B_Sum_ITOG_vnkl_B   = B_Sum_EKV_vnkl_B;
        elif(podotchetS == "Внутрибанковские")
           P_Kol_vnpl_B   = P_Kol_vnpl_B   + 1; P_Sum_RRF_vnpl_B   = ""; P_Sum_EKV_vnpl_B   = P_Sum_EKV_vnpl_B   + SumR; P_Sum_ITOG_vnpl_B   = P_Sum_EKV_vnpl_B;
           B_Kol_vnpl_B   = B_Kol_vnpl_B   + 1; B_Sum_RRF_vnpl_B   = ""; B_Sum_EKV_vnpl_B   = B_Sum_EKV_vnpl_B   + SumR; B_Sum_ITOG_vnpl_B   = B_Sum_EKV_vnpl_B;
        elif(podotchetS == "Внутренние ордера")
           P_Kol_vnor_B   = P_Kol_vnor_B   + 1; P_Sum_RRF_vnor_B   = ""; P_Sum_EKV_vnor_B   = P_Sum_EKV_vnor_B   + SumR; P_Sum_ITOG_vnor_B   = P_Sum_EKV_vnor_B;
           B_Kol_vnor_B   = B_Kol_vnor_B   + 1; B_Sum_RRF_vnor_B   = ""; B_Sum_EKV_vnor_B   = B_Sum_EKV_vnor_B   + SumR; B_Sum_ITOG_vnor_B   = B_Sum_EKV_vnor_B;
        end;
           P_Kol_itog1_B  = P_Kol_itog1_B  + 1; P_Sum_RRF_itog1_B  = ""; P_Sum_EKV_itog1_B  = P_Sum_EKV_itog1_B  + SumR; P_Sum_ITOG_itog1_B  = P_Sum_EKV_itog1_B;
           B_Kol_itog1_B  = B_Kol_itog1_B  + 1; B_Sum_RRF_itog1_B  = ""; B_Sum_EKV_itog1_B  = B_Sum_EKV_itog1_B  + SumR; B_Sum_ITOG_itog1_B  = B_Sum_EKV_itog1_B;
     else
      	if(podotchetS == "НОСТРО")
           P_Kol_nostro_E = P_Kol_nostro_E + 1; P_Sum_RRF_nostro_E = ""; P_Sum_EKV_nostro_E = P_Sum_EKV_nostro_E + SumR; P_Sum_ITOG_nostro_E = P_Sum_EKV_nostro_E;
           B_Kol_nostro_E = B_Kol_nostro_E + 1; B_Sum_RRF_nostro_E = ""; B_Sum_EKV_nostro_E = B_Sum_EKV_nostro_E + SumR; B_Sum_ITOG_nostro_E = B_Sum_EKV_nostro_E;
        elif(podotchetS == "МФР")
           P_Kol_mfr_E    = P_Kol_mfr_E    + 1; P_Sum_RRF_mfr_E    = ""; P_Sum_EKV_mfr_E    = P_Sum_EKV_mfr_E    + SumR; P_Sum_ITOG_mfr_E    = P_Sum_EKV_mfr_E;
           B_Kol_mfr_E    = B_Kol_mfr_E    + 1; B_Sum_RRF_mfr_E    = ""; B_Sum_EKV_mfr_E    = B_Sum_EKV_mfr_E    + SumR; B_Sum_ITOG_mfr_E    = B_Sum_EKV_mfr_E;
        elif(podotchetS == "Внутриклиентские")
           P_Kol_vnkl_E   = P_Kol_vnkl_E   + 1; P_Sum_RRF_vnkl_E   = ""; P_Sum_EKV_vnkl_E   = P_Sum_EKV_vnkl_E   + SumR; P_Sum_ITOG_vnkl_E   = P_Sum_EKV_vnkl_E;
           B_Kol_vnkl_E   = B_Kol_vnkl_E   + 1; B_Sum_RRF_vnkl_E   = ""; B_Sum_EKV_vnkl_E   = B_Sum_EKV_vnkl_E   + SumR; B_Sum_ITOG_vnkl_E   = B_Sum_EKV_vnkl_E;
        elif(podotchetS == "Внутрибанковские")
           P_Kol_vnpl_E   = P_Kol_vnpl_E   + 1; P_Sum_RRF_vnpl_E   = ""; P_Sum_EKV_vnpl_E   = P_Sum_EKV_vnpl_E   + SumR; P_Sum_ITOG_vnpl_E   = P_Sum_EKV_vnpl_E;
           B_Kol_vnpl_E   = B_Kol_vnpl_E   + 1; B_Sum_RRF_vnpl_E   = ""; B_Sum_EKV_vnpl_E   = B_Sum_EKV_vnpl_E   + SumR; B_Sum_ITOG_vnpl_E   = B_Sum_EKV_vnpl_E;
        elif(podotchetS == "Внутренние ордера")
           P_Kol_vnor_E   = P_Kol_vnor_E   + 1; P_Sum_RRF_vnor_E   = ""; P_Sum_EKV_vnor_E   = P_Sum_EKV_vnor_E   + SumR; P_Sum_ITOG_vnor_E   = P_Sum_EKV_vnor_E;
           B_Kol_vnor_E   = B_Kol_vnor_E   + 1; B_Sum_RRF_vnor_E   = ""; B_Sum_EKV_vnor_E   = B_Sum_EKV_vnor_E   + SumR; B_Sum_ITOG_vnor_E   = B_Sum_EKV_vnor_E;
        end;
           P_Kol_itog1_E  = P_Kol_itog1_E  + 1; P_Sum_RRF_itog1_E  = ""; P_Sum_EKV_itog1_E  = P_Sum_EKV_itog1_E  + SumR; P_Sum_ITOG_itog1_E  = P_Sum_EKV_itog1_E;
           B_Kol_itog1_E  = B_Kol_itog1_E  + 1; B_Sum_RRF_itog1_E  = ""; B_Sum_EKV_itog1_E  = B_Sum_EKV_itog1_E  + SumR; B_Sum_ITOG_itog1_E  = B_Sum_EKV_itog1_E;
     end;
  elif (Mode == "Баланс - Конверсионные - Все")
/*-------------------------------------------------------------------------------------------------------------------------------*/
  if((substr(data.value("AccKr"),14,5) == "21010") or (substr(data.value("AccKr"),14,5) == "22010") or (substr(data.value("AccDeb"),14,5) == "21010") or (substr(data.value("AccDeb"),14,5) == "22010") or (data.value("T_RESULT_CARRY") == 18))
       if(Vid_HranS == "Б")
//       if (data.value("vid_hran") == 0)
        P_Kol_itog1_B  = P_Kol_itog1_B  + 1; P_Sum_RRF_itog1_B  = P_Sum_RRF_itog1_B + data.value("sumRUR");   P_Sum_ITOG_itog1_B  = P_Sum_ITOG_itog1_B  + data.value("sumRUR");
        B_Kol_itog1_B  = B_Kol_itog1_B  + 1; B_Sum_RRF_itog1_B  = B_Sum_RRF_itog1_B + data.value("sumRUR");   B_Sum_ITOG_itog1_B  = B_Sum_ITOG_itog1_B  + data.value("sumRUR");
       else                                                                                                                                           
        P_Kol_itog1_E  = P_Kol_itog1_E  + 1; P_Sum_RRF_itog1_E  = P_Sum_RRF_itog1_E + data.value("sumRUR");   P_Sum_ITOG_itog1_E  = P_Sum_ITOG_itog1_E  + data.value("sumRUR");
        B_Kol_itog1_E  = B_Kol_itog1_E  + 1; B_Sum_RRF_itog1_E  = B_Sum_RRF_itog1_E + data.value("sumRUR");   B_Sum_ITOG_itog1_E  = B_Sum_ITOG_itog1_E  + data.value("sumRUR");
       end;                                                                                                
   else
       if(Vid_HranS == "Б")
//       if (data.value("vid_hran") == 0)            
        P_Kol_itog1_B  = P_Kol_itog1_B  + 1; P_Sum_EKV_itog1_B  = P_Sum_EKV_itog1_B + data.value("sumRUR");   P_Sum_ITOG_itog1_B  = P_Sum_ITOG_itog1_B  +  data.value("sumRUR");
        B_Kol_itog1_B  = B_Kol_itog1_B  + 1; B_Sum_EKV_itog1_B  = B_Sum_EKV_itog1_B + data.value("sumRUR");   B_Sum_ITOG_itog1_B  = B_Sum_ITOG_itog1_B  +  data.value("sumRUR");
       else                                                                                                                                                               
        P_Kol_itog1_E  = P_Kol_itog1_E  + 1; P_Sum_EKV_itog1_E  = P_Sum_EKV_itog1_E + data.value("sumRUR");   P_Sum_ITOG_itog1_E  = P_Sum_ITOG_itog1_E  +  data.value("sumRUR");
        B_Kol_itog1_E  = B_Kol_itog1_E  + 1; B_Sum_EKV_itog1_E  = B_Sum_EKV_itog1_E + data.value("sumRUR");   B_Sum_ITOG_itog1_E  = B_Sum_ITOG_itog1_E  +  data.value("sumRUR");
       end;
   end;                                                                                                     
end;
END;/*while*/

if(Mode == "Баланс - Конверсионные - Все")
      [  │ПОДР. 1000                          │ Б │############│###############│###############│###############│
         │                                    ├───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ИТОГО ПО ВИДАМ ХРАНЕНИЯ             │ Э │############│###############│###############│###############│
         ├────────────────────────────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤](
                                              P_Kol_itog1_B,  P_Sum_RRF_itog1_B,P_Sum_EKV_itog1_B,P_Sum_ITOG_itog1_B,
                                              P_Kol_itog1_E,  P_Sum_RRF_itog1_E,P_Sum_EKV_itog1_E,P_Sum_ITOG_itog1_E);
elif ((Mode == "Баланс - Рубли - Все") or (Mode == "Баланс - Валюта - Все"))                            
      [  │ПОДР. 1000             │            │ Б │############│###############│###############│###############│
         │ИТОГО ПО ВИДАМ ОТЧЕТОВ │ БР/НОСТРО  ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │ БР/МФР     ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │ БР/Кл      ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
	 │                       │ БР/Пл      ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │ БР/МО      ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
         ├───────────────────────┴────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ПОДР. 1000                          │ Б │############│###############│###############│###############│
         │                                    ├───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ИТОГО ПО ВИДАМ ХРАНЕНИЯ             │ Э │############│###############│###############│###############│
         ├────────────────────────────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤](
                                              P_Kol_nostro_B,P_Sum_RRF_nostro_B,P_Sum_EKV_nostro_B,P_Sum_ITOG_nostro_B,
                                              P_Kol_nostro_E,P_Sum_RRF_nostro_E,P_Sum_EKV_nostro_E,P_Sum_ITOG_nostro_E, 
                                              P_Kol_mfr_B,    P_Sum_RRF_mfr_B,  P_Sum_EKV_mfr_B,  P_Sum_ITOG_mfr_B, 
                                              P_Kol_mfr_E,    P_Sum_RRF_mfr_E,  P_Sum_EKV_mfr_E,  P_Sum_ITOG_mfr_E, 
                                              P_Kol_vnkl_B,   P_Sum_RRF_vnkl_B, P_Sum_EKV_vnkl_B, P_Sum_ITOG_vnkl_B,
                                              P_Kol_vnkl_E,   P_Sum_RRF_vnkl_E, P_Sum_EKV_vnkl_E, P_Sum_ITOG_vnkl_E,
                                              P_Kol_vnpl_B,   P_Sum_RRF_vnpl_B, P_Sum_EKV_vnpl_B, P_Sum_ITOG_vnpl_B,
                                              P_Kol_vnpl_E,   P_Sum_RRF_vnpl_E, P_Sum_EKV_vnpl_E, P_Sum_ITOG_vnpl_E,
                                              P_Kol_vnor_B,   P_Sum_RRF_vnor_B, P_Sum_EKV_vnor_B, P_Sum_ITOG_vnor_B,
                                              P_Kol_vnor_E,   P_Sum_RRF_vnor_E, P_Sum_EKV_vnor_E, P_Sum_ITOG_vnor_E,
                                              P_Kol_itog1_B,  P_Sum_RRF_itog1_B,P_Sum_EKV_itog1_B,P_Sum_ITOG_itog1_B,
                                              P_Kol_itog1_E,  P_Sum_RRF_itog1_E,P_Sum_EKV_itog1_E,P_Sum_ITOG_itog1_E);
else
      [  │ПОДР. 1000                          │ Б │############│###############│###############│###############│
         │                                    ├───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ИТОГО ПО ВИДАМ ХРАНЕНИЯ             │ Э │############│###############│###############│###############│
         ├────────────────────────────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤](
               /*substr(подразделение2,1,5),*/    P_Kol_itog1_B,  P_Sum_RRF_itog1_B,P_Sum_EKV_itog1_B,P_Sum_ITOG_itog1_B,
                                              P_Kol_itog1_E,  P_Sum_RRF_itog1_E,P_Sum_EKV_itog1_E,P_Sum_ITOG_itog1_E,
                   подразделение1);
end;

if(Mode == "Баланс - Конверсионные - Все")
      [  │ БАНК:                              │ Б │############│###############│###############│###############│
         │                                    ├───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ИТОГО ПО ВИДАМ ХРАНЕНИЯ             │ Э │############│###############│###############│###############│
         └────────────────────────────────────┴───┴────────────┴───────────────┴───────────────┴───────────────┘](
                                              B_Kol_itog1_B,  B_Sum_RRF_itog1_B,B_Sum_EKV_itog1_B,B_Sum_ITOG_itog1_B,
                                              B_Kol_itog1_E,  B_Sum_RRF_itog1_E,B_Sum_EKV_itog1_E,B_Sum_ITOG_itog1_E);
elif ((Mode == "Баланс - Рубли - Все") or (Mode == "Баланс - Валюта - Все"))                            
      [  │ БАНК:                 │            │ Б │############│###############│###############│###############│
         │ИТОГО ПО ВИДАМ ОТЧЕТОВ │ БР/НОСТРО  ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │ БР/МФР     ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │ БР/Кл      ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
	 │                       │ БР/Пл      ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │ БР/МО      ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
         ├───────────────────────┴────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ БАНК:                              │ Б │############│###############│###############│###############│
         │                                    ├───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ИТОГО ПО ВИДАМ ХРАНЕНИЯ             │ Э │############│###############│###############│###############│
         └────────────────────────────────────┴───┴────────────┴───────────────┴───────────────┴───────────────┘](
                                              B_Kol_nostro_B,B_Sum_RRF_nostro_B,B_Sum_EKV_nostro_B,B_Sum_ITOG_nostro_B,
                                              B_Kol_nostro_E,B_Sum_RRF_nostro_E,B_Sum_EKV_nostro_E,B_Sum_ITOG_nostro_E, 
                                              B_Kol_mfr_B,    B_Sum_RRF_mfr_B,  B_Sum_EKV_mfr_B,  B_Sum_ITOG_mfr_B, 
                                              B_Kol_mfr_E,    B_Sum_RRF_mfr_E,  B_Sum_EKV_mfr_E,  B_Sum_ITOG_mfr_E, 
                                              B_Kol_vnkl_B,   B_Sum_RRF_vnkl_B, B_Sum_EKV_vnkl_B, B_Sum_ITOG_vnkl_B,
                                              B_Kol_vnkl_E,   B_Sum_RRF_vnkl_E, B_Sum_EKV_vnkl_E, B_Sum_ITOG_vnkl_E,
                                              B_Kol_vnpl_B,   B_Sum_RRF_vnpl_B, B_Sum_EKV_vnpl_B, B_Sum_ITOG_vnpl_B,
                                              B_Kol_vnpl_E,   B_Sum_RRF_vnpl_E, B_Sum_EKV_vnpl_E, B_Sum_ITOG_vnpl_E,
                                              B_Kol_vnor_B,   B_Sum_RRF_vnor_B, B_Sum_EKV_vnor_B, B_Sum_ITOG_vnor_B,
                                              B_Kol_vnor_E,   B_Sum_RRF_vnor_E, B_Sum_EKV_vnor_E, B_Sum_ITOG_vnor_E,
                                              B_Kol_itog1_B,  B_Sum_RRF_itog1_B,B_Sum_EKV_itog1_B,B_Sum_ITOG_itog1_B,
                                              B_Kol_itog1_E,  B_Sum_RRF_itog1_E,B_Sum_EKV_itog1_E,B_Sum_ITOG_itog1_E);
else
      [  │ БАНК:                              │ Б │############│###############│###############│###############│
         │                                    ├───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ИТОГО ПО ВИДАМ ХРАНЕНИЯ             │ Э │############│###############│###############│###############│
         └────────────────────────────────────┴───┴────────────┴───────────────┴───────────────┴───────────────┘](
                                              B_Kol_itog1_B,  B_Sum_RRF_itog1_B,B_Sum_EKV_itog1_B,B_Sum_ITOG_itog1_B,
                                              B_Kol_itog1_E,  B_Sum_RRF_itog1_E,B_Sum_EKV_itog1_E,B_Sum_ITOG_itog1_E);
end;
end;
if(not((NumOtdel == 0) or (NumOtdel == "")))
      [  └───────────────────────┴────────────┴───┴────────────┴───────────────┴───────────────┴───────────────┘]
end;
    [

       Главный бухгалтер_________________________________

       Контролер____________________________

       Отчет подготовил  #############################################################]
       (getShortName(GetOperName({oper})));
END;


/*************************************************************************************/
/*                         СВОДНАЯ КОНТРОЛЬНАЯ ВЕДОМОСТЬ БАНКА                       */
/*************************************************************************************/

MACRO svodnaja_vedomost_banka(Mode:string,VidHran:string,glava:integer)
  var select1, select2,select3, select, Data, SumR, paymentID1 = 0, paymentID2 = 0, сумма_в_рублях, selectRUR, DataRUR, razdelS, kod_otdela, kol = 0,
      select_otdels, Data_otdels, num_otdel, name_otdel, flag_pechati_nulevih_otdelov, Select_1000_1, Select_1000_2,Select_1000_3,chapter,glavaS;
  var select_kassa_20202,Data_kassa_20202,Summ_kassa_20202 = $0,Kol_kassa_20202 = 0,Kol_kassa_ITOG1,SumItogo_kassa_ITOG1,param_1000;
  var name_otdel1,name_otdel2,name_otdel3,StoreKind,payment_id = 0, data_count, select_count, progressCount = 1;
  var StoreKindParam,resultCarry,externalExists;
  private var needTranscript = false; 
  private var transcriptOperRUR = "   ",transcriptOperVAL = "   ",transcriptOperKON = "   ", oper1=0, oper2=0;
//----------------------------------------------------------------------------------------------------------------------------------------------------------|
  var Kol_kassa_RUR_B  = 0,SumRRF_kassa_RUR_B  = $0,SumEKV_kassa_RUR_B  = $0,SumItogo_kassa_RUR_B  = $0,                            //|                     |
      Kol_kassa_RUR_E  = 0,SumRRF_kassa_RUR_E  = $0,SumEKV_kassa_RUR_E  = $0,SumItogo_kassa_RUR_E  = $0,                            //|                     |
      Kol_kassa_VAL_B  = 0,SumRRF_kassa_VAL_B  = $0,SumEKV_kassa_VAL_B  = $0,SumItogo_kassa_VAL_B  = $0,                            //|                     |
      Kol_kassa_VAL_E  = 0,SumRRF_kassa_VAL_E  = $0,SumEKV_kassa_VAL_E  = $0,SumItogo_kassa_VAL_E  = $0,                            //|                     |
      Kol_kassa_KON_B  = 0,SumRRF_kassa_KON_B  = $0,SumEKV_kassa_KON_B  = $0,SumItogo_kassa_KON_B  = $0,                            //|  СЧЕТЧИКИ ПО КАССЕ  |
      Kol_kassa_KON_E  = 0,SumRRF_kassa_KON_E  = $0,SumEKV_kassa_KON_E  = $0,SumItogo_kassa_KON_E  = $0,                            //|                     |
      Kol_kassa_ITOG_B = 0,SumRRF_kassa_ITOG_B = $0,SumEKV_kassa_ITOG_B = $0,SumItogo_kassa_ITOG_B = $0,                            //|                     |
      Kol_kassa_ITOG_E = 0,SumRRF_kassa_ITOG_E = $0,SumEKV_kassa_ITOG_E = $0,SumItogo_kassa_ITOG_E = $0,                            //|                     |
      Kol_kassa_ITOG   = 0,SumRRF_kassa_ITOG   = $0,SumEKV_kassa_ITOG   = $0,SumItogo_kassa_ITOG   = $0;                            //|                     |
//----------------------------------------------------------------------------------------------------------------------------------------------------------|
  var kol_vnesh_Operu_RUR_B   = 0,SumRRF_vnesh_Operu_RUR_B   = $0,SumEKV_vnesh_Operu_RUR_B   = $0,SumItogo_vnesh_Operu_RUR_B   = $0,//| С |                 |
      kol_vnesh_Operu_RUR_E   = 0,SumRRF_vnesh_Operu_RUR_E   = $0,SumEKV_vnesh_Operu_RUR_E   = $0,SumItogo_vnesh_Operu_RUR_E   = $0,//| Ч |                 |
      kol_vnesh_nostro_RUR_B  = 0,SumRRF_vnesh_nostro_RUR_B  = $0,SumEKV_vnesh_nostro_RUR_B  = $0,SumItogo_vnesh_nostro_RUR_B  = $0,//| Е |                 |
      kol_vnesh_nostro_RUR_E  = 0,SumRRF_vnesh_nostro_RUR_E  = $0,SumEKV_vnesh_nostro_RUR_E  = $0,SumItogo_vnesh_nostro_RUR_E  = $0,//| Т |                 |
      kol_vnesh_mfr_RUR_B     = 0,SumRRF_vnesh_mfr_RUR_B     = $0,SumEKV_vnesh_mfr_RUR_B     = $0,SumItogo_vnesh_mfr_RUR_B     = $0,//| Ч | РУБЛИ           |
      kol_vnesh_mfr_RUR_E     = 0,SumRRF_vnesh_mfr_RUR_E     = $0,SumEKV_vnesh_mfr_RUR_E     = $0,SumItogo_vnesh_mfr_RUR_E     = $0,//| И |                 |
      kol_vnesh_prochie_RUR_B = 0,SumRRF_vnesh_prochie_RUR_B = $0,SumEKV_vnesh_prochie_RUR_B = $0,SumItogo_vnesh_prochie_RUR_B = $0,//| К |                 | 
      kol_vnesh_prochie_RUR_E = 0,SumRRF_vnesh_prochie_RUR_E = $0,SumEKV_vnesh_prochie_RUR_E = $0,SumItogo_vnesh_prochie_RUR_E = $0,//| И |                 |
      kol_vnesh_ITOG_RUR_B    = 0,SumRRF_vnesh_ITOG_RUR_B    = $0,SumEKV_vnesh_ITOG_RUR_B    = $0,SumItogo_vnesh_ITOG_RUR_B    = $0,//|   |                 |
      kol_vnesh_ITOG_RUR_E    = 0,SumRRF_vnesh_ITOG_RUR_E    = $0,SumEKV_vnesh_ITOG_RUR_E    = $0,SumItogo_vnesh_ITOG_RUR_E    = $0,//| П |_________________|
      kol_vnesh_nostro_VAL_B  = 0,SumRRF_vnesh_nostro_VAL_B  = $0,SumEKV_vnesh_nostro_VAL_B  = $0,SumItogo_vnesh_nostro_VAL_B  = $0,//| О |                 |
      kol_vnesh_nostro_VAL_E  = 0,SumRRF_vnesh_nostro_VAL_E  = $0,SumEKV_vnesh_nostro_VAL_E  = $0,SumItogo_vnesh_nostro_VAL_E  = $0,//|   |                 |
      kol_vnesh_mfr_VAL_B     = 0,SumRRF_vnesh_mfr_VAL_B     = $0,SumEKV_vnesh_mfr_VAL_B     = $0,SumItogo_vnesh_mfr_VAL_B     = $0,//| В |                 |
      kol_vnesh_mfr_VAL_E     = 0,SumRRF_vnesh_mfr_VAL_E     = $0,SumEKV_vnesh_mfr_VAL_E     = $0,SumItogo_vnesh_mfr_VAL_E     = $0,//| Н |                 |
      kol_vnesh_prochie_VAL_B = 0,SumRRF_vnesh_prochie_VAL_B = $0,SumEKV_vnesh_prochie_VAL_B = $0,SumItogo_vnesh_prochie_VAL_B = $0,//| Е | ВАЛЮТА          |
      kol_vnesh_prochie_VAL_E = 0,SumRRF_vnesh_prochie_VAL_E = $0,SumEKV_vnesh_prochie_VAL_E = $0,SumItogo_vnesh_prochie_VAL_E = $0,//| Ш |                 |
      kol_vnesh_konv_VAL_B    = 0,SumRRF_vnesh_konv_VAL_B    = $0,SumEKV_vnesh_konv_VAL_B    = $0,SumItogo_vnesh_konv_VAL_B    = $0,//| Н |                 |
      kol_vnesh_konv_VAL_E    = 0,SumRRF_vnesh_konv_VAL_E    = $0,SumEKV_vnesh_konv_VAL_E    = $0,SumItogo_vnesh_konv_VAL_E    = $0,//| И |                 |
      kol_vnesh_ITOG_VAL_B    = 0,SumRRF_vnesh_ITOG_VAL_B    = $0,SumEKV_vnesh_ITOG_VAL_B    = $0,SumItogo_vnesh_ITOG_VAL_B    = $0,//| М |                 |
      kol_vnesh_ITOG_VAL_E    = 0,SumRRF_vnesh_ITOG_VAL_E    = $0,SumEKV_vnesh_ITOG_VAL_E    = $0,SumItogo_vnesh_ITOG_VAL_E    = $0,//|   |_________________|
      Kol_vnesh_ITOG          = 0,SumRRF_vnesh_ITOG          = $0,SumEKV_vnesh_ITOG          = $0,SumItogo_vnesh_ITOG          = $0;//|   | ИТОГ            |  
//----------------------------------------------------------------------------------------------------------------------------------------------------------|
  var Kol_vnutr_RUR_B  = 0,SumRRF_vnutr_RUR_B  = $0,SumEKV_vnutr_RUR_B  = $0,SumItogo_vnutr_RUR_B  = $0,                            //|                     |
      Kol_vnutr_RUR_E  = 0,SumRRF_vnutr_RUR_E  = $0,SumEKV_vnutr_RUR_E  = $0,SumItogo_vnutr_RUR_E  = $0,                            //|                     |
      Kol_vnutr_VAL_B  = 0,SumRRF_vnutr_VAL_B  = $0,SumEKV_vnutr_VAL_B  = $0,SumItogo_vnutr_VAL_B  = $0,                            //|                     |
      Kol_vnutr_VAL_E  = 0,SumRRF_vnutr_VAL_E  = $0,SumEKV_vnutr_VAL_E  = $0,SumItogo_vnutr_VAL_E  = $0,                            //| СЧЕТЧИКИ ПО ВНУТ-   |
      Kol_vnutr_KON_B  = 0,SumRRF_vnutr_KON_B  = $0,SumEKV_vnutr_KON_B  = $0,SumItogo_vnutr_KON_B  = $0,                            //| РЕННИМ ДОКУМЕНТАМ   |
      Kol_vnutr_KON_E  = 0,SumRRF_vnutr_KON_E  = $0,SumEKV_vnutr_KON_E  = $0,SumItogo_vnutr_KON_E  = $0,                            //|   (по отделам)      |
      Kol_vnutr_ITOG_B = 0,SumRRF_vnutr_ITOG_B = $0,SumEKV_vnutr_ITOG_B = $0,SumItogo_vnutr_ITOG_B = $0,                            //|                     |
      Kol_vnutr_ITOG_E = 0,SumRRF_vnutr_ITOG_E = $0,SumEKV_vnutr_ITOG_E = $0,SumItogo_vnutr_ITOG_E = $0,                            //|                     |
      Kol_vnutr_ITOG   = 0,SumRRF_vnutr_ITOG   = $0,SumEKV_vnutr_ITOG   = $0,SumItogo_vnutr_ITOG   = $0;                            //|                     |
//----------------------------------------------------------------------------------------------------------------------------------------------------------|
  var Kol_bank_RUR_B  = 0,SumRRF_bank_RUR_B  = $0,SumEKV_bank_RUR_B  = $0,SumItogo_bank_RUR_B  = $0,                                //|                     |
      Kol_bank_RUR_E  = 0,SumRRF_bank_RUR_E  = $0,SumEKV_bank_RUR_E  = $0,SumItogo_bank_RUR_E  = $0,                                //|                     |
      Kol_bank_VAL_B  = 0,SumRRF_bank_VAL_B  = $0,SumEKV_bank_VAL_B  = $0,SumItogo_bank_VAL_B  = $0,                                //|                     |
      Kol_bank_VAL_E  = 0,SumRRF_bank_VAL_E  = $0,SumEKV_bank_VAL_E  = $0,SumItogo_bank_VAL_E  = $0,                                //| СЧЕТЧИКИ ПО ВНУТ-   |
      Kol_bank_KON_B  = 0,SumRRF_bank_KON_B  = $0,SumEKV_bank_KON_B  = $0,SumItogo_bank_KON_B  = $0,                                //| РЕННИМ ДОКУМЕНТАМ   |
      Kol_bank_KON_E  = 0,SumRRF_bank_KON_E  = $0,SumEKV_bank_KON_E  = $0,SumItogo_bank_KON_E  = $0,                                //|   (по банку)        |
      Kol_bank_ITOG_B = 0,SumRRF_bank_ITOG_B = $0,SumEKV_bank_ITOG_B = $0,SumItogo_bank_ITOG_B = $0,                                //|                     |
      Kol_bank_ITOG_E = 0,SumRRF_bank_ITOG_E = $0,SumEKV_bank_ITOG_E = $0,SumItogo_bank_ITOG_E = $0,                                //|                     |
      Kol_bank_ITOG   = 0,SumRRF_bank_ITOG   = $0,SumEKV_bank_ITOG   = $0,SumItogo_bank_ITOG   = $0;                                //|                     |
//----------------------------------------------------------------------------------------------------------------------------------------------------------|

   сумма_в_рублях = $0;
   chapter = glava;

    var selectProgress = 
    " select count(1)                                "+
    "   from dacctrn_dbt arh                         "+
    "  where ARH.T_DATE_CARRY = TO_DATE ('" + DateDocum +"', 'DD.MM.YYYY')         "+
    "    and ARH.T_ACCOUNT_PAYER not like '%ОВП%'    "+
    "    and ARH.T_ACCOUNT_RECEIVER not like '%ОВП%' "+
    "    and ARH.T_CHAPTER = " + chapter              ;
    var DataProgress = ExecSQLSelect(selectProgress);
    DataProgress.movenext();
    var allDocsNum = int(DataProgress.value(0));
    initprogress(allDocsNum,"Обработка документов кассы","Идет отбор документов для отчета");

    select1 = 
    "     SELECT   SUM, accdeb, acckr,nvl(paymentid,-1) paymentid,                        "+
    "          (SELECT storekind                                                          "+ 
    "             FROM TABLE (user_ea.get_dev_prop (a.dockind,                            "+ 
    "                                               a.origin,                             "+ 
    "                                               a.paymkind,                           "+ 
    "                                               a.shifr_oper,                         "+ 
    "                                               a.numb_pack,                          "+ 
    "                                               a.chapter,                            "+ 
    "                                               a.t_typedocument,                     "+ 
    "                                               a.accdeb,                             "+ 
    "                                               a.T_FIID_PAYER,                       "+
    "                                               a.acckr,                              "+ 
    "                                               a.T_FIID_RECEIVER,                    "+ 
    "                                               NULL                                  "+ 
    "                                              )                                      "+ 
    "                        )) vid_hran                                                  "+ 
    "     FROM (SELECT DISTINCT arh.T_SUM_NATCUR AS SUM,                                  "+        
    "                           arh.t_account_payer AS accdeb,                            "+ 
    "                           arh.t_account_receiver AS acckr,                          "+ 
    "                           arh.T_FIID_PAYER,                                         "+
    "                           arh.T_FIID_RECEIVER,                                      "+
    "                           prop.t_paymentkind paymkind,                              "+ 
    "                           user_ea.GetOrigin(paym.t_dockind,paym.t_paymentid)origin, "+ 
    "                           paym.t_chapter chapter,                                   "+
    "                           paym.t_dockind dockind,                                   "+
    "                           arh.t_number_pack numb_pack,                              "+ 
    "                           arh.t_shifr_oper shifr_oper,                              "+
    "                           paym.t_paymentid paymentid,                               "+ 
    "                           arh.t_typedocument                                        "+ 
    "               FROM        dpmdocs_dbt docs,                                         "+ 
    "                           dpmpaym_dbt paym,                                         "+ 
    "                           dpmrmprop_dbt prop,                                       "+ 
    "                           dacctrn_dbt arh                                           "+
    "              WHERE        arh.t_date_carry = to_date(:DateDocum1,'DD.MM.YYYY')      "+ 
    "                       AND arh.t_chapter = :chapter                                  "+ 
    "                       AND arh.T_ACCTRNID = docs.T_ACCTRNID(+)                       "+
    "                       AND docs.t_paymentid = paym.t_paymentid(+)                    "+ 
    "                       AND prop.t_paymentid(+) = paym.t_paymentid                    "+ 
    "                       AND (SUBSTR (arh.t_account_payer, 1, 5) IN                    "+ 
    "                                                   ('20202', '20203', '20207')       "+ 
    "                        OR SUBSTR (arh.t_account_receiver, 1, 5) IN                  "+ 
    "                                                   ('20202', '20203', '20207'))      "+ 
    "                       AND (   EXISTS (                                              "+ 
    "                                  SELECT 1                                           "+ 
    "                                   FROM dpmprop_dbt deb, dpmprop_dbt cred            "+ 
    "                                   WHERE cred.t_paymentid = docs.t_paymentid         "+ 
    "                                     AND deb.t_paymentid = docs.t_paymentid          "+ 
    "                                     AND deb.t_paymentid = cred.t_paymentid          "+ 
    "                                     and deb.t_debetcredit = 0                       "+
    "                                     and cred.t_debetcredit = 1                      "+
    "                                     AND cred.t_group <> :group1                     "+ 
    "                                     AND deb.t_group <> :group2)                     "+ 
    "                            OR docs.t_paymentid IS NULL                              "+ 
    "                            OR paym.t_paymentid IS NULL)                             ";

    var param_kassa = MakeArray(SQLParam ("DateDocum1", string(DateDocum)),
                                SQLParam ("chapter", chapter),
                                SQLParam ("group1",PAYMENTS_GROUP_EXTERNAL),
                                SQLParam ("group2",PAYMENTS_GROUP_EXTERNAL));

        Select = Select1 + "  AND arh.T_FIID_PAYER = 0                                      "+
                           "  AND arh.T_FIID_RECEIVER = 0) a                                ";
        Data = ExecSQLSelect(Select,param_kassa);
      while (data.movenext()) 
        useprogress(progressCount);
        progressCount = progressCount + 1;
	StoreKind = data.value("vid_hran");
	payment_id = data.value("paymentid");
	StoreKind = kateg_vid_hran(payment_id,StoreKind,chapter);
        if (StoreKind == 0)
           Kol_kassa_RUR_B = Kol_kassa_RUR_B + 1;
           SumRRF_kassa_RUR_B = SumRRF_kassa_RUR_B + data.value("sum");
           SumItogo_kassa_RUR_B = SumRRF_kassa_RUR_B;
        else
           Kol_kassa_RUR_E = Kol_kassa_RUR_E + 1;
           SumRRF_kassa_RUR_E = SumRRF_kassa_RUR_E + data.value("sum");
           SumItogo_kassa_RUR_E = SumRRF_kassa_RUR_E;
        end;
      end;
      Select = Select1 + "  and substr(arh.T_ACCOUNT_PAYER,6,3) = substr(arh.T_ACCOUNT_RECEIVER,6,3) "+ //так сразу ОВП откидывает
                         "  AND arh.T_FIID_PAYER <> 0                                                "+
                         "  AND arh.T_FIID_RECEIVER <> 0) a                                          ";
      Data = ExecSQLSelect(Select,param_kassa);

      while (data.movenext())
        useprogress(progressCount);
        progressCount = progressCount + 1;
        SumR       = data.value("Sum");
	StoreKind  = data.value("vid_hran");
	payment_id = data.value("paymentid");
	StoreKind  = kateg_vid_hran(payment_id,StoreKind,chapter);
        if (StoreKind == 0)
           Kol_kassa_val_B = Kol_kassa_val_B + 1;
           SumEKV_kassa_val_B = SumEKV_kassa_val_B + SumR;
           SumItogo_kassa_val_B = SumEKV_kassa_val_B;
        else
           Kol_kassa_val_E = Kol_kassa_val_E + 1;
           SumEKV_kassa_val_E = SumEKV_kassa_val_E + SumR;
           SumItogo_kassa_val_E = SumEKV_kassa_val_E;
        end;
      end;

      Select = Select1 + "  AND arh.T_FIID_PAYER <> arh.T_FIID_RECEIVER                    "+
                         "  AND arh.t_result_carry not in (18,82)) a order by paymentid    ";
      select_count = "select count (1) from(" + select + ")";
      Data_count = ExecSQLSelect(Select_count,param_kassa);
      data_count.movenext();
      Data = ExecSQLSelect(Select,param_kassa);

debugbreak;
debugbreak;
      while (data.movenext())
         useprogress(progressCount);
         progressCount = progressCount + 1;
         paymentID1 = data.value("paymentid");
/*-------------------------------------------------------------------------------------------------------------------------------*/
         if (paymentID1 != paymentID2)
            if (paymentID2 != 0) 
               Kol_kassa_KON_B = Kol_kassa_KON_B + 1; SumEKV_kassa_KON_B = SumEKV_kassa_KON_B + Сумма_в_рублях;
            end;
            Сумма_в_рублях = $0;
            paymentID2 = paymentID1;
         end;
         //Gurin S. 06.04.2016 R-642559-2 Добавил 70606
//         if ((data.value("AccKr") != "ОВП") and (data.value("AccDeb") != "ОВП") and (substr(data.value("AccKr"),14,5) != "21010") and (substr(data.value("AccKr"),14,5) != "22010") and (substr(data.value("AccDeb"),14,5) != "21010") and (substr(data.value("AccDeb"),14,5) != "22010") and (substr(data.value("AccDeb"),6,3) != substr(data.value("AccKr"),6,3)) and (substr(data.value("AccKr"),1,5) != "60309")and ((substr(data.value("AccDeb"),1,5) != "20202") or (substr(data.value("AccKr"),1,5) != "20202")))
         if ((data.value("AccKr") != "ОВП") and (data.value("AccDeb") != "ОВП") and (substr(data.value("AccKr"),14,5) != "21010") and (substr(data.value("AccKr"),14,5) != "22010") and (substr(data.value("AccDeb"),14,5) != "21010") and (substr(data.value("AccDeb"),14,5) != "22010") and (substr(data.value("AccDeb"),6,3) != substr(data.value("AccKr"),6,3)) and (substr(data.value("AccKr"),1,5) != "60309") 
              and (substr(data.value("AccKr"),1,5) != "70601") and (substr(data.value("AccDeb"),1,5) != "70606"))
            сумма_в_рублях = data.value("Sum");
         end;
//         if((substr(data.value("AccKr"),14,5) == "21010") or (substr(data.value("AccKr"),14,5) == "22010") or (substr(data.value("AccDeb"),14,5) == "21010") or (substr(data.value("AccDeb"),14,5) == "22010") or ((substr(data.value("AccDeb"),1,5) == "20202") and (substr(data.value("Acckr"),1,5) == "20202")))
         if((substr(data.value("AccKr"),14,5) == "21010") or (substr(data.value("AccKr"),14,5) == "22010") or (substr(data.value("AccDeb"),14,5) == "21010") or (substr(data.value("AccDeb"),14,5) == "22010") 
             or (substr(data.value("Acckr"),1,5) == "70601") or (substr(data.value("AccDeb"),1,5) == "70606"))
            Kol_kassa_KON_E = Kol_kassa_KON_E + 1; SumRRF_kassa_KON_E = SumRRF_kassa_KON_E + data.value("Sum");
         end;
         if(substr(data.value("AccKr"),1,5) == "60309")
            Kol_kassa_KON_B = Kol_kassa_KON_B + 1; SumEKV_kassa_KON_B = SumEKV_kassa_KON_B + data.value("sum");
         end; 
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
      end;/*while*/
/*иногда не попадала мультивалютная проводка последняя, добавил проверку на число доков в запросе и в отчете*/ // GSP 26.10.2012 по I-00274826-2
     if(Kol_kassa_KON_B + Kol_kassa_KON_E != data_count.value(0))
        Kol_kassa_KON_B = Kol_kassa_KON_B + 1; SumEKV_kassa_KON_B = SumEKV_kassa_KON_B + Сумма_в_рублях;
     end;
/*------------------------------------------------------------------------------------------------------*/
     SumItogo_kassa_KON_B   = SumRRF_kassa_KON_B    + SumEKV_kassa_KON_B    ;
     SumItogo_kassa_KON_E   = SumRRF_kassa_KON_E    + SumEKV_kassa_KON_E    ; 
     Kol_kassa_ITOG_B       = Kol_kassa_RUR_B       + Kol_kassa_VAL_B       + Kol_kassa_KON_B      ;
     Kol_kassa_ITOG_E       = Kol_kassa_RUR_E       + Kol_kassa_VAL_E       + Kol_kassa_KON_E      ;
     Kol_kassa_ITOG         = Kol_kassa_ITOG_B      + Kol_kassa_ITOG_E      ;
     SumRRF_kassa_ITOG_B    = SumRRF_kassa_RUR_B    + SumRRF_kassa_VAL_B    + SumRRF_kassa_KON_B   ;
     SumRRF_kassa_ITOG_E    = SumRRF_kassa_RUR_E    + SumRRF_kassa_VAL_E    + SumRRF_kassa_KON_E   ;
     SumRRF_kassa_ITOG      = SumRRF_kassa_ITOG_B   + SumRRF_kassa_ITOG_E   ;
     SumEKV_kassa_ITOG_B    = SumEKV_kassa_RUR_B    + SumEKV_kassa_VAL_B    + SumEKV_kassa_KON_B   ;
     SumEKV_kassa_ITOG_E    = SumEKV_kassa_RUR_E    + SumEKV_kassa_VAL_E    + SumEKV_kassa_KON_E   ;
     SumEKV_kassa_ITOG      = SumEKV_kassa_ITOG_B   + SumEKV_kassa_ITOG_E   ;
     SumItogo_kassa_ITOG_B  = SumItogo_kassa_RUR_B  + SumItogo_kassa_VAL_B  + SumItogo_kassa_KON_B ;
     SumItogo_kassa_ITOG_E  = SumItogo_kassa_RUR_E  + SumItogo_kassa_VAL_E  + SumItogo_kassa_KON_E ;
     SumItogo_kassa_ITOG    = SumItogo_kassa_ITOG_B + SumItogo_kassa_ITOG_E ;

    select_kassa_20202 = 
    " SELECT   SUM (SUM) SUM, COUNT (1) kol                                                "+
    "   FROM   (SELECT   DISTINCT ARH.T_SUM_NATCUR AS SUM, ARH.T_ACCTRNID                  "+
    "             FROM   dacctrn_dbt arh                                                   "+
    "            WHERE       arh.t_date_carry = TO_DATE ('" + DateDocum +"', 'DD.MM.YYYY') "+
    "                    AND arh.t_chapter = 1                                             "+
    "                    AND SUBSTR (arh.t_account_payer, 1, 5) IN ('20202')               "+
    "                    AND SUBSTR (arh.t_account_receiver, 1, 5) IN ('20202'))           ";
    Data_kassa_20202 = ExecSQLSelect(Select_kassa_20202);                          

    if( Data_kassa_20202.movenext());
       if(Data_kassa_20202.value("kol") != 0)
          Summ_kassa_20202 =  Summ_kassa_20202 + Data_kassa_20202.value("sum");
          kol_kassa_20202  = kol_kassa_20202   + Data_kassa_20202.value("kol");
          Kol_kassa_ITOG1  = Kol_kassa_ITOG    + kol_kassa_20202;
          SumItogo_kassa_ITOG1 = SumItogo_kassa_ITOG + Summ_kassa_20202;
       end;
    end;
      [   ##########################

                                           СВОДНАЯ
        	                 КОНТРОЛЬНАЯ ВЕДОМОСТЬ БАНКА
                               по видам документов подразделений
      ]({Name_Bank});
    if  (chapter == 1)
         glavaS = " ГЛАВА А.  БАЛАНСОВЫЕ  СЧЕТА"
    elif(chapter == 3)
         glavaS = " ГЛАВА В.  ВНЕБАЛАНСОВЫЕ  СЧЕТА"
    elif(chapter == 4)
         glavaS = " ГЛАВА Г.  СРОЧНЫЕ  СДЕЛКИ" 
    else
         glavaS = " Неизвестная глава баланса" 
    end;
      [                      ###############################################](glavaS);
      [      	                 за  ##########

          Отчет: ###################################################################

      ]  (DateDocum,Mode);

      [  ┌───────────────────────┬────────────┬───┬────────────┬───────────────────────────────────────────────┐
         │ № / Наименование      │ Вид отчета │вид│ Кол-во     │                Сумма документов               │
	 │подразделения/отдела   │            │хр.│ документов ├───────────────┬───────────────┬───────────────┤
	 │                       │            │   │            │  В рублях РФ  │   В руб. экв. │     ИТОГО     │
         ├───────────────────────┴────────────┴───┴────────────┴───────────────┴───────────────┴───────────────┤
         │                                                                                                     │
         │ 1. КАССОВЫЕ  ДОКУМЕНТЫ  ПОДРАЗДЕЛЕНИЙ:                                                              │
         ├───────────────────────┬────────────┬───┬────────────┬───────────────┬───────────────┬───────────────┤
         │ КАССОВЫЕ  ОПЕРАЦИИ    │            │ Б │############│###############│###############│###############│
         │ ПО  БАНКУ             │  рублевые  ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │  валютные  ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
	 │                       │ конверсион ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │    ные     │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │   ИТОГО    ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │ по отчетам │ Э │############│###############│###############│###############│
         ├───────────────────────┴────────────┴───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ ВСЕГО КАССОВЫХ ОПЕРАЦИЙ ПО БАНКУ:      │            │               │               │               │
         │  из них приходно-расходных: ####       │############│###############│###############│###############│
         │  на сумму: ############## руб.         │            │               │               │               │
         ├────────────────────────────────────────┴────────────┴───────────────┴───────────────┴───────────────┤]
                                                  (Kol_kassa_RUR_B,SumRRF_kassa_RUR_B,SumEKV_kassa_RUR_B,SumItogo_kassa_RUR_B,
                                                   Kol_kassa_RUR_E,SumRRF_kassa_RUR_E,SumEKV_kassa_RUR_E,SumItogo_kassa_RUR_E,
                                                   Kol_kassa_VAL_B,SumRRF_kassa_VAL_B,SumEKV_kassa_VAL_B,SumItogo_kassa_VAL_B,
                                                   Kol_kassa_VAL_E,SumRRF_kassa_VAL_E,SumEKV_kassa_VAL_E,SumItogo_kassa_VAL_E,
                                                   Kol_kassa_KON_B,SumRRF_kassa_KON_B,SumEKV_kassa_KON_B,SumItogo_kassa_KON_B,
                                                   Kol_kassa_KON_E,SumRRF_kassa_KON_E,SumEKV_kassa_KON_E,SumItogo_kassa_KON_E,
                                                   Kol_kassa_ITOG_B,SumRRF_kassa_ITOG_B,SumEKV_kassa_ITOG_B,SumItogo_kassa_ITOG_B,
                                                   Kol_kassa_ITOG_E,SumRRF_kassa_ITOG_E,SumEKV_kassa_ITOG_E,SumItogo_kassa_ITOG_E,
                                      int(kol_kassa_20202),
                                                   Kol_kassa_ITOG, SumRRF_kassa_ITOG, SumEKV_kassa_ITOG, SumItogo_kassa_ITOG,
                       Summ_kassa_20202/*,       int(Kol_kassa_ITOG1),                                     SumItogo_kassa_ITOG1*/);   //кассовые адаптированы, данные совпадают с 30кой.

/************************************************************/
/*    Отбор внешних для сводной контрольной ведомости       */
/************************************************************/
    message("отбор внешних документов");
    select1 =
    " SELECT   a.accdeb, a.acckr, a.SUM, a.CS, paymentid,                               "+
    "          (SELECT   storekind                                                      "+
    "             FROM   TABLE(user_ea.get_dev_prop (                                   "+
    "                             a.dockind,                                            "+
    "                             a.origin,                                             "+
    "                             a.paymkind,                                           "+
    "                             a.shifr_oper,                                         "+
    "                             a.numb_pack,                                          "+
    "                             a.chapter,                                            "+
    "                             a.t_typedocument,                                     "+
    "                             a.accdeb,                                             "+
    "                             a.T_FIID_PAYER,                                       "+
    "                             a.acckr,                                              "+
    "                             a.T_FIID_RECEIVER,                                    "+
    "                             NULL))) vid_hran,                                     "+
    "          a.t_result_carry                                                         "+
    "   FROM   (SELECT   DISTINCT                                                       "+
    "                    arh.t_account_payer AS accdeb,                                 "+
    "                    arh.t_account_receiver AS acckr,                               "+
    "                    ARH.T_SUM_NATCUR AS SUM,                                       "+
    "                    pm.T_CORSCHEM CS,                                              "+
    "                    ARH.T_ACCTRNID appkey,                                         "+
    "                    arh.t_typedocument,                                            "+
    "                    ARH.T_FIID_PAYER,                                              "+
    "                    ARH.T_FIID_RECEIVER,                                           "+
    "                    prop.t_paymentkind paymkind,                                   "+
    "                    user_ea.GetOrigin (paym.t_dockind, paym.t_paymentid) origin,   "+
    "                    paym.t_chapter chapter,                                        "+
    "                    pm.T_DEBETCREDIT DbCr,                                         "+
    "                    paym.t_dockind dockind,                                        "+
    "                    arh.t_number_pack numb_pack,                                   "+
    "                    prop.t_shifroper shifr_oper,                                   "+
    "                    paym.t_paymentid paymentid,                                    "+
    "                    arh.t_result_carry                                             "+
    "             FROM   dpmdocs_dbt docs,                                              "+
    "                    dpmpaym_dbt paym,                                              "+
    "                    dpmrmprop_dbt prop,                                            "+
    "                    dpmprop_dbt pm,                                                "+
    "                    dacctrn_dbt arh                                                "+
    "            WHERE       arh.t_date_carry = TO_DATE (:DateDocum1, 'DD.MM.YYYY')     "+
    "                    AND ARH.t_STATE = 1                                            "+  //GSP 28.04.2014
    "                    AND arh.t_chapter = :chapter                                   "+
    "                    AND ARH.T_ACCTRNID = DOCS.T_ACCTRNID                           "+
    "                    AND docs.t_paymentid = paym.t_paymentid                        "+
    "                    AND paym.t_paymentid = prop.t_paymentid                        "+
    "                    AND paym.t_paymentid = pm.t_paymentid                          "+
    "                    AND arh.t_account_payer <> 'ОВП'                               "+
    "                    AND arh.t_account_receiver <> 'ОВП'                            "+
    "                    AND SUBSTR (arh.t_account_payer, 1, 5) NOT IN                  "+
    "                             ('20202', '20203', '20207','00000')                   "+
    "                    AND SUBSTR (arh.t_account_receiver, 1, 5) NOT IN               "+
    "                             ('20202', '20203', '20207')                           ";
  if(substr(RepTypes,1,9) == "Баланс ->")
    select1 = select1+
    "                    AND EXISTS                                                     "+
    "                            (SELECT   1                                            "+
    "                               FROM   dpmprop_dbt deb, dpmprop_dbt cred            "+
    "                              WHERE       cred.T_PAYMENTID = docs.T_PAYMENTID      "+
    "                                      AND deb.T_PAYMENTID = docs.T_PAYMENTID       "+
    "                                      AND deb.T_PAYMENTID = cred.T_PAYMENTID       "+
    "                                      AND deb.t_debetcredit = 0                    "+
    "                                      AND cred.t_debetcredit = 1                   "+
    "                                      AND (cred.t_group = :group1                  "+
    "                                           OR deb.t_group = :group2))              ";  /*условие для внешних*/
  end;
    Select = Select1 + 
    "                    AND arh.T_FIID_PAYER = 0                                       "+   
    "                    AND arh.T_FIID_RECEIVER = 0 ) a                                "+
//    "                    AND substr(arh.T_ACCOUNT_PAYER,6,3) = '810'                    "+
//    "                    AND substr(arh.T_ACCOUNT_RECEIVER,6,3) = '810' ) a             "+
    "  WHERE   dbcr = 1                                                                 ";
   if(substr(RepTypes,1,9) == "Баланс ->")
     var param_vn = MakeArray(SQLParam ("DateDocum1", string(DateDocum)),
                              SQLParam ("chapter", chapter),
                              SQLParam ("group1",PAYMENTS_GROUP_EXTERNAL),
                              SQLParam ("group2",PAYMENTS_GROUP_EXTERNAL));
//debugbreak;
     Data = ExecSQLSelect(Select,param_vn);                                                                        
   end;
      while(Data.movenext())                                                                                 //
        useprogress(progressCount);
        progressCount = progressCount + 1;
	razdelS = opredelenie_razdela_vneshnih(data.value("accdeb"),data.value("acckr"),data.value("CS"));
	StoreKind = data.value("vid_hran");
	payment_id = data.value("paymentid");
	StoreKind = kateg_vid_hran(payment_id,StoreKind,chapter);
       if (StoreKind == 0)
                if  (razdelS == "ОПЕРУ")
                    kol_vnesh_Operu_RUR_B        = kol_vnesh_Operu_RUR_B      + 1;
                    SumRRF_vnesh_Operu_RUR_B     = SumRRF_vnesh_Operu_RUR_B   + data.value("Sum");
                    SumItogo_vnesh_Operu_RUR_B   = SumRRF_vnesh_Operu_RUR_B   ;
                elif(razdelS == "НОСТРО")
                    kol_vnesh_nostro_RUR_B       = kol_vnesh_nostro_RUR_B     + 1;
                    SumRRF_vnesh_nostro_RUR_B    = SumRRF_vnesh_nostro_RUR_B  + data.value("Sum");
                    SumItogo_vnesh_nostro_RUR_B  = SumRRF_vnesh_nostro_RUR_B  ;
		elif(razdelS == "МФР")
                    kol_vnesh_mfr_RUR_B          = kol_vnesh_mfr_RUR_B        + 1;
                    SumRRF_vnesh_mfr_RUR_B       = SumRRF_vnesh_mfr_RUR_B     + data.value("Sum");
                    SumItogo_vnesh_mfr_RUR_B     = SumRRF_vnesh_mfr_RUR_B     ;
		elif(razdelS == "ПРОЧИЕ")
                    kol_vnesh_prochie_RUR_B      = kol_vnesh_prochie_RUR_B    + 1;
                    SumRRF_vnesh_prochie_RUR_B   = SumRRF_vnesh_prochie_RUR_B + data.value("Sum");
                    SumItogo_vnesh_prochie_RUR_B = SumRRF_vnesh_prochie_RUR_B ;
                end;
       else
                if  (razdelS == "ОПЕРУ")
                    kol_vnesh_Operu_RUR_E        = kol_vnesh_Operu_RUR_E      + 1;
                    SumRRF_vnesh_Operu_RUR_E     = SumRRF_vnesh_Operu_RUR_E   + data.value("Sum");
                    SumItogo_vnesh_Operu_RUR_E   = SumRRF_vnesh_Operu_RUR_E   ;
                elif(razdelS == "НОСТРО")
                    kol_vnesh_nostro_RUR_E       = kol_vnesh_nostro_RUR_E     + 1;
                    SumRRF_vnesh_nostro_RUR_E    = SumRRF_vnesh_nostro_RUR_E  + data.value("Sum");
                    SumItogo_vnesh_nostro_RUR_E  = SumRRF_vnesh_nostro_RUR_E  ;
		elif(razdelS == "МФР")
                    kol_vnesh_mfr_RUR_E          = kol_vnesh_mfr_RUR_E        + 1;
                    SumRRF_vnesh_mfr_RUR_E       = SumRRF_vnesh_mfr_RUR_E     + data.value("Sum");
                    SumItogo_vnesh_mfr_RUR_E     = SumRRF_vnesh_mfr_RUR_E     ;
		elif(razdelS == "ПРОЧИЕ")
                    kol_vnesh_prochie_RUR_E      = kol_vnesh_prochie_RUR_E    + 1;
                    SumRRF_vnesh_prochie_RUR_E   = SumRRF_vnesh_prochie_RUR_E + data.value("Sum");
                    SumItogo_vnesh_prochie_RUR_E = SumRRF_vnesh_prochie_RUR_E ;
                end;
       end;
      end;/*while*/
                    kol_vnesh_ITOG_RUR_B      = kol_vnesh_Operu_RUR_B    + kol_vnesh_nostro_RUR_B    + kol_vnesh_mfr_RUR_B    + kol_vnesh_prochie_RUR_B;
                    SumRRF_vnesh_ITOG_RUR_B   = SumRRF_vnesh_Operu_RUR_B + SumRRF_vnesh_nostro_RUR_B + SumRRF_vnesh_mfr_RUR_B + SumRRF_vnesh_prochie_RUR_B;
                    SumItogo_vnesh_ITOG_RUR_B = SumRRF_vnesh_ITOG_RUR_B;
                    kol_vnesh_ITOG_RUR_E      = kol_vnesh_Operu_RUR_E    + kol_vnesh_nostro_RUR_E    + kol_vnesh_mfr_RUR_E    + kol_vnesh_prochie_RUR_E;
                    SumRRF_vnesh_ITOG_RUR_E   = SumRRF_vnesh_Operu_RUR_E + SumRRF_vnesh_nostro_RUR_E + SumRRF_vnesh_mfr_RUR_E + SumRRF_vnesh_prochie_RUR_E;
                    SumItogo_vnesh_ITOG_RUR_E = SumRRF_vnesh_ITOG_RUR_E;

      [  │                                                                                                     │
         │ 2.БУХГАЛТЕРСКИЕ  ДОКУМЕНТЫ  ВНЕШНИХ  ОПЕРАЦИЙ  ПОДРАЗДЕЛЕНИЙ:                                       │
         │  (ВХОДЯЩИЕ, ИСХОДЯЩИЕ ПЛАТЕЖИ включая ТРАНЗИТНЫЕ, НЕВЫЯСНЕННЫЕ, НЕЗАВЕРШЕННЫЕ )                     │
         ├───────────────────────┬────────────┬───┬────────────┬───────────────┬───────────────┬───────────────┤
         │ ВНЕШНИЕ  ОПЕРАЦИИ     │            │ Б │############│###############│###############│###############│
         │ ПО  БАНКУ  В  РУБЛЯХ  │  рублевые  ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │ РКЦ/ОПЕРУ/ │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │  рублевые  ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │   НОСТРО   │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
	 │                       │  рублевые  ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │     МФР    │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │  рублевые  │ Б │############│###############│###############│###############│
         │                       │   прочие   ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │   схемы    │ Э │############│###############│###############│###############│
         ├───────────────────────┴────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                                    │ Б │############│###############│###############│###############│
         │  ИТОГО внешние ( РУБЛИ )           ├───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                                    │ Э │############│###############│###############│###############│](
                                            kol_vnesh_Operu_RUR_B  ,SumRRF_vnesh_Operu_RUR_B  ,SumEKV_vnesh_Operu_RUR_B  ,SumItogo_vnesh_Operu_RUR_B,
                                            kol_vnesh_Operu_RUR_E  ,SumRRF_vnesh_Operu_RUR_E  ,SumEKV_vnesh_Operu_RUR_E  ,SumItogo_vnesh_Operu_RUR_E,
                                            kol_vnesh_nostro_RUR_B ,SumRRF_vnesh_nostro_RUR_B ,SumEKV_vnesh_nostro_RUR_B ,SumItogo_vnesh_nostro_RUR_B,
                                            kol_vnesh_nostro_RUR_E ,SumRRF_vnesh_nostro_RUR_E ,SumEKV_vnesh_nostro_RUR_E ,SumItogo_vnesh_nostro_RUR_E,
                                            kol_vnesh_mfr_RUR_B    ,SumRRF_vnesh_mfr_RUR_B    ,SumEKV_vnesh_mfr_RUR_B    ,SumItogo_vnesh_mfr_RUR_B,
                                            kol_vnesh_mfr_RUR_E    ,SumRRF_vnesh_mfr_RUR_E    ,SumEKV_vnesh_mfr_RUR_E    ,SumItogo_vnesh_mfr_RUR_E,
                                            kol_vnesh_prochie_RUR_B,SumRRF_vnesh_prochie_RUR_B,SumEKV_vnesh_prochie_RUR_B,SumItogo_vnesh_prochie_RUR_B,
                                            kol_vnesh_prochie_RUR_E,SumRRF_vnesh_prochie_RUR_E,SumEKV_vnesh_prochie_RUR_E,SumItogo_vnesh_prochie_RUR_E,
                                            kol_vnesh_ITOG_RUR_B   ,SumRRF_vnesh_ITOG_RUR_B   ,SumEKV_vnesh_ITOG_RUR_B   ,SumItogo_vnesh_ITOG_RUR_B,
                                            kol_vnesh_ITOG_RUR_E   ,SumRRF_vnesh_ITOG_RUR_E   ,SumEKV_vnesh_ITOG_RUR_E   ,SumItogo_vnesh_ITOG_RUR_E);   /* GSP Рублевые внешние адаптированы под 2031*/



    Select = Select1 + 
    "                    AND substr(arh.T_ACCOUNT_PAYER,6,3) = substr(arh.T_ACCOUNT_RECEIVER,6,3) "+ 
    "                    AND arh.T_FIID_PAYER <> 0                                                "+   
    "                    AND arh.T_FIID_RECEIVER <> 0 ) a                                         "+
    "  WHERE   dbcr = 1                                                                           ";
    if(substr(RepTypes,1,9) == "Баланс ->")
       Data = ExecSQLSelect(Select,param_vn);
    end;
    while(Data.movenext())
        useprogress(progressCount);
        progressCount = progressCount + 1;
        razdelS = opredelenie_razdela_vneshnih(data.value("accdeb"),data.value("acckr"),data.value("CS"));
        SumR = data.value("Sum");
        StoreKind = data.value("vid_hran");
        payment_id = data.value("paymentid");
        StoreKind = kateg_vid_hran(payment_id,StoreKind,chapter);
        if(StoreKind == 0)
           if(razdelS == "НОСТРО")
              kol_vnesh_nostro_VAL_B       = kol_vnesh_nostro_VAL_B     + 1;
              SumEKV_vnesh_nostro_VAL_B    = SumEKV_vnesh_nostro_VAL_B  + SumR;
              SumItogo_vnesh_nostro_VAL_B  = SumEKV_vnesh_nostro_VAL_B  ;
           elif(razdelS == "МФР")
              kol_vnesh_mfr_VAL_B          = kol_vnesh_mfr_VAL_B        + 1;
              SumEKV_vnesh_mfr_VAL_B       = SumEKV_vnesh_mfr_VAL_B     + SumR;
              SumItogo_vnesh_mfr_VAL_B     = SumEKV_vnesh_mfr_VAL_B     ;
           elif(razdelS == "ПРОЧИЕ")
              kol_vnesh_prochie_VAL_B      = kol_vnesh_prochie_VAL_B    + 1;
              SumEKV_vnesh_prochie_VAL_B   = SumEKV_vnesh_prochie_VAL_B + SumR;
              SumItogo_vnesh_prochie_VAL_B = SumEKV_vnesh_prochie_VAL_B ;
           end;

        else
           if(razdelS == "НОСТРО")
              kol_vnesh_nostro_VAL_E       = kol_vnesh_nostro_VAL_E     + 1;
              SumEKV_vnesh_nostro_VAL_E    = SumEKV_vnesh_nostro_VAL_E  + SumR;
              SumItogo_vnesh_nostro_VAL_E  = SumEKV_vnesh_nostro_VAL_E  ;
           elif(razdelS == "МФР")
              kol_vnesh_mfr_VAL_E          = kol_vnesh_mfr_VAL_E        + 1;
              SumEKV_vnesh_mfr_VAL_E       = SumEKV_vnesh_mfr_VAL_E     + SumR;
              SumItogo_vnesh_mfr_VAL_E     = SumEKV_vnesh_mfr_VAL_E     ;
           elif(razdelS == "ПРОЧИЕ")
              kol_vnesh_prochie_VAL_E      = kol_vnesh_prochie_VAL_E    + 1;
              SumEKV_vnesh_prochie_VAL_E   = SumEKV_vnesh_prochie_VAL_E + SumR;
              SumItogo_vnesh_prochie_VAL_E = SumEKV_vnesh_prochie_VAL_E ;
           end;
        end;
    end;/*while*/
    Select = Select1 + " AND arh.T_FIID_PAYER <> arh.T_FIID_RECEIVER  ) a   WHERE   dbcr = 1        "; //15.08.2014 R-421158-2 DPN 
    if(substr(RepTypes,1,9) == "Баланс ->")
       Data = ExecSQLSelect(Select,param_vn);                                                                        //
    end;
      while(Data.movenext())                                                                                 //
        useprogress(progressCount);
        progressCount = progressCount + 1;
        paymentID1 = data.value("paymentid");
	StoreKind = data.value("vid_hran");
	payment_id = data.value("paymentid");
	StoreKind = kateg_vid_hran(payment_id,StoreKind,chapter);
/*-------------------------------------------------------------------------------------------------------------------------------*/
    if((substr(data.value("AccKr"),14,5) == "21010") or (substr(data.value("AccKr"),14,5) == "22010")or(substr(data.value("AccDeb"),14,5) == "21010")or(substr(data.value("AccDeb"),14,5) == "22010") or (data.value("T_RESULT_CARRY") ==18) or (data.value("T_RESULT_CARRY") == 82))
       if ((StoreKind == 0) and (substr(data.value("accDeb"),1,5) != "90901")and (substr(data.value("accDeb"),1,5) != "90902")and (substr(data.value("accKr"),1,5) != "90901")and (substr(data.value("accKr"),1,5) != "90902"))
        kol_vnesh_konv_VAL_B = kol_vnesh_konv_VAL_B + 1; SumRRF_vnesh_konv_VAL_B = SumRRF_vnesh_konv_VAL_B + data.value("Sum");
       else
        kol_vnesh_konv_VAL_E = kol_vnesh_konv_VAL_E + 1; SumRRF_vnesh_konv_VAL_E = SumRRF_vnesh_konv_VAL_E + data.value("Sum");
       end;
    else
       if ((StoreKind == 0) and (substr(data.value("accDeb"),1,5) != "90901")and (substr(data.value("accDeb"),1,5) != "90902")and (substr(data.value("accKr"),1,5) != "90901")and (substr(data.value("accKr"),1,5) != "90902"))
        kol_vnesh_konv_VAL_B = kol_vnesh_konv_VAL_B + 1; SumEKV_vnesh_konv_VAL_B = SumEKV_vnesh_konv_VAL_B + data.value("Sum");
       else
        kol_vnesh_konv_VAL_E = kol_vnesh_konv_VAL_E + 1; SumEKV_vnesh_konv_VAL_E = SumEKV_vnesh_konv_VAL_E + data.value("Sum");
       end;
    end;
    end;/*while*/
                    SumItogo_vnesh_konv_VAL_B = SumRRF_vnesh_konv_VAL_B   + SumEKV_vnesh_konv_VAL_B ;
                    SumItogo_vnesh_konv_VAL_E = SumRRF_vnesh_konv_VAL_E   + SumEKV_vnesh_konv_VAL_E ;
                    kol_vnesh_ITOG_VAL_B      = kol_vnesh_nostro_VAL_B    + kol_vnesh_mfr_VAL_B     + kol_vnesh_prochie_VAL_B    + kol_vnesh_konv_VAL_B    + kol_vnesh_ITOG_RUR_B;
                    SumEKV_vnesh_ITOG_VAL_B   = SumEKV_vnesh_nostro_VAL_B + SumEKV_vnesh_mfr_VAL_B  + SumEKV_vnesh_prochie_VAL_B + SumEKV_vnesh_konv_VAL_B + SumEKV_vnesh_ITOG_RUR_B;
                    SumRRF_vnesh_ITOG_VAL_B   = SumRRF_vnesh_konv_VAL_B   + SumRRF_vnesh_ITOG_RUR_B ;
                    SumItogo_vnesh_ITOG_VAL_B = SumEKV_vnesh_ITOG_VAL_B   + SumRRF_vnesh_ITOG_VAL_B ;
                    kol_vnesh_ITOG_VAL_E      = kol_vnesh_nostro_VAL_E    + kol_vnesh_mfr_VAL_E     + kol_vnesh_prochie_VAL_E    + kol_vnesh_konv_VAL_E    + kol_vnesh_ITOG_RUR_E;
                    SumEKV_vnesh_ITOG_VAL_E   = SumEKV_vnesh_nostro_VAL_E + SumEKV_vnesh_mfr_VAL_E  + SumEKV_vnesh_prochie_VAL_E + SumEKV_vnesh_konv_VAL_E + SumEKV_vnesh_ITOG_RUR_E;
                    SumRRF_vnesh_ITOG_VAL_E   = SumRRF_vnesh_konv_VAL_E   + SumRRF_vnesh_ITOG_RUR_E ;
                    SumItogo_vnesh_ITOG_VAL_E = SumEKV_vnesh_ITOG_VAL_E   + SumRRF_vnesh_ITOG_VAL_E ;
                    kol_vnesh_ITOG            = kol_vnesh_ITOG_VAL_B      + kol_vnesh_ITOG_VAL_E    ; 
                    SumRRF_vnesh_ITOG         = SumRRF_vnesh_ITOG_VAL_B   + SumRRF_vnesh_ITOG_VAL_E ;
                    SumEKV_vnesh_ITOG         = SumEKV_vnesh_ITOG_VAL_B   + SumEKV_vnesh_ITOG_VAL_E ;
                    SumItogo_vnesh_ITOG       = SumItogo_vnesh_ITOG_VAL_B + SumItogo_vnesh_ITOG_VAL_E;

      [  ├───────────────────────┬────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ ВНЕШНИЕ  ОПЕРАЦИИ     │            │ Б │############│###############│###############│###############│
         │ ПО  БАНКУ  В  ВАЛЮТЕ  │   валюта   ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │   НОСТРО   │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │   валюта   ├───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │    МФР     │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
	 │                       │   валюта   ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │  пр. схемы │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │   конвер-  ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │   сионные  │ Э │############│###############│###############│###############│
         ├───────────────────────┴────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                                    │ Б │############│###############│###############│###############│
         │  ИТОГО внешние ( РУБЛИ + ВАЛЮТА )  ├───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                                    │ Э │############│###############│###############│###############│
         ├────────────────────────────────────┴───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                                        │            │               │               │               │
         │ Всего внешних документов  по 000       │############│###############│###############│###############│
         │                                        │            │               │               │               │](
                                            kol_vnesh_nostro_VAL_B ,SumRRF_vnesh_nostro_VAL_B ,SumEKV_vnesh_nostro_VAL_B ,SumItogo_vnesh_nostro_VAL_B ,
                                            kol_vnesh_nostro_VAL_E ,SumRRF_vnesh_nostro_VAL_E ,SumEKV_vnesh_nostro_VAL_E ,SumItogo_vnesh_nostro_VAL_E ,
                                            kol_vnesh_mfr_VAL_B    ,SumRRF_vnesh_mfr_VAL_B    ,SumEKV_vnesh_mfr_VAL_B    ,SumItogo_vnesh_mfr_VAL_B    ,
                                            kol_vnesh_mfr_VAL_E    ,SumRRF_vnesh_mfr_VAL_E    ,SumEKV_vnesh_mfr_VAL_E    ,SumItogo_vnesh_mfr_VAL_E    ,
                                            kol_vnesh_prochie_VAL_B,SumRRF_vnesh_prochie_VAL_B,SumEKV_vnesh_prochie_VAL_B,SumItogo_vnesh_prochie_VAL_B,
                                            kol_vnesh_prochie_VAL_E,SumRRF_vnesh_prochie_VAL_E,SumEKV_vnesh_prochie_VAL_E,SumItogo_vnesh_prochie_VAL_E,
                                            kol_vnesh_konv_VAL_B   ,SumRRF_vnesh_konv_VAL_B   ,SumEKV_vnesh_konv_VAL_B   ,SumItogo_vnesh_konv_VAL_B   ,
                                            kol_vnesh_konv_VAL_E   ,SumRRF_vnesh_konv_VAL_E   ,SumEKV_vnesh_konv_VAL_E   ,SumItogo_vnesh_konv_VAL_E   ,
                                            kol_vnesh_ITOG_VAL_B   ,SumRRF_vnesh_ITOG_VAL_B   ,SumEKV_vnesh_ITOG_VAL_B   ,SumItogo_vnesh_ITOG_VAL_B   ,
                                            kol_vnesh_ITOG_VAL_E   ,SumRRF_vnesh_ITOG_VAL_E   ,SumEKV_vnesh_ITOG_VAL_E   ,SumItogo_vnesh_ITOG_VAL_E   ,
                                            kol_vnesh_ITOG         ,SumRRF_vnesh_ITOG         ,SumEKV_vnesh_ITOG         ,SumItogo_vnesh_ITOG        );   /* GSP отбор внешних адаптирован */

    message("отбор внутренних документов");

      [  ├────────────────────────────────────────┴────────────┴───────────────┴───────────────┴───────────────┤
         │                                                                                                     │
         │  3.БУХГАЛТЕРСКИЕ  ДОКУМЕНТЫ  ВНУТРЕННИХ ОПЕРАЦИЙ  ПОДРАЗДЕЛЕНИЙ:                                    │
         │              ( ВНУТРИБАНКОВСКИЕ   ПЛАТЕЖИ   И  ОПЕРАЦИИ  )                                          │
         ├───────────────────────┬────────────┬───┬────────────┬───────────────┬───────────────┬───────────────┤];

    Select_otdels = 
    " select t_code1, t_name from dotdels_dbt " + "\n" + 
    " where t_code2 = 0                       " + "\n" +
    " order by t_code1 asc                    " + "\n" ;
    Data_otdels = ExecSQLSelect(Select_otdels);

/* 21.05.2013 joy В январе в ГЭБе по вине внешней системы есть некоректные проводки, которые требуют отдельного учета*/
var GebJan2013 = false;
if ((fgBank.is_GEB) and (DateDocum >= date ("01.01.2013")) and (DateDocum <= date ("31.01.2013")))
    GebJan2013 = true;
end;

    flag_pechati_nulevih_otdelov = 0;
   while(Data_otdels.movenext())
     num_otdel  = Data_otdels.value("t_code1");                            
     name_otdel = Data_otdels.value("t_name");
     message("Отбор документов по подразделению " + num_otdel + ".0 - " + name_otdel);
     name_otdel1 = substr(name_otdel,1 ,16);
     name_otdel2 = substr(name_otdel,17,20);
     name_otdel3 = substr(name_otdel,37,20);

    if(substr(RepTypes,1,9) == "Баланс ->")
       StoreKindParam = " (a.dockind,a.origin,a.paymkind,a.shifr_oper,a.numb_pack,a.chapter,        "+
                        "  a.t_typedocument,a.accdeb,a.T_FIID_PAYER,a.acckr,a.T_FIID_RECEIVER,NULL) ";
       resultCarry = " ";
      externalExists = 
      "                    AND (EXISTS                                                                         "+
      "                            (SELECT   1                                                                 "+
      "                               FROM   dpmprop_dbt deb, dpmprop_dbt cred                                 "+
      "                              WHERE       cred.T_PAYMENTID = docs.T_PAYMENTID                           "+
      "                                      AND deb.T_PAYMENTID = docs.T_PAYMENTID                            "+
      "                                      AND deb.T_PAYMENTID = cred.T_PAYMENTID                            "+
      "                                      AND deb.t_debetcredit = 0                                         "+
      "                                      AND cred.t_debetcredit = 1                                        "+
      "                                      AND cred.t_group <> :group1                                       "+
      "                                      AND deb.t_group <> :group2)                                       "+
      "                         OR docs.t_paymentid IS NULL                                                    "+
      "                         OR paym.t_paymentid IS NULL                                                    "+
      "                         OR pm.t_paymentid IS NULL)                                                     ";

    else
      StoreKindParam = " (null,a.origin,null,case when docKind not in (15,70) and chapter <> 1 then '09' else shifr_oper end, "+
                       "  a.numb_pack,a.chapter,a.t_typedocument,a.accdeb,a.T_FIID_PAYER,a.acckr,a.T_FIID_RECEIVER, null )    ";
      resultCarry = " AND arh.t_result_carry <> 14 ";   
      externalExists = " ";
    end;

    select1 = 
    " SELECT   DISTINCT SUM, NVL(paymentid, -1) paymentid, AppKey, AccDeb, AccKr,T_RESULT_CARRY,             "+
    " case when a.docKind not in (15,70) and a.chapter <> 1 then 1 else to_number(NVL(                       "+
    "                   (SELECT   storeKind                                                                  "+
    "                      FROM   TABLE (USER_EA.Get_dev_prop"+ StoreKindParam +" )),1)) end vid_hran        "+
    "   FROM   (SELECT   arh.t_numb_document AS NumDoc,                                                      "+
    "                    arh.t_account_payer AS AccDeb,                                                      "+
    "                    arh.t_account_receiver AS AccKr,                                                    "+
    "                    ARH.T_SUM_NATCUR AS SUM,                                                            "+
    "                    ARH.T_ACCTRNID AppKey,                                                              "+
    "                    arh.t_typedocument,                                                                 "+
    "                    prop.T_PAYMENTKIND paymkind,                                                        "+
    "                    user_ea.GetOrigin (paym.t_dockind, paym.t_paymentid) origin,                        "+
    "                    arh.T_CHAPTER chapter,                                                              "+
    "                    paym.T_DOCKIND dockind,                                                             "+
    "                    arh.T_NUMBER_PACK numb_pack,                                                        "+
    "                    prop.T_SHIFROPER shifr_oper,                                                        "+
    "                    ARH.T_FIID_PAYER,                                                                   "+
    "                    ARH.T_FIID_RECEIVER,                                                                "+
    "                    arh.T_RESULT_CARRY,                                                                 "+
    "                    paym.t_paymentid paymentid                                                          "+
    "             FROM   dpmdocs_dbt docs,                                                                   "+
    "                    dpmpaym_dbt paym,                                                                   "+
    "                    DOTDELS_DBT,                                                                        "+
    "                    dpmrmprop_dbt prop,                                                                 "+
    "                    dpmprop_dbt pm,                                                                     "+
    "                    (SELECT   *                                                                         "+
    "                       FROM   DOP_OTDEL_DBT                                                             "+
    "                      WHERE   (T_oper, t_datebegin) IN                                                  "+
    "                                    (  SELECT   T_oper, MAX (t_datebegin) t_datebegin                   "+
    "                                         FROM   DOP_OTDEL_DBT                                           "+
    "                                        WHERE       t_datebegin <= TO_DATE (:DateDocum1 ,'DD.MM.YYYY')  "+
    "                                                AND (t_dateend  >= TO_DATE (:DateDocum2 ,'DD.MM.YYYY')  "+
    "                                                    OR t_dateend = TO_DATE ('01.01.0001','DD.MM.YYYY')) "+
    "                                     GROUP BY   T_oper)) DOP_OTDEL_DBT,                                 "+
    "                    dacctrn_dbt arh                                                                     "+
    "            WHERE       arh.t_date_carry = TO_DATE (:DateDocum3, 'DD.MM.YYYY')                          "+
    "                    AND (DOP_OTDEL_DBT.t_dateend >= TO_DATE (:DateDocum4, 'DD.MM.YYYY')                 "+
    "                         OR t_dateend = TO_DATE ('01.01.0001', 'DD.MM.YYYY'))                           "+
    "                    AND t_datebegin <= TO_DATE (:DateDocum5, 'DD.MM.YYYY')                              "+
    "                    AND arh.T_OPER = DOP_OTDEL_DBT.T_oper                                               "+
    "                    AND arh.t_state = 1                                                                 "+
    "                    AND arh.t_chapter = :Chapter                                                        "+
    "                    AND ARH.T_ACCTRNID = DOCS.T_ACCTRNID(+)                                             "+
    "                    AND docs.T_PAYMENTID = paym.T_PAYMENTID(+)                                          "+
    "                    AND prop.t_paymentid(+) = paym.t_paymentid                                          "+
    "                    AND pm.t_paymentid(+) = paym.t_paymentid                                            "+
    "                    AND DOTDELS_DBT.T_CODE1 = :num_otdel                                                "+
    "                    AND DOP_OTDEL_DBT.T_CODE1 = DOTDELS_DBT.T_CODE1                                     "+
    "                    AND DOP_OTDEL_DBT.T_CODE2 = DOTDELS_DBT.T_CODE2                                     "+
    resultCarry + externalExists ;

   if(RepTypes != "Внебаланс")
      Select = Select1 +
      "                    AND SUBSTR (arh.T_ACCOUNT_PAYER, 6, 3) = '810'                                      "+
      "                    AND SUBSTR (arh.T_ACCOUNT_RECEIVER, 6, 3) = '810'                                   "+
      "                    AND SUBSTR (arh.t_account_receiver, 1, 5) NOT IN('20202', '20203', '20207','00000') "+
      "                    AND SUBSTR (arh.t_account_payer, 1, 5) NOT IN('20202', '20203', '20207')    "+
      "                         ) a                                                                            ";
   else
      Select = Select1 + 
      "     AND ((SUBSTR (arh.t_account_payer, 6, 3) = '810' and SUBSTR (arh.t_account_receiver, 6,3) = '810') "+
      "           OR (SUBSTR (arh.t_account_payer, 6, 3) <> SUBSTR (arh.t_account_receiver, 6,3)               "+
      "           or (arh.t_account_payer like 'ОВП%' AND docs.t_paymentid IS NULL)                            "+
      "           or (arh.t_account_receiver like 'ОВП%' AND docs.t_paymentid IS NULL)))                       "+
      "                    AND SUBSTR (arh.t_account_receiver, 1, 5) NOT IN('20202', '20203', '20207','00000')         "+
      "                    AND SUBSTR (arh.t_account_payer, 1, 5) NOT IN('20202', '20203', '20207')            "+
      "                         ) a                                                                            ";
   end;

   if(substr(RepTypes,1,9) == "Баланс ->")
      var param = makeArray (SQLParam ("DateDocum1", string(DateDocum)),
                             SQLParam ("DateDocum2", string(DateDocum)),
                             SQLParam ("DateDocum3", string(DateDocum)),
                             SQLParam ("DateDocum4", string(DateDocum)),
                             SQLParam ("DateDocum5", string(DateDocum)),
                             SQLParam ("Chapter",    Chapter), 
                             SQLParam ("num_otdel",  num_otdel), 
                             SQLParam ("group1",     PAYMENTS_GROUP_EXTERNAL),
                             SQLParam ("group2",     PAYMENTS_GROUP_EXTERNAL));

   else
          param = makeArray (SQLParam ("DateDocum1", string(DateDocum)),
                             SQLParam ("DateDocum2", string(DateDocum)),
                             SQLParam ("DateDocum3", string(DateDocum)),
                             SQLParam ("DateDocum4", string(DateDocum)),
                             SQLParam ("DateDocum5", string(DateDocum)),
                             SQLParam ("Chapter",    Chapter), 
                             SQLParam ("num_otdel",  num_otdel));

   end;
	      Data = ExecSQLselect(Select,param);
//debugbreak;
    while (Data.movenext())
      useprogress(progressCount);
      progressCount = progressCount + 1;
      flag_pechati_nulevih_otdelov = 1;
      StoreKind = data.value("vid_hran");
      payment_id = data.value("paymentid");
      StoreKind = kateg_vid_hran(payment_id,StoreKind,chapter);
      if(StoreKind == 0)
         Kol_vnutr_RUR_B = Kol_vnutr_RUR_B + 1;
         SumRRF_vnutr_RUR_B = SumRRF_vnutr_RUR_B + Data.value("sum");
         SumItogo_vnutr_RUR_B = SumRRF_vnutr_RUR_B;
      else
         Kol_vnutr_RUR_E = Kol_vnutr_RUR_E + 1;
         SumRRF_vnutr_RUR_E = SumRRF_vnutr_RUR_E + Data.value("sum");
         SumItogo_vnutr_RUR_E = SumRRF_vnutr_RUR_E;
      end;
    end;/*while*/
    select = select1 + " AND substr(arh.T_ACCOUNT_PAYER,6,3) = substr(arh.T_ACCOUNT_RECEIVER,6,3)    "+ 
                       " AND substr(arh.T_ACCOUNT_PAYER,6,3) <> '810'                                "+
                       " AND substr(arh.T_ACCOUNT_RECEIVER,6,3) <> '810'                             "+
                       " AND SUBSTR (arh.t_account_receiver, 1, 5) NOT IN('20202', '20203', '20207','00000') "+
                       " AND SUBSTR (arh.t_account_payer, 1, 5) NOT IN('20202', '20203', '20207')    "+
                       " AND SUBSTR(arh.t_account_receiver,1,3) NOT in ('ОВП')                       "+       // 15.04.2013 joy I-00291358-3
                       " AND SUBSTR(arh.t_account_payer,1,3)    NOT in ('ОВП')) a                    "; //            Отсекаем лишнее
    Data = ExecSQLselect(Select,param);

//debugbreak;
    while (Data.movenext())
      useprogress(progressCount);
      progressCount = progressCount + 1;
      flag_pechati_nulevih_otdelov = 1; 
      SumR       = data.value("Sum");
      StoreKind  = data.value("vid_hran");
      payment_id = data.value("paymentid");
      StoreKind  = kateg_vid_hran(payment_id,StoreKind,chapter);
      if(StoreKind == 0)
         Kol_vnutr_VAL_B = Kol_vnutr_VAL_B + 1;
         SumEKV_vnutr_VAL_B = SumEKV_vnutr_VAL_B + SumR;
         SumItogo_vnutr_VAL_B = SumEKV_vnutr_VAL_B;
      else
         Kol_vnutr_VAL_E = Kol_vnutr_VAL_E + 1;
         SumEKV_vnutr_VAL_E = SumEKV_vnutr_VAL_E + SumR;
         SumItogo_vnutr_VAL_E = SumEKV_vnutr_VAL_E;
      end;
    end;/*while*/
    if(RepTypes != "Внебаланс")
      select = select1 + " AND substr(arh.T_ACCOUNT_PAYER,6,3) <> substr(arh.T_ACCOUNT_RECEIVER,6,3)                                         "+ 
                         " AND (SUBSTR (arh.t_account_receiver, 1, 5) NOT IN ('20202','20203','20207','00000') or arh.T_RESULT_CARRY  in (18,82,83)) "+ 	
                         " AND (SUBSTR (arh.t_account_payer, 1, 5) NOT IN ('20202','20203','20207') or arh.T_RESULT_CARRY  in (18,82,83))    "+
	                 " AND SUBSTR(arh.t_account_receiver,1,3) NOT in ('ОВП')                                                             "+      
                         " AND SUBSTR(arh.t_account_payer,1,3)    NOT in ('ОВП')) a                                                          "; 
      Data = ExecSQLselect(Select,param);
debugbreak;
      while (Data.movenext())
        useprogress(progressCount);
        progressCount = progressCount + 1;
         SumR       = data.value("Sum");
         flag_pechati_nulevih_otdelov = 1;

         StoreKind  = data.value("vid_hran");
         payment_id = data.value("paymentid");
         StoreKind  = kateg_vid_hran(payment_id,StoreKind,chapter);
         if((substr(data.value("AccKr"),14,5) == "21010") or (substr(data.value("AccKr"),14,5) == "22010") or (substr(data.value("AccDeb"),14,5) == "21010") or (substr(data.value("AccDeb"),14,5) == "22010") or (data.value("T_RESULT_CARRY") == 18) or (data.value("T_RESULT_CARRY") == 82))
           if ((StoreKind == 0) and (payment_id != -1))
              kol_vnutr_kon_B = kol_vnutr_kon_B + 1; SumRRF_vnutr_kon_B = SumRRF_vnutr_kon_B + SumR;
           else
              kol_vnutr_kon_E = kol_vnutr_kon_E + 1; SumRRF_vnutr_kon_E = SumRRF_vnutr_kon_E + SumR;
           end;
         else
           if (StoreKind == 0)
              kol_vnutr_kon_B = kol_vnutr_kon_B + 1; SumEKV_vnutr_kon_B = SumEKV_vnutr_kon_B + SumR;
           else
              kol_vnutr_kon_E = kol_vnutr_kon_E + 1; SumEKV_vnutr_kon_E = SumEKV_vnutr_kon_E + SumR;
           end;
         end;
      end;/*while*/
    end;
        SumItogo_vnutr_KON_B  = SumRRF_vnutr_kon_B   + SumEKV_vnutr_kon_B   ;
        SumItogo_vnutr_KON_E  = SumRRF_vnutr_kon_E   + SumEKV_vnutr_kon_E   ;
        Kol_vnutr_ITOG_B      = kol_vnutr_RUR_B      + kol_vnutr_VAL_B      + kol_vnutr_kon_B      ;
        Kol_vnutr_ITOG_E      = kol_vnutr_RUR_E      + kol_vnutr_VAL_E      + kol_vnutr_kon_E      ;
        SumRRF_vnutr_ITOG_B   = SumRRF_vnutr_RUR_B   + SumRRF_vnutr_VAL_B   + SumRRF_vnutr_kon_B   ;
        SumRRF_vnutr_ITOG_E   = SumRRF_vnutr_RUR_E   + SumRRF_vnutr_VAL_E   + SumRRF_vnutr_kon_E   ;
        SumEKV_vnutr_ITOG_B   = SumEKV_vnutr_RUR_B   + SumEKV_vnutr_VAL_B   + SumEKV_vnutr_kon_B   ;
        SumEKV_vnutr_ITOG_E   = SumEKV_vnutr_RUR_E   + SumEKV_vnutr_VAL_E   + SumEKV_vnutr_kon_E   ;
        SumItogo_vnutr_ITOG_B = SumItogo_vnutr_RUR_B + SumItogo_vnutr_VAL_B + SumItogo_vnutr_kon_B ;
        SumItogo_vnutr_ITOG_E = SumItogo_vnutr_RUR_E + SumItogo_vnutr_VAL_E + SumItogo_vnutr_kon_E ;
        Kol_vnutr_ITOG        = Kol_vnutr_ITOG_B     + Kol_vnutr_ITOG_E     ;
        SumRRF_vnutr_ITOG     = SumRRF_vnutr_ITOG_B  + SumRRF_vnutr_ITOG_E  ;
        SumEKV_vnutr_ITOG     = SumEKV_vnutr_ITOG_B  + SumEKV_vnutr_ITOG_E  ;
        SumItogo_vnutr_ITOG   = SumItogo_vnutr_ITOG_B+ SumItogo_vnutr_ITOG_E; 

if(flag_pechati_nulevih_otdelov == 1)
       // ├───────────────────────┬────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
      [  │ ##.0 ################ │            │ Б │############│###############│###############│###############│
         │  #################### │  РУБЛЕВЫЕ  ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │  #################### │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │  ВАЛЮТНЫЕ  ├───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
	 │                       │КОНВЕРСИОН- ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │       НЫЕ  │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │   ИТОГО    ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │ по отчетам │ Э │############│###############│###############│###############│
         ├───────────────────────┴────────────┴───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                                        │            │               │               │               │
         │  Всего документов на сумму по ##.0     │############│###############│###############│###############│
         │                                        │            │               │               │               │
         ├───────────────────────┬────────────┬───┼────────────┼───────────────┼───────────────┼───────────────┤]
          (num_otdel,name_otdel1,                  Kol_vnutr_RUR_B,SumRRF_vnutr_RUR_B,SumEKV_vnutr_RUR_B,SumItogo_vnutr_RUR_B,
                     name_otdel2,
                     name_otdel3,                  Kol_vnutr_RUR_E,SumRRF_vnutr_RUR_E,SumEKV_vnutr_RUR_E,SumItogo_vnutr_RUR_E,
                                                   Kol_vnutr_VAL_B,SumRRF_vnutr_VAL_B,SumEKV_vnutr_VAL_B,SumItogo_vnutr_VAL_B,
                                                   Kol_vnutr_VAL_E,SumRRF_vnutr_VAL_E,SumEKV_vnutr_VAL_E,SumItogo_vnutr_VAL_E,
                                                   Kol_vnutr_KON_B,SumRRF_vnutr_KON_B,SumEKV_vnutr_KON_B,SumItogo_vnutr_KON_B,
                                                   Kol_vnutr_KON_E,SumRRF_vnutr_KON_E,SumEKV_vnutr_KON_E,SumItogo_vnutr_KON_E,
                                                   Kol_vnutr_ITOG_B,SumRRF_vnutr_ITOG_B,SumEKV_vnutr_ITOG_B,SumItogo_vnutr_ITOG_B,
                                                   Kol_vnutr_ITOG_E,SumRRF_vnutr_ITOG_E,SumEKV_vnutr_ITOG_E,SumItogo_vnutr_ITOG_E,
                                        num_otdel, Kol_vnutr_ITOG, SumRRF_vnutr_ITOG, SumEKV_vnutr_ITOG, SumItogo_vnutr_ITOG);

      Kol_bank_RUR_B       = Kol_bank_RUR_B       + Kol_vnutr_RUR_B      ;     Kol_bank_RUR_E       = Kol_bank_RUR_E       + Kol_vnutr_RUR_E      ;
      SumRRF_bank_RUR_B    = SumRRF_bank_RUR_B    + SumRRF_vnutr_RUR_B   ;     SumRRF_bank_RUR_E    = SumRRF_bank_RUR_E    + SumRRF_vnutr_RUR_E   ;
      SumEKV_bank_RUR_B    = SumEKV_bank_RUR_B    + SumEKV_vnutr_RUR_B   ;     SumEKV_bank_RUR_E    = SumEKV_bank_RUR_E    + SumEKV_vnutr_RUR_E   ;
      SumItogo_bank_RUR_B  = SumItogo_bank_RUR_B  + SumItogo_vnutr_RUR_B ;     SumItogo_bank_RUR_E  = SumItogo_bank_RUR_E  + SumItogo_vnutr_RUR_E ;
      Kol_bank_VAL_B       = Kol_bank_VAL_B       + Kol_vnutr_VAL_B      ;     Kol_bank_VAL_E       = Kol_bank_VAL_E       + Kol_vnutr_VAL_E      ;
      SumRRF_bank_VAL_B    = SumRRF_bank_VAL_B    + SumRRF_vnutr_VAL_B   ;     SumRRF_bank_VAL_E    = SumRRF_bank_VAL_E    + SumRRF_vnutr_VAL_E   ;
      SumEKV_bank_VAL_B    = SumEKV_bank_VAL_B    + SumEKV_vnutr_VAL_B   ;     SumEKV_bank_VAL_E    = SumEKV_bank_VAL_E    + SumEKV_vnutr_VAL_E   ;
      SumItogo_bank_VAL_B  = SumItogo_bank_VAL_B  + SumItogo_vnutr_VAL_B ;     SumItogo_bank_VAL_E  = SumItogo_bank_VAL_E  + SumItogo_vnutr_VAL_E ;
      Kol_bank_KON_B       = Kol_bank_KON_B       + Kol_vnutr_KON_B      ;     Kol_bank_KON_E       = Kol_bank_KON_E       + Kol_vnutr_KON_E      ;
      SumRRF_bank_KON_B    = SumRRF_bank_KON_B    + SumRRF_vnutr_KON_B   ;     SumRRF_bank_KON_E    = SumRRF_bank_KON_E    + SumRRF_vnutr_KON_E   ;
      SumEKV_bank_KON_B    = SumEKV_bank_KON_B    + SumEKV_vnutr_KON_B   ;     SumEKV_bank_KON_E    = SumEKV_bank_KON_E    + SumEKV_vnutr_KON_E   ;
      SumItogo_bank_KON_B  = SumItogo_bank_KON_B  + SumItogo_vnutr_KON_B ;     SumItogo_bank_KON_E  = SumItogo_bank_KON_E  + SumItogo_vnutr_KON_E ;
      Kol_bank_ITOG_B      = Kol_bank_ITOG_B      + Kol_vnutr_ITOG_B     ;     Kol_bank_ITOG_E      = Kol_bank_ITOG_E      + Kol_vnutr_ITOG_E     ; 
      SumRRF_bank_ITOG_B   = SumRRF_bank_ITOG_B   + SumRRF_vnutr_ITOG_B  ;     SumRRF_bank_ITOG_E   = SumRRF_bank_ITOG_E   + SumRRF_vnutr_ITOG_E  ;
      SumEKV_bank_ITOG_B   = SumEKV_bank_ITOG_B   + SumEKV_vnutr_ITOG_B  ;     SumEKV_bank_ITOG_E   = SumEKV_bank_ITOG_E   + SumEKV_vnutr_ITOG_E  ;
      SumItogo_bank_ITOG_B = SumItogo_bank_ITOG_B + SumItogo_vnutr_ITOG_B;     SumItogo_bank_ITOG_E = SumItogo_bank_ITOG_E + SumItogo_vnutr_ITOG_E;
      Kol_bank_ITOG        = Kol_bank_ITOG        + Kol_vnutr_ITOG       ;     SumRRF_bank_ITOG     = SumRRF_bank_ITOG     + SumRRF_vnutr_ITOG    ;
      SumEKV_bank_ITOG     = SumEKV_bank_ITOG     + SumEKV_vnutr_ITOG    ;     SumItogo_bank_ITOG   = SumItogo_bank_ITOG   + SumItogo_vnutr_ITOG  ;
      Kol_vnutr_RUR_B  = 0;SumRRF_vnutr_RUR_B  = $0;SumEKV_vnutr_RUR_B  = $0;SumItogo_vnutr_RUR_B  = $0;                            //|                     |
      Kol_vnutr_RUR_E  = 0;SumRRF_vnutr_RUR_E  = $0;SumEKV_vnutr_RUR_E  = $0;SumItogo_vnutr_RUR_E  = $0;                            //|                     |
      Kol_vnutr_VAL_B  = 0;SumRRF_vnutr_VAL_B  = $0;SumEKV_vnutr_VAL_B  = $0;SumItogo_vnutr_VAL_B  = $0;                            //|     ОБНУЛЯЕМ        |
      Kol_vnutr_VAL_E  = 0;SumRRF_vnutr_VAL_E  = $0;SumEKV_vnutr_VAL_E  = $0;SumItogo_vnutr_VAL_E  = $0;                            //|
      Kol_vnutr_KON_B  = 0;SumRRF_vnutr_KON_B  = $0;SumEKV_vnutr_KON_B  = $0;SumItogo_vnutr_KON_B  = $0;                            //| РЕННИМ ДОКУМЕНТАМ   |
      Kol_vnutr_KON_E  = 0;SumRRF_vnutr_KON_E  = $0;SumEKV_vnutr_KON_E  = $0;SumItogo_vnutr_KON_E  = $0;                            //|   (по отделам)      |
      Kol_vnutr_ITOG_B = 0;SumRRF_vnutr_ITOG_B = $0;SumEKV_vnutr_ITOG_B = $0;SumItogo_vnutr_ITOG_B = $0;                            //|                     |
      Kol_vnutr_ITOG_E = 0;SumRRF_vnutr_ITOG_E = $0;SumEKV_vnutr_ITOG_E = $0;SumItogo_vnutr_ITOG_E = $0;                            //|                     |
      Kol_vnutr_ITOG   = 0;SumRRF_vnutr_ITOG   = $0;SumEKV_vnutr_ITOG   = $0;SumItogo_vnutr_ITOG   = $0;                            //|                     |
  flag_pechati_nulevih_otdelov = 0;

end;
end;/**while**/

    message("отбор документов по неизвестному подразделению");
select_1000_1 =
    " SELECT   DISTINCT SUM, NVL(paymentid, -1) paymentid, AppKey, AccDeb, AccKr,T_RESULT_CARRY, t_oper,                  "+
    "                   (SELECT   storeKind                                                                               "+
    "                      FROM   TABLE (USER_EA.Get_dev_prop"+ StoreKindParam +" )) vid_hran                             "+
    "   FROM   (SELECT   arh.t_numb_document AS NumDoc,                                                                   "+
    "                    arh.t_account_payer AS AccDeb,                                                                   "+
    "                    arh.t_account_receiver AS AccKr,                                                                 "+
    "                    ARH.T_SUM_NATCUR AS SUM,                                                                         "+
    "                    ARH.T_ACCTRNID AppKey,                                                                           "+
    "                    arh.t_typedocument,                                                                              "+
    "                    prop.T_PAYMENTKIND paymkind,                                                                     "+
    "                    user_ea.GetOrigin (paym.t_dockind, paym.t_paymentid) origin,                                     "+
    "                    arh.T_CHAPTER chapter,                                                                           "+
    "                    paym.T_DOCKIND dockind,                                                                          "+
    "                    arh.T_NUMBER_PACK numb_pack,                                                                     "+
    "                    prop.T_SHIFROPER shifr_oper,                                                                     "+
    "                    ARH.T_FIID_PAYER,                                                                                "+
    "                    ARH.T_FIID_RECEIVER,                                                                             "+
    "                    arh.T_RESULT_CARRY,                                                                              "+
    "                    arh.t_oper,                                                                                      "+
    "                    paym.t_paymentid paymentid                                                                       "+
    "             FROM   dpmdocs_dbt docs,                                                                                "+
    "                    dpmpaym_dbt paym,                                                                                "+
    "                    dpmrmprop_dbt prop,                                                                              "+
    "                    dpmprop_dbt pm,                                                                                  "+
    "                    dacctrn_dbt arh                                                                                  "+
    "            WHERE       arh.t_date_carry = TO_DATE (:DateDocum1, 'DD.MM.YYYY')                                       "+
    "                    AND arh.t_chapter = :Chapter                                                                     "+
    "                    AND arh.t_state = 1                                                                              "+
    "                    AND ARH.T_ACCTRNID = DOCS.T_ACCTRNID(+)                                                          "+
    "                    AND docs.T_PAYMENTID = paym.T_PAYMENTID(+)                                                       "+
    "                    AND prop.t_paymentid(+) = paym.t_paymentid                                                       "+
    "                    AND pm.t_paymentid(+) = paym.t_paymentid                                                         "+
    "                    AND arh.t_oper not in (SELECT   dop_otdel_dbt.T_oper                                             "+
    "                                             FROM   dop_otdel_dbt                                                    "+
    "                                            WHERE   (dop_otdel_dbt.t_dateend >= TO_DATE (:DateDocum2, 'DD.MM.YYYY')  "+
    "                                                     OR t_dateend = TO_DATE ('01.01.0001', 'DD.MM.YYYY'))            "+
    "                                                    AND t_datebegin <= TO_DATE (:DateDocum3, 'DD.MM.YYYY'))          "+
    resultCarry + externalExists ;


   if(RepTypes != "Внебаланс")
      Select = Select_1000_1 +
      "                  AND SUBSTR (arh.T_ACCOUNT_PAYER, 6, 3) = '810'                                        "+
      "                  AND SUBSTR (arh.T_ACCOUNT_RECEIVER, 6, 3) = '810'                                     "+
      "                    AND SUBSTR (arh.t_account_receiver, 1, 5) NOT IN('20202', '20203', '20207')         "+
      "                    AND SUBSTR (arh.t_account_payer, 1, 5) NOT IN('20202', '20203', '20207')            "+
      "                         ) a                                                                            ";
   else
      Select = Select_1000_1 + 
      "     AND ((SUBSTR (arh.t_account_payer, 6, 3) = '810' and SUBSTR (arh.t_account_receiver, 6,3) = '810') "+
      "           OR (SUBSTR (arh.t_account_payer, 6, 3) <> SUBSTR (arh.t_account_receiver, 6,3)               "+
      "           or (arh.t_account_payer like 'ОВП%' AND docs.t_paymentid IS NULL)                            "+
      "           or (arh.t_account_receiver like 'ОВП%' AND docs.t_paymentid IS NULL)))                       "+
      "                         ) a                                                                            ";
   end;

    if(substr(RepTypes,1,9) == "Баланс ->")
       param_1000 = makeArray (SQLParam ("DateDocum1", string(DateDocum)),
                               SQLParam ("Chapter",    Chapter), 
                               SQLParam ("DateDocum2", string(DateDocum)),
                               SQLParam ("DateDocum3", string(DateDocum)),
                               SQLParam ("group1",     PAYMENTS_GROUP_EXTERNAL),
                               SQLParam ("group2",     PAYMENTS_GROUP_EXTERNAL));
    else
       param_1000 = makeArray (SQLParam ("DateDocum1", string(DateDocum)),
                               SQLParam ("Chapter",    Chapter), 
                               SQLParam ("DateDocum2", string(DateDocum)),
                               SQLParam ("DateDocum3", string(DateDocum)));
    end;
//debugbreak;
    Data = ExecSQLSelect(Select,param_1000);

    while (Data.movenext())
        useprogress(progressCount);
        progressCount = progressCount + 1;
       flag_pechati_nulevih_otdelov = 1;
       StoreKind  = data.value("vid_hran");
       payment_id = data.value("paymentid");
       StoreKind  = kateg_vid_hran(payment_id,StoreKind,chapter);
/*-------------------------- вывод расшифровки по отделу № 1000 -----------------------------------*/
        oper1 = data.value("t_oper");
        needTranscript = true;
        if(oper2 != oper1) 
           oper2 = oper1;
           transcriptOperRUR = transcriptOperRUR + oper1 + "\t- " + GetOperName(oper1) + "\n" + "       ";
        end;
/*----------------------------------------- end ---------------------------------------------------*/
        if (StoreKind == 0)
           Kol_vnutr_RUR_B = Kol_vnutr_RUR_B + 1;
           SumRRF_vnutr_RUR_B = SumRRF_vnutr_RUR_B + Data.value("sum");
           SumItogo_vnutr_RUR_B = SumRRF_vnutr_RUR_B;
        else
           Kol_vnutr_RUR_E = Kol_vnutr_RUR_E + 1;
           SumRRF_vnutr_RUR_E = SumRRF_vnutr_RUR_E + Data.value("sum");
           SumItogo_vnutr_RUR_E = SumRRF_vnutr_RUR_E;
        end;
    end;/*while*/

    select = select_1000_1 + " AND substr(arh.T_ACCOUNT_PAYER,6,3) = substr(arh.T_ACCOUNT_RECEIVER,6,3)    "+ 
                             " AND substr(arh.T_ACCOUNT_PAYER,6,3) <> '810'                                "+
                             " AND substr(arh.T_ACCOUNT_RECEIVER,6,3) <> '810'                             "+
                             " AND SUBSTR (arh.t_account_receiver, 1, 5) NOT IN('20202', '20203', '20207') "+
                             " AND SUBSTR (arh.t_account_payer, 1, 5) NOT IN('20202', '20203', '20207')    "+
                             " AND SUBSTR(arh.t_account_receiver,1,3) NOT in ('ОВП')                       "+
                             " AND SUBSTR(arh.t_account_payer,1,3)    NOT in ('ОВП')) a                    ";

    Data = ExecSQLSelect(Select,param_1000);
    oper2 = 0;
    while (Data.movenext())
        useprogress(progressCount);
        progressCount = progressCount + 1;
       needTranscript = true;
       flag_pechati_nulevih_otdelov = 1;
       SumR       = data.value("Sum");
       StoreKind  = data.value("vid_hran");
       payment_id = data.value("paymentid");
       StoreKind  = kateg_vid_hran(payment_id,StoreKind,chapter);
/*-------------------------- вывод расшифровки по отделу № 1000 -----------------------------------*/
       oper1 = data.value("t_oper");
       needTranscript = true;
       if(oper2 != oper1) 
          oper2 = oper1;
          transcriptOperVAL = transcriptOperVAL + oper1 + "\t- " + GetOperName(oper1) + "\n" + "       ";
       end;
/*----------------------------------------- end ---------------------------------------------------*/
       if (StoreKind == 0)
          Kol_vnutr_VAL_B = Kol_vnutr_VAL_B + 1;
          SumEKV_vnutr_VAL_B = SumEKV_vnutr_VAL_B + SumR;
          SumItogo_vnutr_VAL_B = SumEKV_vnutr_VAL_B;
       else
          Kol_vnutr_VAL_E = Kol_vnutr_VAL_E + 1;
          SumEKV_vnutr_VAL_E = SumEKV_vnutr_VAL_E + SumR;
          SumItogo_vnutr_VAL_E = SumEKV_vnutr_VAL_E;
       end;
    end;/*while*/

    if(RepTypes != "Внебаланс")
       select = select_1000_1 + " AND substr(arh.T_ACCOUNT_PAYER,6,3) <> substr(arh.T_ACCOUNT_RECEIVER,6,3)                                         "+ 
                                " AND (SUBSTR (arh.t_account_receiver, 1, 5) NOT IN ('20202','20203','20207') or arh.T_RESULT_CARRY  in (18,82,83)) "+ 	
                                " AND (SUBSTR (arh.t_account_payer, 1, 5) NOT IN ('20202','20203','20207') or arh.T_RESULT_CARRY  in (18,82,83))    "+
	                        " AND SUBSTR(arh.t_account_receiver,1,3) NOT in ('ОВП')                                                             "+      
                                " AND SUBSTR(arh.t_account_payer,1,3)    NOT in ('ОВП')) a                                                          "; 
debugbreak;
       Data = ExecSQLSelect(Select,param_1000);
       oper2 = 0;
       while (Data.movenext())
        useprogress(progressCount);
        progressCount = progressCount + 1;
          needTranscript = true;
          flag_pechati_nulevih_otdelov = 1;
          paymentID1 = data.value("paymentid");
          StoreKind  = data.value("vid_hran");
          payment_id = data.value("paymentid");
          StoreKind  = kateg_vid_hran(payment_id,StoreKind,chapter);
/*-------------------------- вывод расшифровки по отделу № 1000 -----------------------------------*/
          oper1 = data.value("t_oper");
          needTranscript = true;
          if(oper2 != oper1) 
             oper2 = oper1;
             transcriptOperKON = transcriptOperKON + oper1 + "\t- " + GetOperName(oper1) + "\n" + "       ";
          end;
/*----------------------------------------- end ---------------------------------------------------*/
          if((substr(data.value("AccKr"),14,5) == "21010") or (substr(data.value("AccKr"),14,5) == "22010") or (substr(data.value("AccDeb"),14,5) == "21010") or (substr(data.value("AccDeb"),14,5) == "22010") or (data.value("T_RESULT_CARRY") == 18) or (data.value("T_RESULT_CARRY") == 82))
             if(StoreKind == 0)
                kol_vnutr_kon_B = kol_vnutr_kon_B + 1; SumRRF_vnutr_kon_B = SumRRF_vnutr_kon_B + data.value("Sum");
             else
                kol_vnutr_kon_E = kol_vnutr_kon_E + 1; SumRRF_vnutr_kon_E = SumRRF_vnutr_kon_E + data.value("Sum");
             end;
          else
             if(StoreKind == 0)
                kol_vnutr_kon_B = kol_vnutr_kon_B + 1; SumEKV_vnutr_kon_B = SumEKV_vnutr_kon_B + data.value("Sum");
             else
                kol_vnutr_kon_E = kol_vnutr_kon_E + 1; SumEKV_vnutr_kon_E = SumEKV_vnutr_kon_E + data.value("Sum");
             end;
          end;
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
       end;/*while*/
    end;


        SumItogo_vnutr_KON_B  = SumRRF_vnutr_kon_B   + SumEKV_vnutr_kon_B   ;
        SumItogo_vnutr_KON_E  = SumRRF_vnutr_kon_E   + SumEKV_vnutr_kon_E   ;
        Kol_vnutr_ITOG_B      = kol_vnutr_RUR_B      + kol_vnutr_VAL_B      + kol_vnutr_kon_B      ;
        Kol_vnutr_ITOG_E      = kol_vnutr_RUR_E      + kol_vnutr_VAL_E      + kol_vnutr_kon_E      ;
        SumRRF_vnutr_ITOG_B   = SumRRF_vnutr_RUR_B   + SumRRF_vnutr_VAL_B   + SumRRF_vnutr_kon_B   ;
        SumRRF_vnutr_ITOG_E   = SumRRF_vnutr_RUR_E   + SumRRF_vnutr_VAL_E   + SumRRF_vnutr_kon_E   ;
        SumEKV_vnutr_ITOG_B   = SumEKV_vnutr_RUR_B   + SumEKV_vnutr_VAL_B   + SumEKV_vnutr_kon_B   ;
        SumEKV_vnutr_ITOG_E   = SumEKV_vnutr_RUR_E   + SumEKV_vnutr_VAL_E   + SumEKV_vnutr_kon_E   ;
        SumItogo_vnutr_ITOG_B = SumItogo_vnutr_RUR_B + SumItogo_vnutr_VAL_B + SumItogo_vnutr_kon_B ;
        SumItogo_vnutr_ITOG_E = SumItogo_vnutr_RUR_E + SumItogo_vnutr_VAL_E + SumItogo_vnutr_kon_E ;
        Kol_vnutr_ITOG        = Kol_vnutr_ITOG_B     + Kol_vnutr_ITOG_E     ;
        SumRRF_vnutr_ITOG     = SumRRF_vnutr_ITOG_B  + SumRRF_vnutr_ITOG_E  ;
        SumEKV_vnutr_ITOG     = SumEKV_vnutr_ITOG_B  + SumEKV_vnutr_ITOG_E  ;
        SumItogo_vnutr_ITOG   = SumItogo_vnutr_ITOG_B+ SumItogo_vnutr_ITOG_E; 

      [  │ 1000 неизвестное      │            │ Б │############│###############│###############│###############│
         │ подразделение         │  РУБЛЕВЫЕ  ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │  ВАЛЮТНЫЕ  ├───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
	 │                       │КОНВЕРСИОН- ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │       НЫЕ  │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │   ИТОГО    ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │ по отчетам │ Э │############│###############│###############│###############│
         ├───────────────────────┴────────────┴───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                                        │            │               │               │               │
         │  Всего документов на сумму по 1000     │############│###############│###############│###############│
         │                                        │            │               │               │               │
         ├───────────────────────┬────────────┬───┼────────────┼───────────────┼───────────────┼───────────────┤]
          (                                        Kol_vnutr_RUR_B,SumRRF_vnutr_RUR_B,SumEKV_vnutr_RUR_B,SumItogo_vnutr_RUR_B,
                                                   Kol_vnutr_RUR_E,SumRRF_vnutr_RUR_E,SumEKV_vnutr_RUR_E,SumItogo_vnutr_RUR_E,
                                                   Kol_vnutr_VAL_B,SumRRF_vnutr_VAL_B,SumEKV_vnutr_VAL_B,SumItogo_vnutr_VAL_B,
                                                   Kol_vnutr_VAL_E,SumRRF_vnutr_VAL_E,SumEKV_vnutr_VAL_E,SumItogo_vnutr_VAL_E,
                                                   Kol_vnutr_KON_B,SumRRF_vnutr_KON_B,SumEKV_vnutr_KON_B,SumItogo_vnutr_KON_B,
                                                   Kol_vnutr_KON_E,SumRRF_vnutr_KON_E,SumEKV_vnutr_KON_E,SumItogo_vnutr_KON_E,
                                                   Kol_vnutr_ITOG_B,SumRRF_vnutr_ITOG_B,SumEKV_vnutr_ITOG_B,SumItogo_vnutr_ITOG_B,
                                                   Kol_vnutr_ITOG_E,SumRRF_vnutr_ITOG_E,SumEKV_vnutr_ITOG_E,SumItogo_vnutr_ITOG_E,
                                                   Kol_vnutr_ITOG, SumRRF_vnutr_ITOG, SumEKV_vnutr_ITOG, SumItogo_vnutr_ITOG);

      Kol_bank_RUR_B       = Kol_bank_RUR_B       + Kol_vnutr_RUR_B      ;     Kol_bank_RUR_E       = Kol_bank_RUR_E       + Kol_vnutr_RUR_E      ;
      SumRRF_bank_RUR_B    = SumRRF_bank_RUR_B    + SumRRF_vnutr_RUR_B   ;     SumRRF_bank_RUR_E    = SumRRF_bank_RUR_E    + SumRRF_vnutr_RUR_E   ;
      SumEKV_bank_RUR_B    = SumEKV_bank_RUR_B    + SumEKV_vnutr_RUR_B   ;     SumEKV_bank_RUR_E    = SumEKV_bank_RUR_E    + SumEKV_vnutr_RUR_E   ;
      SumItogo_bank_RUR_B  = SumItogo_bank_RUR_B  + SumItogo_vnutr_RUR_B ;     SumItogo_bank_RUR_E  = SumItogo_bank_RUR_E  + SumItogo_vnutr_RUR_E ;
      Kol_bank_VAL_B       = Kol_bank_VAL_B       + Kol_vnutr_VAL_B      ;     Kol_bank_VAL_E       = Kol_bank_VAL_E       + Kol_vnutr_VAL_E      ;
      SumRRF_bank_VAL_B    = SumRRF_bank_VAL_B    + SumRRF_vnutr_VAL_B   ;     SumRRF_bank_VAL_E    = SumRRF_bank_VAL_E    + SumRRF_vnutr_VAL_E   ;
      SumEKV_bank_VAL_B    = SumEKV_bank_VAL_B    + SumEKV_vnutr_VAL_B   ;     SumEKV_bank_VAL_E    = SumEKV_bank_VAL_E    + SumEKV_vnutr_VAL_E   ;
      SumItogo_bank_VAL_B  = SumItogo_bank_VAL_B  + SumItogo_vnutr_VAL_B ;     SumItogo_bank_VAL_E  = SumItogo_bank_VAL_E  + SumItogo_vnutr_VAL_E ;
      Kol_bank_KON_B       = Kol_bank_KON_B       + Kol_vnutr_KON_B      ;     Kol_bank_KON_E       = Kol_bank_KON_E       + Kol_vnutr_KON_E      ;
      SumRRF_bank_KON_B    = SumRRF_bank_KON_B    + SumRRF_vnutr_KON_B   ;     SumRRF_bank_KON_E    = SumRRF_bank_KON_E    + SumRRF_vnutr_KON_E   ;
      SumEKV_bank_KON_B    = SumEKV_bank_KON_B    + SumEKV_vnutr_KON_B   ;     SumEKV_bank_KON_E    = SumEKV_bank_KON_E    + SumEKV_vnutr_KON_E   ;
      SumItogo_bank_KON_B  = SumItogo_bank_KON_B  + SumItogo_vnutr_KON_B ;     SumItogo_bank_KON_E  = SumItogo_bank_KON_E  + SumItogo_vnutr_KON_E ;
      Kol_bank_ITOG_B      = Kol_bank_ITOG_B      + Kol_vnutr_ITOG_B     ;     Kol_bank_ITOG_E      = Kol_bank_ITOG_E      + Kol_vnutr_ITOG_E     ; 
      SumRRF_bank_ITOG_B   = SumRRF_bank_ITOG_B   + SumRRF_vnutr_ITOG_B  ;     SumRRF_bank_ITOG_E   = SumRRF_bank_ITOG_E   + SumRRF_vnutr_ITOG_E  ;
      SumEKV_bank_ITOG_B   = SumEKV_bank_ITOG_B   + SumEKV_vnutr_ITOG_B  ;     SumEKV_bank_ITOG_E   = SumEKV_bank_ITOG_E   + SumEKV_vnutr_ITOG_E  ;
      SumItogo_bank_ITOG_B = SumItogo_bank_ITOG_B + SumItogo_vnutr_ITOG_B;     SumItogo_bank_ITOG_E = SumItogo_bank_ITOG_E + SumItogo_vnutr_ITOG_E;
      Kol_bank_ITOG        = Kol_bank_ITOG        + Kol_vnutr_ITOG       ;     SumRRF_bank_ITOG     = SumRRF_bank_ITOG     + SumRRF_vnutr_ITOG    ;
      SumEKV_bank_ITOG     = SumEKV_bank_ITOG     + SumEKV_vnutr_ITOG    ;     SumItogo_bank_ITOG   = SumItogo_bank_ITOG   + SumItogo_vnutr_ITOG  ;
//msgbox(Kol_bank_KON_E);
//msgbox(SumItogo_bank_KON_E);
      [  │ ИТОГО  ПО ВНУТРЕННИМ  │            │ Б │############│###############│###############│###############│
         │ ДОКУМЕНТАМ БАНКА      │  РУБЛЕВЫЕ  ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │    ПО ВИДАМ ОТЧЕТОВ   │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │  ВАЛЮТНЫЕ  ├───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
	 │                       │КОНВЕРСИОН- ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │       НЫЕ  │ Э │############│###############│###############│###############│
	 ├───────────────────────┴────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ ИТОГО ВНУТРЕННИХ ПО БАНКУ          │ Б │############│###############│###############│###############│
         │                ПО ВИДАМ ХРАНЕНИЯ   ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                                    │ Э │############│###############│###############│###############│
         ├────────────────────────────────────┴───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ ВСЕГО ВНУТРЕННИХ ПО БАНКУ              │            │               │               │               │
         │                 ДОКУМЕНТОВ  НА  СУММУ  │############│###############│###############│###############│
         │                                        │            │               │               │               │
         ├───────────────────────┬────────────┬───┼────────────┼───────────────┼───────────────┼───────────────┤]
                                                  (Kol_bank_RUR_B,SumRRF_bank_RUR_B,SumEKV_bank_RUR_B,SumItogo_bank_RUR_B,
                                                   Kol_bank_RUR_E,SumRRF_bank_RUR_E,SumEKV_bank_RUR_E,SumItogo_bank_RUR_E,
                                                   Kol_bank_VAL_B,SumRRF_bank_VAL_B,SumEKV_bank_VAL_B,SumItogo_bank_VAL_B,
                                                   Kol_bank_VAL_E,SumRRF_bank_VAL_E,SumEKV_bank_VAL_E,SumItogo_bank_VAL_E,
                                                   Kol_bank_KON_B,SumRRF_bank_KON_B,SumEKV_bank_KON_B,SumItogo_bank_KON_B,
                                                   Kol_bank_KON_E,SumRRF_bank_KON_E,SumEKV_bank_KON_E,SumItogo_bank_KON_E,
                                                   Kol_bank_ITOG_B,SumRRF_bank_ITOG_B,SumEKV_bank_ITOG_B,SumItogo_bank_ITOG_B,
                                                   Kol_bank_ITOG_E,SumRRF_bank_ITOG_E,SumEKV_bank_ITOG_E,SumItogo_bank_ITOG_E,
                                                   Kol_bank_ITOG, SumRRF_bank_ITOG, SumEKV_bank_ITOG, SumItogo_bank_ITOG);

      Kol_bank_RUR_B      = Kol_bank_RUR_B      + kol_vnesh_ITOG_RUR_B        + Kol_kassa_RUR_B          ;
      Kol_bank_RUR_E      = Kol_bank_RUR_E      + kol_vnesh_ITOG_RUR_E        + Kol_kassa_RUR_E          ;
      Kol_bank_VAL_B      = Kol_bank_VAL_B      + kol_vnesh_nostro_VAL_B      + kol_vnesh_mfr_VAL_B      + kol_vnesh_prochie_VAL_B + Kol_kassa_VAL_B;
      Kol_bank_VAL_E      = Kol_bank_VAL_E      + kol_vnesh_nostro_VAL_E      + kol_vnesh_mfr_VAL_E      + kol_vnesh_prochie_VAL_E + Kol_kassa_VAL_E;
      Kol_bank_KON_B      = Kol_bank_KON_B      + kol_vnesh_konv_VAL_B        + Kol_kassa_KON_B          ;
      Kol_bank_KON_E      = Kol_bank_KON_E      + kol_vnesh_konv_VAL_E        + Kol_kassa_KON_E          ;
      SumRRF_bank_RUR_B   = SumRRF_bank_RUR_B   + SumRRF_vnesh_ITOG_RUR_B     + SumRRF_kassa_RUR_B       ; 
      SumRRF_bank_RUR_E   = SumRRF_bank_RUR_E   + SumRRF_vnesh_ITOG_RUR_E     + SumRRF_kassa_RUR_E       ;
      SumRRF_bank_VAL_B   = SumRRF_bank_VAL_B   + SumRRF_vnesh_nostro_VAL_B   + SumRRF_vnesh_mfr_VAL_B   + SumRRF_vnesh_prochie_VAL_B + SumRRF_kassa_VAL_B;
      SumRRF_bank_VAL_E   = SumRRF_bank_VAL_E   + SumRRF_vnesh_nostro_VAL_E   + SumRRF_vnesh_mfr_VAL_E   + SumRRF_vnesh_prochie_VAL_E + SumRRF_kassa_VAL_E;
      SumRRF_bank_KON_B   = SumRRF_bank_KON_B   + SumRRF_vnesh_konv_VAL_B     + SumRRF_kassa_KON_B       ;
      SumRRF_bank_KON_E   = SumRRF_bank_KON_E   + SumRRF_vnesh_konv_VAL_E     + SumRRF_kassa_KON_E       ;
      SumEKV_bank_RUR_B   = SumEKV_bank_RUR_B   + SumEKV_vnesh_ITOG_RUR_B     + SumEKV_kassa_RUR_B       ;
      SumEKV_bank_RUR_E   = SumEKV_bank_RUR_E   + SumEKV_vnesh_ITOG_RUR_E     + SumEKV_kassa_RUR_E       ;
      SumEKV_bank_VAL_B   = SumEKV_bank_VAL_B   + SumEKV_vnesh_nostro_VAL_B   + SumEKV_vnesh_mfr_VAL_B   + SumEKV_vnesh_prochie_VAL_B + SumEKV_kassa_VAL_B;
      SumEKV_bank_VAL_E   = SumEKV_bank_VAL_E   + SumEKV_vnesh_nostro_VAL_E   + SumEKV_vnesh_mfr_VAL_E   + SumEKV_vnesh_prochie_VAL_E + SumEKV_kassa_VAL_E;
      SumEKV_bank_KON_B   = SumEKV_bank_KON_B   + SumEKV_vnesh_konv_VAL_B     + SumEKV_kassa_KON_B       ;
      SumEKV_bank_KON_E   = SumEKV_bank_KON_E   + SumEKV_vnesh_konv_VAL_E     + SumEKV_kassa_KON_E       ;
      SumItogo_bank_RUR_B = SumItogo_bank_RUR_B + SumItogo_vnesh_ITOG_RUR_B   + SumItogo_kassa_RUR_B     ;
      SumItogo_bank_RUR_E = SumItogo_bank_RUR_E + SumItogo_vnesh_ITOG_RUR_E   + SumItogo_kassa_RUR_E     ;
      SumItogo_bank_VAL_B = SumItogo_bank_VAL_B + SumItogo_vnesh_nostro_VAL_B + SumItogo_vnesh_mfr_VAL_B + SumItogo_vnesh_prochie_VAL_B + SumItogo_kassa_VAL_B;
      SumItogo_bank_VAL_E = SumItogo_bank_VAL_E + SumItogo_vnesh_nostro_VAL_E + SumItogo_vnesh_mfr_VAL_E + SumItogo_vnesh_prochie_VAL_E + SumItogo_kassa_VAL_E;
      SumItogo_bank_KON_B = SumItogo_bank_KON_B + SumItogo_vnesh_konv_VAL_B   + SumItogo_kassa_KON_B     ;
      SumItogo_bank_KON_E = SumItogo_bank_KON_E + SumItogo_vnesh_konv_VAL_E   + SumItogo_kassa_KON_E     ;
      Kol_bank_ITOG_B     = Kol_bank_RUR_B      + Kol_bank_VAL_B              + Kol_bank_KON_B           ; 
      Kol_bank_ITOG_E     = Kol_bank_RUR_E      + Kol_bank_VAL_E              + Kol_bank_KON_E           ;
      Kol_bank_ITOG       = Kol_bank_ITOG_B     + Kol_bank_ITOG_E             ;
      SumRRF_bank_ITOG_B  = SumRRF_bank_RUR_B   + SumRRF_bank_VAL_B           + SumRRF_bank_KON_B        ;  
      SumRRF_bank_ITOG_E  = SumRRF_bank_RUR_E   + SumRRF_bank_VAL_E           + SumRRF_bank_KON_E        ;
      SumRRF_bank_ITOG    = SumRRF_bank_ITOG_B  + SumRRF_bank_ITOG_E          ;
      SumEKV_bank_ITOG_B  = SumEKV_bank_RUR_B   + SumEKV_bank_VAL_B           + SumEKV_bank_KON_B        ;
      SumEKV_bank_ITOG_E  = SumEKV_bank_RUR_E   + SumEKV_bank_VAL_E           + SumEKV_bank_KON_E        ;
      SumEKV_bank_ITOG    = SumEKV_bank_ITOG_B  + SumEKV_bank_ITOG_E          ;
      SumItogo_bank_ITOG_B= SumItogo_bank_RUR_B + SumItogo_bank_VAL_B         + SumItogo_bank_KON_B      ;
      SumItogo_bank_ITOG_E= SumItogo_bank_RUR_E + SumItogo_bank_VAL_E         + SumItogo_bank_KON_E      ;
      SumItogo_bank_ITOG  = SumItogo_bank_ITOG_B+ SumItogo_bank_ITOG_E        ;

       //  ├───────────────────────┬────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
      [  │ ИТОГО  ПО БАНКУ       │            │ Б │############│###############│###############│###############│
         │      ПО ВИДАМ ОТЧЕТОВ │  РУБЛЕВЫЕ  ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
         │                       │  ВАЛЮТНЫЕ  ├───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Э │############│###############│###############│###############│
	 │                       ├────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │                       │            │ Б │############│###############│###############│###############│
	 │                       │КОНВЕРСИОН- ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                       │       НЫЕ  │ Э │############│###############│###############│###############│
	 ├───────────────────────┴────────────┼───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ ИТОГО ПО БАНКУ                     │ Б │############│###############│###############│###############│
         │                ПО ВИДАМ ХРАНЕНИЯ   ├───┼────────────┼───────────────┼───────────────┼───────────────┤
	 │                                    │ Э │############│###############│###############│###############│
         ├────────────────────────────────────┴───┼────────────┼───────────────┼───────────────┼───────────────┤
         │ ВСЕГО  ПО БАНКУ                        │            │               │               │               │
         │                 ДОКУМЕНТОВ  НА  СУММУ  │############│###############│###############│###############│
         │                                        │            │               │               │               │
         └────────────────────────────────────────┴────────────┴───────────────┴───────────────┴───────────────┘]
                                                  (Kol_bank_RUR_B,SumRRF_bank_RUR_B,SumEKV_bank_RUR_B,SumItogo_bank_RUR_B,
                                                   Kol_bank_RUR_E,SumRRF_bank_RUR_E,SumEKV_bank_RUR_E,SumItogo_bank_RUR_E,
                                                   Kol_bank_VAL_B,SumRRF_bank_VAL_B,SumEKV_bank_VAL_B,SumItogo_bank_VAL_B,
                                                   Kol_bank_VAL_E,SumRRF_bank_VAL_E,SumEKV_bank_VAL_E,SumItogo_bank_VAL_E,
                                                   Kol_bank_KON_B,SumRRF_bank_KON_B,SumEKV_bank_KON_B,SumItogo_bank_KON_B,
                                                   Kol_bank_KON_E,SumRRF_bank_KON_E,SumEKV_bank_KON_E,SumItogo_bank_KON_E,
                                                   Kol_bank_ITOG_B,SumRRF_bank_ITOG_B,SumEKV_bank_ITOG_B,SumItogo_bank_ITOG_B,
                                                   Kol_bank_ITOG_E,SumRRF_bank_ITOG_E,SumEKV_bank_ITOG_E,SumItogo_bank_ITOG_E,
                                                   Kol_bank_ITOG, SumRRF_bank_ITOG, SumEKV_bank_ITOG, SumItogo_bank_ITOG);
    [

       Главный бухгалтер_________________________________

       Контролер____________________________

       Отчет подготовил  #############################################################]
       (getShortName(GetOperName({oper})));

if(needTranscript)                                                                                                //GSP по C-22673
     [

        --------------------------------------------------------------------------------------------------------
          ВНИМАНИЕ!!! отчет содержит проводки под пользователями, не привязанными к оргструктуре         
           
           Непривязанные пользователи, проводившие рублевые документы:

          #

           Непривязанные пользователи, проводившие валютные документы:

          #

           Непривязанные пользователи, проводившие конверсионные документы:

          #
     ](TranscriptOperRUR,transcriptOperVAL,transcriptOperKON);
end;

END;/*macro*/
 

MACRO spravka_DEV (Mode:string,Chapter:integer, Oper_new:integer, otchetbank:bool, nbalanse1:string, nbalanse2:string, Valuta_otcheta:string)
  var Select, Data, Select1, Select2, Select3, razdel1, razdel2 = 0, Kol_razd = 0, Sum_razd = $0;
  var schet,kol_vo,valuta,nominal,SumRRF,nomerEX, AbsCode, code_cur,summa_v_rubl;
	OperSelect = Oper_new;

    select =
    " select accdebet,SUM(b.SUM) as sum,T_FIID_PAYER, t_name, count(1) as chislo, vid_hran                                                        "+ "\n" ;  
    if(Valuta_otcheta != "Рубли")
       select = select +
       " , Sum(SumRUR) SumRUR 															       "+ "\n" ;
    end;
    select = select +
    "       from(                                                                                                                                          "+ "\n" +
    "        select accdebet, accCred, SUM,T_FIID_PAYER, t_name, AppKey,a.t_paymentid, (SELECT storeKind FROM TABLE(USER_EA.Get_dev_prop                "+ "\n" ;
    if(substr(RepTypes,1,9) == "Баланс ->")
       select = select +
       " (a.dockind, a.origin, a.paymkind, a.shifr_oper, a.numb_pack, a.chapter, a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))) vid_hran   "+ "\n" ;    
    else
       select = select +
       " (null, a.origin, null, a.shifr_oper, a.numb_pack, a.chapter, a.t_typedocument, a.accdeb, a.T_FIID_PAYER, a.acckr, a.T_FIID_RECEIVER, null ))) vid_hran   "+ "\n" ;    
    end;
    if(Valuta_otcheta != "Рубли")
       select = select +
       " ,sumRUR                                                                                                                                       "+ "\n";
    end;
    select = select +
"         from (                                                                                                                                       "+ "\n" ;
select1 =
"               SELECT   substr(arh.t_account_payer,1,5) AS accdebet,                                                                                  "+ "\n" +
"                        substr(arh.t_account_receiver,1,5) AS accCred,                                                                                "+ "\n" +
"                        arh.t_account_payer AS accdeb,                                                                                                "+ "\n" +
"                        arh.t_account_receiver AS acckr,                                                                                              "+ "\n" +
"                        arh.T_SUM_PAYER AS SUM,                                                                                                       "+ "\n" +
"                        arh.T_SUM_NATCUR sumRUR,                                                                                                      "+ "\n" +
"                        dfininstr_dbt.t_name,                                                                                                         "+ "\n" +
"                        arh.T_FIID_PAYER,                                                                                                             "+ "\n" +
"                        arh.T_FIID_RECEIVER,                                                                                                          "+ "\n" +
"                        prop.t_paymentkind paymkind,                                                                                                  "+ "\n" +
"                        user_ea.GetOrigin ( paym.t_dockind, paym.t_paymentid) origin,                                                                 "+ "\n" +
"                        arh.t_chapter chapter,                                                                                                       "+ "\n" +
"                        paym.t_dockind dockind,                                                                                                       "+ "\n" +
"                        arh.t_number_pack numb_pack,                                                                                                  "+ "\n" +
"                        arh.t_shifr_oper shifr_oper,                                                                                                  "+ "\n" +
"                        paym.t_fiid cred_fiid,                                                                                                        "+ "\n" +
"                        paym.t_payfiid deb_fiid,                                                                                                      "+ "\n" +
"                        arh.t_typedocument,                                                                                                           "+ "\n" +
"                        arh.T_ACCTRNID AppKey,                                                                                                        "+ "\n" +
"                        paym.t_paymentid                                                                                                              "+ "\n" +
"                   FROM dpmdocs_dbt docs,                                                                                                             "+ "\n" +
"                        dpmpaym_dbt paym,                                                                                                             "+ "\n" ;
    if(not(otchetbank))
select1 = Select1 +
"                (select * from DOP_OTDEL_DBT where (T_oper,t_datebegin) in (select T_oper,max(t_datebegin) t_datebegin                                "+ "\n" +
"                   from DOP_OTDEL_DBT where t_datebegin<=TO_DATE ('"+ DateDocum + "', 'DD.MM.YYYY')                                                   "+ "\n" +
"                        and (t_dateend >= TO_DATE ('"+ DateDocum + "', 'DD.MM.YYYY') OR t_dateend  = TO_DATE ('01.01.0001', 'DD.MM.YYYY'))            "+ "\n" +                                                                 
"                        group by T_oper)) DOP_OTDEL_DBT,                                                                                              "+ "\n" +
"                        dotdels_dbt,                                                                                                                  "+ "\n" ;
    end;
select1 = Select1 +
"                        dfininstr_dbt,                                                                                                                "+ "\n" +
"                        dpmrmprop_dbt prop,                                                                                                           "+ "\n" ;
Select2 = 
"	             AND arh.t_date_carry = to_date('" + DateDocum +"','DD.MM.YYYY')                                                                   "+ "\n" ;      
    if(not(otchetbank))
Select2 = Select2 +
"                    and (DOP_OTDEL_DBT.t_dateend >=to_date('"+ DateDocum + "','DD.MM.YYYY') or t_dateend = to_date('01.01.0001','DD.MM.YYYY'))        "+ "\n" +     
"                    and t_datebegin <=to_date('"+ DateDocum + "','DD.MM.YYYY')                                                                        "+ "\n" ;     
    end;
Select2 = Select2 +
"                    AND dfininstr_dbt.T_FIID = arh.T_FIID_PAYER                                                                                       "+ "\n" +
"	             AND arh.t_chapter = "+ Chapter                                                                                                     + "\n" +      
"                    AND arh.T_ACCTRNID = docs.T_ACCTRNID(+)                                                                                           "+ "\n" +
"                    AND docs.t_paymentid = paym.t_paymentid(+)                                                                                        "+ "\n" +
"                    AND prop.t_paymentid(+) = paym.t_paymentid                                                                                        "+ "\n" +
"                    and arh.t_account_payer <> 'ОВП'                                                                                                  "+ "\n" +
"                    and arh.t_account_receiver <> 'ОВП'                                                                                               "+ "\n" ;
Select3 = "";
    if(not(otchetbank))
        Select3 = select3 +
"                    AND arh.t_oper = dop_otdel_dbt.t_oper                                                                                             "+ "\n" +
"                    AND dop_otdel_dbt.t_code1 = dotdels_dbt.t_code1                                                                                   "+ "\n" +
"                    AND dop_otdel_dbt.t_code2 = dotdels_dbt.t_code2                                                                                   "+ "\n" +
"            and dotdels_dbt.T_CODE1 = "+ NumOtdel;
      if(NumPodOtdel !=0)
        Select3 = select3 +
"            and dotdels_dbt.T_CODE2 = "+ NumPodOtdel;
      end;
     if ((OperSelect!=0) and (OperSelect!=""))     /*если выбран опер, то запрос по одному оперу*/
       Select3 = select3 +
"	     AND arh.T_OPER =" + OperSelect;
     end;
    end;
	if(RepTypes != "Внебаланс")
        Select3 = select3 +
"                    AND (   EXISTS (                                                                                                                  "+ "\n" +
"                               SELECT 1                                                                                                               "+ "\n" +
"                                 FROM dpmprop_dbt deb, dpmprop_dbt cred                                                                               "+ "\n" +
"                                WHERE cred.t_paymentid = docs.t_paymentid                                                                             "+ "\n" +
"                                  AND deb.t_paymentid = docs.t_paymentid                                                                              "+ "\n" +
"                                  AND deb.t_paymentid = cred.t_paymentid                                                                              "+ "\n" +
"            and deb.t_debetcredit = 0 and cred.t_debetcredit = 1                                                                                    ";	
if(RepTypes == "Баланс -> Внешние")
        Select3 = select3 +
"            and (cred.t_group ="+ PAYMENTS_GROUP_EXTERNAL + " or deb.t_group ="+ PAYMENTS_GROUP_EXTERNAL+  ")))  /*условие для внешних*/               "+ "\n" ;
else
        Select3 = select3 +
"            and cred.t_group <>"+ PAYMENTS_GROUP_EXTERNAL + " and deb.t_group <>"+ PAYMENTS_GROUP_EXTERNAL+  ")  /*условие для внутренних*/           "+ "\n" +          
"             or docs.t_paymentid is null)                                                                                                             "+ "\n" ;
end;
	end;
        Select3 = select3 +
              nbalanse1 + ")" + "\n" + nbalanse2 + ")                                                                                                  "+ "\n" ;  
  if (Valuta_otcheta == "Рубли")

	if(RepTypes != "Внебаланс")
	   Select = Select + Select1 + "dacctrn_dbt arh  Where substr(arh.T_ACCOUNT_PAYER,6,3) = '810' and substr(arh.T_ACCOUNT_RECEIVER,6,3) = '810' " + Select2; 
	else
           Select = Select + Select1 + "dacctrn_dbt arh  Where ((SUBSTR (arh.t_account_payer, 6, 3) = '810' and SUBSTR (arh.t_account_receiver, 6,3) = '810') "+
	      "  OR (SUBSTR (arh.t_account_payer, 6, 3) <> SUBSTR (arh.t_account_receiver, 6,3))) " + Select2;
        end;
select = select +           " AND SUBSTR (arh.t_account_receiver, 1, 5) NOT IN ('20202','20203','20207')                                               "+ "\n" +	
                            " AND SUBSTR (arh.t_account_payer, 1, 5) NOT IN ('20202','20203','20207')                                                  "+ "\n" + select3;
elif (Valuta_otcheta == "Валюта")
select = select + select1 + " dacctrn_dbt arh "+ "\n" + " Where substr(arh.T_ACCOUNT_PAYER,6,3) = substr(arh.T_ACCOUNT_RECEIVER,6,3)                   "+ "\n" +
                            " AND substr (arh.T_ACCOUNT_PAYER,6,3) <> '810' and substr(arh.T_ACCOUNT_RECEIVER,6,3) <> '810'                            "+ "\n" + Select2+
                            " AND SUBSTR (arh.t_account_receiver, 1, 5) NOT IN ('20202','20203','20207')                                               "+ "\n" +	
                            " AND SUBSTR (arh.t_account_payer, 1, 5) NOT IN ('20202','20203','20207')                                                  "+ "\n" + select3;
elif (Valuta_otcheta == "Конверсионные")
select = select + select1 + " dacctrn_dbt arh "+ "\n" + " Where substr(arh.T_ACCOUNT_PAYER,6,3) <> substr(arh.T_ACCOUNT_RECEIVER,6,3)                  "+ "\n" + Select2+
                            " AND (SUBSTR (arh.t_account_receiver, 1, 5) NOT IN ('20202','20203','20207') or arh.T_RESULT_CARRY in (18, 82))           "+ "\n" +	
                            " AND (SUBSTR (arh.t_account_payer, 1, 5) NOT IN ('20202','20203','20207') or arh.T_RESULT_CARRY in (18, 82))              "+ "\n" + select3;
  end;
select = select +
                            " ) a                                                                                                                      "+ "\n" +         
                            " ) b                                                                                                                      "+ "\n" +
                            " where (b.vid_hran <> 0                                                                                                   "+ "\n" +
                            "    or ((exists                                                                                                           "+ "\n" + //GSP 18.12.2012
                            "           (select 1                                                                                                      "+ "\n" +
                            "              from dobjatcor_dbt obj                                                                                      "+ "\n" +
                            "             where t_object = lpad(b.t_paymentid,10,0)                                                                    "+ "\n" +
                            "               and obj.t_groupid = 1010                                                                                   "+ "\n" +
                            "               and obj.t_objecttype = 501                                                                                 "+ "\n" +
                            "               and OBJ.T_ATTRID = 2 ))                                                                                    "+ "\n" +
                            "        and accCred not in ('90901','90902')                                                                              "+ "\n" +
                            "        and accdebet not in ('90901','90902')))                                                                           "+ "\n" + //GSP 27.12.2012
                            "   AND   not (exists                                                                                                      "+ "\n" +
                            "                 (select 1                                                                                                "+ "\n" +
                            "                    from dobjatcor_dbt obj                                                                                "+ "\n" +
                            "                   where t_object = lpad(b.t_paymentid,10,0)                                                              "+ "\n" +
                            "                     and obj.t_groupid = 1010                                                                             "+ "\n" +
                            "                     and obj.t_objecttype = 501                                                                           "+ "\n" +
                            "                     and OBJ.T_ATTRID = 1 )                                                                               "+ "\n" +
                            "             and accCred not in ('90901','90902')                                                                         "+ "\n" +
                            "             and accdebet not in ('90901','90902'))                                                                       "+ "\n" +
                            " Group by accdebet, T_FIID_PAYER, t_name, vid_hran                                                                        "+ "\n" +
                            " order by accdebet                                                                                                        "+ "\n" ;
debugbreak;
debugbreak;
    Data = ExecSQLSelect(Select);                                                                                                                  
    AbsCode = "";
    AbsCode = LoadRegVal ("PRBB\\EA\\ABSCODE", V_STRING);
    if(not(AbsCode))
       AbsCode = "";
    end;
    if(RepForms == "Справка ДЭВ")
	[ ##########################

							СПРАВКА
 			       о бухгалтерских  документах, сформированных и хранящихся 
					           в электронном виде                    ]({Name_Bank});
	
	[                      к отчету: ################################################################### ](Mode);
       if(otchetbank)
        [                                              по БАНКУ                          ]
       else
        [                      по подразделению: ##################################################################](NameDepart);
       end;
       if(OperSelect!=0)
        [                      по операционисту: ##### - ##############################################](string(operselect),GetOperName(operselect));                
       end;
       if (pachkaS != "") 
        [                      по номерам пачек: ######](string(pachkaS));
       end;
        [     	                                   за  ##########
	]  (DateDocum);
    else
      [
         Справочно: о документах данного отчета, хранящихся в электронном виде];
    end;
      [
         ┌──────────┬──────────────┬────────────────────────┬────────────────┬─────────────────┬──────────────┐
         │          │ Количество   │ Наименование           │Сумма в номинале│                 │              │
	 │ № Счета  │документов(шт)│ валюты/драгоценного    │валюты/уч.ед.   │Сумма в валюте РФ│   Номер EX   │
	 │          │              │ металла                │массы металла   │                 │              │
         ├──────────┼──────────────┼────────────────────────┼────────────────┼─────────────────┼──────────────┤];
 debugbreak;
 debugbreak;

    while(Data.movenext());                                                                                                                           
       schet    = data.value("accdebet");
       kol_vo   = string(data.value("chislo"):0:0);
       valuta   = data.value("t_name");
       nominal  = data.value("sum");
       code_cur = data.value("T_FIID_PAYER");
       if(Valuta_otcheta == "Рубли")                         //для конверсионных доделать
          SumRRF  = nominal;
          nominal = "        -";
       elif (Valuta_otcheta == "Валюта")
          SumRRF = data.value("SumRUR");                                                                //GSP по I-00321900-2
          if(valType (SumRRF) == V_SPECIAL_VALUE)
             SumRRF = СуммаРуб( data.value("Sum"), data.value("T_FIID_PAYER"), DateDocum );
          end;
       elif (Valuta_otcheta == "Конверсионные")
          if(code_cur == 0)
             SumRRF  = nominal;
             nominal = "        -";
          else
             SumRRF  = data.value("SumRUR");
          end;
       end ;
       nomerEX = ""; 
       nomerEX  = substr(string(DateDocum),7,4) + substr(string(DateDocum),4,2) + substr(string(DateDocum),1,2) + "-" + string(AbsCode) + "-1";

      [  │##########│##############│########################│################│#################│##############│]
         (schet,kol_vo:c,valuta,nominal:0:2,SumRRF:0:2,nomerEX);                                                                                                                            
      [  ├──────────┼──────────────┼────────────────────────┼────────────────┼─────────────────┼──────────────┤];
       Kol_razd = Kol_razd + data.value("chislo");
       Sum_razd = Sum_razd + SumRRF;
    end;/*while*/                                                                                                                                           
      [  │  итого   │##############│                        │                │#################│##############│
         │ за день  │              │                        │                │                 │              │ 
         └──────────┴──────────────┴────────────────────────┴────────────────┴─────────────────┴──────────────┘]
                    (Kol_razd:c:0:0, Sum_razd,nomerEX);

    if(RepForms == "Справка ДЭВ")
      [                                Справка сформирована: ________________##################################](getShortName(GetOperName({oper})));
    end;
END;/*MACRO*/                                                                                                                                          


MACRO PrintTranscript_1000(select_RUR,select_VAL, select_KON,parametrs)


      [


           ВНИМАНИЕ!!! отчет содержит проводки под пользователями, не привязанными к оргструктуре ]

END;/*MACRO*/                                                                                                                                                       
                                                                                                                                                       
                                                                                                                                                       
                                                                                                                                                       
                                                                                                                                                       
                                                                                                                                                       












