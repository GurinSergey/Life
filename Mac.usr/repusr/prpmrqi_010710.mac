/************************************************************************/
/*         €¢â®¬ â¨§¨à®¢ ­­ ï ¡ ­ª®¢áª ï á¨áâ¥¬  RS-Bank                */
/*                 Copyright (c) R-Style Software Lab 2002              */
/*                                                                      */
/*  ˆ¬ï ä ©«       : prpmrqi.mac                                        */
/*                                                                      */
/*  ¯¨á ­¨¥       : ¥ç âì ¯« â¥¦­®£® ¯®àãç¥­¨ï.                       */
/*                                                                      */
/*  à®£à ¬¬¨áâ    : ‘¬¨à­®¢ ‘.‚.                                       */
/*                                                                      */
/*  ‘®§¤ ­         : 09.10.02                                           */
/*                                                                      */
/************************************************************************/

import prpm, gnd120p;

/* ¥ç âì ¯« â¥¦­®£® ¯®àãç¥­¨ï ¤® ¢áâã¯«¥­¨ï ¢ á¨«ã 1256-“ */
MACRO PrintPayReqBefore1256(ncopy:integer):bool

  var PayerProps   :TPartyProperties = TPartyProperties("Payer",    pr_pmpaym, pr_debet,  pr_pmrmprop);
  var ReceiverProps:TPartyProperties = TPartyProperties("Receiver", pr_pmpaym, pr_credit, pr_pmrmprop);

  var PayerString   :string, 
      ReceiverString:string,
      ground        :string;
      
  PayerString    = MakeINN_KPP_String(PayerProps.INN)    + " " + PayerProps.Name;
  ReceiverString = MakeINN_KPP_String(ReceiverProps.INN) + " " + ReceiverProps.Name;
  ground         = InterpretGround( pr_pmrmprop.rec.Ground );
  
  ARRAY SS, SG, SBP, SBR, SP, SR;

  strsplit( PayerString,            SP,    50, 46, 5 );
  strsplit( ReceiverString,         SR,    50, 46, 5 );
  strsplit( PayerProps.BankName,    SBP,   50, 50, 2 );
  strsplit( ReceiverProps.BankName, SBR,   50, 50, 2 );
  strsplit( ground,                 SG,    85, 85, 3 );
  strsplit( RubToStrAlt(pr_pmpaym.rec.Amount), SS, 76, 76, 3 );

  while(ncopy != 0)
    [                                                                                         ÚÄÄÄÄÄÄÄÄÄ¿
                                                                                              ³ 0401060 ³
                                                                                              ÀÄÄÄÄÄÄÄÄÄÙ
           ############
       ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
       ®áâã¯. ¢ ¡ ­ª ¯« â.
                                                    ############     #############
       « â¥¦­®¥ ¯®àãç¥­¨¥ N ###############        ÄÄÄÄÄÄÄÄÄÄÄÄ     ÄÄÄÄÄÄÄÄÄÄÄÄÄ
                                                       („ â )        (‚¨¤ ¯« â¥¦ )

       ‘ã¬¬    ³ ####################################################################################
       ¯à®¯¨áìî³ ####################################################################################
               ³ ####################################################################################
      ÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
       ˆ ############################################## ³ ‘ã¬¬      ³ #############################
       ################################################## ³           ³
       ################################################## ³           ³
       ################################################## ÃÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
       ################################################## ³ ‘ç.N.     ³ #############################
                                                          ³           ³
       « â¥«ìé¨ª                                         ³           ³
      ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
       ################################################## ³ ˆŠ       ³ #############################
       ################################################## ÃÄÄÄÄÄÄÄÄÄÄÄ´
                                                          ³ ‘ç.N.     ³ #############################
        ­ª ¯« â¥«ìé¨ª                                    ³           ³
      ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
       ################################################## ³ ˆŠ       ³ #############################
       ################################################## ÃÄÄÄÄÄÄÄÄÄÄÄ´
                                                          ³ ‘ç.N.     ³ #############################
        ­ª ¯®«ãç â¥«ï                                    ³           ³
      ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄ´
       ˆ ############################################## ³ ‘ç.N.     ³ #############################
       ################################################## ³           ³
       ################################################## ÃÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄ
       ################################################## ³  ‚¨¤ ®¯.  ³ #### ³ ‘à®ª ¯« â. ³ ##########
       ################################################## ÃÄÄÄÄÄÄÄÄÄÄÄ´      ÃÄÄÄÄÄÄÄÄÄÄÄÄ´
                                                          ³  §. ¯«.  ³      ³ ç¥à ¯« â. ³ ##########
                                                          ÃÄÄÄÄÄÄÄÄÄÄÄ´      ÃÄÄÄÄÄÄÄÄÄÄÄÄ´
       ®«ãç â¥«ì                                         ³ Š®¤       ³      ³ ¥§. ¯®«¥  ³
      ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄ
        §­ ç¥­¨¥ ¯« â¥¦ :
       ###############################################################################################
       ###############################################################################################
       ###############################################################################################

      ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
                                                ®¤¯¨á¨                        â¬¥âª¨ ¡ ­ª 
                                                                               ####################
            Œ..
                                                ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

                                                ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ


    ]
    (pr_pmrmprop.rec.Date:f:c, pr_pmrmprop.rec.Date:f:c, 
     GetPaymentKind(pr_pmrmprop.rec.PaymentKind):c, pr_pmrmprop.rec.Number:l,
     SS(0):l, SS(1):l, SS(2),
     SP(0):l, pr_pmpaym.rec.Amount:l:f,
     SP(1):l, SP(2):l, SP(3), SP(4),
     PayerProps.Account:l,
     SBP(0):l, PayerProps.BankBIC:l, SBP(1):l, PayerProps.BankCorrAccount:l,
     SBR(0):l, ReceiverProps.BankBIC:l, SBR(1):l, 
     ReceiverProps.BankCorrAccount:l, SR(0), ReceiverProps.Account:l,
     SR(1), SR(2), SR(3),
     pr_pmrmprop.rec.ShifrOper:l, "", SR(4), pr_pmrmprop.rec.Priority:z,
     SG(0):l, SG(1):l, SG(2):l, pr_pmpaym.rec.PayerBankMarkDate:f:c
    );

    ncopy = ncopy - 1;
  end;
  
  return TRUE;
  
END;

/* ¥ç âì ¯« â¥¦­®£® ¯®àãç¥­¨ï ¯® 1256-“ */
MACRO PrintPayReq1256(ncopy:integer):bool

  var PayerProps   :TPartyProperties = TPartyProperties("Payer",    pr_pmpaym, pr_debet,  pr_pmrmprop);
  var ReceiverProps:TPartyProperties = TPartyProperties("Receiver", pr_pmpaym, pr_credit, pr_pmrmprop);

  var pINN   :string, 
      pKPP   :string,
      rINN   :string, 
      rKPP   :string,
      ground :string;
      
  ARRAY SS, SG, SBP, SBR, SP, SR;

  ground        = InterpretGround( pr_pmrmprop.rec.Ground );
  
  splitINN_KPP(PayerProps.INN,    pINN, pKPP);
  splitINN_KPP(ReceiverProps.INN, rINN, rKPP);

  strsplit( PayerProps.Name,        SP,    50, 50, 4 );
  strsplit( ReceiverProps.Name,     SR,    50, 50, 4 );
  strsplit( PayerProps.BankName,    SBP,   50, 50, 2 );
  strsplit( ReceiverProps.BankName, SBR,   50, 50, 2 );
  strsplit( ground,                 SG,    85, 85, 3 );
  strsplit( RubToStrAlt(pr_pmpaym.rec.Amount), SS, 76, 76, 3 );

  while(ncopy != 0)
    [                                                                                  ÚÄÄÄÄÄÄÄÄÄ¿
                                                                                       ³ 0401060 ³
                                                                                       ÀÄÄÄÄÄÄÄÄÄÙ
          ############            ##########
      ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ  ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
      ®áâã¯. ¢ ¡ ­ª ¯« â.   ‘¯¨á ­® á® áç. ¯« â.
                                                   ############     #############           ÚÄÄÄÄ¿
      « â¥¦­®¥ ¯®àãç¥­¨¥ N ###############        ÄÄÄÄÄÄÄÄÄÄÄÄ     ÄÄÄÄÄÄÄÄÄÄÄÄÄ           ³ ## ³
                                                      („ â )        (‚¨¤ ¯« â¥¦ )           ÀÄÄÄÄÙ

      ‘ã¬¬    ³ ####################################################################################
      ¯à®¯¨áìî³ ####################################################################################
              ³ ####################################################################################
     ÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
      ˆ ############ ³ Š #########                   ³ ‘ã¬¬      ³ #############################
     ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´           ³
      ################################################## ³           ³
      ################################################## ³           ³
      ################################################## ÃÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
      ################################################## ³ ‘ç.N.     ³ #############################
                                                         ³           ³
      « â¥«ìé¨ª                                         ³           ³
     ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
      ################################################## ³ ˆŠ       ³ #############################
      ################################################## ÃÄÄÄÄÄÄÄÄÄÄÄ´
                                                         ³ ‘ç.N.     ³ #############################
       ­ª ¯« â¥«ìé¨ª                                    ³           ³
     ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
      ################################################## ³ ˆŠ       ³ #############################
      ################################################## ÃÄÄÄÄÄÄÄÄÄÄÄ´
                                                         ³ ‘ç.N.     ³ #############################
       ­ª ¯®«ãç â¥«ï                                    ³           ³
     ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄ´
      ˆ ############ ³ Š #########                   ³ ‘ç.N.     ³ #############################
     ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´           ³
      ################################################## ³           ³
      ################################################## ÃÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄ
      ################################################## ³  ‚¨¤ ®¯.  ³ #### ³ ‘à®ª ¯« â. ³ ##########
      ################################################## ÃÄÄÄÄÄÄÄÄÄÄÄ´      ÃÄÄÄÄÄÄÄÄÄÄÄÄ´
                                                         ³  §. ¯«.  ³      ³ ç¥à ¯« â. ³ ##########
                                                         ÃÄÄÄÄÄÄÄÄÄÄÄ´      ÃÄÄÄÄÄÄÄÄÄÄÄÄ´
      ®«ãç â¥«ì                                         ³ Š®¤       ³      ³ ¥§. ¯®«¥  ³
     ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÁÂÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄ
      ####################³ ########### ³ ## ³ ########## ³ ############### ³ ########## ³ ##
     ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄ
       §­ ç¥­¨¥ ¯« â¥¦ :
      ###############################################################################################
      ###############################################################################################
      ###############################################################################################

     ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ
                                               ®¤¯¨á¨                        â¬¥âª¨ ¡ ­ª 
                                                                              #####################
           Œ..
                                               ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ

                                               ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ


        ]
    (pr_pmpaym.rec.PayerBankEnterDate:f:c, pr_pmrmprop.rec.PayerChargeOffDate:f:c, pr_pmrmprop.rec.Date:f:c, 
     GetPaymentKind(pr_pmrmprop.rec.PaymentKind):c, pr_pmrmprop.rec.Number:l,
     pr_pmrmprop.rec.TaxAuthorState,
     SS(0):l, SS(1):l, SS(2),
     pINN, pKPP, pr_pmpaym.rec.Amount:l:f,
     SP(0), SP(1):l, SP(2):l, SP(3),
     PayerProps.Account:l,
     SBP(0):l, PayerProps.BankBIC:l, SBP(1):l, PayerProps.BankCorrAccount:l,
     SBR(0):l, ReceiverProps.BankBIC:l, SBR(1):l, 
     ReceiverProps.BankCorrAccount:l, rINN, rKPP, ReceiverProps.Account:l,
     SR(0), SR(1), SR(2),
     pr_pmrmprop.rec.ShifrOper:l, "", SR(3), pr_pmrmprop.rec.Priority:c,
     IfThenElse(pr_pmrmprop.rec.TaxAuthorState, pr_pmrmprop.rec.BttTICode,   ""),
     IfThenElse(pr_pmrmprop.rec.TaxAuthorState, pr_pmrmprop.rec.OKATOCode,   ""),
     IfThenElse(pr_pmrmprop.rec.TaxAuthorState, pr_pmrmprop.rec.TaxPmGround, ""),
     IfThenElse(pr_pmrmprop.rec.TaxAuthorState, pr_pmrmprop.rec.TaxPmPeriod, ""),
     IfThenElse(pr_pmrmprop.rec.TaxAuthorState, pr_pmrmprop.rec.TaxPmNumber, ""),
     IfThenElse(pr_pmrmprop.rec.TaxAuthorState, pr_pmrmprop.rec.TaxPmDate,   ""),
     IfThenElse(pr_pmrmprop.rec.TaxAuthorState, pr_pmrmprop.rec.TaxPmType,   ""),
     SG(0):l, SG(1):l, SG(2):l, pr_pmpaym.rec.PayerBankMarkDate:f
    );

    ncopy = ncopy - 1;
  end;
  
  return TRUE;
  
END;

MACRO PrintPayReq(ncopy:integer):bool
  if(is1256UPayment(pr_pmrmprop))
    return PrintPayReq1256(ncopy);
  else
    return PrintPayReqBefore1256(ncopy);
  end;
END;
