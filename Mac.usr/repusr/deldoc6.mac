//* Отчет по пользователям, удалившим документы за указанный период*//
//* Негашова С.С. 26.05.2015 *//
import BankInter, RSD, globals;
var zapros:RSDRecordset;
var SQLQuery:string  = "";
var counter  :integer = 0;
var d_beg:Date;
//*var d_beg={date_doc}, d_end={date_doc}, all_in = 0;*//

//*getdate(d_beg,"Введите дату начала периода:");*//
//*getdate(d_end,"Введите дату окончания периода:");*//

//*if (d_end<d_beg)*//
//*	msgbox("Дата окончания периода не может быть меньше даты начала!!!");*//
//*	exit(1);*//
//*end;*//


if (not getDate(d_beg,"Задайте дату, за которую было удаление"))
  exit;
end;



// * Выбор данных за дату d_beg   по таблице usr_payments_log И PERSON.DBT*//

SQLQuery = " SELECT dgo.paymentid,dgo.ndoc,dgo.payeracc,dgo.receiveracc,dgo.amount,dgo.ground,dgo.oper,dp.t_oper,dgo.log_data,dp.t_name "
           " FROM   usr_payments_log dgo, dperson_dbt dp"
           " WHERE  dp.t_oper = dgo.oper "
           " AND dp.t_oper!=22222"
 "       AND dgo.date_doc LIKE to_date('" + d_beg + "','dd.mm.yyyy') "
//*           "       and dgo.date_doc = " + d_beg + ""  *//
//*           "       and dgo.date_doc = " + d_end + "         *//
//*  " GROUP BY   dgo.oper, dgo.date_doc "*//
          " ORDER BY   dgo.oper ";
  

zapros = RSDRecordset(SQLQuery); /*Результат запроса*/
 [
   ########## ########

      Список сотрудников, удаливших платежи  с датой  ############## 
    
   ----------+----------+---------------------+--------------------+-------------+-------------------------------------------------------------------------------+------+--------------------------------+-----------------------------+
   |id       |Номер     |Плательщик           |Получатель          |Сумма        |             Назначение платежа                                                |ОПЕР  |ФИО                             | Системная дата и время      |
   |payment  |документа |  счет               |  счет              |             |                                                                               |      |операциониста                   | удаления, опер              |
   +---------+----------+---------------------+--------------------+-------------+-------------------------------------------------------------------------------+------+--------------------------------+-----------------------------+ ](Date, Time, d_beg); // {CurDate}

while (zapros.moveNext)
 counter = counter +1;
  [ |#########|##########|#####################|####################|#############|###############################################################################|######|################################|#############################|]

        (zapros.value(0):r, zapros.value(1):r, zapros.value(2):l,zapros.value(3):l,zapros.value(4):r,zapros.value(5):l,zapros.value(6):r,zapros.value(9):l,zapros.value(8):l);

end;
[ +------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|

   Всего записей #####] (counter);
          
