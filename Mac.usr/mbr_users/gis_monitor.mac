// ----------------------------------------------------------------------------
// @filename: gis_monitor_scroll.mac v.1
// @author  : 29.05.2013 Teleshova
// @desc    : Скроллинг для мониторинга обработки шлюзом ГИС ГМП сообщений РС-банк(информационный скроллинг) C-19326
// @changes : none
// ---------------------------------------------------------------------------
import globals, SbCrdInter;
import lib_registry, zubrunscroll;

var v_date_begin = {curdate},
    v_date_end = {curdate};
var sql;

private macro Monitor_Show ()
   debugbreak;
   var scroll = ZUBScroll;
   sql = "select t_payment_id, t_date, t_mes_trn, t_request_id, t_response_id, t_status, t_error_code, t_error_desc, " +
               " to_char(send_request_time,'dd.mm.yyyy hh24:mi:ss') req_t, to_char(get_response_time,'dd.mm.yyyy hh24:mi:ss') res_t " +
               " from usr_gis_gmp_monitor_dbt monitor " + 
               " where MONITOR.T_DATE between to_date('" + v_date_begin + "','dd.mm.yyyy') " +
                                      " and to_date('" + v_date_end + "','dd.mm.yyyy') ";

   scroll.Columns.Add ("t_payment_id"      , "ИД Платежа"            ,     10, ZUB_SCR_COL_NONEDITABLE);
   scroll.Columns.Add ("t_date"            , "ДПП платежа"           ,     10, ZUB_SCR_COL_NONEDITABLE);
   scroll.Columns.Add ("t_mes_trn"         , "Референс сообщения"    ,     20, ZUB_SCR_COL_NONEDITABLE);
   scroll.Columns.Add ("t_request_id"      , "ИД Запроса"            ,     20, ZUB_SCR_COL_NONEDITABLE);
   scroll.Columns.Add ("t_response_id"     , "ИД Ответа"             ,     8 , ZUB_SCR_COL_NONEDITABLE);
   scroll.Columns.Add ("t_status"          , "Статус запроса"        ,     8 , ZUB_SCR_COL_NONEDITABLE);
   scroll.Columns.Add ("t_error_code"      , "Код ошибки"            ,     8 , ZUB_SCR_COL_NONEDITABLE);
   scroll.Columns.Add ("t_error_desc"      , "Описание ошибки"       ,     65, ZUB_SCR_COL_NONEDITABLE);
   scroll.Columns.Add ("req_t"             , "Время отправки запроса",     65, ZUB_SCR_COL_NONEDITABLE);
   scroll.Columns.Add ("res_t"             , "Время получения ответа",     65, ZUB_SCR_COL_NONEDITABLE);

   scroll.ScrollReadOnly = true;
   scroll.SqlText = sql;
   scroll.ScrollHead = "Мониторинг запросов в шлюз ГИС ГМП (только для чтения)";
   scroll.ScrollPrompt = "~Esc~ Выход ~Ctrl+Shift+F5~ Фильтр";
   Scroll.Scroll;
end;

ВвестиПериодДат(v_date_begin,v_date_end);
Monitor_Show();
exit(1);