/****************************************************************************/
/*                   R-Style SoftWare Lab, RS-Bank 6.0                      */
/****************************************************************************/
/*                  Подсистема "Межбанковские расчеты"                      */
/* Генерация запросов по сообщению ED243                                    */
/*                                                                          */
/*  Имя файла: uf_load243.mac                                               */
/*  Создан:    26.03.14 Gurin S. Новый альбом УФЭБС v2.6.0                  */
/****************************************************************************/
import "ufgendoc.mac";
import "uf_loader.mac";
debugbreak;
var ver_st = 2;

macro GenDoc( addrMes )
  SetBuff( wlmes, addrMes );
  
  PrintLog(2,"Генерация запроса по ED243");

  ClearRecord(wlreq);
  
  var error = 0, Строка, i = 0;
  var xml:object = ActiveX( "MSXML.DOMDocument" );
  
  if( not СчитатьПоле( XMLField, Строка ) )
    return FALSE;
  end;

  if ( not xml.loadXML(Строка) )
    println( string( "Неверный формат сообщения по форме ED243" ) );
    return false;
  end; 
  //Gurin S. Новый альбом УФЭБС, этот функционал самописный у нас пока что
  EDLoader.selfInit(string(wlmes.Trn,".xml"), xml.xml, True);

  return TRUE;

  OnError(er) /* обработка ошибок времени выполнения */
    ExeptionMessage(er);
    return FALSE;
end;