Import MesInter, fns_lib, rsd;

macro PrintForm( addrMes, MassCopy )

 file MessageFile() txt;
 record wlmes( wlmes );
 SetBuff( wlmes, addrMes );

 var field_name, field_value, paths, stat = false;
 var rs;
 var MessageFileName;
 debugbreak;
 
 MessageFileName = ПолучитьИмяВходФайлаПоСообщ( wlmes.mesid );
 Println( "ИмяФайла ", ОтрезатьПутьОтИмениФайла(MessageFileName) );

 rs = RsdRecordSet(" select t_importdir,t_archivedir from dwltpfrmt_dbt where t_name like '%ФНС_365-П%' ");
 if( rs.movenext() )
  paths = rs.value(0) + ";" + rs.value(1);
  MessageFileName = FindPath( ОтрезатьПутьОтИмениФайла(MessageFileName), paths );
 end;

 if ( MessageFileName != "" )
  if ( open(MessageFile, MessageFileName) )
   stat = true;
  else
   stat = false;
  end;
 else
  stat = false;
 end;

 if(stat == true)
  while( Next(MessageFile) )
   println( MessageFile.str );
  end;
 else
  while( СчитатьПоле( field_name, field_value ) )
   println( field_name, ":", field_value );
   if( (field_name == "ВерсФорм") or (field_name == "ТипПлат") or (field_name == "НомВалСч") )
    [###]("###");
    [@@@];
   end;
  end;
  [===];
 end;
 
return true;

end;