/*+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

   ████████   ████████
   ███   ███  ███   ███
   ███  ████  ███  ████
   ███████    ███████
   ███  ███   ███  ███
   ███   ███  ███   ███

   RR Рахмедов Р.С.
   
   Имя файла: imp_kfm_usr.mac

   Создан :   04.04.2014
   
   Описание: Макрос позволяющий указать директорию со справочником террористов минуя дистрибутивный механизм выбора файла.

   ChangeLog:
-----------------------------------------------------------------------------------------------------------------------------------------------------
   //RR 23.01.2015 Произведены изменения в механизме загрузки, решено отказаться от использования Exel'я, теперь путь читается из настройки реестра
-----------------------------------------------------------------------------------------------------------------------------------------------------
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/
import globals, RsExts;

 // Чтение настройки
 var regPath = "ФИНМОНИТОРИНГ\\DIR_IMP_SPR_TERR_FSFM",
     defPath = "\\\\prbs-mow-fl-b00\\departs\\fz115\\P",
     Path, Err;
 GetRegistryValue( regPath, V_STRING, Path, Err );
 if ( ( err != 0 ))
    msgbox("Не удалось прочесть настроку реестра "+regPath+"/nдля загрузки установлена директория по умолчанию/n"+defPath);
    Path = defPath;
 end;
 
 //debugbreak;
 var dir = TDirList ( string ( Path, "/", "*.dbf" ), "f" );
 
 if (GetTrue(false, "Выбран верный файл?\n"+dir.name(0)))
   ExecMacroFile("imp_kfm.mac","ImportFun", string (Path, "\\", dir.name(0)), {curdate});
 else
   msgbox("Загрука справочника отменена");
 end;
