import rsbdataset, globals, ptinter, ActX;

 var ЧислоЛистов=3,      
      File_Name="";

 var Код_Ячейки="";
 var Номер_Строки  = 2,  /*с которой начинается заполнение данных*/
     лист = 1;


MACRO БезналичныеПлатежи(start, endd, sum)
var rs, str, str2, cnt=0;
var newcode, oldcode, isfirst = true, summ=$0;
 str = "SELECT   p.t_date, NVL (p.t_payername, CHR (1)) t_payername, " +
       "         NVL (p.t_payerinn, CHR (1)) t_payerinn, " +
       "         NVL (pr.t_bankcode, CHR (1)) t_bankcode, " +
       "         NVL (p.t_receivername, CHR (1)) t_receivername, " +
       "         NVL (t.t_receiveraccount, CHR (1)) t_receiveraccount, t.t_amount, " +
       "         p.t_ground, t.t_payer, t.t_receiver " +
       "    FROM dpmpaym_dbt t, dpmrmprop_dbt p, dpmprop_dbt pr " +
       "   WHERE t.t_dockind IN (320, 322) " +
       "     AND (t.t_payeraccount LIKE '407%' OR t.t_payeraccount LIKE '408%') " +
       "     AND (   t.t_receiveraccount LIKE '423%' " +
       "          OR t.t_receiveraccount LIKE '426%' " +
       "          OR t.t_receiveraccount LIKE '47422%' " +
       "          OR t.t_receiveraccount LIKE '40911%' " +       // vihrov 20.10.2010 I-073963
       "          OR t.t_receiveraccount LIKE '40817%') " +
       "     AND t_paymstatus = 32000 " +
       "     AND t.t_amount >=  " + sum+
       "     AND p.t_paymentid = t.t_paymentid " +
       "     AND pr.t_paymentid = t.t_paymentid " +
       "     AND pr.t_debetcredit = 0 " +
       "     AND pr.t_issender = 'X' " +  
       "     AND p.t_date BETWEEN TO_DATE ('"+start+"', 'dd.mm.yyyy') " +
       "                      AND TO_DATE ('"+endd+"', 'dd.mm.yyyy') " +
       "UNION ALL " +
       "SELECT   p.t_date, NVL (p.t_payername, CHR (1)) t_payername, " +
       "         NVL (p.t_payerinn, CHR (1)) t_payerinn, '044525986' t_bankcode, " +
       "         NVL (p.t_receivername, CHR (1)) t_receivername, " +
       "         NVL (t.t_receiveraccount, CHR (1)) t_receiveraccount, t.t_amount, " +
       "         p.t_ground, t.t_payer, t.t_receiver " +
       "    FROM dpmpaym_dbt t, dpmrmprop_dbt p " +
       "   WHERE t.t_dockind IN (16, 17, 27, 70, 201, 202, 450) " +
       "     AND (t.t_payeraccount LIKE '407%' OR t.t_payeraccount LIKE '408%') " +
       "     AND (   t.t_receiveraccount LIKE '423%' " +
       "          OR t.t_receiveraccount LIKE '47422%' " +
       "          OR t.t_receiveraccount LIKE '426%' " +
       "          OR t.t_receiveraccount LIKE '40911%' " +       // vihrov 20.10.2010 I-073963
       "          OR t.t_receiveraccount LIKE '40817%') " +
       "     AND t_paymstatus = 32000 " +
       "     AND t.t_amount >=  " + sum+
       "     AND p.t_paymentid = t.t_paymentid " +

       /* EVG 31/1/2014 Переход на 2031
       "     AND t.t_receiverbankid = " + {selfid}+*/
       "     AND t.t_receiverbankid = " + {OurBank}+

       "     AND p.t_date BETWEEN TO_DATE ('"+start+"', 'dd.mm.yyyy') " +
       "                      AND TO_DATE ('"+endd+"', 'dd.mm.yyyy') " +
       "ORDER BY t_bankcode, t_payerinn, t_amount " ;
  rs = trsbdataset(str);

  if(start==endd)
     str2 = "за "+ start +" г.";
  elif(start==date("00.00.0000"))
     str2 =  "за период 00.00.0000 - "+ endd +" г.";
  else
     str2 =  "за период "+ start +" - "+ endd +" г.";
  end;


[                 Безналичные платежи поступившие на физических лиц # 

 ┌───────┬────────────┬──────────────────────────────────────────────┬───────────────────────────────┬──────────────┬──────────────────────────────────────────────┬───────────────────────────┬─────────────────┬────────────────────────────────────────────────────────┐
 │ № п/п │    Дата    │          Наименование  плательщика           │        ИНН  плательщика       │  БИК банка   │          Наименование  получателя            │  Лицевой счет получателя  │      Сумма      │                                                        │
 │       │            │                                              │                               │ плательщика  │                                              │                           │                 │                                                        │
](str2);




  while (rs and rs.movenext)
    if(isfirst == true)
       newcode = oldcode = trim(rs.t_bankcode);
       isfirst = false;
    end;
    newcode = trim(rs.t_bankcode);
    if(newcode != oldcode)
[├───────┴────────────┴──────────────────────────────────────────────┴───────────────────────────────┴──────────────┴──────────────────────────────────────────────┴───────────────────────────┼─────────────────┼────────────────────────────────────────────────────────┤
 │ Итого по группе платежей                                                                                                                                                                    │ ############### │                                                        │
 ├───────┬────────────┬──────────────────────────────────────────────┬───────────────────────────────┬──────────────┬──────────────────────────────────────────────┬───────────────────────────┼─────────────────┼────────────────────────────────────────────────────────┤]
  (summ);
//       Код_Ячейки ="A"+Номер_Строки; Шрифт(2,Код_Ячейки,"Arial Cyr","полужирный",10); Запись_ячейка(2,Код_Ячейки,"Итого по группе платежей");
//       Код_Ячейки ="H"+Номер_Строки; Шрифт(2,Код_Ячейки,"Arial Cyr","полужирный",10); Запись_ячейка(2,Код_Ячейки,summ);
//       Номер_Строки=Номер_Строки+1;
       oldcode = newcode;
       cnt = 0;
       summ = 0;
    else
[├───────┼────────────┼──────────────────────────────────────────────┼───────────────────────────────┼──────────────┼──────────────────────────────────────────────┼───────────────────────────┼─────────────────┼────────────────────────────────────────────────────────┤];
    end;
    cnt = cnt+1;
    summ = summ + money(rs.t_amount);

[│ ##### │ ########## │ ############################################ │ ############################# │ ############ │ ############################################ │ ######################### │ ############### │ ###################################################### │]
(cnt, date(rs.t_date), rs.t_payername:w,  rs.t_payerinn, rs.t_bankcode, rs.t_receivername:w, rs.t_receiveraccount, money(rs.t_amount), rs.t_ground:w);

  Код_Ячейки ="A"+Номер_Строки;  Запись_ячейка(2,Код_Ячейки,cnt);
  Код_Ячейки ="B"+Номер_Строки;  Запись_ячейка(2,Код_Ячейки,date(rs.t_date));
  Код_Ячейки ="C"+Номер_Строки;  Запись_ячейка(2,Код_Ячейки,rs.t_payername);
  Код_Ячейки ="D"+Номер_Строки;  Запись_ячейка(2,Код_Ячейки,rs.t_payerinn);
  Код_Ячейки ="E"+Номер_Строки;  Запись_ячейка(2,Код_Ячейки,rs.t_bankcode);
  Код_Ячейки ="F"+Номер_Строки;  Запись_ячейка(2,Код_Ячейки,rs.t_receivername);
  Код_Ячейки ="G"+Номер_Строки;  Запись_ячейка(2,Код_Ячейки,rs.t_receiveraccount);
  Код_Ячейки ="H"+Номер_Строки;  Запись_ячейка(2,Код_Ячейки, money(rs.t_amount));
  Код_Ячейки ="I"+Номер_Строки;  Запись_ячейка(2,Код_Ячейки,rs.t_ground);

  Номер_Строки=Номер_Строки+1;

  end;


[├───────┴────────────┴──────────────────────────────────────────────┴───────────────────────────────┴──────────────┴──────────────────────────────────────────────┴───────────────────────────┼─────────────────┼────────────────────────────────────────────────────────┤
 │ Итого по группе платежей                                                                                                                                                                    │ ############### │                                                        │
 └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┴─────────────────┴────────────────────────────────────────────────────────┘]
  (summ);
//       Код_Ячейки ="A"+Номер_Строки; Шрифт(2,Код_Ячейки,"Arial Cyr","полужирный",10); Запись_ячейка(2,Код_Ячейки,"Итого по группе платежей");
//       Код_Ячейки ="H"+Номер_Строки; Шрифт(2,Код_Ячейки,"Arial Cyr","полужирный",10); Запись_ячейка(2,Код_Ячейки,summ);
//       Номер_Строки=Номер_Строки+1;

end;

MACRO БезналичныеПеречисления(start, endd, sum)
var rs, str, str2, cnt=0;
var newcode, oldcode, isfirst = true, summ=$0;
 str = "SELECT   p.t_date, NVL (p.t_payername, CHR (1)) t_payername, " +
       "         NVL (p.t_receiverinn, CHR (1)) t_receiverinn, " +
       "         NVL (pr.t_bankcode, CHR (1)) t_bankcode, " +
       "         NVL (p.t_receivername, CHR (1)) t_receivername, " +
       "         NVL (t.t_receiveraccount, CHR (1)) t_receiveraccount, t.t_amount, " +
       "         p.t_ground, t.t_payer, t.t_receiver " +
       "    FROM dpmpaym_dbt t, dpmrmprop_dbt p, dpmprop_dbt pr " +
       "   WHERE t.t_dockind IN (16, 17, 27, 70, 201, 202, 450) " +
       "     AND (t.t_payeraccount LIKE '407%' OR t.t_payeraccount LIKE '408%') " +
       "     AND (   t.t_receiveraccount LIKE '423%' " +
       "          OR t.t_receiveraccount LIKE '47422%' " +
       "          OR t.t_receiveraccount LIKE '40911%' " +       // vihrov 20.10.2010 I-073963
       "          OR t.t_receiveraccount LIKE '426%' " +
       "          OR t.t_receiveraccount LIKE '40817%') " +
       "     AND t_paymstatus = 32000 " +
       "     AND t.t_amount >=  " + sum+
       "     AND p.t_paymentid = t.t_paymentid " +
       "     AND pr.t_paymentid = t.t_paymentid " +
       "     AND pr.t_debetcredit = 1 " +
       "     AND pr.t_issender = chr(0) " +

       /* EVG 31/1/2014 Переход на 2031
       "     AND t.t_receiverbankid != " + {selfid}+*/
       "     AND t.t_receiverbankid != " + {OurBank}+

       "     AND p.t_date BETWEEN TO_DATE ('"+start+"', 'dd.mm.yyyy') " +
       "                      AND TO_DATE ('"+endd+"', 'dd.mm.yyyy') " +
       "ORDER BY t_bankcode, p.t_payerinn, t.t_amount " ;

  rs = trsbdataset(str);


  if(start==endd)
     str2 = "за "+ start +" г.";
  elif(start==date("00.00.0000"))
     str2 =  "за период 00.00.0000 - "+ endd +" г.";
  else
     str2 =  "за период "+ start +" - "+ endd +" г.";
  end;



[                 Безналичные внешние перечисления клиентов на физических лиц #

 ┌───────┬────────────┬──────────────────────────────────────────────┬──────────────┬──────────────────────────────────────────────┬───────────────────────────────┬──────────────┬─────────────────┬────────────────────────────────────────────────────────┐
 │ № п/п │    Дата    │          Наименование  плательщика           │     Код      │          Наименование  получателя            │         ИНН получателя        │  БИК  банка  │      Сумма      │                                                        │
 │       │            │                                              │ плательщика  │                                              │                               │  Получателя  │                 │                                                        │
](str2);




  while (rs and rs.movenext)
    if(isfirst == true)
       newcode = oldcode = trim(rs.t_bankcode);
       isfirst = false;
    end;
    newcode = trim(rs.t_bankcode);
    if(newcode != oldcode)
[├───────┴────────────┴──────────────────────────────────────────────┴──────────────┴──────────────────────────────────────────────┴───────────────────────────────┴──────────────┼─────────────────┼────────────────────────────────────────────────────────┤
 │ Итого по группе платежей                                                                                                                                                       │ ############### │                                                        │
 ├───────┬────────────┬──────────────────────────────────────────────┬──────────────┬──────────────────────────────────────────────┬───────────────────────────────┬──────────────┼─────────────────┼────────────────────────────────────────────────────────┤]
  (summ);
//       Код_Ячейки ="A"+Номер_Строки; Шрифт(1,Код_Ячейки,"Arial Cyr","полужирный",10); Запись_ячейка(1,Код_Ячейки,"Итого по группе платежей");
//       Код_Ячейки ="H"+Номер_Строки; Шрифт(1,Код_Ячейки,"Arial Cyr","полужирный",10); Запись_ячейка(1,Код_Ячейки,summ);
//       Номер_Строки=Номер_Строки+1;
       oldcode = newcode;
       cnt = 0;
       summ = 0;

    else
[├───────┼────────────┼──────────────────────────────────────────────┼──────────────┼──────────────────────────────────────────────┼───────────────────────────────┼──────────────┼─────────────────┼────────────────────────────────────────────────────────┤];
    end;
    cnt = cnt+1;
    summ = summ + money(rs.t_amount);

[│ ##### │ ########## │ ############################################ │ ############ │ ############################################ │ ############################# │ ############ │ ############### │ ###################################################### │]
(cnt, date(rs.t_date), rs.t_payername:w,  ПолучитьКодСубъекта(rs.t_payer,1),rs.t_receivername:w, rs.receiverinn, rs.t_bankcode,  money(rs.t_amount), rs.t_ground:w);

  Код_Ячейки ="A"+Номер_Строки;  Запись_ячейка(1,Код_Ячейки,cnt);
  Код_Ячейки ="B"+Номер_Строки;  Запись_ячейка(1,Код_Ячейки,date(rs.t_date));
  Код_Ячейки ="C"+Номер_Строки;  Запись_ячейка(1,Код_Ячейки,rs.t_payername);
  Код_Ячейки ="D"+Номер_Строки;  Запись_ячейка(1,Код_Ячейки,ПолучитьКодСубъекта(rs.t_payer,1));
  Код_Ячейки ="E"+Номер_Строки;  Запись_ячейка(1,Код_Ячейки,rs.t_receivername);
  Код_Ячейки ="F"+Номер_Строки;  Запись_ячейка(1,Код_Ячейки,rs.receiverinn);
  Код_Ячейки ="G"+Номер_Строки;  Запись_ячейка(1,Код_Ячейки, rs.t_bankcode);
  Код_Ячейки ="H"+Номер_Строки;  Запись_ячейка(1,Код_Ячейки, money(rs.t_amount));
  Код_Ячейки ="I"+Номер_Строки;  Запись_ячейка(1,Код_Ячейки,rs.t_ground);

  Номер_Строки=Номер_Строки+1;
end;


[├───────┴────────────┴──────────────────────────────────────────────┴──────────────┴──────────────────────────────────────────────┴───────────────────────────────┴──────────────┼─────────────────┼────────────────────────────────────────────────────────┤
 │ Итого по группе платежей                                                                                                                                                       │ ############### │                                                        │
 └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┴─────────────────┴────────────────────────────────────────────────────────┘]
  (summ);
//       Код_Ячейки ="A"+Номер_Строки; Шрифт(1,Код_Ячейки,"Arial Cyr","полужирный",10); Запись_ячейка(1,Код_Ячейки,"Итого по группе платежей");
//       Код_Ячейки ="H"+Номер_Строки; Шрифт(1,Код_Ячейки,"Arial Cyr","полужирный",10); Запись_ячейка(1,Код_Ячейки,summ);
//       Номер_Строки=Номер_Строки+1;

end;


MACRO БезналичныеПоИНН(startd, endd, summ_, inn_)
//           msgbox("По ИНН");
//           msgbox(startd + " " + endd + " " + summ_ + " " + inn_);


var     str_ = "        SELECT p.t_date, " + 
                "       t.t_payer, " + 
                "             NVL (p.t_payername, CHR (1)) t_payername, " + 
                "             NVL (pr.t_bankcode, CHR (1)) t_bankcode, " + 
                "             CASE " + 
                "                WHEN INSTR (NVL (p.t_payerinn, CHR (1)), '/', 1) != 0 " + 
                "                THEN " + 
                "                   SUBSTR (NVL (p.t_payerinn, CHR (1)), " + 
                "                           1, " + 
                "                           INSTR (NVL (p.t_payerinn, CHR (1)), '/', 1) - 1 " + 
                "                   ) " + 
                "                ELSE " + 
                "                   NVL (p.t_payerinn, CHR (1)) " + 
                "             END " + 
                "             t_payerinn, " + 
                "             CASE " + 
                "               WHEN INSTR (NVL (p.t_receiverinn, CHR (1)), '/', 1) = 11 " + 
                "               THEN " + 
                "                       SUBSTR (NVL (p.t_receiverinn, CHR (1)), 1, 10) " + 
                "             ELSE " + 
                "              NVL (p.t_receiverinn, CHR (1)) " + 
                "             END " + 
                "               t_receiverinn, " + 
                "             NVL (p.t_receivername, CHR (1)) t_receivername, " + 
                "             NVL (t.t_receiveraccount, CHR (1)) t_receiveraccount, " + 
                "             t.t_amount, " + 
                "             p.t_ground, " + 
                "             t.t_payer, " + 
                "             t.t_receiver " + 
                "      FROM dpmpaym_dbt t, dpmrmprop_dbt p, dpmprop_dbt pr " + 
                "      WHERE t.t_dockind IN (16, 17, 27, 70, 201, 202, 450) " + 
                "            AND t_paymstatus = 32000 " + 
                "            AND t.t_amount >= " + summ_ +
                "            AND p.t_receiverinn like '"+inn_+"%' " + 
                "            AND p.t_paymentid = t.t_paymentid " + 
                "            AND pr.t_paymentid = t.t_paymentid " + 
                "            AND pr.t_debetcredit = 1 " + 
                "            AND pr.t_issender = CHR (0) " + 
                "            AND t.t_receiverbankid != 28323  " + 
                "            AND p.t_date BETWEEN TO_DATE ('" + startd + "', 'dd.mm.yyyy') " + 
                "                             AND  TO_DATE ('" + endd + "', 'dd.mm.yyyy') " + 
                "      ORDER BY t.t_payer, t_bankcode, t.t_amount";
         
var     rs = trsbdataset(str_);
var     cnt = 1;
                                                                        
       ob.Cells(1,1).Value      = "№ п/п";
       ob.Cells(1,2).Value      = "Дата";
       ob.Cells(1,3).Value      = "Наименование плательщика";
       ob.Cells(1,4).Value      = "ИНН плательщика";
       ob.Cells(1,5).Value      = "БИК банка плательщика";
       ob.Cells(1,6).Value      = "ИНН получателя";
       ob.Cells(1,7).Value      = "Наименование получателя";
       ob.Cells(1,8).Value      = "Лицевой счет получателя";
       ob.Cells(1,9).Value      = "Сумма";
       ob.Cells(1,10).Value     = "Основание";
       ob.Rows("1:1").Select;
        ob.Range("D1").Activate;
        ob.Selection.Font.Bold = True;
        ob.Columns("D:D").Select;
        ob.Selection.NumberFormat = "@";
        ob.Columns("H:H").Select;
        ob.Selection.NumberFormat = "@";
        ob.Columns("I:I").Select;
        ob.Selection.NumberFormat = "# ##0,00";
        ob.Cells.Select;
        ob.Selection.Font.Size = 8;
        
        Номер_Строки = 2;
        var gsumm = $0;
        var previd = -1;

[                 Безналичные внешние перечисления клиентов по ИНН получателя

 ┌───────┬────────────┬────────────────────────────────────────────────────┬─────────────────┬─────────────────────────┬─────────────────┬────────────────────────────────────────────────────┬───────────────────────────┬─────────────────────────┬──────────────────────────────────────────────────────┐
 │ № п/п │    Дата    │             Наименование  плательщика              │       ИНН       │       БИК банка         │ ИНН получателя  │               Наименование получателя              │      ЛС Получателя        │        Сумма            │                  Основание                           │
 │       │            │                                                    │   плательщика   │                         │                 │                                                    │                           │                         │                                                             │
];



        while (rs and rs.movenext)
                if ((previd ==  rs.t_payer) OR (previd == -1))
                        previd = rs.t_payer;
                ob.Cells(Номер_Строки, 1).Value = cnt;          
                ob.Cells(Номер_Строки, 2).Value = date(rs.t_date);
                ob.Cells(Номер_Строки, 3).Value = rs.t_payername;
                ob.Cells(Номер_Строки, 4).Value = rs.t_payerinn;
                ob.Cells(Номер_Строки, 5).Value = rs.t_bankcode;
                ob.Cells(Номер_Строки, 6).Value = rs.t_receiverinn;
                ob.Cells(Номер_Строки, 7).Value = rs.t_receivername;
                ob.Cells(Номер_Строки, 8).Value = rs.t_receiveraccount;
                ob.Cells(Номер_Строки, 9).Value = money(rs.t_amount);
                ob.Cells(Номер_Строки, 10).Value        = rs.t_ground;
                        gsumm = gsumm + money(rs.t_amount);
[├───────┼────────────┼────────────────────────────────────────────────────┼─────────────────┼─────────────────────────┼─────────────────┼────────────────────────────────────────────────────┼───────────────────────────┼───────────────────────┼────────────────────────────────────────────────────────┤];

[│ ##### │ ########## │ ################################################## │ ############### │ ####################### │ ############### │ ################################################## │ ######################### │ ##################### │ ###################################################### │]
        (cnt, date(rs.t_date), rs.t_payername:w, rs.t_payerinn, rs.t_bankcode, rs.t_receiverinn, rs.t_receivername:w, rs.t_receiveraccount, money(rs.t_amount), rs.t_ground:w);


                 else
                        if (gsumm == 0)
                                gsumm =  money(rs.t_amount);
//                      else
//                              gsumm = gsumm + money(rs.t_amount);
                        end; 
//                      Номер_Строки = Номер_Строки + 1;
                        ob.Cells(Номер_Строки, 1).Value = "Итого:";             
                ob.Cells(Номер_Строки, 2).Value = gsumm;

[├───────┴────────────┴────────────────────────────────────────────────────┴─────────────────┴─────────────────────────┴─────────────────┴────────────────────────────────────────────────────┴───────────────────────────┴───────────────────────┴────────────────────────────────────────────────────────┤];
[│ ИТОГО:                                                                                                                                                                                       ######################### │                                                                                │]
        (gsumm);
[├───────┬────────────┬────────────────────────────────────────────────────┬─────────────────┬─────────────────────────┬─────────────────┬────────────────────────────────────────────────────┬───────────────────────────┬───────────────────────┬────────────────────────────────────────────────────────┤];

                        ob.Rows(Номер_Строки+":"+Номер_Строки).Select;
                        ob.Selection.Interior.ColorIndex = 6;
                        Номер_Строки = Номер_Строки + 1;
                ob.Cells(Номер_Строки, 1).Value = cnt;          
                ob.Cells(Номер_Строки, 2).Value = date(rs.t_date);
                ob.Cells(Номер_Строки, 3).Value = rs.t_payername;
                ob.Cells(Номер_Строки, 4).Value = rs.t_payerinn;
                ob.Cells(Номер_Строки, 5).Value = rs.t_bankcode;
                ob.Cells(Номер_Строки, 6).Value = rs.t_receiverinn;
                ob.Cells(Номер_Строки, 7).Value = rs.t_receivername;
                ob.Cells(Номер_Строки, 8).Value = rs.t_receiveraccount;
                ob.Cells(Номер_Строки, 9).Value = money(rs.t_amount);
                ob.Cells(Номер_Строки, 10).Value        = rs.t_ground;
                       gsumm = money(rs.t_amount);
                        previd = rs.t_payer;
[│ ##### │ ########## │ ################################################## │ ############### │ ####################### │ ############### │ ################################################## │ ######################### │ ##################### │ ###################################################### │]
        (cnt, date(rs.t_date), rs.t_payername:w, rs.t_payerinn, rs.t_bankcode, rs.t_receiverinn, rs.t_receivername:w, rs.t_receiveraccount, money(rs.t_amount), rs.t_ground:w);
[├───────┼────────────┼────────────────────────────────────────────────────┼─────────────────┼─────────────────────────┼─────────────────┼────────────────────────────────────────────────────┼───────────────────────────┼───────────────────────┼────────────────────────────────────────────────────────┤];

                 end; 
                Номер_Строки = Номер_Строки + 1;
                cnt = cnt + 1;          
        end;
                        ob.Cells(Номер_Строки, 1).Value = "Итого:";             
                ob.Cells(Номер_Строки, 2).Value = gsumm;
                        ob.Rows(Номер_Строки+":"+Номер_Строки).Select;
                        ob.Selection.Interior.ColorIndex = 6;
[├───────┴────────────┴────────────────────────────────────────────────────┴─────────────────┴─────────────────────────┴─────────────────┴────────────────────────────────────────────────────┴───────────────────────────┴───────────────────────┴────────────────────────────────────────────────────────┤];
[│ ИТОГО:                                                                                                                                                                                       ######################### │                                                                                │]
        (gsumm);
[└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┴────────────────────────────────────────────────────────────────────────────────┘];
                        Номер_Строки = Номер_Строки + 1;

             



             ob.Columns("A:J").EntireColumn.AutoFit;

end;


array m_menu;
      m_menu(0)="Безналичные платежи поступившие на физических лиц";
      m_menu(1)="Безналичные внешние перечисления клиентов на физических лиц";
      m_menu(2)="Безналичные внешние перечисления клиентов по ИНН получателя";




 var startdate, enddate, promt, summ=$50000, inn="7724261610";
  startDate = {curdate} - 1;

     ОткрытиеТаблицы_Книги("fm_beznal_pl.xls");
     ИнициализацияЛистов(ЧислоЛистов);


promt = menu(m_menu, "Какой отчет выпускаем?","Какой отчет выпускаем?",null,null);
   if (promt < 0)
      exit(1);
   
   elif ((promt == 0) or (promt == 1))
 
        getmoney(summ,"Минимальная сумма");
        
        if ( not GetDate( startDate, "Введите начальную дату отчета :" ) )
                exit(1);
        else
                if (startDate >= {curdate})
                        msgbox("Значение даты "+string(startDate)+" введено неверно !!!");
                        exit(1);
                end;
        
                if(startdate == date(0,0,0))
                startdate = "01.01.0001";
                end;
        end;
        
        endDate = startDate;
        if ( not GetDate( endDate, "Введите конечную дату отчета :" ) )
                exit(1);
        else
                if (startDate > endDate)
                msgbox("Значение даты "+string(endDate)+" введено неверно !!!");
                exit(1);
                end;
        end;
   elif (promt == 2)
       getmoney(summ,"Минимальная сумма");
        getstring(inn, "ИНН");
        
                
        if ( not GetDate( startDate, "Введите начальную дату отчета :" ) )
                exit(1);
        else
                if (startDate >= {curdate})
                        msgbox("Значение даты "+string(startDate)+" введено неверно !!!");
                        exit(1);
                end;
        
                if(startdate == date(0,0,0))
                startdate = "01.01.0001";
                end;
        end;
        
        endDate = startDate;
        if ( not GetDate( endDate, "Введите конечную дату отчета :" ) )
                exit(1);
        else
                if (startDate > endDate)
                msgbox("Значение даты "+string(endDate)+" введено неверно !!!");
                exit(1);
                end;
        end;

  end;
    
  if (promt == 0)
     ws(2).Activate;/*можно писать в этот лист*/
     ob.Visible=false;

     БезналичныеПлатежи(startdate, enddate, summ);
  elif (promt == 1)
     ws(1).Activate;/*можно писать в этот лист*/
     ob.Visible=false;

     БезналичныеПеречисления(startdate, enddate, summ);
  elif (promt == 2)
     ws(3).Activate;/*можно писать в этот лист*/
     ob.Visible=false;

     БезналичныеПоИНН(startdate, enddate, summ, inn);
  end;
  
  msgbox("Все! Теперь можете просмотреть полученный отчет в EXCEL","| Нажмите ESC");
  ob.Visible=true;
 // exit(1);