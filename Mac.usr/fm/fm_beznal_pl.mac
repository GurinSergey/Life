import rsbdataset, globals, ptinter, ActX;

 var ó®·´Æã®·‚Æ¢=3,      
      File_Name="";

 var äÆ§_üÁ•©™®="";
 var çÆ¨•‡_ë‚‡Æ™®  = 2,  /*· ™Æ‚Æ‡Æ© ≠†Á®≠†•‚·Ô ß†ØÆ´≠•≠®• §†≠≠ÎÂ*/
     ´®·‚ = 1;


MACRO Å•ß≠†´®Á≠Î•è´†‚•¶®(start, endd, sum)
var rs, str, str2, cnt=0;
var newcode, oldcode, isfirst = true, summ=$0;
 str = "SELECT   p.t_date, NVL (p.t_payername, CHR (1)) t_payername, " +
       "         NVL (p.t_payerinn, CHR (1)) t_payerinn, " +
       "         NVL (pr.t_bankcode, CHR (1)) t_bankcode, " +
       "         NVL (p.t_receivername, CHR (1)) t_receivername, " +
       "         NVL (t.t_receiveraccount, CHR (1)) t_receiveraccount, t.t_amount, " +
       "         p.t_ground, t.t_payer, t.t_receiver " +
       "    FROM dpmpaym_dbt t, dpmrmprop_dbt p, dpmprop_dbt pr " +
       "   WHERE t.t_dockind IN (320, 322) " +
       "     AND (t.t_payeraccount LIKE '407%' OR t.t_payeraccount LIKE '408%') " +
       "     AND (   t.t_receiveraccount LIKE '423%' " +
       "          OR t.t_receiveraccount LIKE '426%' " +
       "          OR t.t_receiveraccount LIKE '47422%' " +
       "          OR t.t_receiveraccount LIKE '40911%' " +       // vihrov 20.10.2010 I-073963
       "          OR t.t_receiveraccount LIKE '40817%') " +
       "     AND t_paymstatus = 32000 " +
       "     AND t.t_amount >=  " + sum+
       "     AND p.t_paymentid = t.t_paymentid " +
       "     AND pr.t_paymentid = t.t_paymentid " +
       "     AND pr.t_debetcredit = 0 " +
       "     AND pr.t_issender = 'X' " +  
       "     AND p.t_date BETWEEN TO_DATE ('"+start+"', 'dd.mm.yyyy') " +
       "                      AND TO_DATE ('"+endd+"', 'dd.mm.yyyy') " +
       "UNION ALL " +
       "SELECT   p.t_date, NVL (p.t_payername, CHR (1)) t_payername, " +
       "         NVL (p.t_payerinn, CHR (1)) t_payerinn, '044525986' t_bankcode, " +
       "         NVL (p.t_receivername, CHR (1)) t_receivername, " +
       "         NVL (t.t_receiveraccount, CHR (1)) t_receiveraccount, t.t_amount, " +
       "         p.t_ground, t.t_payer, t.t_receiver " +
       "    FROM dpmpaym_dbt t, dpmrmprop_dbt p " +
       "   WHERE t.t_dockind IN (16, 17, 27, 70, 201, 202, 450) " +
       "     AND (t.t_payeraccount LIKE '407%' OR t.t_payeraccount LIKE '408%') " +
       "     AND (   t.t_receiveraccount LIKE '423%' " +
       "          OR t.t_receiveraccount LIKE '47422%' " +
       "          OR t.t_receiveraccount LIKE '426%' " +
       "          OR t.t_receiveraccount LIKE '40911%' " +       // vihrov 20.10.2010 I-073963
       "          OR t.t_receiveraccount LIKE '40817%') " +
       "     AND t_paymstatus = 32000 " +
       "     AND t.t_amount >=  " + sum+
       "     AND p.t_paymentid = t.t_paymentid " +

       /* EVG 31/1/2014 è•‡•ÂÆ§ ≠† 2031
       "     AND t.t_receiverbankid = " + {selfid}+*/
       "     AND t.t_receiverbankid = " + {OurBank}+

       "     AND p.t_date BETWEEN TO_DATE ('"+start+"', 'dd.mm.yyyy') " +
       "                      AND TO_DATE ('"+endd+"', 'dd.mm.yyyy') " +
       "ORDER BY t_bankcode, t_payerinn, t_amount " ;
  rs = trsbdataset(str);

  if(start==endd)
     str2 = "ß† "+ start +" £.";
  elif(start==date("00.00.0000"))
     str2 =  "ß† Ø•‡®Æ§ 00.00.0000 - "+ endd +" £.";
  else
     str2 =  "ß† Ø•‡®Æ§ "+ start +" - "+ endd +" £.";
  end;


[                 Å•ß≠†´®Á≠Î• Ø´†‚•¶® ØÆ·‚„Ø®¢Ë®• ≠† ‰®ß®Á•·™®Â ´®Ê # 

 ⁄ƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
 ≥ ¸ Ø/Ø ≥    Ñ†‚†    ≥          ç†®¨•≠Æ¢†≠®•  Ø´†‚•´ÏÈ®™†           ≥        àçç  Ø´†‚•´ÏÈ®™†       ≥  Åàä °†≠™†   ≥          ç†®¨•≠Æ¢†≠®•  ØÆ´„Á†‚•´Ô            ≥  ã®Ê•¢Æ© ·Á•‚ ØÆ´„Á†‚•´Ô  ≥      ë„¨¨†      ≥                                                        ≥
 ≥       ≥            ≥                                              ≥                               ≥ Ø´†‚•´ÏÈ®™†  ≥                                              ≥                           ≥                 ≥                                                        ≥
](str2);




  while (rs and rs.movenext)
    if(isfirst == true)
       newcode = oldcode = trim(rs.t_bankcode);
       isfirst = false;
    end;
    newcode = trim(rs.t_bankcode);
    if(newcode != oldcode)
[√ƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¥
 ≥ à‚Æ£Æ ØÆ £‡„ØØ• Ø´†‚•¶•©                                                                                                                                                                    ≥ ############### ≥                                                        ≥
 √ƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¥]
  (summ);
//       äÆ§_üÁ•©™® ="A"+çÆ¨•‡_ë‚‡Æ™®; ò‡®‰‚(2,äÆ§_üÁ•©™®,"Arial Cyr","ØÆ´„¶®‡≠Î©",10); á†Ø®·Ï_ÔÁ•©™†(2,äÆ§_üÁ•©™®,"à‚Æ£Æ ØÆ £‡„ØØ• Ø´†‚•¶•©");
//       äÆ§_üÁ•©™® ="H"+çÆ¨•‡_ë‚‡Æ™®; ò‡®‰‚(2,äÆ§_üÁ•©™®,"Arial Cyr","ØÆ´„¶®‡≠Î©",10); á†Ø®·Ï_ÔÁ•©™†(2,äÆ§_üÁ•©™®,summ);
//       çÆ¨•‡_ë‚‡Æ™®=çÆ¨•‡_ë‚‡Æ™®+1;
       oldcode = newcode;
       cnt = 0;
       summ = 0;
    else
[√ƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¥];
    end;
    cnt = cnt+1;
    summ = summ + money(rs.t_amount);

[≥ ##### ≥ ########## ≥ ############################################ ≥ ############################# ≥ ############ ≥ ############################################ ≥ ######################### ≥ ############### ≥ ###################################################### ≥]
(cnt, date(rs.t_date), rs.t_payername:w,  rs.t_payerinn, rs.t_bankcode, rs.t_receivername:w, rs.t_receiveraccount, money(rs.t_amount), rs.t_ground:w);

  äÆ§_üÁ•©™® ="A"+çÆ¨•‡_ë‚‡Æ™®;  á†Ø®·Ï_ÔÁ•©™†(2,äÆ§_üÁ•©™®,cnt);
  äÆ§_üÁ•©™® ="B"+çÆ¨•‡_ë‚‡Æ™®;  á†Ø®·Ï_ÔÁ•©™†(2,äÆ§_üÁ•©™®,date(rs.t_date));
  äÆ§_üÁ•©™® ="C"+çÆ¨•‡_ë‚‡Æ™®;  á†Ø®·Ï_ÔÁ•©™†(2,äÆ§_üÁ•©™®,rs.t_payername);
  äÆ§_üÁ•©™® ="D"+çÆ¨•‡_ë‚‡Æ™®;  á†Ø®·Ï_ÔÁ•©™†(2,äÆ§_üÁ•©™®,rs.t_payerinn);
  äÆ§_üÁ•©™® ="E"+çÆ¨•‡_ë‚‡Æ™®;  á†Ø®·Ï_ÔÁ•©™†(2,äÆ§_üÁ•©™®,rs.t_bankcode);
  äÆ§_üÁ•©™® ="F"+çÆ¨•‡_ë‚‡Æ™®;  á†Ø®·Ï_ÔÁ•©™†(2,äÆ§_üÁ•©™®,rs.t_receivername);
  äÆ§_üÁ•©™® ="G"+çÆ¨•‡_ë‚‡Æ™®;  á†Ø®·Ï_ÔÁ•©™†(2,äÆ§_üÁ•©™®,rs.t_receiveraccount);
  äÆ§_üÁ•©™® ="H"+çÆ¨•‡_ë‚‡Æ™®;  á†Ø®·Ï_ÔÁ•©™†(2,äÆ§_üÁ•©™®, money(rs.t_amount));
  äÆ§_üÁ•©™® ="I"+çÆ¨•‡_ë‚‡Æ™®;  á†Ø®·Ï_ÔÁ•©™†(2,äÆ§_üÁ•©™®,rs.t_ground);

  çÆ¨•‡_ë‚‡Æ™®=çÆ¨•‡_ë‚‡Æ™®+1;

  end;


[√ƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¥
 ≥ à‚Æ£Æ ØÆ £‡„ØØ• Ø´†‚•¶•©                                                                                                                                                                    ≥ ############### ≥                                                        ≥
 ¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ]
  (summ);
//       äÆ§_üÁ•©™® ="A"+çÆ¨•‡_ë‚‡Æ™®; ò‡®‰‚(2,äÆ§_üÁ•©™®,"Arial Cyr","ØÆ´„¶®‡≠Î©",10); á†Ø®·Ï_ÔÁ•©™†(2,äÆ§_üÁ•©™®,"à‚Æ£Æ ØÆ £‡„ØØ• Ø´†‚•¶•©");
//       äÆ§_üÁ•©™® ="H"+çÆ¨•‡_ë‚‡Æ™®; ò‡®‰‚(2,äÆ§_üÁ•©™®,"Arial Cyr","ØÆ´„¶®‡≠Î©",10); á†Ø®·Ï_ÔÁ•©™†(2,äÆ§_üÁ•©™®,summ);
//       çÆ¨•‡_ë‚‡Æ™®=çÆ¨•‡_ë‚‡Æ™®+1;

end;

MACRO Å•ß≠†´®Á≠Î•è•‡•Á®·´•≠®Ô(start, endd, sum)
var rs, str, str2, cnt=0;
var newcode, oldcode, isfirst = true, summ=$0;
 str = "SELECT   p.t_date, NVL (p.t_payername, CHR (1)) t_payername, " +
       "         NVL (p.t_receiverinn, CHR (1)) t_receiverinn, " +
       "         NVL (pr.t_bankcode, CHR (1)) t_bankcode, " +
       "         NVL (p.t_receivername, CHR (1)) t_receivername, " +
       "         NVL (t.t_receiveraccount, CHR (1)) t_receiveraccount, t.t_amount, " +
       "         p.t_ground, t.t_payer, t.t_receiver " +
       "    FROM dpmpaym_dbt t, dpmrmprop_dbt p, dpmprop_dbt pr " +
       "   WHERE t.t_dockind IN (16, 17, 27, 70, 201, 202, 450) " +
       "     AND (t.t_payeraccount LIKE '407%' OR t.t_payeraccount LIKE '408%') " +
       "     AND (   t.t_receiveraccount LIKE '423%' " +
       "          OR t.t_receiveraccount LIKE '47422%' " +
       "          OR t.t_receiveraccount LIKE '40911%' " +       // vihrov 20.10.2010 I-073963
       "          OR t.t_receiveraccount LIKE '426%' " +
       "          OR t.t_receiveraccount LIKE '40817%') " +
       "     AND t_paymstatus = 32000 " +
       "     AND t.t_amount >=  " + sum+
       "     AND p.t_paymentid = t.t_paymentid " +
       "     AND pr.t_paymentid = t.t_paymentid " +
       "     AND pr.t_debetcredit = 1 " +
       "     AND pr.t_issender = chr(0) " +

       /* EVG 31/1/2014 è•‡•ÂÆ§ ≠† 2031
       "     AND t.t_receiverbankid != " + {selfid}+*/
       "     AND t.t_receiverbankid != " + {OurBank}+

       "     AND p.t_date BETWEEN TO_DATE ('"+start+"', 'dd.mm.yyyy') " +
       "                      AND TO_DATE ('"+endd+"', 'dd.mm.yyyy') " +
       "ORDER BY t_bankcode, p.t_payerinn, t.t_amount " ;

  rs = trsbdataset(str);


  if(start==endd)
     str2 = "ß† "+ start +" £.";
  elif(start==date("00.00.0000"))
     str2 =  "ß† Ø•‡®Æ§ 00.00.0000 - "+ endd +" £.";
  else
     str2 =  "ß† Ø•‡®Æ§ "+ start +" - "+ endd +" £.";
  end;



[                 Å•ß≠†´®Á≠Î• ¢≠•Ë≠®• Ø•‡•Á®·´•≠®Ô ™´®•≠‚Æ¢ ≠† ‰®ß®Á•·™®Â ´®Ê #

 ⁄ƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
 ≥ ¸ Ø/Ø ≥    Ñ†‚†    ≥          ç†®¨•≠Æ¢†≠®•  Ø´†‚•´ÏÈ®™†           ≥     äÆ§      ≥          ç†®¨•≠Æ¢†≠®•  ØÆ´„Á†‚•´Ô            ≥         àçç ØÆ´„Á†‚•´Ô        ≥  Åàä  °†≠™†  ≥      ë„¨¨†      ≥                                                        ≥
 ≥       ≥            ≥                                              ≥ Ø´†‚•´ÏÈ®™†  ≥                                              ≥                               ≥  èÆ´„Á†‚•´Ô  ≥                 ≥                                                        ≥
](str2);




  while (rs and rs.movenext)
    if(isfirst == true)
       newcode = oldcode = trim(rs.t_bankcode);
       isfirst = false;
    end;
    newcode = trim(rs.t_bankcode);
    if(newcode != oldcode)
[√ƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¥
 ≥ à‚Æ£Æ ØÆ £‡„ØØ• Ø´†‚•¶•©                                                                                                                                                       ≥ ############### ≥                                                        ≥
 √ƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¥]
  (summ);
//       äÆ§_üÁ•©™® ="A"+çÆ¨•‡_ë‚‡Æ™®; ò‡®‰‚(1,äÆ§_üÁ•©™®,"Arial Cyr","ØÆ´„¶®‡≠Î©",10); á†Ø®·Ï_ÔÁ•©™†(1,äÆ§_üÁ•©™®,"à‚Æ£Æ ØÆ £‡„ØØ• Ø´†‚•¶•©");
//       äÆ§_üÁ•©™® ="H"+çÆ¨•‡_ë‚‡Æ™®; ò‡®‰‚(1,äÆ§_üÁ•©™®,"Arial Cyr","ØÆ´„¶®‡≠Î©",10); á†Ø®·Ï_ÔÁ•©™†(1,äÆ§_üÁ•©™®,summ);
//       çÆ¨•‡_ë‚‡Æ™®=çÆ¨•‡_ë‚‡Æ™®+1;
       oldcode = newcode;
       cnt = 0;
       summ = 0;

    else
[√ƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¥];
    end;
    cnt = cnt+1;
    summ = summ + money(rs.t_amount);

[≥ ##### ≥ ########## ≥ ############################################ ≥ ############ ≥ ############################################ ≥ ############################# ≥ ############ ≥ ############### ≥ ###################################################### ≥]
(cnt, date(rs.t_date), rs.t_payername:w,  èÆ´„Á®‚ÏäÆ§ë„°Í•™‚†(rs.t_payer,1),rs.t_receivername:w, rs.receiverinn, rs.t_bankcode,  money(rs.t_amount), rs.t_ground:w);

  äÆ§_üÁ•©™® ="A"+çÆ¨•‡_ë‚‡Æ™®;  á†Ø®·Ï_ÔÁ•©™†(1,äÆ§_üÁ•©™®,cnt);
  äÆ§_üÁ•©™® ="B"+çÆ¨•‡_ë‚‡Æ™®;  á†Ø®·Ï_ÔÁ•©™†(1,äÆ§_üÁ•©™®,date(rs.t_date));
  äÆ§_üÁ•©™® ="C"+çÆ¨•‡_ë‚‡Æ™®;  á†Ø®·Ï_ÔÁ•©™†(1,äÆ§_üÁ•©™®,rs.t_payername);
  äÆ§_üÁ•©™® ="D"+çÆ¨•‡_ë‚‡Æ™®;  á†Ø®·Ï_ÔÁ•©™†(1,äÆ§_üÁ•©™®,èÆ´„Á®‚ÏäÆ§ë„°Í•™‚†(rs.t_payer,1));
  äÆ§_üÁ•©™® ="E"+çÆ¨•‡_ë‚‡Æ™®;  á†Ø®·Ï_ÔÁ•©™†(1,äÆ§_üÁ•©™®,rs.t_receivername);
  äÆ§_üÁ•©™® ="F"+çÆ¨•‡_ë‚‡Æ™®;  á†Ø®·Ï_ÔÁ•©™†(1,äÆ§_üÁ•©™®,rs.receiverinn);
  äÆ§_üÁ•©™® ="G"+çÆ¨•‡_ë‚‡Æ™®;  á†Ø®·Ï_ÔÁ•©™†(1,äÆ§_üÁ•©™®, rs.t_bankcode);
  äÆ§_üÁ•©™® ="H"+çÆ¨•‡_ë‚‡Æ™®;  á†Ø®·Ï_ÔÁ•©™†(1,äÆ§_üÁ•©™®, money(rs.t_amount));
  äÆ§_üÁ•©™® ="I"+çÆ¨•‡_ë‚‡Æ™®;  á†Ø®·Ï_ÔÁ•©™†(1,äÆ§_üÁ•©™®,rs.t_ground);

  çÆ¨•‡_ë‚‡Æ™®=çÆ¨•‡_ë‚‡Æ™®+1;
end;


[√ƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¥
 ≥ à‚Æ£Æ ØÆ £‡„ØØ• Ø´†‚•¶•©                                                                                                                                                       ≥ ############### ≥                                                        ≥
 ¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ]
  (summ);
//       äÆ§_üÁ•©™® ="A"+çÆ¨•‡_ë‚‡Æ™®; ò‡®‰‚(1,äÆ§_üÁ•©™®,"Arial Cyr","ØÆ´„¶®‡≠Î©",10); á†Ø®·Ï_ÔÁ•©™†(1,äÆ§_üÁ•©™®,"à‚Æ£Æ ØÆ £‡„ØØ• Ø´†‚•¶•©");
//       äÆ§_üÁ•©™® ="H"+çÆ¨•‡_ë‚‡Æ™®; ò‡®‰‚(1,äÆ§_üÁ•©™®,"Arial Cyr","ØÆ´„¶®‡≠Î©",10); á†Ø®·Ï_ÔÁ•©™†(1,äÆ§_üÁ•©™®,summ);
//       çÆ¨•‡_ë‚‡Æ™®=çÆ¨•‡_ë‚‡Æ™®+1;

end;


MACRO Å•ß≠†´®Á≠Î•èÆàçç(startd, endd, summ_, inn_)
//           msgbox("èÆ àçç");
//           msgbox(startd + " " + endd + " " + summ_ + " " + inn_);


var     str_ = "        SELECT p.t_date, " + 
                "       t.t_payer, " + 
                "             NVL (p.t_payername, CHR (1)) t_payername, " + 
                "             NVL (pr.t_bankcode, CHR (1)) t_bankcode, " + 
                "             CASE " + 
                "                WHEN INSTR (NVL (p.t_payerinn, CHR (1)), '/', 1) != 0 " + 
                "                THEN " + 
                "                   SUBSTR (NVL (p.t_payerinn, CHR (1)), " + 
                "                           1, " + 
                "                           INSTR (NVL (p.t_payerinn, CHR (1)), '/', 1) - 1 " + 
                "                   ) " + 
                "                ELSE " + 
                "                   NVL (p.t_payerinn, CHR (1)) " + 
                "             END " + 
                "             t_payerinn, " + 
                "             CASE " + 
                "               WHEN INSTR (NVL (p.t_receiverinn, CHR (1)), '/', 1) = 11 " + 
                "               THEN " + 
                "                       SUBSTR (NVL (p.t_receiverinn, CHR (1)), 1, 10) " + 
                "             ELSE " + 
                "              NVL (p.t_receiverinn, CHR (1)) " + 
                "             END " + 
                "               t_receiverinn, " + 
                "             NVL (p.t_receivername, CHR (1)) t_receivername, " + 
                "             NVL (t.t_receiveraccount, CHR (1)) t_receiveraccount, " + 
                "             t.t_amount, " + 
                "             p.t_ground, " + 
                "             t.t_payer, " + 
                "             t.t_receiver " + 
                "      FROM dpmpaym_dbt t, dpmrmprop_dbt p, dpmprop_dbt pr " + 
                "      WHERE t.t_dockind IN (16, 17, 27, 70, 201, 202, 450) " + 
                "            AND t_paymstatus = 32000 " + 
                "            AND t.t_amount >= " + summ_ +
                "            AND p.t_receiverinn like '"+inn_+"%' " + 
                "            AND p.t_paymentid = t.t_paymentid " + 
                "            AND pr.t_paymentid = t.t_paymentid " + 
                "            AND pr.t_debetcredit = 1 " + 
                "            AND pr.t_issender = CHR (0) " + 
                "            AND t.t_receiverbankid != 28323  " + 
                "            AND p.t_date BETWEEN TO_DATE ('" + startd + "', 'dd.mm.yyyy') " + 
                "                             AND  TO_DATE ('" + endd + "', 'dd.mm.yyyy') " + 
                "      ORDER BY t.t_payer, t_bankcode, t.t_amount";
         
var     rs = trsbdataset(str_);
var     cnt = 1;
                                                                        
       ob.Cells(1,1).Value      = "¸ Ø/Ø";
       ob.Cells(1,2).Value      = "Ñ†‚†";
       ob.Cells(1,3).Value      = "ç†®¨•≠Æ¢†≠®• Ø´†‚•´ÏÈ®™†";
       ob.Cells(1,4).Value      = "àçç Ø´†‚•´ÏÈ®™†";
       ob.Cells(1,5).Value      = "Åàä °†≠™† Ø´†‚•´ÏÈ®™†";
       ob.Cells(1,6).Value      = "àçç ØÆ´„Á†‚•´Ô";
       ob.Cells(1,7).Value      = "ç†®¨•≠Æ¢†≠®• ØÆ´„Á†‚•´Ô";
       ob.Cells(1,8).Value      = "ã®Ê•¢Æ© ·Á•‚ ØÆ´„Á†‚•´Ô";
       ob.Cells(1,9).Value      = "ë„¨¨†";
       ob.Cells(1,10).Value     = "é·≠Æ¢†≠®•";
       ob.Rows("1:1").Select;
        ob.Range("D1").Activate;
        ob.Selection.Font.Bold = True;
        ob.Columns("D:D").Select;
        ob.Selection.NumberFormat = "@";
        ob.Columns("H:H").Select;
        ob.Selection.NumberFormat = "@";
        ob.Columns("I:I").Select;
        ob.Selection.NumberFormat = "# ##0,00";
        ob.Cells.Select;
        ob.Selection.Font.Size = 8;
        
        çÆ¨•‡_ë‚‡Æ™® = 2;
        var gsumm = $0;
        var previd = -1;

[                 Å•ß≠†´®Á≠Î• ¢≠•Ë≠®• Ø•‡•Á®·´•≠®Ô ™´®•≠‚Æ¢ ØÆ àçç ØÆ´„Á†‚•´Ô

 ⁄ƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
 ≥ ¸ Ø/Ø ≥    Ñ†‚†    ≥             ç†®¨•≠Æ¢†≠®•  Ø´†‚•´ÏÈ®™†              ≥       àçç       ≥       Åàä °†≠™†         ≥ àçç ØÆ´„Á†‚•´Ô  ≥               ç†®¨•≠Æ¢†≠®• ØÆ´„Á†‚•´Ô              ≥      ãë èÆ´„Á†‚•´Ô        ≥        ë„¨¨†            ≥                  é·≠Æ¢†≠®•                           ≥
 ≥       ≥            ≥                                                    ≥   Ø´†‚•´ÏÈ®™†   ≥                         ≥                 ≥                                                    ≥                           ≥                         ≥                                                             ≥
];



        while (rs and rs.movenext)
                if ((previd ==  rs.t_payer) OR (previd == -1))
                        previd = rs.t_payer;
                ob.Cells(çÆ¨•‡_ë‚‡Æ™®, 1).Value = cnt;          
                ob.Cells(çÆ¨•‡_ë‚‡Æ™®, 2).Value = date(rs.t_date);
                ob.Cells(çÆ¨•‡_ë‚‡Æ™®, 3).Value = rs.t_payername;
                ob.Cells(çÆ¨•‡_ë‚‡Æ™®, 4).Value = rs.t_payerinn;
                ob.Cells(çÆ¨•‡_ë‚‡Æ™®, 5).Value = rs.t_bankcode;
                ob.Cells(çÆ¨•‡_ë‚‡Æ™®, 6).Value = rs.t_receiverinn;
                ob.Cells(çÆ¨•‡_ë‚‡Æ™®, 7).Value = rs.t_receivername;
                ob.Cells(çÆ¨•‡_ë‚‡Æ™®, 8).Value = rs.t_receiveraccount;
                ob.Cells(çÆ¨•‡_ë‚‡Æ™®, 9).Value = money(rs.t_amount);
                ob.Cells(çÆ¨•‡_ë‚‡Æ™®, 10).Value        = rs.t_ground;
                        gsumm = gsumm + money(rs.t_amount);
[√ƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¥];

[≥ ##### ≥ ########## ≥ ################################################## ≥ ############### ≥ ####################### ≥ ############### ≥ ################################################## ≥ ######################### ≥ ##################### ≥ ###################################################### ≥]
        (cnt, date(rs.t_date), rs.t_payername:w, rs.t_payerinn, rs.t_bankcode, rs.t_receiverinn, rs.t_receivername:w, rs.t_receiveraccount, money(rs.t_amount), rs.t_ground:w);


                 else
                        if (gsumm == 0)
                                gsumm =  money(rs.t_amount);
//                      else
//                              gsumm = gsumm + money(rs.t_amount);
                        end; 
//                      çÆ¨•‡_ë‚‡Æ™® = çÆ¨•‡_ë‚‡Æ™® + 1;
                        ob.Cells(çÆ¨•‡_ë‚‡Æ™®, 1).Value = "à‚Æ£Æ:";             
                ob.Cells(çÆ¨•‡_ë‚‡Æ™®, 2).Value = gsumm;

[√ƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¥];
[≥ àíéÉé:                                                                                                                                                                                       ######################### ≥                                                                                ≥]
        (gsumm);
[√ƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¥];

                        ob.Rows(çÆ¨•‡_ë‚‡Æ™®+":"+çÆ¨•‡_ë‚‡Æ™®).Select;
                        ob.Selection.Interior.ColorIndex = 6;
                        çÆ¨•‡_ë‚‡Æ™® = çÆ¨•‡_ë‚‡Æ™® + 1;
                ob.Cells(çÆ¨•‡_ë‚‡Æ™®, 1).Value = cnt;          
                ob.Cells(çÆ¨•‡_ë‚‡Æ™®, 2).Value = date(rs.t_date);
                ob.Cells(çÆ¨•‡_ë‚‡Æ™®, 3).Value = rs.t_payername;
                ob.Cells(çÆ¨•‡_ë‚‡Æ™®, 4).Value = rs.t_payerinn;
                ob.Cells(çÆ¨•‡_ë‚‡Æ™®, 5).Value = rs.t_bankcode;
                ob.Cells(çÆ¨•‡_ë‚‡Æ™®, 6).Value = rs.t_receiverinn;
                ob.Cells(çÆ¨•‡_ë‚‡Æ™®, 7).Value = rs.t_receivername;
                ob.Cells(çÆ¨•‡_ë‚‡Æ™®, 8).Value = rs.t_receiveraccount;
                ob.Cells(çÆ¨•‡_ë‚‡Æ™®, 9).Value = money(rs.t_amount);
                ob.Cells(çÆ¨•‡_ë‚‡Æ™®, 10).Value        = rs.t_ground;
                       gsumm = money(rs.t_amount);
                        previd = rs.t_payer;
[≥ ##### ≥ ########## ≥ ################################################## ≥ ############### ≥ ####################### ≥ ############### ≥ ################################################## ≥ ######################### ≥ ##################### ≥ ###################################################### ≥]
        (cnt, date(rs.t_date), rs.t_payername:w, rs.t_payerinn, rs.t_bankcode, rs.t_receiverinn, rs.t_receivername:w, rs.t_receiveraccount, money(rs.t_amount), rs.t_ground:w);
[√ƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ≈ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¥];

                 end; 
                çÆ¨•‡_ë‚‡Æ™® = çÆ¨•‡_ë‚‡Æ™® + 1;
                cnt = cnt + 1;          
        end;
                        ob.Cells(çÆ¨•‡_ë‚‡Æ™®, 1).Value = "à‚Æ£Æ:";             
                ob.Cells(çÆ¨•‡_ë‚‡Æ™®, 2).Value = gsumm;
                        ob.Rows(çÆ¨•‡_ë‚‡Æ™®+":"+çÆ¨•‡_ë‚‡Æ™®).Select;
                        ob.Selection.Interior.ColorIndex = 6;
[√ƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¥];
[≥ àíéÉé:                                                                                                                                                                                       ######################### ≥                                                                                ≥]
        (gsumm);
[¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¡ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ];
                        çÆ¨•‡_ë‚‡Æ™® = çÆ¨•‡_ë‚‡Æ™® + 1;

             



             ob.Columns("A:J").EntireColumn.AutoFit;

end;


array m_menu;
      m_menu(0)="Å•ß≠†´®Á≠Î• Ø´†‚•¶® ØÆ·‚„Ø®¢Ë®• ≠† ‰®ß®Á•·™®Â ´®Ê";
      m_menu(1)="Å•ß≠†´®Á≠Î• ¢≠•Ë≠®• Ø•‡•Á®·´•≠®Ô ™´®•≠‚Æ¢ ≠† ‰®ß®Á•·™®Â ´®Ê";
      m_menu(2)="Å•ß≠†´®Á≠Î• ¢≠•Ë≠®• Ø•‡•Á®·´•≠®Ô ™´®•≠‚Æ¢ ØÆ àçç ØÆ´„Á†‚•´Ô";




 var startdate, enddate, promt, summ=$50000, inn="7724261610";
  startDate = {curdate} - 1;

     é‚™‡Î‚®•í†°´®ÊÎ_ä≠®£®("fm_beznal_pl.xls");
     à≠®Ê®†´®ß†Ê®Ôã®·‚Æ¢(ó®·´Æã®·‚Æ¢);


promt = menu(m_menu, "ä†™Æ© Æ‚Á•‚ ¢ÎØ„·™†•¨?","ä†™Æ© Æ‚Á•‚ ¢ÎØ„·™†•¨?",null,null);
   if (promt < 0)
      exit(1);
   
   elif ((promt == 0) or (promt == 1))
 
        getmoney(summ,"å®≠®¨†´Ï≠†Ô ·„¨¨†");
        
        if ( not GetDate( startDate, "Ç¢•§®‚• ≠†Á†´Ï≠„Ó §†‚„ Æ‚Á•‚† :" ) )
                exit(1);
        else
                if (startDate >= {curdate})
                        msgbox("á≠†Á•≠®• §†‚Î "+string(startDate)+" ¢¢•§•≠Æ ≠•¢•‡≠Æ !!!");
                        exit(1);
                end;
        
                if(startdate == date(0,0,0))
                startdate = "01.01.0001";
                end;
        end;
        
        endDate = startDate;
        if ( not GetDate( endDate, "Ç¢•§®‚• ™Æ≠•Á≠„Ó §†‚„ Æ‚Á•‚† :" ) )
                exit(1);
        else
                if (startDate > endDate)
                msgbox("á≠†Á•≠®• §†‚Î "+string(endDate)+" ¢¢•§•≠Æ ≠•¢•‡≠Æ !!!");
                exit(1);
                end;
        end;
   elif (promt == 2)
       getmoney(summ,"å®≠®¨†´Ï≠†Ô ·„¨¨†");
        getstring(inn, "àçç");
        
                
        if ( not GetDate( startDate, "Ç¢•§®‚• ≠†Á†´Ï≠„Ó §†‚„ Æ‚Á•‚† :" ) )
                exit(1);
        else
                if (startDate >= {curdate})
                        msgbox("á≠†Á•≠®• §†‚Î "+string(startDate)+" ¢¢•§•≠Æ ≠•¢•‡≠Æ !!!");
                        exit(1);
                end;
        
                if(startdate == date(0,0,0))
                startdate = "01.01.0001";
                end;
        end;
        
        endDate = startDate;
        if ( not GetDate( endDate, "Ç¢•§®‚• ™Æ≠•Á≠„Ó §†‚„ Æ‚Á•‚† :" ) )
                exit(1);
        else
                if (startDate > endDate)
                msgbox("á≠†Á•≠®• §†‚Î "+string(endDate)+" ¢¢•§•≠Æ ≠•¢•‡≠Æ !!!");
                exit(1);
                end;
        end;

  end;
    
  if (promt == 0)
     ws(2).Activate;/*¨Æ¶≠Æ Ø®·†‚Ï ¢ Ì‚Æ‚ ´®·‚*/
     ob.Visible=false;

     Å•ß≠†´®Á≠Î•è´†‚•¶®(startdate, enddate, summ);
  elif (promt == 1)
     ws(1).Activate;/*¨Æ¶≠Æ Ø®·†‚Ï ¢ Ì‚Æ‚ ´®·‚*/
     ob.Visible=false;

     Å•ß≠†´®Á≠Î•è•‡•Á®·´•≠®Ô(startdate, enddate, summ);
  elif (promt == 2)
     ws(3).Activate;/*¨Æ¶≠Æ Ø®·†‚Ï ¢ Ì‚Æ‚ ´®·‚*/
     ob.Visible=false;

     Å•ß≠†´®Á≠Î•èÆàçç(startdate, enddate, summ, inn);
  end;
  
  msgbox("Ç·•! í•Ø•‡Ï ¨Æ¶•‚• Ø‡Æ·¨Æ‚‡•‚Ï ØÆ´„Á•≠≠Î© Æ‚Á•‚ ¢ EXCEL","| ç†¶¨®‚• ESC");
  ob.Visible=true;
 // exit(1);