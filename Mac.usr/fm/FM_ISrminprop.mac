import globals, RSD;

var sdate = {curdate}, edate = {curdate};
if (not GetDate(sdate, "Дата начала периода"))
  println("Отменено пользователем");
  exit;
end;
if (not GetDate(edate, "Дата конца периода"))
  println("Отменено пользователем");
  exit;
end;

var sqltext = "SELECT CONTR.T_OPERATIONID, CONTR.T_DATE, CONTR.T_SUMRUB, CONTR.T_SUMCUR, CONTR.T_GROUND " 
              +"\n FROM drminprop_dbt prop, dopcontr_dbt contr " 
              +"\n WHERE CONTR.T_DOCUMENTID = PROP.T_PAYMENTID AND CONTR.T_DOCKIND <> 1 " 
              +"\n   AND CONTR.T_DATEREVEAL BETWEEN TO_DATE ('"+sdate+"', 'dd.mm.yyyy') " 
              +"\n                              AND TO_DATE ('"+edate+"', 'dd.mm.yyyy') " 
              +"\n Order by CONTR.T_DATE ";
                                                                               
var rsdrecord =  RsdRecordSet(sqltext);

if (rsdrecord)
  [
                       Операции ФМ по платежам на невыясненных
                       Период: ############ - ############

   ┌──────────────┬─────────────────┬─────────────────┬────────────────────┬───────────────────────────────────────────┐
   │ ID операции  │      Дата       │ Сумма в рублях  │ Сумма в ин. валюте │            Основание платежа              │
   ├──────────────┼─────────────────┼─────────────────┼────────────────────┼───────────────────────────────────────────┤
  ] (date(sdate), date(edate));


  while (rsdrecord.MoveNext())
   [│ ############ │ ############### │ ############### │ ################## │ ######################################### │
    ├──────────────┼─────────────────┼─────────────────┼────────────────────┼───────────────────────────────────────────┤
   ](rsdrecord.value(0), date(rsdrecord.value(1)), rsdrecord.value(2), rsdrecord.value(3), rsdrecord.value(4):w);
  end;
end;

