/*+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   
   ████████           █████      █             ███                   █████               ████   █    ███                 ███
   ███   ███        ███  ███   ███             ███                 ███  ███             ███   ███    ███                 ███
   ████████         ██████    ██████  ██   ██  ███   ██████        ██████      ██████  █████ ██████  ███       ████████  ███████
   ███  ███   █████    █████   ███    ███ ███  ███  ████████          █████   ███  ███  ███   ███    ███          █████  ███  ███
   ███   ███        ███  ███   ███     █████   ███  ███            ███  ███   ███  ███  ███   ███    ███       ███  ███  ███  ███
   ███    ███         ████      ████    ███    ███    █████          ████       ████    ███    ████  ███████    ███ ███  ███ ██
                                     █████

   Гуцу Е.В.

   Имя файла: fg_Life_parm.mac

   Создан:    08.07.2010

   Описание:  Функции для работы с банками ФГ Лайф

   ChangeLog:
-----------------------------------------------------------------------------------------------------------------------------------------------------
   //RR 30.10.2013 Добавил новое свойство класса BankShortName, в него будет записыватся короткое наименование банка
   //KS 12.05.2014 Добавил всё, что касается Солидарности. Ниже комменты не пишу - можно понять, где я делал правки по подстроке SLD
-----------------------------------------------------------------------------------------------------------------------------------------------------
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/

import PTInter, CTInter, "cb_sql.mac";


// Бики банков группы

/* EVG Добавил private - если будет неопределённый идентификатор, пишите. */
private
//    ПРББ, ВУЗ и НБС                     Экспресс-волга и филиалы                      Газэнергобанк и филиалы
CONST BIC_PRBB = "044525986",             BIC_EXV            = "046311808",             BIC_GEB           = "042908701",
                                          BIC_EXV_fVolgograd = "041806835",             BIC_GEB_fLudinovo = "", // Пока не нашел
      BIC_VUZ  = "046577781",             BIC_EXV_fAngeles   = "046375825", 
                                          BIC_EXV_fVoronez   = "042007755",
      BIC_NBS  = "042406718",             BIC_EXV_fUlianovsk = "047308902",             BIC_GO            = "044525732",
                                          BIC_EXV_Stavropol  = "040702756",
      BIC_SLD  = "043601706";

private const  PRBB_SHORT_NAME = "ПРББ",    EXV_SHORT_NAME            = "ЭВ Саратов",  
               GEB_SHORT_NAME  = "ГЭБ",     EXV_fVolgograd_SHORT_NAME = "ЭВ Волгоград",  
               VUZ_SHORT_NAME  = "ВУЗ",     EXV_fAngeles_SHORT_NAME   = "ЭВ Энгельс", 
               GO_SHORT_NAME   = "Пойдем",  EXV_fVoronez_SHORT_NAME   = "ЭВ Воронеж",
               NBS_SHORT_NAME  = "НБС",     EXV_fUlianovsk_SHORT_NAME = "ЭВ Ульяновск",   
                                            EXV_Stavropol_SHORT_NAME  = "ЭВ Ставрополь",
               SLD_SHORT_NAME  = "Солидарность";

// Массивы банков группы
VAR arPRBB = TArray(),
    arVUZ  = TArray(),
    arEXV  = TArray(),
    arGEB  = TArray(),
    arNBS  = TArray(),
    arGO   = TArray(),
    arSLD  = TArray();


    arPRBB(0) = BIC_PRBB;                 arEXV(0) = BIC_EXV;                           arGEB(0) = BIC_GEB;
                                          arEXV(1) = BIC_EXV_fVolgograd;                arGEB(1) = BIC_GEB_fLudinovo;
    arVUZ(0)  = BIC_VUZ;                  arEXV(2) = BIC_EXV_fAngeles;
                                          arEXV(3) = BIC_EXV_fVoronez;
    arNBS(0)  = BIC_NBS;                  arEXV(4) = BIC_EXV_fUlianovsk;                arGO(0)  = BIC_GO;
                                          arEXV(5) = BIC_EXV_Stavropol;
    arSLD(0)  = BIC_SLD;

CLASS fg_life_subject( PartyID )


   // Служебные
   private var Error;

   //var Party:object;
   var BankBic:string;

   var BankShortName:string;

   var is_PRBB:bool 			= false,
       is_VUZ:bool  			= false,
       is_EXV:bool  			= false,
       is_GEB:bool  			= false,
       is_NBS:bool  			= false,
       is_GO:bool   			= false,
       is_EXV_Volgograd:bool	        = false,
       is_EXV_Voronezh:bool	        = false,
       is_EXV_Ulyanovsk:bool	        = false,
       is_EXV_Stavropol:bool	        = false,
       is_SLD:bool                      = false;

   // Внутренний метод, определяющий банк группы
   private macro DefineFgBank()
      var n;

      // ПРББ
      n = 0;
      while ( n < arPRBB.Size )
         if ( arPRBB(n) == BankBic )
            is_PRBB = true;
            BankShortName = PRBB_SHORT_NAME;
            return;
         end;
         n = n + 1;
      end;
      
      // ВУЗ
      n = 0;
      while ( n < arVUZ.Size )
         if ( arVUZ(n) == BankBic )
            is_VUZ = true;
            BankShortName = VUZ_SHORT_NAME;
            return;
         end;
         n = n + 1;
      end;

      // ГЭБ
      n = 0;
      while ( n < arGEB.Size )
         if ( arGEB(n) == BankBic )
            is_GEB = true;
            BankShortName = GEB_SHORT_NAME;
            return;
         end;
         n = n + 1;
      end;

      // Экспресс-Волга
      n = 0;
      while ( n < arEXV.Size )
         if ( arEXV(n) == BankBic )
            is_EXV = true;
            BankShortName = EXV_SHORT_NAME;
            if (arEXV(n) == BIC_EXV_fVolgograd)
            	is_EXV_Volgograd = true;
               BankShortName = EXV_fVolgograd_SHORT_NAME;
            elif(arEXV(n) == BIC_EXV_fVoronez)
            	is_EXV_Voronezh = true;
               BankShortName = EXV_fVoronez_SHORT_NAME;
            elif(arEXV(n) == BIC_EXV_fUlianovsk)
            	is_EXV_Ulyanovsk = true;
               BankShortName = EXV_fUlianovsk_SHORT_NAME;
            elif(arEXV(n) == BIC_EXV_Stavropol)
            	is_EXV_Stavropol = true;
               BankShortName = EXV_Stavropol_SHORT_NAME;
            else
            end;
            return;
         end;
         n = n + 1;
      end;
   
      // НБС
      n = 0;
      while ( n < arNBS.Size )
         if ( arNBS(n) == BankBic )
            is_NBS = true;
            BankShortName = NBS_SHORT_NAME;
            return;
         end;
         n = n + 1;
      end;
   
      // Пойдём
      n = 0;
      while ( n < arGO.Size )
         if ( arGO(n) == BankBic )
            is_GO = true;
            BankShortName = GO_SHORT_NAME;
            return;
         end;
         n = n + 1;
      end;

      // Солидарность
      n = 0;
      while ( n < arSLD.Size )
         if ( arSLD(n) == BankBic )
            is_SLD = true;
            BankShortName = SLD_SHORT_NAME;
            return;
         end;
         n = n + 1;
      end;

   end;


   // Инициализация класса по БИКу
   macro ConsrtuctByBic( bic )

      var query, cmd, rs;

      if ( ValType( bic ) != V_UNDEF )
         BankBic = bic;
         DefineFgBank();

         /* EVG К сожалению, инициализировать объект класса RSBParty() здесь нельзя, т.к.
            из-за этого возникают проблемы в контексте шагов операции.
         query = " Select code.t_ObjectID from dObjCode_dbt code " +
                 "  Where code.t_ObjectType = ? " +
                 "    and code.t_CodeKind   = ? " +
                 "    and code.t_State      = 0 " +
                 "    and code.t_Code       = ? " ;

         cmd = RsdCommand( query );
         cmd.AddParam("", RSDBP_IN, OBJTYPE_PARTY);
         cmd.AddParam("", RSDBP_IN, PTCK_BIC);
         cmd.AddParam("", RSDBP_IN, bic);
         rs = RsdRecordSet( cmd );
         if ( rs and rs.MoveNext() )
            Party = RSBParty( rs.Value(0) );
         end;*/
      else
         msgbox ( "Ошибка! При вызове конструктора класса " + GenClassName(this) + " по БИКу нужно|" +
                  "передавать его (БИК) в качестве параметра.|" +
                  "Пример: obj.ConsrtuctByBic(\"044525986\")" );
      end;

   end;


   // Конструктор
   if ( ValType( PartyID ) != V_UNDEF )
      
      /* EVG К сожалению, инициализировать объект класса RSBParty() здесь нельзя, т.к.
         из-за этого возникают проблемы в контексте шагов операции.
      Party = RSBParty( PartyID );
      BankBic = Party.Code(PTCK_BIC);*/

      BankBic = ПолучитьКодСубъекта( PartyID, PTCK_BIC, Error );
      if ( Error == 0 )
         DefineFgBank();
      else
         msgbox( "Ошибка! Не определён БИК субъекта с ID = " + PartyID );
      end;

   end;


END;
















