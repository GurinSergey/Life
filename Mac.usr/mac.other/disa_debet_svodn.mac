/************************************************************************/
/*          Автоматизированная банковская система RS-Bank v6.0          */
/*                                                                      */
/*               Copyright (c) R-Style Vologda                          */
/*                                                                      */
/*  Имя файла        :                                                  */
/*                                                                      */
/*  Описание         : макрос отчета "Дебиторская задолженность по 474, 603, 459 счетам "      */
/*                                                                      */
/*  Программист      : Вихров Д.В.                                      */
/*                                                                      */
/*  Создан           : 05.11.2009                                       */
/*                                                                      */
/*  Изменен:         : Gurin S. 05.02.2013                              */
/*                   : 30.04.2014 DPN Адаптация под 31                  */
/************************************************************************/

import globals, oralib,bankinter,rsbdataset, RsbDataSet;
import frontcommon;

macro output_ot4et(dlgm,ds,oconn,wsego,begin_vremya)
	var endtime;
	var pereras4et:bool=false;
	var exel47423dop:integer=2;
	var exelbignorma:integer=2;
	var exel60323hz:integer=2;
	var exel47423str=2,exel47427str=2,exel60323str=2,exel459str=2;
	var ob,ex,obBook,obSheet;
	var out, output = "deb474-459.xlsm", fulloutput;
	var temp3,temp4;
	var wsego_obrabotano_clientov;
	var risk_temp:integer,risk:integer,norma:double,norma_big:bool=false,norma_from_front_null:bool=true;
  var date_ot4 = dlgm.rec.date_name_field;
  var dd1:string=substr(string(date_ot4),1,6)+substr(string(date_ot4),9,2);
  var is_1_streb_47423=0,kk_1_1_47423=0,kk_1_2_47423=0,kk_1_3_47423=0,kk_1_4_47423=0,kk_1_5_47423=0;
  var is_2_streb_47423=0,kk_2_1_47423=0,kk_2_2_47423=0,kk_2_3_47423=0,kk_2_4_47423=0,kk_2_5_47423=0;
  var pz_1_30_47423=0,pz_1_90_47423=0,pz_1_180_47423=0,pz_1_b180_47423=0;
  var pz_2_30_47423=0,pz_2_90_47423=0,pz_2_180_47423=0,pz_2_b180_47423=0;
  var fr_1_it_47423=0,fr_1_2_47423=0,fr_1_3_47423=0,fr_1_4_47423=0,fr_1_5_47423=0;
  var fr_2_it_47423=0,fr_2_2_47423=0,fr_2_3_47423=0,fr_2_4_47423=0,fr_2_5_47423=0;
	var os_1_st_47423=0,os_1_sr_47423=0,os_11_st_47423=0,os_11_sr_47423=0,os_12_st_47423=0,os_12_sr_47423=0,os_13_st_47423=0,os_13_sr_47423=0,os_14_st_47423=0,os_14_sr_47423=0,os_15_st_47423=0,os_15_sr_47423=0;
	var os_2_st_47423=0,os_2_sr_47423=0,os_21_st_47423=0,os_21_sr_47423=0;

  var is_1_streb_459=0,kk_1_1_459=0,kk_1_2_459=0,kk_1_3_459=0,kk_1_4_459=0,kk_1_5_459=0;
  var is_2_streb_459=0,kk_2_1_459=0,kk_2_2_459=0,kk_2_3_459=0,kk_2_4_459=0,kk_2_5_459=0;
  var pz_1_30_459=0,pz_1_90_459=0,pz_1_180_459=0,pz_1_b180_459=0;
  var pz_2_30_459=0,pz_2_90_459=0,pz_2_180_459=0,pz_2_b180_459=0;
  var fr_1_it_459=0,fr_1_2_459=0,fr_1_3_459=0,fr_1_4_459=0,fr_1_5_459=0;
  var fr_2_it_459=0,fr_2_2_459=0,fr_2_3_459=0,fr_2_4_459=0,fr_2_5_459=0;
	var os_1_st_459=0,os_1_sr_459=0,os_11_st_459=0,os_11_sr_459=0,os_12_st_459=0,os_12_sr_459=0,os_13_st_459=0,os_13_sr_459=0,os_14_st_459=0,os_14_sr_459=0,os_15_st_459=0,os_15_sr_459=0;
	var os_2_st_459=0,os_2_sr_459=0,os_21_st_459=0,os_21_sr_459=0;

  var is_1_streb_47427=0,kk_1_1_47427=0,kk_1_2_47427=0,kk_1_3_47427=0,kk_1_4_47427=0,kk_1_5_47427=0;
  var is_2_streb_47427=0,kk_2_1_47427=0,kk_2_2_47427=0,kk_2_3_47427=0,kk_2_4_47427=0,kk_2_5_47427=0;
  var pz_1_30_47427=0,pz_1_90_47427=0,pz_1_180_47427=0,pz_1_b180_47427=0;
  var pz_2_30_47427=0,pz_2_90_47427=0,pz_2_180_47427=0,pz_2_b180_47427=0;
  var fr_1_it_47427=0,fr_1_2_47427=0,fr_1_3_47427=0,fr_1_4_47427=0,fr_1_5_47427=0;
  var fr_2_it_47427=0,fr_2_2_47427=0,fr_2_3_47427=0,fr_2_4_47427=0,fr_2_5_47427=0;
	var os_1_st_47427=0,os_1_sr_47427=0,os_11_st_47427=0,os_11_sr_47427=0,os_12_st_47427=0,os_12_sr_47427=0,os_13_st_47427=0,os_13_sr_47427=0,os_14_st_47427=0,os_14_sr_47427=0,os_15_st_47427=0,os_15_sr_47427=0;
	var os_2_st_47427=0,os_2_sr_47427=0,os_21_st_47427=0,os_21_sr_47427=0;

  var is_1_streb_60323:double=0,kk_1_1_60323=0,kk_1_2_60323=0,kk_1_3_60323=0,kk_1_4_60323=0,kk_1_5_60323=0;
  var is_2_streb_60323=0,kk_2_1_60323=0,kk_2_2_60323=0,kk_2_3_60323=0,kk_2_4_60323=0,kk_2_5_60323=0;
  var pz_1_30_60323=0,pz_1_90_60323=0,pz_1_180_60323=0,pz_1_b180_60323=0;
  var pz_2_30_60323=0,pz_2_90_60323=0,pz_2_180_60323=0,pz_2_b180_60323=0;
  var fr_1_it_60323=0,fr_1_2_60323=0,fr_1_3_60323=0,fr_1_4_60323=0,fr_1_5_60323=0;
  var fr_2_it_60323=0,fr_2_2_60323=0,fr_2_3_60323=0,fr_2_4_60323=0,fr_2_5_60323=0;
	var os_1_st_60323=0,os_1_sr_60323=0,os_11_st_60323=0,os_11_sr_60323=0,os_12_st_60323=0,os_12_sr_60323=0,os_13_st_60323=0,os_13_sr_60323=0,os_14_st_60323=0,os_14_sr_60323=0,os_15_st_60323=0,os_15_sr_60323=0;
	var os_2_st_60323=0,os_2_sr_60323=0,os_21_st_60323=0,os_21_sr_60323=0;

	var mc4_z60323proz=Tarray,mc4_z60323pro4=Tarray,mc4_r60323proz=Tarray,mc4_r60323pro4=Tarray;
	var mre_z60323proz=Tarray,mre_z60323pro4=Tarray,mre_r60323proz=Tarray,mre_r60323pro4=Tarray;
	var mpr_z60323proz=Tarray,mpr_z60323pro4=Tarray,mpr_r60323proz=Tarray,mpr_r60323pro4=Tarray;
	var mc4_z459proz=Tarray,mc4_r459proz=Tarray;
	var mre_z459proz=Tarray,mre_r459proz=Tarray;
	var mpr_z459proz=Tarray,mpr_r459proz=Tarray;
	var mc4_z47427proz=Tarray,mc4_r47427proz=Tarray;
	var mre_z47427proz=Tarray,mre_r47427proz=Tarray;
	var mpr_z47427proz=Tarray,mpr_r47427proz=Tarray;

	var mc4_z47423proz=Tarray,mc4_z47423pro4RKO=Tarray,mc4_z47423pro4neRKO=Tarray;
	var mre_z47423proz=Tarray,mre_z47423pro4RKO=Tarray,mre_z47423pro4neRKO=Tarray;
	var mpr_z47423proz=Tarray,mpr_z47423pro4RKO=Tarray,mpr_z47423pro4neRKO=Tarray;
	var mc4_r47423proz=Tarray,mc4_r47423pro4RKO=Tarray,mc4_r47423pro4neRKO=Tarray;
	var mre_r47423proz=Tarray,mre_r47423pro4RKO=Tarray,mre_r47423pro4neRKO=Tarray;

	var out_dir="";
	//GetRegistryValue("BANK_INI\\ОБЩИЕ ПАРАМЕТРЫ\\ДИРЕКТОРИИ\\TEXTDIR",2,out_dir);
	//var out_file=out_dir+"disa1_debet_rassh.txt";
	//file rash("debet47423_rassh.txt") txt write;


	array aInput;
	var kolwo:integer=0,id_cl;
	var c4_cl:string=""; //это когда перебирать счета по одному клиенту
	var ds_cl_zad;
	var it47423_proz:bool=false,it60323_proz:bool=false,it47427_proz:bool=false,it459_proz:bool=false;
	var it47423_pro4RKO:bool=false,it60323_pro4:bool=false,it47427_pro4:bool=false,it459_pro4:bool=false;
	var it47423_pro4neRKO:bool=false;
	var nada_rezerv47423_proz:bool=true,nada_rezerv60323_proz:bool=true,nada_rezerv459_proz:bool=true,nada_rezerv47427_proz:bool=true;
	var nada_rezerv47423_pro4RKO:bool=true,nada_rezerv60323_pro4:bool=true,nada_rezerv459_pro4:bool=true,nada_rezerv47427_pro4:bool=true;
	var nada_rezerv47423_pro4neRKO:bool=true;

	MACRO obnulit_nada_rezerv;
		nada_rezerv47423_proz=true;		nada_rezerv60323_proz=true;nada_rezerv459_proz=true;nada_rezerv47427_proz=true;
		nada_rezerv47423_pro4RKO=true;nada_rezerv60323_pro4=true;nada_rezerv459_pro4=true;nada_rezerv47427_pro4=true;
		nada_rezerv47423_pro4neRKO=true;
	END;

	MACRO obnulit_massivy
		mc4_z60323proz.size=0;mc4_z60323pro4.size=0;mc4_r60323proz.size=0;mc4_r60323pro4.size=0; 
		mre_z60323proz.size=0;mre_z60323pro4.size=0;mre_r60323proz.size=0;mre_r60323pro4.size=0; 
		mpr_z60323proz.size=0;mpr_z60323pro4.size=0;mpr_r60323proz.size=0;mpr_r60323pro4.size=0; 
		mc4_z459proz.size=0;mc4_r459proz.size=0;
		mre_z459proz.size=0;mre_r459proz.size=0;
		mpr_z459proz.size=0;mpr_r459proz.size=0;
		mc4_z47427proz.size=0;mc4_r47427proz.size=0;
		mre_z47427proz.size=0;mre_r47427proz.size=0;
		mpr_z47427proz.size=0;mpr_r47427proz.size=0;
	  mc4_z47423proz.size=0;mc4_z47423pro4RKO.size=0;mc4_z47423pro4neRKO.size=0;
	  mre_z47423proz.size=0;mre_z47423pro4RKO.size=0;mre_z47423pro4neRKO.size=0;
	  mpr_z47423proz.size=0;mpr_z47423pro4RKO.size=0;mpr_z47423pro4neRKO.size=0;
	  mc4_r47423proz.size=0;mc4_r47423pro4RKO.size=0;mc4_r47423pro4neRKO.size=0;
	  mre_r47423proz.size=0;mre_r47423pro4RKO.size=0;mre_r47423pro4neRKO.size=0;
	END;

	MACRO day_c4eta_zadolzhennosti(c__)
	// 30.04.2014 DPN Переписал запрос (Адаптация под 31)
		var s__="	select da.t_account, abs ( dr.t_rest ) rest, to_date ( '"+date_ot4+"', 'DD.MM.YYYY' ) - dr.t_restdate period	"+  
		        "	from daccount_dbt da, drestdate_dbt dr	"+                                                                        
		        "	where da.t_code_currency = 0 and da.t_chapter = 1	"+                                                              
		        "	      and (   da.t_account like ( '47423%' )	"+                                                                  
		        "	           or da.t_account like ( '60323%' )	"+                                                                  
		        "	           or da.t_account like ( '60312____4%' )	"+                             
		        "	           or da.t_account like ( '47427%' )	"+  
		        "	           or da.t_account like ( '459%' ) )	"+                                                                  
		        "	      and not ( da.t_account like '45918%' )	"+                                                                  
		        "	      and DR.T_ACCOUNTID = DA.T_ACCOUNTID	"+                                                                          
		        "	      and dr.T_RESTDATE =	"+                                                                                    
		        "	           ( select max ( T_RESTDATE )	"+                                                                      
		        "	            from drestdate_dbt dr2	"+                                                                            
		        "	            where     DR2.T_ACCOUNTID = DR.T_ACCOUNTID	"+                                                                                                        
		        "	             and dr2.T_RESTDATE <= to_date ( '"+date_ot4+"', 'DD.MM.YYYY' ) )	"+                            
		        "	             and dr.t_rest <> 0	"+                                                                                      
		        "	             and ( da.t_close_date > to_date ( '"+date_ot4+"', 'DD.MM.YYYY' )	"+                                          
		        "	                  or da.t_close_date = to_date ( '01.01.0001', 'DD.MM.YYYY' ) )	"+                                      
		        "	      and da.t_open_date <= to_date ( '"+date_ot4+"', 'DD.MM.YYYY' )	"+                                            
		        "	      and da.t_client ="+c__+" "+
		        "				and da.t_account<>'60323810600000023146' "+
		        "				and da.t_account<>'60323810604000018364' "+
		        "				and da.t_account<>'60323810400000014177' "+
		        "				and da.t_account<>'60323810200000016838' "+
		        "				and da.t_account<>'60323810104000018505' "+
		        "				and da.t_account<>'60323810600000016836' "+
		        "				and da.t_account<>'60323810900000016837' "+
		        "				and da.t_account<>'60323810300005760283' "+
		        "				and da.t_account<>'60323810012000026294' ";
		//getstring(s__);
		return s__;
	END; 

	MACRO day_risk_i_normu_clienta(risk_code_)
//	    msgbox("2");debugbreak;
		var rsdf;
		risk_temp=-13; //-1 для свидетельства того, что получен НОВЫЙ риск клиента
		risk=-13;
		pereras4et=false;
		ainput(1)=string(risk_code_);
	  rsdf= RSADORecordset(ExecuteFrontProcEx("rsb6_get_client_risk", aInput, oConn));
	  if (not(rsdf)) msgbox("2. попытка вызвать процедуру rsb6_get_client_risk из ФРОНТ вызвала ошибку. \nпараметры входа: 0:"+ainput(0)+", 1:"+ainput(1)+". строка коннекта: \n"+oConn.connectionstring); exit(0); end;
	rsdf.movenext();
    risk=rsdf.m_value[0];
    norma=rsdf.m_value[1];
    norma_from_front_null=false;
    if (norma==0) norma_from_front_null=true; end;
//    if (risk==6) debugbreak; end;
	onerror (er)
		msgbox("попытка вызвать процедуру rsb6_get_client_risk из ФРОНТ вызвала ошибку. \nпараметры входа: \n1:"+ainput(0)+"\n2:"+ainput(1)+"\n3:"+ainput(2)+"\nстрока коннекта: "+oConn.connectionstring);
		exit(0);
	END;

	MACRO iskl603nalist(ss);
		ex.sheets("60323hz").select;
		obSheet = obBook.ActiveSheet(); 
		obSheet.Range("a"+exel60323hz).numberformat="@";
		obSheet.Range("a"+exel60323hz).Value=ss;
		exel60323hz=exel60323hz+1;
	END;
              
	MACRO htoyta(ss:string)
		it47423_pro4RKO=false;it47423_pro4neRKO=false;it60323_pro4=false;it47427_pro4=false;it459_pro4=false;
		it47423_proz=false;														it60323_proz=false;it47427_proz=false;it459_proz=false;

		if  ( (substr(ss,1,5)=="47423") and ((substr(ss,10,1)=="2") or (substr(ss,10,1)=="4")) ) it47423_proz=true;
		elif( (substr(ss,1,5)=="47423") and ((substr(ss,10,1)=="3") or (substr(ss,10,1)=="0") or (substr(ss,10,1)=="1")) ) it47423_pro4RKO=true;
		elif( (substr(ss,1,5)=="60323") /* and    ((substr(ss,10,2)=="10") or (substr(ss,10,2)=="02")) */ ) it60323_proz=true;
		elif( (substr(ss,1,5)=="60312") and   (substr(ss,6,3)=="810") and (substr(ss,10,1)=="4") ) it60323_proz=true; //госпошлина
//		elif( (substr(ss,1,5)=="60323") and not((substr(ss,10,2)=="10") or (substr(ss,10,2)=="02"))) iskl603nalist(ss);
		elif(  substr(ss,1,5)=="47427" ) it47427_proz=true;
		elif( (substr(ss,1,3)=="459") and (substr(ss,4,2)!="18") ) it459_proz=true;
		else 
			if (substr(ss,1,5)!="60312") msgbox("       счет  "+ss+" почему то не попадает ни в одну из групп счетов задолженности(ни 47423, ни 60323, ни 47427, ни 459)"); end;
	 	  //insert(rash);
		end;
	END;// htoyta

	MACRO zabit_rezerv(mc4,mre,sql_)
		private var ds=trsbdataset(sql_);
		while(ds.movenext()) // забиваем счета резерва в массив
			mc4[mc4.size]=ds.value("t_account");
			mre[mre.size]=ds.value("rest");
		end;
	END; // забить резервы в массивы ==============

	MACRO day_sql_for_rezerv(id_c)
		var tt;;
		var sql1=""+
		"select * "+                                                                                                              
		"from ( select da.t_account, "+                                                                                           
		"              abs(rsb_account.resta ( da.t_account, to_date ( '"+date_ot4+"', 'DD.MM.RRRR' ), da.t_chapter, null )) rest "+
		"       from daccount_dbt da "+                                                                                           
		"       where da.t_code_currency = 0 and da.t_chapter = 1 ";
		var smask:string;
		var sql2=" and da.t_client = "+id_c+" "+
             " and ( da.t_close_date > to_date ( '"+date_ot4+"', 'DD.MM.YYYY' ) "+
             "    or da.t_close_date = to_date ( '01.01.0001', 'DD.MM.YYYY' ) ) "+
             " and da.t_open_date   <= to_date ( '"+date_ot4+"', 'DD.MM.YYYY' ) ) "+
						 " where rest <> 0 ";
	  if   (it60323_proz) 
	  	smask="and (   da.t_account like '60324____0___13%'  "+
	  	      "     or da.t_account like '60324____3___13%'  "+
	  	      "     or da.t_account like '60324____5___13%'  "+
	  	      "     or da.t_account like '60324810_00__11%') "+
	  	      "and da.t_account <> '60324810450001323146'    "+
	  	      "and da.t_account <> '60324810700001318364'    "+
	  	      "and da.t_account <> '60324810005001316838'    "+
	  	      "and da.t_account <> '60324810200001318505'    "+
	  	      "and da.t_account <> '60324810405001316836'    "+
	  	      "and da.t_account <> '60324810705001316837'    "+
	  	      "and da.t_account <> '60324810930001326294'    "+
	  	      "and da.t_account not like '60324810_00001160419'    "+
	  	      "and da.t_account not like '60324810_00001160198'    ";
	  	nada_rezerv60323_proz=false;
	  elif (it60323_pro4)
	  	return "не должно быть такого";            
	  elif (it459_proz )
	  	smask=" and (da.t_account like '45918%') ";
	  elif (it47427_proz)
            //  debugbreak;
              //Gurin S. 05.02.2013
	  	smask=" and ((((da.t_account like '47425_____02%') and (da.t_open_date < TO_DATE ('21.09.2012', 'dd.mm.yyyy'))) or ((da.t_account like '47425____20%') and (da.t_open_date >= TO_DATE ('21.09.2012', 'dd.mm.yyyy')))) "
                    "   or (da.t_account like '47425_________2%' and not(da.t_account like '__________0%') )) "
	  elif (it47423_proz)
              //Gurin S. 05.02.2013
	  	smask=" and (((da.t_account like '47425_____03%') and (da.t_open_date < TO_DATE ('21.09.2012', 'dd.mm.yyyy'))) or ((da.t_account like '47425____30%') and (da.t_open_date >= TO_DATE ('21.09.2012', 'dd.mm.yyyy'))))";
	  elif (it47423_pro4RKO)
//	  	smask=" and (da.t_account like '47425_____2___3%')";
	  	smask=" and	regexp_like(da.t_account , '^47425\\d{5}2\\d{3}3\\d{5}') ";//vihrov 04.07.2012 так быстрее
/*	  elif (it47423_pro4neRKO )
	  	smask=" and ((da.t_account like '47425_________3%') and not(da.t_account like '47425_____2%') and not (da.t_account like '47425_____03%')) "; */
	  end;
  	tt=sql1+smask+sql2;
  	//getstring(tt);
  	return tt;
	END;

	MACRO zadolzhennost_v_massiv(mc4,mre,mpr,ds);
		mc4[mc4.size]=ds.value("t_account");
		mre[mre.size]=ds.value("rest");
		mpr[mpr.size]=ds.value("period");
	END;

	MACRO slozhit_dannye(mas);
		var temp:integer,temp1:integer;
		if (mas.size >1) // ------------------------скидываю все остатки счетов на первый. остальные в ноль--
			for (temp,0,mas.size-2)
				temp1=mas.size-1-temp;
				mas[temp1-1]=mas[temp1-1]+mas[temp1];mas[temp1]=0;
			end;
		end; // -------------------------------------------------------------закончили сваливать счета в один ------------------
		if (mas.size==0) mas[0]=0; end;
	END;

	MACRO opredelit_risk(mre_z,mre_r);
            //  debugbreak;
		norma_big=false;
		norma=mre_r[0]/mre_z[0]*100;
		if  (norma==0) risk=1;
		elif((norma>0)and(norma<=20)) risk=2;
		elif((norma>20)and(norma<=50)) risk=3;
		elif((norma>50)and(norma<=99)) risk=4;
		elif((norma>99)and(norma<=100)) risk=5;
		else 
			norma_big=true; risk=5;
		end;
	onerror
		println("ошибка при вычислении нормы резервирования и группы риска. для клиента "+id_cl+". Устанавливаю норму в ноль, группу в 1");
		norma=0; risk=1;
	END;

	MACRO pos4itat_60323proz;
 		is_2_streb_60323=is_2_streb_60323+mre_z60323proz[0]; 
 		fr_2_it_60323=fr_2_it_60323+mre_r60323proz[0];
  	if (risk==0) pereras4et=true; risk_temp=0;opredelit_risk(mre_z60323proz,mre_r60323proz); end;
  	if   (risk==1) kk_2_1_60323=kk_2_1_60323+mre_z60323proz[0];
 		elif (risk==2) kk_2_2_60323=kk_2_2_60323+mre_z60323proz[0]; fr_2_2_60323=fr_2_2_60323+mre_r60323proz[0];
  	elif (risk==3) kk_2_3_60323=kk_2_3_60323+mre_z60323proz[0]; fr_2_3_60323=fr_2_3_60323+mre_r60323proz[0];
  	elif (risk==4) kk_2_4_60323=kk_2_4_60323+mre_z60323proz[0]; fr_2_4_60323=fr_2_4_60323+mre_r60323proz[0];
 		elif (risk==5) kk_2_5_60323=kk_2_5_60323+mre_z60323proz[0]; fr_2_5_60323=fr_2_5_60323+mre_r60323proz[0];
  	end;
  	if   (mpr_z60323proz[0]<=30)																pz_2_30_60323	 =pz_2_30_60323+	mre_z60323proz[0];
  	elif((mpr_z60323proz[0]>=31) and (mpr_z60323proz[0]<=90))   pz_2_90_60323	 =pz_2_90_60323+	mre_z60323proz[0];
  	elif((mpr_z60323proz[0]>=91) and (mpr_z60323proz[0]<=180))  pz_2_180_60323 =pz_2_180_60323+	mre_z60323proz[0];
  	elif (mpr_z60323proz[0]>=181)  															pz_2_b180_60323=pz_2_b180_60323+mre_z60323proz[0];
  	end;
	END;

	MACRO pos4itat_47427proz;
 		is_2_streb_47427=is_2_streb_47427+mre_z47427proz[0]; 
 		fr_2_it_47427=fr_2_it_47427+mre_r47427proz[0];
  	if (risk==0) pereras4et=true;risk_temp=0;opredelit_risk(mre_z47427proz,mre_r47427proz); end;
  	if   (risk==1) kk_2_1_47427=kk_2_1_47427+mre_z47427proz[0];
 		elif (risk==2) kk_2_2_47427=kk_2_2_47427+mre_z47427proz[0]; fr_2_2_47427=fr_2_2_47427+mre_r47427proz[0];
  	elif (risk==3) kk_2_3_47427=kk_2_3_47427+mre_z47427proz[0]; fr_2_3_47427=fr_2_3_47427+mre_r47427proz[0];
  	elif (risk==4) kk_2_4_47427=kk_2_4_47427+mre_z47427proz[0]; fr_2_4_47427=fr_2_4_47427+mre_r47427proz[0];
 		elif (risk==5) kk_2_5_47427=kk_2_5_47427+mre_z47427proz[0]; fr_2_5_47427=fr_2_5_47427+mre_r47427proz[0];
  	end;
  	if   (mpr_z47427proz[0]<=30)																pz_2_30_47427	 =pz_2_30_47427+	mre_z47427proz[0];
  	elif((mpr_z47427proz[0]>=31) and (mpr_z47427proz[0]<=90))   pz_2_90_47427	 =pz_2_90_47427+	mre_z47427proz[0];
  	elif((mpr_z47427proz[0]>=91) and (mpr_z47427proz[0]<=180))  pz_2_180_47427 =pz_2_180_47427+	mre_z47427proz[0];
  	elif (mpr_z47427proz[0]>=181)  															pz_2_b180_47427=pz_2_b180_47427+mre_z47427proz[0];
  	end;
	END;

	MACRO inexel_error_47423_risk1
		if (mre_r47423proz[0]!=0)
			ex.sheets("47423dop").select;
      obSheet = obBook.ActiveSheet(); 
			exel47423dop=exel47423dop+1;
			obSheet.Range("b"+exel47423dop).numberformat="@";
			obSheet.Range("b"+exel47423dop).Value=mc4_z47423proz[0];

			obSheet.Range("c"+exel47423dop).numberformat="0"+ex.international(3)+"00";
			obSheet.Range("c"+exel47423dop).Value=mre_z47423proz[0];

			obSheet.Range("d"+exel47423dop).numberformat="@";
			obSheet.Range("d"+exel47423dop).Value=mc4_r47423proz[0];

			obSheet.Range("e"+exel47423dop).numberformat="0"+ex.international(3)+"00";
			obSheet.Range("e"+exel47423dop).Value=mre_r47423proz[0];
			obSheet.Range("f"+exel47423dop).Value=risk;
		end;
	END;

	MACRO pos4itat_47423proz;
 		is_2_streb_47423=is_2_streb_47423+mre_z47423proz[0]; 
 		fr_2_it_47423=fr_2_it_47423+mre_r47423proz[0];
  	if (risk==0) pereras4et=true;risk_temp=0;opredelit_risk(mre_z47423proz,mre_r47423proz); end;
  	if   (risk==1) kk_2_1_47423=kk_2_1_47423+mre_z47423proz[0]; inexel_error_47423_risk1;
 		elif (risk==2) kk_2_2_47423=kk_2_2_47423+mre_z47423proz[0]; fr_2_2_47423=fr_2_2_47423+mre_r47423proz[0];
  	elif (risk==3) kk_2_3_47423=kk_2_3_47423+mre_z47423proz[0]; fr_2_3_47423=fr_2_3_47423+mre_r47423proz[0];
  	elif (risk==4) kk_2_4_47423=kk_2_4_47423+mre_z47423proz[0]; fr_2_4_47423=fr_2_4_47423+mre_r47423proz[0];
 		elif (risk==5) kk_2_5_47423=kk_2_5_47423+mre_z47423proz[0]; fr_2_5_47423=fr_2_5_47423+mre_r47423proz[0];
  	end;
  	if   (mpr_z47423proz[0]<=30)																pz_2_30_47423	 =pz_2_30_47423+	mre_z47423proz[0];
  	elif((mpr_z47423proz[0]>=31) and (mpr_z47423proz[0]<=90))   pz_2_90_47423	 =pz_2_90_47423+	mre_z47423proz[0];
  	elif((mpr_z47423proz[0]>=91) and (mpr_z47423proz[0]<=180))  pz_2_180_47423 =pz_2_180_47423+	mre_z47423proz[0];
  	elif (mpr_z47423proz[0]>=181)  															pz_2_b180_47423=pz_2_b180_47423+mre_z47423proz[0];
  	end;
	END;

	MACRO pos4itat_47423pro4neRKO;
 		is_1_streb_47423=is_1_streb_47423+mre_z47423pro4neRKO[0]; 
 		fr_1_it_47423=fr_1_it_47423+mre_r47423pro4neRKO[0];
  	if (risk==0) pereras4et=true;risk_temp=0;opredelit_risk(mre_z47423pro4neRKO,mre_r47423pro4neRKO); end;
  	if   (risk==1) kk_1_1_47423=kk_1_1_47423+mre_z47423pro4neRKO[0];
 		elif (risk==2) kk_1_2_47423=kk_1_2_47423+mre_z47423pro4neRKO[0]; fr_1_2_47423=fr_1_2_47423+mre_r47423pro4neRKO[0];
  	elif (risk==3) kk_1_3_47423=kk_1_3_47423+mre_z47423pro4neRKO[0]; fr_1_3_47423=fr_1_3_47423+mre_r47423pro4neRKO[0];
  	elif (risk==4) kk_1_4_47423=kk_1_4_47423+mre_z47423pro4neRKO[0]; fr_1_4_47423=fr_1_4_47423+mre_r47423pro4neRKO[0];
 		elif (risk==5) kk_1_5_47423=kk_1_5_47423+mre_z47423pro4neRKO[0]; fr_1_5_47423=fr_1_5_47423+mre_r47423pro4neRKO[0];
  	end;
  	if   (mpr_z47423pro4neRKO[0]<=30)																			pz_1_30_47423	 =pz_1_30_47423+	mre_z47423pro4neRKO[0];
  	elif((mpr_z47423pro4neRKO[0]>=31) and (mpr_z47423pro4neRKO[0]<=90))   pz_1_90_47423	 =pz_1_90_47423+	mre_z47423pro4neRKO[0];
  	elif((mpr_z47423pro4neRKO[0]>=91) and (mpr_z47423pro4neRKO[0]<=180))  pz_1_180_47423 =pz_1_180_47423+	mre_z47423pro4neRKO[0];
  	elif (mpr_z47423pro4neRKO[0]>=181)  																	pz_1_b180_47423=pz_1_b180_47423+mre_z47423pro4neRKO[0];
  	end;
	END;

	MACRO pos4itat_459proz;
 		is_2_streb_459=is_2_streb_459+mre_z459proz[0]; 
 		fr_2_it_459=fr_2_it_459+mre_r459proz[0];
  	if (risk==0) pereras4et=true;risk_temp=0;opredelit_risk(mre_z459proz,mre_r459proz); end;
  	if   (risk==1) kk_2_1_459=kk_2_1_459+mre_z459proz[0];
 		elif (risk==2) kk_2_2_459=kk_2_2_459+mre_z459proz[0]; fr_2_2_459=fr_2_2_459+mre_r459proz[0];
  	elif (risk==3) kk_2_3_459=kk_2_3_459+mre_z459proz[0]; fr_2_3_459=fr_2_3_459+mre_r459proz[0];
  	elif (risk==4) kk_2_4_459=kk_2_4_459+mre_z459proz[0]; fr_2_4_459=fr_2_4_459+mre_r459proz[0];
 		elif (risk==5) kk_2_5_459=kk_2_5_459+mre_z459proz[0]; fr_2_5_459=fr_2_5_459+mre_r459proz[0];
  	end;
  	if   (mpr_z459proz[0]<=30)															pz_2_30_459	 =pz_2_30_459+	mre_z459proz[0];
  	elif((mpr_z459proz[0]>=31) and (mpr_z459proz[0]<=90))   pz_2_90_459	 =pz_2_90_459+	mre_z459proz[0];
  	elif((mpr_z459proz[0]>=91) and (mpr_z459proz[0]<=180))  pz_2_180_459 =pz_2_180_459+	mre_z459proz[0];
  	elif (mpr_z459proz[0]>=181)  														pz_2_b180_459=pz_2_b180_459+mre_z459proz[0];
  	end;
	END;


	MACRO pos4itat_47423pro4RKO;
 		is_1_streb_47423=is_1_streb_47423+mre_z47423pro4RKO[0]; 
 		fr_1_it_47423=fr_1_it_47423+mre_r47423pro4RKO[0];
  	risk_temp=risk;pereras4et=true;opredelit_risk(mre_z47423pro4RKO,mre_r47423pro4RKO); //принудительно определяем риск по формуле, а не по фронту
  	if   (risk==1) kk_1_1_47423=kk_1_1_47423+mre_z47423pro4RKO[0];
 		elif (risk==2) kk_1_2_47423=kk_1_2_47423+mre_z47423pro4RKO[0]; fr_1_2_47423=fr_1_2_47423+mre_r47423pro4RKO[0];
  	elif (risk==3) kk_1_3_47423=kk_1_3_47423+mre_z47423pro4RKO[0]; fr_1_3_47423=fr_1_3_47423+mre_r47423pro4RKO[0];
  	elif (risk==4) kk_1_4_47423=kk_1_4_47423+mre_z47423pro4RKO[0]; fr_1_4_47423=fr_1_4_47423+mre_r47423pro4RKO[0];
 		elif (risk==5) kk_1_5_47423=kk_1_5_47423+mre_z47423pro4RKO[0]; fr_1_5_47423=fr_1_5_47423+mre_r47423pro4RKO[0];
  	end;
  	if   (mpr_z47423pro4RKO[0]<=30)																		pz_1_30_47423	 =pz_1_30_47423+	mre_z47423pro4RKO[0];
  	elif((mpr_z47423pro4RKO[0]>=31) and (mpr_z47423pro4RKO[0]<=90))   pz_1_90_47423	 =pz_1_90_47423+	mre_z47423pro4RKO[0];
  	elif((mpr_z47423pro4RKO[0]>=91) and (mpr_z47423pro4RKO[0]<=180))  pz_1_180_47423 =pz_1_180_47423+	mre_z47423pro4RKO[0];
  	elif (mpr_z47423pro4RKO[0]>=181)  																pz_1_b180_47423=pz_1_b180_47423+mre_z47423pro4RKO[0];
  	end;
	END;


	MACRO pos4itat_60323pro4;
 		is_1_streb_60323=is_1_streb_60323+mre_z60323pro4[0]; 
 		fr_1_it_60323=fr_1_it_60323+mre_r60323pro4[0];
  	if (risk==0) risk_temp=0;pereras4et=true;opredelit_risk(mre_z60323pro4,mre_r60323pro4); end;
  	if   (risk==1) kk_1_1_60323=kk_1_1_60323+mre_z60323pro4[0];
 		elif (risk==2) kk_1_2_60323=kk_1_2_60323+mre_z60323pro4[0]; fr_1_2_60323=fr_1_2_60323+mre_r60323pro4[0];
  	elif (risk==3) kk_1_3_60323=kk_1_3_60323+mre_z60323pro4[0]; fr_1_3_60323=fr_1_3_60323+mre_r60323pro4[0];
  	elif (risk==4) kk_1_4_60323=kk_1_4_60323+mre_z60323pro4[0]; fr_1_4_60323=fr_1_4_60323+mre_r60323pro4[0];
 		elif (risk==5) kk_1_5_60323=kk_1_5_60323+mre_z60323pro4[0]; fr_1_5_60323=fr_1_5_60323+mre_r60323pro4[0];
  	end;
  	if   (mpr_z60323pro4[0]<=30)																pz_1_30_60323	 =pz_1_30_60323+	mre_z60323pro4[0];
  	elif((mpr_z60323pro4[0]>=31) and (mpr_z60323pro4[0]<=90))   pz_1_90_60323	 =pz_1_90_60323+	mre_z60323pro4[0];
  	elif((mpr_z60323pro4[0]>=91) and (mpr_z60323pro4[0]<=180))  pz_1_180_60323 =pz_1_180_60323+	mre_z60323pro4[0];
  	elif (mpr_z60323pro4[0]>=181)  															pz_1_b180_60323=pz_1_b180_60323+mre_z60323pro4[0];
  	end;
	END;


	MACRO pos4itat_60323proz_pos;
		os_2_st_60323=os_2_st_60323+mre_z60323proz[0];
		os_2_sr_60323=os_2_sr_60323+mre_r60323proz[0];
		if (norma>20)
			os_21_st_60323=os_21_st_60323+mre_z60323proz[0];
			os_21_sr_60323=os_21_sr_60323+mre_r60323proz[0];
		end;
	END;

	MACRO pos4itat_47427proz_pos;
		os_2_st_47427=os_2_st_47427+mre_z47427proz[0];
		os_2_sr_47427=os_2_sr_47427+mre_r47427proz[0];
		if (norma>20)
			os_21_st_47427=os_21_st_47427+mre_z47427proz[0];
			os_21_sr_47427=os_21_sr_47427+mre_r47427proz[0];
		end;
	END;

	MACRO pos4itat_47423proz_pos;
		os_2_st_47423=os_2_st_47423+mre_z47423proz[0];
		os_2_sr_47423=os_2_sr_47423+mre_r47423proz[0];
		if (norma>20)
			os_21_st_47423=os_21_st_47423+mre_z47423proz[0];
			os_21_sr_47423=os_21_sr_47423+mre_r47423proz[0];
		end;
	END;


	MACRO pos4itat_47423pro4neRKO_pos;
		os_1_st_47423=os_1_st_47423+mre_z47423pro4neRKO[0];
		os_1_sr_47423=os_1_sr_47423+mre_r47423pro4neRKO[0];
		if  (norma==0)										os_11_st_47423=os_11_st_47423+mre_z47423pro4neRKO[0]; 
			if (mre_r47423pro4neRKO[0]!=0) /*debugbreak;*/ end ;os_11_sr_47423=os_11_sr_47423+mre_r47423pro4neRKO[0];
		elif ((norma>0) and (norma<=3)) 	os_12_st_47423=os_12_st_47423+mre_z47423pro4neRKO[0]; os_12_sr_47423=os_12_sr_47423+mre_r47423pro4neRKO[0]; if ((os_12_sr_47423/os_12_st_47423*100)>3)  msgbox("sssss"); end;
		elif ((norma>3) and (norma<=20))	os_13_st_47423=os_13_st_47423+mre_z47423pro4neRKO[0]; os_13_sr_47423=os_13_sr_47423+mre_r47423pro4neRKO[0];
		elif((norma>20) and (norma<=50))	os_14_st_47423=os_14_st_47423+mre_z47423pro4neRKO[0]; os_14_sr_47423=os_14_sr_47423+mre_r47423pro4neRKO[0];
		elif (norma>50)										os_15_st_47423=os_15_st_47423+mre_z47423pro4neRKO[0]; os_15_sr_47423=os_15_sr_47423+mre_r47423pro4neRKO[0];
		end;
	END;

	MACRO pos4itat_47423pro4RKO_pos;
		os_1_st_47423=os_1_st_47423+mre_z47423pro4RKO[0];
		os_1_sr_47423=os_1_sr_47423+mre_r47423pro4RKO[0];
		//risk_temp=risk;pereras4et=true;opredelit_risk(mre_z47423pro4RKO,mre_r47423pro4RKO);
		if  (norma==0)										os_11_st_47423=os_11_st_47423+mre_z47423pro4RKO[0]; 
			if (mre_r47423pro4RKO[0]!=0) /*debugbreak;*/ end ;os_11_sr_47423=os_11_sr_47423+mre_r47423pro4RKO[0];
		elif ((norma>0) and (norma<=3)) 	os_12_st_47423=os_12_st_47423+mre_z47423pro4RKO[0]; os_12_sr_47423=os_12_sr_47423+mre_r47423pro4RKO[0];if ((os_12_sr_47423/os_12_st_47423*100)>3)  msgbox("sssss22222"); end;
		elif ((norma>3) and (norma<=20))	os_13_st_47423=os_13_st_47423+mre_z47423pro4RKO[0]; os_13_sr_47423=os_13_sr_47423+mre_r47423pro4RKO[0];
		elif((norma>20) and (norma<=50))	os_14_st_47423=os_14_st_47423+mre_z47423pro4RKO[0]; os_14_sr_47423=os_14_sr_47423+mre_r47423pro4RKO[0];
		elif (norma>50)										os_15_st_47423=os_15_st_47423+mre_z47423pro4RKO[0]; os_15_sr_47423=os_15_sr_47423+mre_r47423pro4RKO[0];
		end;
	END;

	MACRO pos4itat_60323pro4_pos;
		os_1_st_60323=os_1_st_60323+mre_z60323pro4[0];
		os_1_sr_60323=os_1_sr_60323+mre_r60323pro4[0];
		//risk_temp=risk;pereras4et=true;opredelit_risk(mre_z60323pro4RKO,mre_r60323pro4RKO);
		if  (norma==0)										os_11_st_60323=os_11_st_60323+mre_z60323pro4[0]; os_11_sr_60323=os_11_sr_60323+mre_r60323pro4[0];
		elif ((norma>0) and (norma<=3)) 	os_12_st_60323=os_12_st_60323+mre_z60323pro4[0]; os_12_sr_60323=os_12_sr_60323+mre_r60323pro4[0];
		elif ((norma>3) and (norma<=20))	os_13_st_60323=os_13_st_60323+mre_z60323pro4[0]; os_13_sr_60323=os_13_sr_60323+mre_r60323pro4[0];
		elif((norma>20) and (norma<=50))	os_14_st_60323=os_14_st_60323+mre_z60323pro4[0]; os_14_sr_60323=os_14_sr_60323+mre_r60323pro4[0];
		elif (norma>50)										os_15_st_60323=os_15_st_60323+mre_z60323pro4[0]; os_15_sr_60323=os_15_sr_60323+mre_r60323pro4[0];
		end;
	END;

	MACRO pos4itat_459proz_pos;
		os_2_st_459=os_2_st_459+mre_z459proz[0];
		os_2_sr_459=os_2_sr_459+mre_r459proz[0];
		if (norma>20)
			os_21_st_459=os_21_st_459+mre_z459proz[0];
			os_21_sr_459=os_21_sr_459+mre_r459proz[0];
		end;
	END;

	MACRO  outbignorma(r,c4_z,re_z,c4_r,re_r)
		private var qqq:string="";
		qqq=obSheet.name;
		//msgbox(qqq);
		ex.sheets("bignorma").select;
		obSheet = obBook.ActiveSheet();
		obSheet.Range("a"+exelbignorma).Value=r;
		obSheet.Range("b"+exelbignorma).numberformat="@";
		obSheet.Range("b"+exelbignorma).Value=c4_z;
    obSheet.Range("c"+exelbignorma).numberformat="0"+ex.international(3)+"00";
		obSheet.Range("c"+exelbignorma).Value=re_z;
		obSheet.Range("d"+exelbignorma).numberformat="@";
		obSheet.Range("d"+exelbignorma).Value=c4_r;
    obSheet.Range("e"+exelbignorma).numberformat="0"+ex.international(3)+"00";
    obSheet.Range("e"+exelbignorma).Value=re_r;
		obSheet.Range("f"+exelbignorma).Value=risk;
		if (pereras4et==true)
			obSheet.Range("g"+exelbignorma).Value="был "+risk_temp;
		end;
		obSheet.Range("h"+exelbignorma).numberformat="0"+ex.international(3)+"00";
		obSheet.Range("h"+exelbignorma).Value=(re_r/re_z)*100;
		exelbignorma=exelbignorma+1;
		ex.sheets(qqq).select;
		obSheet = obBook.ActiveSheet();
	END;
	


	MACRO	output_in_file(razd,mc4_z,mre_z,mc4_r,mre_r);
		private var i:integer;
		private var tek_str_exel:integer;
		if 	 (substr(razd,1,5)=="47423") ex.sheets("47423rassh").select;tek_str_exel=exel47423str;
		elif (substr(razd,1,5)=="47427") ex.sheets("47427rassh").select;tek_str_exel=exel47427str;
		elif (substr(razd,1,5)=="  459") ex.sheets("459rassh").select;tek_str_exel=exel459str;
		elif ( (substr(razd,1,5)=="60323") or (substr(razd,1,5)=="60312") ) ex.sheets("60323rassh").select;tek_str_exel=exel60323str;
		end;
		obSheet = obBook.ActiveSheet(); 
		for (i,0,mc4_z.size-1)
			//rash.str=razd+string(mc4_z[i]:22:r)+string(mre_z[i]:18:2:r)+string(mc4_r[i]:23:r)+string(mre_r[i]:17:2:r)+string(risk:8:r);
			obSheet.Range("a"+tek_str_exel).Value=razd;
			obSheet.Range("b"+tek_str_exel).numberformat="@";
			obSheet.Range("b"+tek_str_exel).Value=mc4_z[i];

      obSheet.Range("c"+tek_str_exel).numberformat="0"+ex.international(3)+"00";
			obSheet.Range("c"+tek_str_exel).Value=mre_z[i];

			obSheet.Range("d"+tek_str_exel).numberformat="@";
			obSheet.Range("d"+tek_str_exel).Value=mc4_r[i];

      obSheet.Range("e"+tek_str_exel).numberformat="0"+ex.international(3)+"00";
      obSheet.Range("e"+tek_str_exel).Value=mre_r[i];

			obSheet.Range("f"+tek_str_exel).Value=risk;
			if (pereras4et==true)
				obSheet.Range("g"+tek_str_exel).Value="был "+risk_temp;
			end;
			
			if ((norma_big) and (i==0)) 
				//rash.str=rash.str+"      NORMA="+string(norma); 
				obSheet.Range("h"+tek_str_exel).Value="NORMA="+string(norma); 
				outbignorma(razd,mc4_z[0],mre_z[0],mc4_r[0],mre_r[0]);
			end;
			//insert(rash);
			tek_str_exel=tek_str_exel+1;
		end;
		//rash.str="-------------------------------------------------------------------------------------------------------";
		//insert(rash);
		obSheet.Range("a"+tek_str_exel).Value="-----------------------------------------------";
		tek_str_exel=tek_str_exel+1;
		if 	 (substr(razd,1,5)=="47423") exel47423str=tek_str_exel;
		elif (substr(razd,1,5)=="47427") exel47427str=tek_str_exel;
		elif (substr(razd,1,5)=="  459") exel459str  =tek_str_exel;
		elif ( (substr(razd,1,5)=="60323") or (substr(razd,1,5)=="60312") ) exel60323str=tek_str_exel;
		end;

	END;


	
	
	
	MACRO 	sdelay_isklu4enie60323pro4(c4_z,c4_r);
		private MACRO day_sql_for_iskl60323(c4);
			var s:string;
			// 30.04.2014 DPN Переписал запрос (Адаптация под 31)
			s=""+
			"select /*+ INDEX(da daccount_dbt_idx2)*/ da.t_account, abs ( dr.t_rest ) rest,  to_date ( '"+date_ot4+"', 'DD.MM.YYYY' ) - dr.t_restdate period, "+
			"       t_code "+                                                                                                   
			"from daccount_dbt da, drestdate_dbt dr, dobjcode_dbt cod "+                                                        
			"where dr.T_RESTDATE = "+                                                                                     
			"           ( select max ( T_RESTDATE ) "+                                                                        
			"            from drestdate_dbt dr2 "+                                                                              
			"            where     dr2.t_accountid = dr.t_accountid "+                                                                                                             
			"                  and dr2.T_RESTDATE <= to_date ( '"+date_ot4+"', 'DD.MM.YYYY' ) and dr2.t_rest <> 0 ) "+                            
			"      and dr.t_rest <> 0 "+                                                                                        
			"      and ( da.t_close_date > to_date ( '"+date_ot4+"', 'DD.MM.YYYY' ) "+                                          
			"           or da.t_close_date = to_date ( '01.01.0001', 'DD.MM.YYYY' ) ) "+                                        
			"      and da.t_open_date <= to_date ( '"+date_ot4+"', 'DD.MM.YYYY' ) "+                                            
			"      and da.t_account = '"+c4_z+"' "+                                                                             
			"      and cod.t_objectid = da.t_client   and cod.t_codekind = 1    and cod.t_objecttype = 3 and cod.t_state=0 ";                     
			return s;
		END;
		private var ds1;
		ds1=trsbdataset(day_sql_for_iskl60323(c4_z)); 

		obnulit_massivy; 
		if (not(ds1.movenext))
			mc4_z60323pro4[0]=c4_z;
			mre_z60323pro4[0]=0;
			mpr_z60323pro4[0]=0;
		else
			mc4_z60323pro4[0]=ds1.value("t_account");
			mre_z60323pro4[0]=ds1.value("rest");
			mpr_z60323pro4[0]=ds1.value("period");
		end;
		day_risk_i_normu_clienta(ds1.value("t_code"));
		if (c4_r!="")
			ds1=trsbdataset(day_sql_for_iskl60323(c4_r)); 
			if (ds1.movenext)
				mc4_r60323pro4[0]=ds1.value("t_account");
				mre_r60323pro4[0]=ds1.value("rest");
			else
				mc4_r60323pro4[0]=c4_r;
				mre_r60323pro4[0]=0;
			end;
		else
			mc4_r60323pro4[0]="-";
			mre_r60323pro4[0]=0;
		end;
		if   (risk<6)  pos4itat_60323pro4;
		else           pos4itat_60323pro4_pos;
		end;
		output_in_file("60323 pro4",mc4_z60323pro4,mre_z60323pro4,mc4_r60323pro4,mre_r60323pro4);
	END;

  initprogress(int(wsego),"начало расчета","Идет обработка клиентов");

  if (IsStandAlone()) // Двухзвенка
    if ((ValType(ex)!=V_UNDEF) and (ex.Visible==False))
      ex = ActiveX("Excel.Application",NULL,false); 
    else
      ex = ActiveX("Excel.Application",NULL,true);
    end;
  else // Трехзвенка
    ob = CreateObject ("rsax","TRsAxServer","RsAxServer",false);
    ex = ob.CreateComObject ("Excel.Application",true);
  end; 
	GetRegistryValue("BANK_INI\\ОБЩИЕ ПАРАМЕТРЫ\\ДИРЕКТОРИИ\\USERTEMPLSDIR",2,out);
	Fulloutput = FindPath(output, out);                    
	if (not Fulloutput)
		msgbox("Не найден шаблон "+output+" в директориях реестра "+out);
		exit();
	end;
	obBook = ex.Workbooks.add(fulloutput); 
  obSheet = obBook.ActiveSheet(); 
  
	//rash.str={curdate};insert(rash);
	//rash.str="раздел        счет задолженности           остаток           счет резерва          остаток        группа риска  ";
	//insert(rash);
  ainput(0)=string({mfo_bank});
  ainput(1)=string("");
  ainput(2)=date(date_ot4);
  kolwo=0;
  //debugbreak;
	message(" входим в основной цикл клиентов ");
	wsego_obrabotano_clientov=0;
	while (ds.movenext()) //-------------------------------------основной масссиввв----------------------------------------
//if (wsego_obrabotano_clientov > 23000)
		obnulit_massivy; 
		obnulit_nada_rezerv;
		id_cl=ds.value("t_client");
   	ds_cl_zad=trsbdataset(day_c4eta_zadolzhennosti(id_cl));
		//getstring(day_c4eta_zadolzhennosti(id_cl));
   	if (ds_cl_zad) day_risk_i_normu_clienta(ds.value("risk_code")); end;
   	while(ds_cl_zad.movenext()) // пошли по счетам задолженности одного клиента 
   	    //debugbreak;
   		c4_cl=string(ds_cl_zad.value("t_account")); 
   		htoyta(c4_cl); 
   		if   (it60323_proz)
   			if (nada_rezerv60323_proz) 
   				//getstring(day_sql_for_rezerv(id_cl));
   				zabit_rezerv(mc4_r60323proz,mre_r60323proz,day_sql_for_rezerv(id_cl)); 
					nada_rezerv60323_proz=false;
   			end;
   			zadolzhennost_v_massiv(mc4_z60323proz,mre_z60323proz,mpr_z60323proz,ds_cl_zad);
   		end;
   		if (it60323_pro4) msgbox(" не должно быть такого (что-то попало в 60323 прочие)");
   	  end;
   	  if (it459_proz)
   	  	//debugbreak;
   	  	if  (nada_rezerv459_proz)
   	  		zabit_rezerv(mc4_r459proz,mre_r459proz,day_sql_for_rezerv(id_cl));
   	  		nada_rezerv459_proz=false;
   	  	end;
   			zadolzhennost_v_massiv(mc4_z459proz,mre_z459proz,mpr_z459proz,ds_cl_zad);
   		end;
   		if (it47427_proz)
   			if (nada_rezerv47427_proz)
   	  		zabit_rezerv(mc4_r47427proz,mre_r47427proz,day_sql_for_rezerv(id_cl));
   	  		nada_rezerv47427_proz=false;
   			end;
   			zadolzhennost_v_massiv(mc4_z47427proz,mre_z47427proz,mpr_z47427proz,ds_cl_zad);
   		end;
   		if (it47423_proz) //debugbreak;
   			if (nada_rezerv47423_proz)
   	  		zabit_rezerv(mc4_r47423proz,mre_r47423proz,day_sql_for_rezerv(id_cl));
   	  		nada_rezerv47423_proz=false;
   			end;
   			zadolzhennost_v_massiv(mc4_z47423proz,mre_z47423proz,mpr_z47423proz,ds_cl_zad);
   		end;
   		if (it47423_pro4RKO)
   			if (nada_rezerv47423_pro4RKO)
   				zabit_rezerv(mc4_r47423pro4RKO,mre_r47423pro4RKO,day_sql_for_rezerv(id_cl));
   				nada_rezerv47423_pro4RKO=false;
   			end;
   			zadolzhennost_v_massiv(mc4_z47423pro4RKO,mre_z47423pro4RKO,mpr_z47423pro4RKO,ds_cl_zad);
   		end;
   		if (it47423_pro4neRKO)
   			if (nada_rezerv47423_pro4neRKO)
   				zabit_rezerv(mc4_r47423pro4neRKO,mre_r47423pro4neRKO,day_sql_for_rezerv(id_cl));
   				nada_rezerv47423_pro4neRKO=false;
   			end;
   			zadolzhennost_v_massiv(mc4_z47423pro4neRKO,mre_z47423pro4neRKO,mpr_z47423pro4neRKO,ds_cl_zad);
   		end;
   	end;
		//if (id_cl==9346) debugbreak; end;

		if 	 (mc4_z60323proz.size>0)
			slozhit_dannye(mre_z60323proz);
			slozhit_dannye(mre_r60323proz);
			if 	 (risk <6) pos4itat_60323proz;
			elif (risk==6) 
				if ((norma==0) or (norma_from_front_null)) norma=mre_r60323proz[0]/mre_z60323proz[0]*100; end;
				pos4itat_60323proz_pos;
			end;
		//elif ()
			output_in_file("60323  %%%",mc4_z60323proz,mre_z60323proz,mc4_r60323proz,mre_r60323proz);
		end;
		if (mc4_z459proz.size>0)
			slozhit_dannye(mre_z459proz);
			slozhit_dannye(mre_r459proz);
			if 	 (risk <6) pos4itat_459proz;
			elif (risk==6) 
				if ((norma==0) or (norma_from_front_null)) norma=mre_r459proz[0]/mre_z459proz[0]*100; end;
				pos4itat_459proz_pos;
			end;
			output_in_file("  459  %%%",mc4_z459proz,mre_z459proz,mc4_r459proz,mre_r459proz);
		end;
		if (mc4_z47427proz.size>0)
			slozhit_dannye(mre_z47427proz);
			slozhit_dannye(mre_r47427proz);
			if 	 (risk <6) pos4itat_47427proz;
			elif (risk==6) 
				if ((norma==0) or (norma_from_front_null)) norma=mre_r47427proz[0]/mre_z47427proz[0]*100; end;
        pos4itat_47427proz_pos;
			end;
			//debugbreak;
			output_in_file("47427  %%%",mc4_z47427proz,mre_z47427proz,mc4_r47427proz,mre_r47427proz);
		end;
		if (mc4_z47423proz.size>0)
			slozhit_dannye(mre_z47423proz);
			slozhit_dannye(mre_r47423proz);
			if 	 (risk <6) pos4itat_47423proz;
			elif (risk==6) 
				if ((norma==0) or (norma_from_front_null)) norma=mre_r47423proz[0]/mre_z47423proz[0]*100; end;
				pos4itat_47423proz_pos;
			end;
			output_in_file("47423  %%%",mc4_z47423proz,mre_z47423proz,mc4_r47423proz,mre_r47423proz);
		end;
		if (mc4_z47423pro4neRKO.size>0)
			slozhit_dannye(mre_z47423pro4neRKO);
			slozhit_dannye(mre_r47423pro4neRKO);
			if 	 (risk <6) pos4itat_47423pro4neRKO;
			elif (risk==6) 
				if ((norma==0) or (norma_from_front_null)) norma=mre_r47423pro4neRKO[0]/mre_z47423pro4neRKO[0]*100; end;
				pos4itat_47423pro4neRKO_pos;
			end;
			output_in_file("47423neRKO",mc4_z47423pro4neRKO,mre_z47423pro4neRKO,mc4_r47423pro4neRKO,mre_r47423pro4neRKO);
		end;
		if (mc4_z47423pro4RKO.size>0)
			slozhit_dannye(mre_z47423pro4RKO);
			slozhit_dannye(mre_r47423pro4RKO);
			if 	 (risk==6) 
				temp4=norma; norma=mre_r47423pro4RKO[0]/mre_z47423pro4RKO[0]*100; 
				pos4itat_47423pro4RKO_pos;
				norma=temp4;
			elif (risk< 6)
			  temp4=norma; norma=mre_r47423pro4RKO[0]/mre_z47423pro4RKO[0]*100; 
				pos4itat_47423pro4RKO;
				norma=temp4;
			end;
			output_in_file("47423  RKO",mc4_z47423pro4RKO,mre_z47423pro4RKO,mc4_r47423pro4RKO,mre_r47423pro4RKO);
		end;
//end;
		wsego_obrabotano_clientov=wsego_obrabotano_clientov+1;
		message(" обработано клиентов: "+wsego_obrabotano_clientov+" ИЗ "+wsego+"        "+string(wsego_obrabotano_clientov/wsego*100)+" %");
		useprogress(wsego_obrabotano_clientov);
	end;				//-------------------------------------основной масссиввв----------------------------------------
	id_cl=-1; //чтобы в логе было понятно, что это все клиенты закончились и пошли исключения.

	remprogress;
	//debugbreak;
       //Gurin S. 27.03.2013 закомментировал по просьбе Зиминой Елены
	sdelay_isklu4enie60323pro4("60323810600000023146","60324810450001323146");
	sdelay_isklu4enie60323pro4("60323810604000018364","60324810700001318364");
	//sdelay_isklu4enie60323pro4("60323810400000014177","");
	//sdelay_isklu4enie60323pro4("60323810200000016838","60324810005001316838");
	sdelay_isklu4enie60323pro4("60323810104000018505","60324810200001318505");
	//sdelay_isklu4enie60323pro4("60323810600000016836","60324810405001316836");
	//sdelay_isklu4enie60323pro4("60323810900000016837","60324810705001316837");
	sdelay_isklu4enie60323pro4("60323810300005760283","");
	sdelay_isklu4enie60323pro4("60323810012000026294","60324810930001326294");
//		close(rash);

println(begin_vremya+"    начало отчета");
println(string( ({curdate}), " ", StrSubst(string(time())," ","0") )+"    конец отчета");
  ex.visible=true;





[

Дебиторская задолженность ЮЛ по счетам 47423 по состоянию на ##########
Индивидуальные ссуды                                                                                                                            
┌───┬────────────┬────────────┬──────────────────────────────────────────────────────────────────┬────────────────────────────────────────────────────┬────────────────────────────────────────────────────────────────┐
│№  │Состав      │Сумма       │       категория качества                                         │Просроченная  задолженность                         │Фактически сформированный  резерв                               │        
│   │активов     │требования  ├────────────┬─────────────┬─────────────┬────────────┬────────────┼────────────┬────────────┬─────────────┬────────────┼────────────┬────────────┬────────────┬────────────┬────────────┤
│   │            │            │    1       │     2       │    3        │    4       │    5       │до 30 дней  │от 31 до 90 │от 91 до 180 │свыше 180   │Итого       │    2       │     3      │    4       │    5       │
├───┼────────────┼────────────┼────────────┼─────────────┼─────────────┼────────────┼────────────┼────────────┼────────────┼─────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
│ 1 │прочие      │############│############│#############│#############│############│############│############│############│#############│############│############│############│############│############│############│
│   │требования  │            │            │             │             │            │            │            │            │             │            │            │            │            │            │            │
├───┼────────────┼────────────┼────────────┼─────────────┼─────────────┼────────────┼────────────┼────────────┼────────────┼─────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
│ 2 │Требования  │############│############│#############│#############│############│############│############│############│#############│############│############│############│############│############│############│
│   │по получению│            │            │             │             │            │            │            │            │             │            │            │            │            │            │            │
│   │процентов   │            │            │             │             │            │            │            │            │             │            │            │            │            │            │            │
└───┴────────────┴────────────┴────────────┴─────────────┴─────────────┴────────────┴────────────┴────────────┴────────────┴─────────────┴────────────┴────────────┴────────────┴────────────┴────────────┴────────────┘

 Однородные ссуды                                                                                        
┌───┬───────────────────────────────────────┬───────────────┬───────────────┐
│№  │   Наименование статьи                 │ Сумма треб.   │ Сформ. резерв │
│───┼───────────────────────────────────────┼───────────────┼───────────────┤
│1  │   Прочие требования                   │###############│###############│ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│   │   из них:                             │               │               │        
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│1.1│   нет резерва - 1 категория           │###############│###############│        
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│1.2│   резерв от 0 до 3 - 2 категория      │###############│###############│ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│1.3│   резерв свыше 3 до 20 - 3 категория  │###############│###############│ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│1.4│   резерв свыше 20 до 50 - 4 категория │###############│###############│ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│1.5│   резерв свыше 50 - 5 категория       │###############│###############│ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│2  │   Требования по получению процентов   │###############│###############│ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│   │   из них:                             │               │               │ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│2.1│   резерв свыше 20                     │###############│###############│ 
└───┴───────────────────────────────────────┴───────────────┴───────────────┘ 

]
(date_ot4, is_1_streb_47423:10:1,kk_1_1_47423:8:2,kk_1_2_47423:7:1,kk_1_3_47423:8:2,kk_1_4_47423:8:2,kk_1_5_47423:8:2,pz_1_30_47423:8:2,pz_1_90_47423:8:2,pz_1_180_47423:8:2,pz_1_b180_47423:8:2,fr_1_it_47423:8:2,fr_1_2_47423:8:2,fr_1_3_47423:8:2,fr_1_4_47423:8:2,fr_1_5_47423:8:2,
					 is_2_streb_47423:10:1,kk_2_1_47423:8:1,kk_2_2_47423:8:2,kk_2_3_47423:8:2,kk_2_4_47423:8:2,kk_2_5_47423:8:2,pz_2_30_47423:8:2,pz_2_90_47423:8:2,pz_2_180_47423:8:2,pz_2_b180_47423:8:2,fr_2_it_47423:8:2,fr_2_2_47423:8:2,fr_2_3_47423:8:2,fr_2_4_47423:8:2,fr_2_5_47423:8:2,
os_1_st_47423:10:1,os_1_sr_47423:10:1,os_11_st_47423:10:1,os_11_sr_47423:10:1,os_12_st_47423:10:1,os_12_sr_47423:10:1,os_13_st_47423:10:1,os_13_sr_47423:10:1,os_14_st_47423:10:1,os_14_sr_47423:10:1,os_15_st_47423:10:1,os_15_sr_47423:10:1,
os_2_st_47423:8:1,os_2_sr_47423:8:1,os_21_st_47423:8:1,os_21_sr_47423:8:1
);
ex.sheets("47423").select;
obSheet = obBook.ActiveSheet(); 
obSheet.Range("j1").Value=date_ot4;
obSheet.Range("c6").Value=is_1_streb_47423;obSheet.Range("d6").Value=kk_1_1_47423;obSheet.Range("e6").Value=kk_1_2_47423;
obSheet.Range("c7").Value=is_2_streb_47423;obSheet.Range("d7").Value=kk_2_1_47423;obSheet.Range("e7").Value=kk_2_2_47423;
obSheet.Range("f6").Value=kk_1_3_47423;obSheet.Range("g6").Value=kk_1_4_47423;obSheet.Range("h6").Value=kk_1_5_47423;
obSheet.Range("f7").Value=kk_2_3_47423;obSheet.Range("g7").Value=kk_2_4_47423;obSheet.Range("h7").Value=kk_2_5_47423;
obSheet.Range("i6").Value=pz_1_30_47423;obSheet.Range("j6").Value=pz_1_90_47423;obSheet.Range("k6").Value=pz_1_180_47423;obSheet.Range("l6").Value=pz_1_b180_47423;
obSheet.Range("i7").Value=pz_2_30_47423;obSheet.Range("j7").Value=pz_2_90_47423;obSheet.Range("k7").Value=pz_2_180_47423;obSheet.Range("l7").Value=pz_2_b180_47423;
obSheet.Range("m6").Value=fr_1_it_47423;obSheet.Range("n6").Value=fr_1_2_47423;obSheet.Range("o6").Value=fr_1_3_47423;obSheet.Range("p6").Value=fr_1_4_47423;obSheet.Range("q6").Value=fr_1_5_47423;
obSheet.Range("m7").Value=fr_2_it_47423;obSheet.Range("n7").Value=fr_2_2_47423;obSheet.Range("o7").Value=fr_2_3_47423;obSheet.Range("p7").Value=fr_2_4_47423;obSheet.Range("q7").Value=fr_2_5_47423;

obSheet.Range("g13").Value=os_1_st_47423; obSheet.Range("j13").Value=os_1_sr_47423; 
obSheet.Range("g15").Value=os_11_st_47423;obSheet.Range("j15").Value=os_11_sr_47423;
obSheet.Range("g16").Value=os_12_st_47423;obSheet.Range("j16").Value=os_12_sr_47423;
obSheet.Range("g17").Value=os_13_st_47423;obSheet.Range("j17").Value=os_13_sr_47423;
obSheet.Range("g18").Value=os_14_st_47423;obSheet.Range("j18").Value=os_14_sr_47423;
obSheet.Range("g19").Value=os_15_st_47423;obSheet.Range("j19").Value=os_15_sr_47423;
obSheet.Range("g20").Value=os_2_st_47423; obSheet.Range("j20").Value=os_2_sr_47423; 
obSheet.Range("g22").Value=os_21_st_47423;obSheet.Range("j22").Value=os_21_sr_47423;
//debugbreak;
[

Дебиторская задолженность ЮЛ по счетам 459 по состоянию на ##########
Индивидуальные ссуды                                                                                                                            
┌───┬────────────┬────────────┬──────────────────────────────────────────────────────────────────┬────────────────────────────────────────────────────┬────────────────────────────────────────────────────────────────┐
│№  │Состав      │Сумма       │       категория качества                                         │Просроченная  задолженность                         │Фактически сформированный  резерв                               │        
│   │активов     │требования  ├────────────┬─────────────┬─────────────┬────────────┬────────────┼────────────┬────────────┬─────────────┬────────────┼────────────┬────────────┬────────────┬────────────┬────────────┤
│   │            │            │    1       │     2       │    3        │    4       │    5       │до 30 дней  │от 31 до 90 │от 91 до 180 │свыше 180   │Итого       │    2       │     3      │    4       │    5       │
├───┼────────────┼────────────┼────────────┼─────────────┼─────────────┼────────────┼────────────┼────────────┼────────────┼─────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
│ 1 │прочие      │############│############│#############│#############│############│############│############│############│#############│############│############│############│############│############│############│
│   │требования  │            │            │             │             │            │            │            │            │             │            │            │            │            │            │            │
├───┼────────────┼────────────┼────────────┼─────────────┼─────────────┼────────────┼────────────┼────────────┼────────────┼─────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
│ 2 │Требования  │############│############│#############│#############│############│############│############│############│#############│############│############│############│############│############│############│
│   │по получению│            │            │             │             │            │            │            │            │             │            │            │            │            │            │            │
│   │процентов   │            │            │             │             │            │            │            │            │             │            │            │            │            │            │            │
└───┴────────────┴────────────┴────────────┴─────────────┴─────────────┴────────────┴────────────┴────────────┴────────────┴─────────────┴────────────┴────────────┴────────────┴────────────┴────────────┴────────────┘

 Однородные ссуды                                                                                        
┌───┬───────────────────────────────────────┬───────────────┬───────────────┐
│№  │   Наименование статьи                 │ Сумма треб.   │ Сформ. резерв │
│───┼───────────────────────────────────────┼───────────────┼───────────────┤
│1  │   Прочие требования                   │###############│###############│ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│   │   из них:                             │               │               │        
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│1.1│   нет резерва - 1 категория           │###############│###############│        
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│1.2│   резерв от 0 до 3 - 2 категория      │###############│###############│ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│1.3│   резерв свыше 3 до 20 - 3 категория  │###############│###############│ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│1.4│   резерв свыше 20 до 50 - 4 категория │###############│###############│ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│1.5│   резерв свыше 50 - 5 категория       │###############│###############│ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│2  │   Требования по получению процентов   │###############│###############│ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│   │   из них:                             │               │               │ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│2.1│   резерв свыше 20                     │###############│###############│ 
└───┴───────────────────────────────────────┴───────────────┴───────────────┘ 

]


(date_ot4, is_1_streb_459:10:1,kk_1_1_459:8:2,kk_1_2_459:7:1,kk_1_3_459:8:2,kk_1_4_459:8:2,kk_1_5_459:8:2,pz_1_30_459:8:2,pz_1_90_459:8:2,pz_1_180_459:8:2,pz_1_b180_459:8:2,fr_1_it_459:8:2,fr_1_2_459:8:2,fr_1_3_459:8:2,fr_1_4_459:8:2,fr_1_5_459:8:2,
					 is_2_streb_459:10:1,kk_2_1_459:8:1,kk_2_2_459:8:2,kk_2_3_459:8:2,kk_2_4_459:8:2,kk_2_5_459:8:2,pz_2_30_459:8:2,pz_2_90_459:8:2,pz_2_180_459:8:2,pz_2_b180_459:8:2,fr_2_it_459:8:2,fr_2_2_459:8:2,fr_2_3_459:8:2,fr_2_4_459:8:2,fr_2_5_459:8:2,
os_1_st_459:10:1,os_1_sr_459:10:1,os_11_st_459:10:1,os_11_sr_459:10:1,os_12_st_459:10:1,os_12_sr_459:10:1,os_13_st_459:10:1,os_13_sr_459:10:1,os_14_st_459:10:1,os_14_sr_459:10:1,os_15_st_459:10:1,os_15_sr_459:10:1,
os_2_st_459:8:1,os_2_sr_459:8:1,os_21_st_459:8:1,os_21_sr_459:8:1
);

ex.sheets("459").select;
obSheet = obBook.ActiveSheet(); 
obSheet.Range("j1").Value=date_ot4;
obSheet.Range("c6").Value=is_1_streb_459;obSheet.Range("d6").Value=kk_1_1_459;obSheet.Range("e6").Value=kk_1_2_459;
obSheet.Range("c7").Value=is_2_streb_459;obSheet.Range("d7").Value=kk_2_1_459;obSheet.Range("e7").Value=kk_2_2_459;
obSheet.Range("f6").Value=kk_1_3_459;obSheet.Range("g6").Value=kk_1_4_459;obSheet.Range("h6").Value=kk_1_5_459;
obSheet.Range("f7").Value=kk_2_3_459;obSheet.Range("g7").Value=kk_2_4_459;obSheet.Range("h7").Value=kk_2_5_459;
obSheet.Range("i6").Value=pz_1_30_459;obSheet.Range("j6").Value=pz_1_90_459;obSheet.Range("k6").Value=pz_1_180_459;obSheet.Range("l6").Value=pz_1_b180_459;
obSheet.Range("i7").Value=pz_2_30_459;obSheet.Range("j7").Value=pz_2_90_459;obSheet.Range("k7").Value=pz_2_180_459;obSheet.Range("l7").Value=pz_2_b180_459;
obSheet.Range("m6").Value=fr_1_it_459;obSheet.Range("n6").Value=fr_1_2_459;obSheet.Range("o6").Value=fr_1_3_459;obSheet.Range("p6").Value=fr_1_4_459;obSheet.Range("q6").Value=fr_1_5_459;
obSheet.Range("m7").Value=fr_2_it_459;obSheet.Range("n7").Value=fr_2_2_459;obSheet.Range("o7").Value=fr_2_3_459;obSheet.Range("p7").Value=fr_2_4_459;obSheet.Range("q7").Value=fr_2_5_459;

obSheet.Range("g13").Value=os_1_st_459; obSheet.Range("j13").Value=os_1_sr_459; 
obSheet.Range("g15").Value=os_11_st_459;obSheet.Range("j15").Value=os_11_sr_459;
obSheet.Range("g16").Value=os_12_st_459;obSheet.Range("j16").Value=os_12_sr_459;
obSheet.Range("g17").Value=os_13_st_459;obSheet.Range("j17").Value=os_13_sr_459;
obSheet.Range("g18").Value=os_14_st_459;obSheet.Range("j18").Value=os_14_sr_459;
obSheet.Range("g19").Value=os_15_st_459;obSheet.Range("j19").Value=os_15_sr_459;
obSheet.Range("g20").Value=os_2_st_459; obSheet.Range("j20").Value=os_2_sr_459; 
obSheet.Range("g22").Value=os_21_st_459;obSheet.Range("j22").Value=os_21_sr_459;



pz_1_30_47427=0;pz_1_90_47427=0;pz_1_180_47427=0;pz_1_b180_47427=0;
pz_2_30_47427=0;pz_2_90_47427=0;pz_2_180_47427=0;pz_2_b180_47427=0;
[

Дебиторская задолженность ЮЛ по счетам 47427 по состоянию на ##########
Индивидуальные ссуды                                                                                                                            
┌───┬────────────┬────────────┬──────────────────────────────────────────────────────────────────┬────────────────────────────────────────────────────┬────────────────────────────────────────────────────────────────┐
│№  │Состав      │Сумма       │       категория качества                                         │Просроченная  задолженность                         │Фактически сформированный  резерв                               │        
│   │активов     │требования  ├────────────┬─────────────┬─────────────┬────────────┬────────────┼────────────┬────────────┬─────────────┬────────────┼────────────┬────────────┬────────────┬────────────┬────────────┤
│   │            │            │    1       │     2       │    3        │    4       │    5       │до 30 дней  │от 31 до 90 │от 91 до 180 │свыше 180   │Итого       │    2       │     3      │    4       │    5       │
├───┼────────────┼────────────┼────────────┼─────────────┼─────────────┼────────────┼────────────┼────────────┼────────────┼─────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
│ 1 │прочие      │############│############│#############│#############│############│############│############│############│#############│############│############│############│############│############│############│
│   │требования  │            │            │             │             │            │            │            │            │             │            │            │            │            │            │            │
├───┼────────────┼────────────┼────────────┼─────────────┼─────────────┼────────────┼────────────┼────────────┼────────────┼─────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
│ 2 │Требования  │############│############│#############│#############│############│############│############│############│#############│############│############│############│############│############│############│
│   │по получению│            │            │             │             │            │            │            │            │             │            │            │            │            │            │            │
│   │процентов   │            │            │             │             │            │            │            │            │             │            │            │            │            │            │            │
└───┴────────────┴────────────┴────────────┴─────────────┴─────────────┴────────────┴────────────┴────────────┴────────────┴─────────────┴────────────┴────────────┴────────────┴────────────┴────────────┴────────────┘

 Однородные ссуды                                                                                        
┌───┬───────────────────────────────────────┬───────────────┬───────────────┐
│№  │   Наименование статьи                 │ Сумма треб.   │ Сформ. резерв │
│───┼───────────────────────────────────────┼───────────────┼───────────────┤
│1  │   Прочие требования                   │###############│###############│ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│   │   из них:                             │               │               │        
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│1.1│   нет резерва - 1 категория           │###############│###############│        
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│1.2│   резерв от 0 до 3 - 2 категория      │###############│###############│ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│1.3│   резерв свыше 3 до 20 - 3 категория  │###############│###############│ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│1.4│   резерв свыше 20 до 50 - 4 категория │###############│###############│ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│1.5│   резерв свыше 50 - 5 категория       │###############│###############│ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│2  │   Требования по получению процентов   │###############│###############│ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│   │   из них:                             │               │               │ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│2.1│   резерв свыше 20                     │###############│###############│ 
└───┴───────────────────────────────────────┴───────────────┴───────────────┘ 

]
(date_ot4, is_1_streb_47427:10:1,kk_1_1_47427:8:2,kk_1_2_47427:7:1,kk_1_3_47427:8:2,kk_1_4_47427:8:2,kk_1_5_47427:8:2,pz_1_30_47427:8:2,pz_1_90_47427:8:2,pz_1_180_47427:8:2,pz_1_b180_47427:8:2,fr_1_it_47427:8:2,fr_1_2_47427:8:2,fr_1_3_47427:8:2,fr_1_4_47427:8:2,fr_1_5_47427:8:2,
					 is_2_streb_47427:10:1,kk_2_1_47427:8:1,kk_2_2_47427:8:2,kk_2_3_47427:8:2,kk_2_4_47427:8:2,kk_2_5_47427:8:2,pz_2_30_47427:8:2,pz_2_90_47427:8:2,pz_2_180_47427:8:2,pz_2_b180_47427:8:2,fr_2_it_47427:8:2,fr_2_2_47427:8:2,fr_2_3_47427:8:2,fr_2_4_47427:8:2,fr_2_5_47427:8:2,
os_1_st_47427:10:1,os_1_sr_47427:10:1,os_11_st_47427:10:1,os_11_sr_47427:10:1,os_12_st_47427:10:1,os_12_sr_47427:10:1,os_13_st_47427:10:1,os_13_sr_47427:10:1,os_14_st_47427:10:1,os_14_sr_47427:10:1,os_15_st_47427:10:1,os_15_sr_47427:10:1,
os_2_st_47427:8:1,os_2_sr_47427:8:1,os_21_st_47427:8:1,os_21_sr_47427:8:1
);

ex.sheets("47427").select;
obSheet = obBook.ActiveSheet(); 
obSheet.Range("j1").Value=date_ot4;
obSheet.Range("c6").Value=is_1_streb_47427;obSheet.Range("d6").Value=kk_1_1_47427;obSheet.Range("e6").Value=kk_1_2_47427;
obSheet.Range("c7").Value=is_2_streb_47427;obSheet.Range("d7").Value=kk_2_1_47427;obSheet.Range("e7").Value=kk_2_2_47427;
obSheet.Range("f6").Value=kk_1_3_47427;obSheet.Range("g6").Value=kk_1_4_47427;obSheet.Range("h6").Value=kk_1_5_47427;
obSheet.Range("f7").Value=kk_2_3_47427;obSheet.Range("g7").Value=kk_2_4_47427;obSheet.Range("h7").Value=kk_2_5_47427;
obSheet.Range("i6").Value=pz_1_30_47427;obSheet.Range("j6").Value=pz_1_90_47427;obSheet.Range("k6").Value=pz_1_180_47427;obSheet.Range("l6").Value=pz_1_b180_47427;
obSheet.Range("i7").Value=pz_2_30_47427;obSheet.Range("j7").Value=pz_2_90_47427;obSheet.Range("k7").Value=pz_2_180_47427;obSheet.Range("l7").Value=pz_2_b180_47427;
obSheet.Range("m6").Value=fr_1_it_47427;obSheet.Range("n6").Value=fr_1_2_47427;obSheet.Range("o6").Value=fr_1_3_47427;obSheet.Range("p6").Value=fr_1_4_47427;obSheet.Range("q6").Value=fr_1_5_47427;
obSheet.Range("m7").Value=fr_2_it_47427;obSheet.Range("n7").Value=fr_2_2_47427;obSheet.Range("o7").Value=fr_2_3_47427;obSheet.Range("p7").Value=fr_2_4_47427;obSheet.Range("q7").Value=fr_2_5_47427;

obSheet.Range("g13").Value=os_1_st_47427; obSheet.Range("j13").Value=os_1_sr_47427; 
obSheet.Range("g15").Value=os_11_st_47427;obSheet.Range("j15").Value=os_11_sr_47427;
obSheet.Range("g16").Value=os_12_st_47427;obSheet.Range("j16").Value=os_12_sr_47427;
obSheet.Range("g17").Value=os_13_st_47427;obSheet.Range("j17").Value=os_13_sr_47427;
obSheet.Range("g18").Value=os_14_st_47427;obSheet.Range("j18").Value=os_14_sr_47427;
obSheet.Range("g19").Value=os_15_st_47427;obSheet.Range("j19").Value=os_15_sr_47427;
obSheet.Range("g20").Value=os_2_st_47427; obSheet.Range("j20").Value=os_2_sr_47427; 
obSheet.Range("g22").Value=os_21_st_47427;obSheet.Range("j22").Value=os_21_sr_47427;



[

Дебиторская задолженность ЮЛ по счетам 60323 по состоянию на ##########
Индивидуальные ссуды                                                                                                                            
┌───┬────────────┬────────────┬──────────────────────────────────────────────────────────────────┬────────────────────────────────────────────────────┬────────────────────────────────────────────────────────────────┐
│№  │Состав      │Сумма       │       категория качества                                         │Просроченная  задолженность                         │Фактически сформированный  резерв                               │        
│   │активов     │требования  ├────────────┬─────────────┬─────────────┬────────────┬────────────┼────────────┬────────────┬─────────────┬────────────┼────────────┬────────────┬────────────┬────────────┬────────────┤
│   │            │            │    1       │     2       │    3        │    4       │    5       │до 30 дней  │от 31 до 90 │от 91 до 180 │свыше 180   │Итого       │    2       │     3      │    4       │    5       │
├───┼────────────┼────────────┼────────────┼─────────────┼─────────────┼────────────┼────────────┼────────────┼────────────┼─────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
│ 1 │прочие      │############│############│#############│#############│############│############│############│############│#############│############│############│############│############│############│############│
│   │требования  │            │            │             │             │            │            │            │            │             │            │            │            │            │            │            │
├───┼────────────┼────────────┼────────────┼─────────────┼─────────────┼────────────┼────────────┼────────────┼────────────┼─────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
│ 2 │Требования  │############│############│#############│#############│############│############│############│############│#############│############│############│############│############│############│############│
│   │по получению│            │            │             │             │            │            │            │            │             │            │            │            │            │            │            │
│   │процентов   │            │            │             │             │            │            │            │            │             │            │            │            │            │            │            │
└───┴────────────┴────────────┴────────────┴─────────────┴─────────────┴────────────┴────────────┴────────────┴────────────┴─────────────┴────────────┴────────────┴────────────┴────────────┴────────────┴────────────┘

 Однородные ссуды                                                                                        
┌───┬───────────────────────────────────────┬───────────────┬───────────────┐
│№  │   Наименование статьи                 │ Сумма треб.   │ Сформ. резерв │
│───┼───────────────────────────────────────┼───────────────┼───────────────┤
│1  │   Прочие требования                   │###############│###############│ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│   │   из них:                             │               │               │        
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│1.1│   нет резерва - 1 категория           │###############│###############│        
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│1.2│   резерв от 0 до 3 - 2 категория      │###############│###############│ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│1.3│   резерв свыше 3 до 20 - 3 категория  │###############│###############│ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│1.4│   резерв свыше 20 до 50 - 4 категория │###############│###############│ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│1.5│   резерв свыше 50 - 5 категория       │###############│###############│ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│2  │   Требования по получению процентов   │###############│###############│ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│   │   из них:                             │               │               │ 
├───┼───────────────────────────────────────┼───────────────┼───────────────┤
│2.1│   резерв свыше 20                     │###############│###############│ 
└───┴───────────────────────────────────────┴───────────────┴───────────────┘ 
                              
]
(date_ot4, is_1_streb_60323:10:1,kk_1_1_60323:8:2,kk_1_2_60323:7:1,kk_1_3_60323:8:2,kk_1_4_60323:8:2,kk_1_5_60323:8:2,pz_1_30_60323:8:2,pz_1_90_60323:8:2,pz_1_180_60323:8:2,pz_1_b180_60323:8:2,fr_1_it_60323:8:2,fr_1_2_60323:8:2,fr_1_3_60323:8:2,fr_1_4_60323:8:2,fr_1_5_60323:8:2,
					 is_2_streb_60323:10:1,kk_2_1_60323:10:1,kk_2_2_60323:10:1,kk_2_3_60323:10:1,kk_2_4_60323:10:1,kk_2_5_60323:10:1,pz_2_30_60323:8:2,pz_2_90_60323:8:2,pz_2_180_60323:8:2,pz_2_b180_60323:8:2,fr_2_it_60323:8:2,fr_2_2_60323:8:2,fr_2_3_60323:8:2,fr_2_4_60323:8:2,fr_2_5_60323:8:2,
os_1_st_60323:10:1,os_1_sr_60323:10:1,os_11_st_60323:10:1,os_11_sr_60323:10:1,os_12_st_60323:10:1,os_12_sr_60323:10:1,os_13_st_60323:10:1,os_13_sr_60323:10:1,os_14_st_60323:10:1,os_14_sr_60323:10:1,os_15_st_60323:10:1,os_15_sr_60323:10:1,
os_2_st_60323:8:1,os_2_sr_60323:8:1,os_21_st_60323:8:1,os_21_sr_60323:8:1
);

ex.sheets("60323").select;
obSheet = obBook.ActiveSheet(); 
obSheet.Range("j1").Value=date_ot4;
obSheet.Range("c6").Value=is_1_streb_60323;obSheet.Range("d6").Value=kk_1_1_60323;obSheet.Range("e6").Value=kk_1_2_60323;
obSheet.Range("c7").Value=is_2_streb_60323;obSheet.Range("d7").Value=kk_2_1_60323;obSheet.Range("e7").Value=kk_2_2_60323;
obSheet.Range("f6").Value=kk_1_3_60323;obSheet.Range("g6").Value=kk_1_4_60323;obSheet.Range("h6").Value=kk_1_5_60323;
obSheet.Range("f7").Value=kk_2_3_60323;obSheet.Range("g7").Value=kk_2_4_60323;obSheet.Range("h7").Value=kk_2_5_60323;
obSheet.Range("i6").Value=pz_1_30_60323;obSheet.Range("j6").Value=pz_1_90_60323;obSheet.Range("k6").Value=pz_1_180_60323;obSheet.Range("l6").Value=pz_1_b180_60323;
obSheet.Range("i7").Value=pz_2_30_60323;obSheet.Range("j7").Value=pz_2_90_60323;obSheet.Range("k7").Value=pz_2_180_60323;obSheet.Range("l7").Value=pz_2_b180_60323;
obSheet.Range("m6").Value=fr_1_it_60323;obSheet.Range("n6").Value=fr_1_2_60323;obSheet.Range("o6").Value=fr_1_3_60323;obSheet.Range("p6").Value=fr_1_4_60323;obSheet.Range("q6").Value=fr_1_5_60323;
obSheet.Range("m7").Value=fr_2_it_60323;obSheet.Range("n7").Value=fr_2_2_60323;obSheet.Range("o7").Value=fr_2_3_60323;obSheet.Range("p7").Value=fr_2_4_60323;obSheet.Range("q7").Value=fr_2_5_60323;

obSheet.Range("g13").Value=os_1_st_60323; obSheet.Range("j13").Value=os_1_sr_60323; 
obSheet.Range("g15").Value=os_11_st_60323;obSheet.Range("j15").Value=os_11_sr_60323;
obSheet.Range("g16").Value=os_12_st_60323;obSheet.Range("j16").Value=os_12_sr_60323;
obSheet.Range("g17").Value=os_13_st_60323;obSheet.Range("j17").Value=os_13_sr_60323;
obSheet.Range("g18").Value=os_14_st_60323;obSheet.Range("j18").Value=os_14_sr_60323;
obSheet.Range("g19").Value=os_15_st_60323;obSheet.Range("j19").Value=os_15_sr_60323;
obSheet.Range("g20").Value=os_2_st_60323; obSheet.Range("j20").Value=os_2_sr_60323; 
obSheet.Range("g22").Value=os_21_st_60323;obSheet.Range("j22").Value=os_21_sr_60323;


   
end;





