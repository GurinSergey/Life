/*+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

    ███████       █████      █████     ███
    █████████   ████████   ████████    ███
    ███   ███   ███        ███         ███
    ████████     ███████    ███████    ███
    ██████            ███        ███   ███
    ███ ████    █████████  █████████   ████████
    ███   ████    █████      █████     ████████

   R-Style Softlab
   
   Имя файла fm_ground.mac

   Описание: Вспомогательные проверки использующиеся макросом fm_scan.mac

   ChangeLog:
-----------------------------------------------------------------------------------------------------------------------------------------------------
//KS 26.11.2013 Адаптации под 31ю сборку не требуется
-----------------------------------------------------------------------------------------------------------------------------------------------------
//RR 16.03.2014 Убраны переменные CheckedGround и GroundWordArray, в замен используем глобальные переменные RR_Checked_Ground, RR_Ground_Word_Array
-----------------------------------------------------------------------------------------------------------------------------------------------------
//RR 25.03.2015 В функцию CheckCode5007 добавлена проверка на новое словосочетание по заявке R-561517-2
//VEA 26.03.2015 Добавлены новые словосочетания по письму Афониной
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/

Import "fm_util.mac";

private var PayerID    : integer;
private var ReceiverID : integer;

private var PayerBankID    : integer;
private var ReceiverBankID : integer;

private var ClientPayerAccount    : bool;
private var ClientReceiverAccount : bool;

var SetCodeFlag : bool; /* признак того, что операции был задан код */

/* разбивет строку на массив слов */
 macro SplitStringByWord( WordArray : TArray, InitialString : string )
  var EndWordPos : integer;
  var CurWord : string, CurString : string;
  var iWord : integer;
           
  CurString = Trim(InitialString);

  iWord = 0;

  while( CurString != "" )
  
    /* ищем, где находится первый пробел в строке */
    EndWordPos = Index( CurString, " " );
    
    if( EndWordPos == 0 )
      
      /* в строке находится целое слово */
      CurWord = CurString;

    else

      /* определяем первое слово в строке */
      CurWord = SubStr( CurString, 1, (EndWordPos - 1) );

    end;
    
    /* заносим слово в массив слов */
    WordArray(iWord) = CurWord;
    iWord = iWord + 1;

    CurString = Trim(SubStr(CurString, EndWordPos));
    
  end;
  
end;

/* заменить символы одинакового начертания */
private macro ReplaceSymbols( InitialString : string ) : string

  InitialString = StrSubst( InitialString, "Ё", "Е" );
  InitialString = StrSubst( InitialString, "A", "А" );
  InitialString = StrSubst( InitialString, "B", "В" );
  InitialString = StrSubst( InitialString, "C", "С" );
  InitialString = StrSubst( InitialString, "E", "Е" );
  InitialString = StrSubst( InitialString, "H", "Н" );
  InitialString = StrSubst( InitialString, "K", "К" );
  InitialString = StrSubst( InitialString, "M", "М" );
  InitialString = StrSubst( InitialString, "O", "О" );
  InitialString = StrSubst( InitialString, "P", "Р" );
  InitialString = StrSubst( InitialString, "T", "Т" );
  InitialString = StrSubst( InitialString, "X", "Х" );

  return InitialString;

end;

/* преобразовать основание для проверки */
 macro ConvertString( InitialString : string ) : string

  var ResultString : string;
  var i : integer, len : integer;
  var DelimiterString = ".,()[]\"&<>{}!?";

  Trim( InitialString );

  /* преобразуем к верхнему регистру */
  ResultString = StrUpr( InitialString );

  /* заменим разделители на пробелы */
  i = 0; len = StrLen( DelimiterString );
  while( i < len )
    i = i + 1;
    ResultString = StrSubst( ResultString, SubStr(DelimiterString, i, 1), " " );
  end;

  ResultString = ReplaceSymbols( ResultString );

  /* добавим пробел в конец строки */
  ResultString = ResultString + " ";

  return ResultString;

end;

/* определить параметры участников операции */
private macro InitPartyParameters( FMOperation : RsbFMOperation )

  ClientPayerAccount    = IsClientAccount( FMOperation.OprParty(_FM_PARTY_PAYER   ).Account );
  ClientReceiverAccount = IsClientAccount( FMOperation.OprParty(_FM_PARTY_RECEIVER).Account );

end;

/* установить код операции */
macro SetOperationCode( FMOperation : RsbFMOperation, Code : string, CodeType : integer )
  
  SetCodeFlag = true;
  FMOperation.AddCode( Code, CodeType );

end;

macro SetOperationCodeUO( FMOperation : RsbFMOperation, Code3X : string, Code4X : string )
  
  SetCodeFlag = true;
  FMOperation.AddCodeUO( Code3X, Code4X );

end;

/* проверить, есть ли слово в основании */
private macro IsWordInString( CheckedString : string, CheckedWord : string )
  
  CheckedWord = StrUpr( CheckedWord );
  
  if( (Index(CheckedString, " " + CheckedWord)) or (SubStr(CheckedString, 1, strlen(CheckedWord)) == CheckedWord) )
    return true;
  end;

  return false;
end;

/* проверить, являются ли два слова соседними */
private macro IsNeighboringWords( WordArray : TArray, CheckedWord1 : string, CheckedWord2 : string, RightOrder : bool )

  var i : integer, nWords : integer;
  var stat : bool;

  stat = false;

  if( RightOrder == null ) RightOrder = false; end;

  CheckedWord1 = StrUpr( CheckedWord1 );
  CheckedWord2 = StrUpr( CheckedWord2 );

  i = 0;
  nWords = WordArray.Size - 1;

  while( (i < nWords) and (stat == false) )

    if( (IsWordInString(WordArray(i), CheckedWord1)) and IsWordInString(WordArray(i + 1),CheckedWord2) )

      stat = true;

    elif( not RightOrder )

     if( (IsWordInString(WordArray(i), CheckedWord2)) and IsWordInString(WordArray(i + 1),CheckedWord1) )
      
        stat = true; /* слова являются соседними */

     end;
    
    end;

    i = i + 1;

  end;

  return stat;

end;

/* проверить счета операции на принадлжность */
macro CompareOperationAccountsWithMask( FMOperation : RsbFMOperation, AccMask : string ) : bool

  return (CompareStrWithMasks(AccMask, FMOperation.OprParty(_FM_PARTY_PAYER   ).Account) == 0)
      or (CompareStrWithMasks(AccMask, FMOperation.OprParty(_FM_PARTY_RECEIVER).Account) == 0);

end;

/* проверка на код 1008 - внесение денег в уставной капитал */
private macro CheckCode1008( FMOperation : RsbFMOperation )

  if( (ReceiverBankID == {OurBank}) and (ClientReceiverAccount == true) and (FMOperation.OprParty(_FM_PARTY_RECEIVER).PartyType == "Ю") )

    if( (((IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "УСТАВ")) or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "СКЛАДОЧН")))
    and ((IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ФОНД" )) or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "КАП"     )))) 
     or  (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "УСТАВ")) or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "КАПИТАЛ"   ))
    
      )

      SetOperationCode( FMOperation, "1008" );
    
    end;

  end;

end;

/* проверка на код 5001 - помещение ценностей в ломбард */
private macro CheckCode5001( FMOperation : RsbFMOperation )

  var NormPayerName = ConvertString( FMOperation.OprParty(_FM_PARTY_PAYER).Name );

  if( (IsWordInString(NormPayerName, "ЛОМБАРД")) or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЛОМБАРД")) )
    SetOperationCode( FMOperation, "5001" );
  end;

end;

/* проверка на код 5002 - выплата страхового возмещения */
private macro CheckCode5002( FMOperation : RsbFMOperation );

  if( (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "АННУИТЕТ"))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "АНУИТЕТ" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ВЫПЛАТ" ))
   or ((IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "СТРАХ") or IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ПЕРЕСТР"))
     and
       ( (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЖИЗН"   ))
      or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ПОЛИС"  ))
      or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "НАКОПИТ"  ))
      or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "БОЛЕЗН" ))
      or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "МЕДИЦИН"))
      or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ПРЕМ"  ))
      or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ВОЗМЕЩ" ))
      or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ВЫПЛ" ))
      or ((IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЛИЧН")) and (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "НАКОПИТ")))
      or ((IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "НЕСЧ")) and (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "СЛУЧ"   )))
       )
      )
   or ((IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ПЕНС")) 
     and 
       ( (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ОБЕСП"))
      or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "СТРАХ"))
       )
      )
      
    )

    SetOperationCode( FMOperation, "5002" );

  end;

end;

/* проверить на код 5003 */
private macro CheckCode5003( FMOperation : RsbFMOperation ) : integer
  
  if( CompareOperationAccountsWithMask(FMOperation, "47701*, 608*, 61211*, 91506*") )

    SetOperationCode( FMOperation, "5003" );
    
  elif( CompareOperationAccountsWithMask(FMOperation, "401* - 408*, 91501*, 91507*") )
      
    if( (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЛИЗИНГ" ))
     or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЛИЗ "   ))
     or (IsNeighboringWords(GetGlobalParameter("RR_Ground_Word_Array", false), "ФИНАНС", "АРЕНД"))
      )
      SetOperationCode( FMOperation, "5003" );
    end;

  end; 

end;

/* проверка на код 5005 - скупка юв. изделий */
private macro CheckCode5005( FMOperation : RsbFMOperation )

  if( (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЗОЛОТ" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "СЕРЕБР"))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ПЛАТИН"))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ПАЛАД" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ПАЛЛАД"))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "РУБИН" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "СИПФИР" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ИЗУМРУД" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "АЛМАЗ" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "БРИЛИАН" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ДРАГ" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ДРАГОЦЕН" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "МЕТАЛ" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "СЛИТОК" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "КАМН" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЮВЕЛИР" ))
   or ((IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ДРАГ")) and (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "МЕТАЛ")))
   or (IsNeighboringWords(GetGlobalParameter("RR_Ground_Word_Array", false), "ЮВ", "ИЗД"))
    )

    SetOperationCode( FMOperation, "5005" );
  
  end;

end;

/* проверка на код 5006 - получение выигрыша в лоттерею  */
private macro CheckCode5006( FMOperation : RsbFMOperation )

  if( (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЛОТЕРЕ" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ТОТАЛИЗ"))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ПАРИ "  ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ВЫИГРЫШ"))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "РОЗЫГРЫШ"))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ВЫЙГРЫШ"  ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ИГОРН"  ))
    )

    SetOperationCode( FMOperation, "5006" );

  end;

end;

/* проверка на принадлежность операции к займам */
private macro CheckCode5007( FMOperation : RsbFMOperation )
  
  if( (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ПОМОЩ"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "БЛАГОТВОРИТ"))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ПОЖЕРТВ"    ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "СПОНС"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "БЕЗВОЗМЕЗД" ))
   or (IsNeighboringWords(GetGlobalParameter("RR_Ground_Word_Array", false), "БЕЗ", "ПРОЦ"))
   or ((
        (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "БЕСПРОЦ")) or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "БЕСПР "))
    or  (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "БЕЗПРОЦ")) or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "БЕЗПР "))
       )
   and ((IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "КРЕДИТ" ))
     or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ССУД" ))
     or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЗАЕМ" ))
     or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЗАЁМ" ))
     or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЗАЙМ" ))))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЗАЙМ" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЗАИМ" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЗАЁМ" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЗАЕМ" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ССУДА" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЗАЙИА" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "БЕЗ ПРО" ))
/* ----- 26.03.2015 ------------------------------------------------------------- */
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ФИН" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "КРЕД" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "СУД" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЖЕРТВ" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЦЖЗ" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "LOAN" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ANLEIHE" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "EMPRUNT" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ZAIM" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "BORROW" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "EMPRUNTS" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ZAEM" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "FIN" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "HELP" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "HILFE" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "AID" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "POMOSH" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "CREDIT" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "KREDIT" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "PRET" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "SSUDA" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "DON" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "SRENDE" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ZERTV" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "TEMPRUNT DE LODEMENT" ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ZUWENDUNG" ))

    )

     SetOperationCode( FMOperation, "5007" );

  end;

end;

/* Проверка на принадлежность операции сделкам с недвижимостью */
private macro CheckCode8001( FMOperation : RsbFMOperation )
  
  var stat : integer;
  var ImmDealRegVal;

  stat = 0;
  /* проверим на принадлежность операции сделкам с недвижимостью */
  if( (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "АРЕНД"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "СУБАРЕНД"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ИМУЩ"       ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "НЕДВИЖ"     ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЗДАН"       ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "СООРУЖЕН"   ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ПОМЕЩ"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЗАЛОГ"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "КВАРТИР"    ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ИПОТЕК"     ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "АЭРОСТАТ"   ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ДИРИЖАБЛ"   ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ПЛАНЕР"     ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ВЕРТОЛЕТ"   ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "САМОЛЕТ"    ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "КОСМИЧ"  ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ТРУБОПРОВ"  ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "НАСАЖДЕН"   ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЛЕСН"       ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "УЧАСТОК"    ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "УЧАСТК"     ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ОБЪЕКТ"     ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЗЕМЛ"       ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ИНВЕСТ"     ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЖИЛЬ"       ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "СТРОИТЕЛ"))
//   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "СМР"        ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "РЕНТ"       ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ДАЧ"        ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "СТР-В"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЯХТ"        ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "КАТЕР"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ДОМ"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ФРАХТ"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "МОРСК"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "РЕКОНСТРУК"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЛЕДОКОЛ"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ПРЕДПРИЯТ"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "РАКЕТ"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ПЛАВСРЕДСТВ"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ГАРАЖ"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "БАРЖА"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "СУДН"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ВОЗДУШН"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "МОРСК"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "НЕЖИЛ"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЗЕМЕЛЬН"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ВИНОГРАДН"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "САДЫ"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "НЕДРА"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЖИЛОЕ"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ИПОТЕЧН"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ДОЛЕВ"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "НАЙМ"      ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "НАЕМ"      ))
   or (IsNeighboringWords(GetGlobalParameter("RR_Ground_Word_Array", false), "ЖИЛ"       , "ДОМ"    ))
   or (IsNeighboringWords(GetGlobalParameter("RR_Ground_Word_Array", false), "ВОЗДУШН"   , "СУД"    ))
   or (IsNeighboringWords(GetGlobalParameter("RR_Ground_Word_Array", false), "ЖЕЛЕЗНОДОР", "ПУТ"    ))
   or (IsNeighboringWords(GetGlobalParameter("RR_Ground_Word_Array", false), "АВТОТР"    , "МАГИСТР"))
   or (IsNeighboringWords(GetGlobalParameter("RR_Ground_Word_Array", false), "ДОЛЕВ"     , "ФИНАНС" ))
    )

    //if( FMOperation.SumEquivalent >= $3000000 )
      SetOperationCode( FMOperation, "8001" );
   /* else
      ImmDealRegVal = GetImmDealRegVal();      
      if( (SetCodeFlag == false) and (ImmDealRegVal == false) )
        stat = 1;
      end;
    end;   */
  
  end;

  return stat;

end;

/* проверка на код 901 (необычные операции) */
 macro CheckUnusualOperations( FMOperation : RsbFMOperation )
  
  var SetCode = false;
  
  if( (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "В СЧЕТ В/Р"    ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "В СЧЕТ ВЗАИМОР"))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "КЛИРИНГ"       ))
    )
   
    SetOperationCodeUO( FMOperation, "901", "1699" );
    SetCode = true;
  end;

  if( (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ПОПОЛН"        ))
   or (((IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ПЕРЕВОД")) or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ПЕРЕЧ")))
    and ( (IsNeighboringWords(GetGlobalParameter("RR_Ground_Word_Array", false), "СОБСТВ", "СР", true))
       or (IsNeighboringWords(GetGlobalParameter("RR_Ground_Word_Array", false), "СОБСТВ", "СЧ", true))
       or (IsNeighboringWords(GetGlobalParameter("RR_Ground_Word_Array", false), "ДЕНЕЖ" , "СР", true))
       or (IsNeighboringWords(GetGlobalParameter("RR_Ground_Word_Array", false), "ДЕНЕЖ" , "СЧ", true))
        )
      )
    )

    SetOperationCodeUO( FMOperation, "901", "1199" );
    SetCode = true;
  end;

  return SetCode;
end;

/* проверка операций, связанный со странами не участвующими в противодействии легализации */
private macro SetCode3000( FMOperation : RsbFMOperation )

  if( (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "КРЕДИТ"))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЗАЙМ"  ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЗАЕМ"  ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ЗАЁМ"  ))
   or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ССУД"  ))
    )
      
      SetOperationCode( FMOperation, "3011" );
    
  elif( (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "АКЦИ"    ))
     or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ВЕКСЕЛ"  ))
     or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ОБЛИГАЦИ"))
     or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "СЕРТИФ"  ))
     or (IsWordInString(GetGlobalParameter("RR_Checked_Ground", false), "ПИФ "    ))
     or (IsNeighboringWords(GetGlobalParameter("RR_Ground_Word_Array", false), "ЦЕННЫ", "БУМАГ"))
     or (CompareStrWithMasks("5*", FMOperation.OprParty(_FM_PARTY_PAYER   ).Account) == 0)
     or (CompareStrWithMasks("5*", FMOperation.OprParty(_FM_PARTY_RECEIVER).Account) == 0)
      )
      
      SetOperationCode( FMOperation, "3021" );
    
  else
      
      SetOperationCode( FMOperation, "3001" );
    
  end;

end;

/* Проверка основания операции на возможность определения кодов */
macro FM_CheckGround( FMOperation : RsbFMOperation, CountrySign : bool, Chapter : integer ) : integer

  var stat : integer;

  PayerID    = FMOperation.OprParty(_FM_PARTY_PAYER   ).PartyID;
  ReceiverID = FMOperation.OprParty(_FM_PARTY_RECEIVER).PartyID;

  PayerBankID    = FMOperation.OprParty(_FM_PARTY_PAYER   ).BankID;
  ReceiverBankID = FMOperation.OprParty(_FM_PARTY_RECEIVER).BankID;

  InitPartyParameters( FMOperation );

  if( Chapter == 1 )
    
    if( CountrySign )
    
      /* проверка на коды из группы 3000 */
      SetCode3000( FMOperation );

    end;

    /* проверка на код 1008 */
    CheckCode1008( FMOperation );

    /* проверка на код 5001 */
    CheckCode5001( FMOperation );

    /* проверка на код 5002 */
    CheckCode5002( FMOperation );
  
  end;

  /* проверка на код 5003 */
  CheckCode5003( FMOperation );

  if( Chapter == 1 )
    
    /* проверка на код 5005 */
    CheckCode5005( FMOperation );

    /* проверка на код 5006 */
    CheckCode5006( FMOperation );

    /* проверка на код 5007 */
    CheckCode5007( FMOperation );
  
  end;

  /* проверка на код 8001 */
  stat = CheckCode8001( FMOperation );

  if( (stat == 0) and (Chapter == 1) )
    
    /* проверка на код 901 (необычные операции) */
    CheckUnusualOperations( FMOperation );

  end;

  if( (stat == 0) and (Chapter == 3) and (SetCodeFlag == false) )
    stat = 1; /* для документов главы В создаем записи об операции, только если определили код операции */
  end;

  return stat;

end;
