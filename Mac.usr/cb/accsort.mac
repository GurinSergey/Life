/*
   Пример макроса сортировки лицевых счетов
   
   - в качестве значения сортировки используется номер счета
*/


/* Функция GetSortAccount вызывается из RS-Bank в момент пересортировки счетов и при вводе/редактировании лицевого счета */
// KS 10.02.2014 Сортировка по R-327814-2
import likepy;  // для IfThenElse

macro GetSortAccount( _account )
  
  record account( "account.dbt" );

  SetBuff( account, _account );

//   return account.Account;

  // Сначала балансовый, потом по валюте, по хвосту
  return substr(account.Account,1,5)+
         IfThenElse(substr(account.Account,6,3)=="810","###",substr(account.Account,6,3))+
         substr(account.Account,10,11);

end;
