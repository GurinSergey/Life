/*---------------------------------------------------------------------------\
|                       Файл    document.mac                                 |
|                   Для проведенных документов                               |
\---------------------------------------------------------------------------*/
import rsd;
import "diver.mac";

record          Документ( arhdoc );
record          СтарыйДокумент( arhdoc );

var rs;
macro    Новый_документ( тип_документа )
        msgbox("Запрещен ввод проводок вручную!|операции должны оформляться первичными документами");
        return 1;
end;

macro    Проверить_документ( Режим, Тип_документа )
      return 0;
end;

macro    ФункцияПользователя( тип_документа )
     var priority, pr;
     if(ВходитВГруппу({oper},185))
      priority = Документ.priority;
      pr = getint(priority, "Очередность");
      if(pr)//если параметр изменили, обновляем базу
         rs = rsdcommand("begin update darhdoc_dbt set t_priority = "+priority+" where t_autokey = "+Документ.autokey+"; commit; end; ");
         rs.execute;
      end;
     //else
       // msgbox("Вы не включены в группу \"185 - Правка примечаний платежа\" ");  
     end;
        return 0;
end;

macro    Проверить_Счет_В_Мемордере( поле ) /*0-счет плательщика, 1-счет получателя*/
        var новое_значение_счета;

        if(поле) новое_значение_счета = Документ.Account_Receiver;
        else новое_значение_счета = Документ.Account_Payer;
        end;
        return новое_значение_счета;
end;
/*
 *      Функция установки подсказки для списка проводок
 *              
 *         параметр ScrollKind принимает значения:
 *         - CARRY_SCROLL - список проводок текущего дня
 *
 *      Если функция возвращает пустую строку, то используется хинт по умолчанию
 */
private macro УстановитьПодсказку( ScrollKind )
  /* EVG */
  return "/*+FIRST_ROWS INDEX(t DARHDOC_DBT_IDX2) INDEX(t DARHDOC_DBT_IDX3)*/";
end;