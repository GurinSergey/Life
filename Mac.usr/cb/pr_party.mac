/**************************************************************************************************/
/*   Печать расширенной анкеты клиента //debug                                                    */
/*                                                                                                */
/*   ASV При внесении изменений в анкету клиента, прошу ставить меня в известность.               */
/*   Иначе буду заменять макрос своей копией.                                                     */
/*   zip_z. Удачи. У нас теперь VSS.                                                              */
/*                                                                                                */
/*   Modify: 01.10.2012 Chesnokov D.S C-14458 ОКОГУ теперь всегда только в 38 категории           */
/*           13.11.2013 Gurin S. R-282343-2 Изменения для Пойдема                                 */
/**************************************************************************************************/

/*FIV Доработка под требования ПРББ и перевод на шаблон MS Word 12.07.2010*/
// KS 21.01.2014 ОКТМО

Import PTInter, CTInter, FMInter, "globals.mac", "adress.mac", "pt_lib.mac", cb_sql, RsbDataSet;
import rsexts, oralib, likepy;
import impcomm;

import "fg_Life_parm.mac";;

/* EVG 15/05/2012 
private const fgBank = fg_life_subject({OurBank});*/
private const fgBank = fg_life_subject();
              fgBank.ConsrtuctByBic( {MFO_Bank} );

const ОПФ_Категория = 28/*4 FIV Заменил категорию*/; /* Организационно-правовая форма */
const Риск_Категория = 14; /* Уровень риска */
const ИПДЛ_Категория = 34; /* Принадлежность к ИПДЛ */

/* Примечания для Контрагентов */
const ДатаЗаполненияАнкеты  = 1;
const СрокХраненияАнкеты    = 2;
const Прим_ОрганыУправления = 4;
const КодыФормГосСтатНабл   = 7;
const Прим_Учредители       = 8;
const Прим_Лицензии         = 9;
const Прим_Органы           = 10;
const Прим_Подразделения    = 11;
const Прим_ВидыДеятельности = 12;
const Прим_ПостКонтрагенты  = 13;
const Прим_ИсторияРепутация = 14;
const Прим_ХарактОпераций   = 15;
const Катег_ОценкаРиска     = 108;
const Прим_ОценкаРиска      = 111;
const ДатаОбновленияАнкеты  = 45;
const Менеджер              = 118;
const ИПДЛ_Организация = 112;  
const ИПДЛ_Должность   = 113;  
const ИПДЛ_Родственник = 114;  
const ИПДЛ_Заинтересованное = 115; 
const Oснования_ДВП = 116; /* Основания действий в пользу выгодоприобретателей */

var stat;

record client_("party.dbt");
record РП_Регистрация("objrgdoc.dbt");

file attr("objattr.dbt") key 0;
file partyreg("objrgdoc.dbt") key 1;
file partcode("objcode.dbt");
array _НаименованиеШапка,
      _Наименование,
      _ИмяКлиента,
      _МестоГосударственнойРегистрации,
      _НаименованиеРегОргана,
      _E_MailКлиента,
      _ФИО,
      _МестоРождения,
      _МестоРаботы_И_Должность,
      _КодыФормГосСтатНабл,
      _ОрганыУправления,
      _СведЛицоОткрывающееСчет,
      _КодыФГСН,
       ORG, DOLG, OSNOV_DVP;

private array _AccountOper, _AccountControlOper;

private array Address, AddressF, AddressP, Phone;
private var VAddress, VAddressF, VAddressP, VPhone,VName;

array _Учредители,
      _Лицензии,
      _Органы,
      _Подразделения,
      _ВидыДеятельности,
      _ПостКонтрагенты,
      _ИсторияРепутация,
      _ХарактОпераций,
      CAPITAL,
      _ОценкаРиска;
var   _VУчредители,
      _VЛицензии,
      _VОрганы,
      _VПодразделения,
      _VВидыДеятельности,
      _VПостКонтрагенты,
      _VИсторияРепутация,
      _VХарактОпераций,
      VCAPITAL,
      _VОценкаРиска;

var AttrID, RegDocID, ОценкаРискаЛег;
var ОПФ_Имя, УровеньРиска,Выгодоприобретатели;
var INN : string, Account_Open_Date : date, Account_Oper : integer, Account_ControlOper : integer;
var FormDateFill  : date; /* дата заполнения анкеты */
var FormDateModif : date; /* дата обновления анкеты */
var FormDateStore : date; /* дата хранения анкеты   */
var _ВелисинаКапитала, Виды_Деятельности;

var strOper : string, strControlOper : string;
var СведЛицоОткрывающееСчет : string;
  var WordApp, WordDoc;
  var FullDotFileName : string;
  var DotFileName, tout;


private macro CreateWordApplication()

var startAX, WordApplication;

  if (isStandAlone())
     return ActiveX("Word.Application");
  else
     startAX = CreateObject("rsax", "TRsAxServer", "LoansAxServer", isStandalone());
     WordApplication = startAX.CreateComObject("Word.Application");
     WordApplication.Visible = true;
     return WordApplication;
  end;

end;

private macro ShowReportOnTerminal( WordApp, WordDoc )
  
  var DocFileName : string, TermFileName : string;

  DocFileName = SplitFile( GetTxtFileName("") );

  DocFileName = MergeFile( DocFileName, "fm_prn_" + string(UserNumber), ".doc" );

  DocFileName = MergeFile( GetCurDir(), DocFileName );

  WordApp.visible = true; 
end;

macro createdoc(DotFileName_)
//        DotFileName_ = "ak_ul.dot";
          debugbreak;
          GetRegistryValue("BANK_INI\\ОБЩИЕ ПАРАМЕТРЫ\\ДИРЕКТОРИИ\\USERTEMPLSDIR",2,tout);
          var FullDotFileName_ = FindPath(DotFileName_, tout);                    
          WordApp = CreateWordApplication();
          return FullDotFileName_;
end;

macro GetInstitute( PartyID )
   
   var rs, str; 
   array arr;
   var CurrCode = "";

   file cur (currency);

   str = "SELECT t_declarecapital, t_realcapital, f.t_fi_code " +
         "  FROM dinstitut_dbt t, dfininstr_dbt f " +
         " WHERE f.t_fiid(+) = t.t_capitalfi AND t_partyid =" + partyid;

   rs = trsbdataset(str);

   if( rs.MoveNext and ( Valtype(rs.t_declarecapital) != 26) )
       var fi_code ="";

      if (rs.t_fi_code == 810)
                fi_code = "RUR";
      end;
      if (rs.t_fi_code == 840)
                fi_code = "USD";
      end;
      if (rs.t_fi_code == 978)
                fi_code = "EUR";
      end;


      CAPITAL(0) = "Зарег. капитал: " + rs.declarecapital + " " + fi_code;
      CAPITAL(1) = "Оплач. капитал: " + rs.realcapital    + " " + fi_code;

   else
      CAPITAL(0) = "НЕ УСТАНОВЛЕН";
      CAPITAL(1) = "";
   end;

end;

private MACRO GetPartyName(partyid)
 var rs, str;
 str = "SELECT t_name " +
       "  FROM dparty_dbt " +
       " WHERE t_partyid = "+partyid;

 rs = trsbdataset(str);
 if(rs and rs.movenext)
    return rs.name;
 else
    return "";
 end;
END;

private macro To_SQLData( dt : date )

  var strDate : string;

  if( dt == Date(0,0,0) )
    strDate = "01.01.0001";
  else
    strDate = string(dt:f);
  end;

  return "to_date('" + strDate + "', 'DD.MM.YYYY')";

end;

private macro ReadDate( rs : RsdRecordset, num : integer )

  var val, IsNull;
  var dt : date;
  var day : integer, mon : integer, year : integer;

  val = rs.value(num, IsNull);

  if( IsNull )
    
    dt = null;

  else

    dt = val;

    DateSplit( dt, day, mon, year );
    if( (day == 1) and (mon == 1) and (year == 1) )
      dt = Date(0, 0, 0);
    end;
  
  end;

  return dt;

end;

private macro PrintDate( dt : date )
  var strDate : string;

  if( dt == null )
    strDate = "";
  elif( dt == Date(0,0,0) )
    strDate = "00.00.0000";
  else
    strDate = string(dt:f);
  end;

  return strDate;
end;

macro ДобавитьСтроку( str, add_string, prefix )
  if( Trim(add_string) != "" )
    if( str )
      str = str + ", ";
    end;
    str = str + prefix + add_string;
  end;
  return str;
end;

/*Получить основной признак в категории */
macro КодКатегории( ObjType, ObjectID, Категория )
  
  var Name = "";
  var rs,str;
  
    str = "SELECT t.* " +
          "  FROM dobjatcor_dbt t" +
          " WHERE t.t_objecttype =  " + ObjType +
          "   AND t.t_groupid = " + Категория +
          "   AND t.t_object =  " + ObjectID + 
          "   AND t.t_general = 'X'";

    rs = trsbdataset(str);

    if(rs and rs.movenext)
      return rs.Value("t_attrid");
    end;
  
  return 0;

end;


/* Организационно-правовая форма */
macro ЗначениеКатегории( ObjType, _object, Категория, EmptyName, IsFullName )
//  debugbreak;  
  var Name = "";
  var rs,str;
//  debugbreak;
  if( EmptyName != null ) Name = EmptyName; end;
  
  if( GetMainObjAttr( null, ObjType, _object, Категория, AttrID ) )
    
    ClearRecord( attr );
    attr.ObjectType = ObjType;
    attr.GroupID    = Категория;
    attr.AttrID     = AttrID;
    
    if( GetEQ(attr) )

      if( IsFullName ) Name = attr.FullName;
      else             Name = attr.Name;
      end;

    end;
  else
    str = "SELECT o.* " +
          "  FROM dobjatcor_dbt t, dobjattr_dbt o " +
          " WHERE o.t_attrid = t.t_attrid " +
          "   AND o.t_groupid = t.t_groupid " +
          "   AND o.t_objecttype = t.t_objecttype " +
          "   AND t.t_objecttype =  " + ObjType +
          "   AND t.t_groupid = " + Категория +
          "   AND t.t_object =  " +_object.partyid;
    rs = trsbdataset(str);
    if(rs and rs.movenext)
      if( rs.FullName != "" ) Name = rs.FullName;
      else Name = rs.Name;
      end;
    end;
  end;
  
  
  return Name;

end;

macro ПечатьКодыФГСН_КО( client_ )
  //debugbreak;

  array Шапка;
  var КодыФГСН : string, WКодыФГСН : string;
  var i, j : integer;
  //debugbreak;
  var ObjCat = RsbObjCategories( OBJTYPE_PARTY, UniID( client_, OBJTYPE_PARTY ));

[|-----------------------+----------------------------------------------------|];

  Шапка(0) = "Коды  форм  федераль-";
  Шапка(1) = "ного государственного";
  Шапка(2) = "статистического  наб-";
  Шапка(3) = "людения              ";

  i = 0;

  /*ОКПО - party.OKPO*/
  if( StrLen( client_.OKPO ) > 0 )
    КодыФГСН = "ОКПО: " + client_.OKPO;
    WКодыФГСН = КодыФГСН;
    StrSplit( КодыФГСН, _КодыФГСН, 50, 50, 10 );
    j = 0;
    
    while( StrLen(_КодыФГСН( j )) > 0 )
      if( i < 4 )
        [| ##################### | ################################################## |]
        ( Шапка( i ), _КодыФГСН( j ));
      else
        [|                       | ################################################## |]
        ( _КодыФГСН( j ));
      end;

      j = j + 1;
      i = i + 1;
    end;
  end;

  /*ОКНХ - категория <Коды ОКОНХ> - objatcor.GroupID = 7, Категория множественная*/
  if( ObjCat.GetFirst( 7, {curdate}, attr ) == 0)
    КодыФГСН = "\nОКОНХ: " + attr.NameObject;
    while( ObjCat.GetNext( attr ) == 0)
      КодыФГСН = КодыФГСН + ", " + attr.NameObject;
    end;
    WКодыФГСН = WКодыФГСН + КодыФГСН;
    StrSplit( КодыФГСН, _КодыФГСН, 50, 50, 10 );
    j = 1; //Lavrenov I-00159209: из-за "\n" в начале строки проворку начинаем не с 0-го элемента
    
    while( StrLen(_КодыФГСН( j )) > 0 )
      if( i < 4 )
        [| ##################### | ################################################## |]
        ( Шапка( i ), _КодыФГСН( j ));
      else
        [|                       | ################################################## |]
        ( _КодыФГСН( j ));
      end;

      j = j + 1;
      i = i + 1;
    end;
  end;

  /*ОКАТО - категория <Справочник ОКАТО>  -- objatcor.GroupID = 12. Не множественная*/
  if( ObjCat.GetMainAttr( 55, {curdate}, attr ) == 0)
    КодыФГСН = "\nОКАТО: " + attr.NameObject;
    WКодыФГСН = WКодыФГСН + КодыФГСН;

    StrSplit( КодыФГСН, _КодыФГСН, 50, 50, 10 );
    j = 1; //Lavrenov I-00159209: из-за "\n" в начале строки проворку начинаем не с 0-го элемента
    
    while( StrLen(_КодыФГСН( j )) > 0 )
      if( i < 4 )
        [| ##################### | ################################################## |]
        ( Шапка( i ), _КодыФГСН( j ));
      else
        [|                       | ################################################## |]
        ( _КодыФГСН( j ));
      end;

      j = j + 1;
      i = i + 1;
    end;
  end;

  // KS 21.01.2014 ОКТМО
  /*ОКТМО - категория <Справочник ОКТМО>  -- objatcor.GroupID = 55. Не множественная*/
  if( ObjCat.GetMainAttr( 12, {curdate}, attr ) == 0)
    КодыФГСН = "\nОКТМО: " + attr.NameObject;
    WКодыФГСН = WКодыФГСН + КодыФГСН;

    StrSplit( КодыФГСН, _КодыФГСН, 50, 50, 10 );
    j = 1; //Lavrenov I-00159209: из-за "\n" в начале строки проворку начинаем не с 0-го элемента
    
    while( StrLen(_КодыФГСН( j )) > 0 )
      if( i < 4 )
        [| ##################### | ################################################## |]
        ( Шапка( i ), _КодыФГСН( j ));
      else
        [|                       | ################################################## |]
        ( _КодыФГСН( j ));
      end;

      j = j + 1;
      i = i + 1;
    end;
  end;

  
  /*ОКВЭД - категория <Код ОКВЭД> - objatcor.GroupID = 17. Множественная*/
  if( ObjCat.GetFirst( 17, {curdate}, attr ) == 0)
    КодыФГСН = "\nОКВЭД: " + attr.NameObject;
    Виды_Деятельности = attr.FullName;
    while( ObjCat.GetNext( attr ) == 0)
      КодыФГСН = КодыФГСН + ", " + attr.NameObject;
      Виды_Деятельности = Виды_Деятельности + "; " + attr.FullName;
    end;

    WКодыФГСН = WКодыФГСН + КодыФГСН;
    StrSplit( КодыФГСН, _КодыФГСН, 50, 50, 2 );
    j = 1; //Lavrenov I-00159209: из-за "\n" в начале строки проворку начинаем не с 0-го элемента
    
    while( StrLen(_КодыФГСН( j )) > 0 )
      if( i < 4 )

        [| ##################### | ################################################## |]
        ( Шапка( i ), _КодыФГСН( j ));
      else
        [|                       | ################################################## |]
        ( _КодыФГСН( j ));
      end;

      j = j + 1;
      i = i + 1;
    end;
  end;

  /*ОКФС - категория <Код ОКФС> - objatcor.GroupID = 28. Не множественная*/
  if( ObjCat.GetMainAttr( 28, {curdate}, attr ) == 0)
    КодыФГСН = "\nОКФС: " + attr.NameObject;

    WКодыФГСН = WКодыФГСН + КодыФГСН;
    StrSplit( КодыФГСН, _КодыФГСН, 50, 50, 10 );
    j = 1;  //Lavrenov I-00159209: из-за "\n" в начале строки проворку начинаем не с 0-го элемента
    
    while( StrLen(_КодыФГСН( j )) > 0 )
      if( i < 4 )
        [| ##################### | ################################################## |]
        ( Шапка( i ), _КодыФГСН( j ));
      else
        [|                       | ################################################## |]
        ( _КодыФГСН( j ));
      end;

      j = j + 1;
      i = i + 1;
    end;
  end;

  /*ОКОПФ - категория <Код ОКОПФ> - objatcor.GroupID = 27. Не множественная*/
  if( ObjCat.GetMainAttr( 27, {curdate}, attr ) == 0)
    КодыФГСН = "\nОКОПФ: " + attr.NameObject;

    WКодыФГСН = WКодыФГСН + КодыФГСН;
    StrSplit( КодыФГСН, _КодыФГСН, 50, 50, 10 );
    j = 1; //Lavrenov I-00159209: из-за "\n" в начале строки проворку начинаем не с 0-го элемента
    
    while( StrLen(_КодыФГСН( j )) > 0 )
      if( i < 4 )
        [| ##################### | ################################################## |]
        ( Шапка( i ), _КодыФГСН( j ));
      else
        [|                       | ################################################## |]
        ( _КодыФГСН( j ));
      end;

      j = j + 1;
      i = i + 1;
    end;
  end;
  
  /*допечатать шапку*/
  while( i < 4 )

    [| ##################### |                                                    |]
    ( Шапка( i ));

    i = i + 1;
  end;

end;


macro ПечатьКодыФГСН( client_ )
//debugbreak;

  array Шапка;
  var КодыФГСН : string, WКодыФГСН : string;
  var i=0, j=0;
  var ObjCat = RsbObjCategories( OBJTYPE_PARTY, UniID( client_, OBJTYPE_PARTY ));
//  debugbreak;
КодыФГСН = "";
WКодыФГСН = "";



[|-----------------------+----------------------------------------------------|];

  Шапка(0) = "Коды  форм  федераль-";
  Шапка(1) = "ного государственного";
  Шапка(2) = "статистического  наб-";
  Шапка(3) = "людения              ";

  i = 0;

  /*ОКПО - party.OKPO*/
  if( StrLen( client_.OKPO ) > 0 )
    КодыФГСН = "ОКПО: " + client_.OKPO;
    WКодыФГСН = КодыФГСН;
    StrSplit( КодыФГСН, _КодыФГСН, 50, 50, 10 );
    j = 0;
    
    while( StrLen(_КодыФГСН( j )) > 0 )
      if( i < 4 )
        [| ##################### | ################################################## |]
        ( Шапка( i ), _КодыФГСН( j ));
      else
        [|                       | ################################################## |]
        ( _КодыФГСН( j ));
      end;

      j = j + 1;
      i = i + 1;
    end;
  end;

  /*ОКНХ - категория <Коды ОКОНХ> - objatcor.GroupID = 7, Категория множественная*/
  if( ObjCat.GetFirst( 7, {curdate}, attr ) == 0)
    КодыФГСН = "\nОКОНХ: " + attr.NameObject;
    while( ObjCat.GetNext( attr ) == 0)
      КодыФГСН = КодыФГСН + ", " + attr.NameObject;
    end;
    WКодыФГСН = WКодыФГСН + КодыФГСН;
    StrSplit( КодыФГСН, _КодыФГСН, 50, 50, 10 );
    j = 1; //Lavrenov I-00159209: из-за "\n" в начале строки проворку начинаем не с 0-го элемента
    
    while( StrLen(_КодыФГСН( j )) > 0 )
      if( i < 4 )
        [| ##################### | ################################################## |]
        ( Шапка( i ), _КодыФГСН( j ));
      else
        [|                       | ################################################## |]
        ( _КодыФГСН( j ));
      end;

      j = j + 1;
      i = i + 1;
    end;
  end;

  /*ОКАТО - категория <Справочник ОКАТО>  -- objatcor.GroupID = 12. Не множественная*/
  if( ObjCat.GetMainAttr( 12, {curdate}, attr ) == 0)
    КодыФГСН = "\nОКАТО: " + attr.NameObject;
    WКодыФГСН = WКодыФГСН + КодыФГСН;

    StrSplit( КодыФГСН, _КодыФГСН, 50, 50, 10 );
    j = 1; //Lavrenov I-00159209: из-за "\n" в начале строки проворку начинаем не с 0-го элемента
    
    while( StrLen(_КодыФГСН( j )) > 0 )
      if( i < 4 )
        [| ##################### | ################################################## |]
        ( Шапка( i ), _КодыФГСН( j ));
      else
        [|                       | ################################################## |]
        ( _КодыФГСН( j ));
      end;

      j = j + 1;
      i = i + 1;
    end;
  end;

  // KS 21.01.2014 ОКТМО
  /*ОКТМО - категория <Справочник ОКТМО>  -- objatcor.GroupID = 55. Не множественная*/
  if( ObjCat.GetMainAttr( 55, {curdate}, attr ) == 0)
    КодыФГСН = "\nОКТМО: " + attr.NameObject;
    WКодыФГСН = WКодыФГСН + КодыФГСН;

    StrSplit( КодыФГСН, _КодыФГСН, 50, 50, 10 );
    j = 1; //Lavrenov I-00159209: из-за "\n" в начале строки проворку начинаем не с 0-го элемента
    
    while( StrLen(_КодыФГСН( j )) > 0 )
      if( i < 4 )
        [| ##################### | ################################################## |]
        ( Шапка( i ), _КодыФГСН( j ));
      else
        [|                       | ################################################## |]
        ( _КодыФГСН( j ));
      end;

      j = j + 1;
      i = i + 1;
    end;
  end;

  
  /*ОКВЭД - категория <Код ОКВЭД> - objatcor.GroupID = 17. Множественная*/
  if( ObjCat.GetFirst( 17, {curdate}, attr ) == 0)
    КодыФГСН = "\nОКВЭД: " + attr.NameObject;
    Виды_Деятельности = attr.FullName;
    while( ObjCat.GetNext( attr ) == 0)
      КодыФГСН = КодыФГСН + ", " + attr.NameObject;
//      [|                       | ################################################## |]
//      (attr.NameObject);
      Виды_Деятельности = Виды_Деятельности + "; " + attr.FullName;
    end;

    WКодыФГСН = WКодыФГСН + КодыФГСН;
    StrSplit( КодыФГСН, _КодыФГСН, 50, 50, 2 );
    j = 1; //Lavrenov I-00159209: из-за "\n" в начале строки проворку начинаем не с 0-го элемента
    
    while( StrLen(_КодыФГСН( j )) > 0 )
      if( i < 4 )

        [| ##################### | ################################################## |]
        ( Шапка( i ), _КодыФГСН( j ));
      else
        [|                       | ################################################## |]
        ( _КодыФГСН( j ));
      end;

      j = j + 1;
      i = i + 1;
    end;
  end;

// Не знаю кто и зачем задвоил вывод ОКОПФ
  /*ОКФС - категория <Код ОКФС> - objatcor.GroupID = 28. Не множественная     
  if( ObjCat.GetMainAttr( 28, {curdate}, attr ) == 0)
    КодыФГСН = "\nОКОПФ: " + attr.NameObject;

    WКодыФГСН = WКодыФГСН + КодыФГСН;
    StrSplit( КодыФГСН, _КодыФГСН, 50, 50, 10 );
    j = 1; //Lavrenov I-00159209: из-за "\n" в начале строки проворку начинаем не с 0-го элемента
    
    while( StrLen(_КодыФГСН( j )) > 0 )
      if( i < 4 )
        [| ##################### | ################################################## |]
        ( Шапка( i ), _КодыФГСН( j ));
      else
        [|                       | ################################################## |]
        ( _КодыФГСН( j ));
      end;

      j = j + 1;
      i = i + 1;
    end;
  end;*/ 

 /*ОКФС*/
  var sql_okfs ="  SELECT *" +
"\n                     FROM dobjatcor_dbt obj, dobjattr_dbt attr" +
"\n                     WHERE     obj.t_groupid = attr.t_groupid" +
"\n                          AND obj.t_object = lpad('"+client_.partyid+"',10,'0')" +
"\n                          AND obj.t_groupid = 27" +
"\n                          and OBJ.T_OBJECTTYPE = 3" +
"\n                          and ATTR.T_ATTRID = OBJ.T_ATTRID ";

  var rs_okfs = trsbdataset(sql_okfs);
  if(rs_okfs.movenext)  
      var text_okfs     = "OKФC :" + rs_okfs.Value("t_numinlist");
  end;
  if( i < 4 )
    [| ##################### | ################################################## |]
    ( Шапка( i ), text_okfs);
  else
    [|                       | ################################################## |]
    ( text_okfs);
  end;
  j = j + 1;
  i = i + 1;

 /*ОКОПФ*/
  var sql_okopf ="  SELECT *" +
"\n                     FROM dobjatcor_dbt obj, dobjattr_dbt attr" +
"\n                     WHERE     obj.t_groupid = attr.t_groupid" +
"\n                          AND obj.t_object = lpad('"+client_.partyid+"',10,'0')" +
"\n                          AND obj.t_groupid = 28" +
"\n                          and OBJ.T_OBJECTTYPE = 3" +
"\n                          and ATTR.T_ATTRID = OBJ.T_ATTRID ";

  var rs_okopf = trsbdataset(sql_okopf);
  if(rs_okopf.movenext) 
      var text_okopf    = "OKОПФ :" + rs_okopf.Value("t_numinlist");
  end;
  if( i < 4 )
    [| ##################### | ################################################## |]
    ( Шапка( i ), text_okopf);
  else
    [|                       | ################################################## |]
    ( text_okopf);
  end;
  j = j + 1;
  i = i + 1;

 /*ОКОГУ*/

  var sql_okogu ="  SELECT   obj.t_groupid, attr.t_numinlist " 
                        +"\n  FROM   dobjatcor_dbt obj, dobjattr_dbt attr " 
                        +"\n WHERE       obj.t_groupid = attr.t_groupid " 
                        +"\n         AND obj.t_object = LPAD ('"+client_.partyid+"', 10, '0') " 
                        +"\n         AND obj.t_groupid = 38 " 
                        +"\n         AND OBJ.T_OBJECTTYPE = 3 " 
                        +"\n         AND ATTR.T_OBJECTTYPE = 3 " 
                        +"\n         AND ATTR.T_ATTRID = OBJ.T_ATTRID " 
                        +"\n        order by obj.t_groupid; ";
//msgbox(sql_okogu);

  var rs_okogu = trsbdataset(sql_okogu);

  //debugbreak;
  var text_okogu;
  if(rs_okogu.movenext) 
      text_okogu    = "OKОГУ :" + rs_okogu.Value("t_numinlist");
      if(rs_okogu.Value("t_groupid") != 38)
        if(rs_okogu.movenext) 
           text_okogu    = "OKОГУ :" + rs_okogu.Value("t_numinlist");
        end;
      end;
  end;


  if( i < 4 )
    [| ##################### | ################################################## |]
    ( Шапка( i ), text_okogu);
  else
    [|                       | ################################################## |]
    ( text_okogu);
  end;
  j = j + 1;
  i = i + 1;


  
  /*допечатать шапку*/
  while( i < 4 )

    [| ##################### |                                                    |]
    ( Шапка( i ));

    i = i + 1;
  end;

          return WКодыФГСН;

end;

macro USR_GetPartyReg(ptid, ListKind_Ref, DocKindID)
var rs, str;
str = "SELECT objrgdoc.*, " +
      "       (SELECT partcode.t_code " +
      "        FROM dpartcode_dbt partcode " +
      "        WHERE partcode.t_codekind = objalreg.t_codekind " +
      "              AND partcode.t_partyid = objrgdoc.t_objectid) t_code " +
      "FROM dobjrgdoc_dbt objrgdoc, dobjalreg_dbt objalreg " +
      "WHERE     objrgdoc.t_objecttype = 3 " +
      "      AND objrgdoc.t_objectid = " + ptid +
      "      AND objrgdoc.t_regpartykind =  " + ListKind_Ref +
      "      AND objrgdoc.t_regdockind = " + DocKindID +
      "      AND objrgdoc.t_isclosed = CHR (0) " +
      "      AND objrgdoc.t_docdate = " +
      "            (SELECT MAX (t.t_docdate) " +
      "             FROM dobjrgdoc_dbt t " +
      "             WHERE     t.t_objecttype = 3 " +
      "                   AND t.t_objectid = " + ptid +
      "                   AND t.t_regpartykind = " + ListKind_Ref +
      "                   AND t.t_regdockind = " + DocKindID +
      "                   AND t.t_isclosed = CHR (0)) " +
      "      AND objalreg.t_objecttype = objrgdoc.t_objecttype " +
      "      AND objalreg.t_regpartykind = objrgdoc.t_regpartykind " +
      "      AND objalreg.t_regdockind = objrgdoc.t_regdockind " +
      "      AND objalreg.t_partyid = 0 " +
      "      AND ROWNUM = 1 ";
  rs = trsbdataset(str);
 
  return rs;
END;

macro GetPartyReg( client_, _partyreg, ListKind_Ref, DocKindID, Number )
  var stat;
  var RegDocID;

  ClearRecord( _partyreg );
//debugbreak;
  if( CB_GetRegistry( OBJTYPE_PARTY, client_.PartyID, ListKind_Ref, DocKindID, _partyreg, Number ) == 0 )    
    SetParm( 4, Number );
    return true;
  else
    Number = "";
    SetParm( 4, Number );
  end;
  return false;
end;

macro Регистрация( client_, ptreg, Number )
  //debugbreak;
  Number = "";

  ClearRecord( ptreg);
  ПолучитьДанныеРегистрации( null, Number, client_.PartyID, ptreg );

  SetParm( 2, Number );

  return true;
  
end;


macro ПолучитьДатуЗакрытия(PartyID) : date
  var rs, sqlStr;
  sqlStr = "SELECT NVL(MAX(t_sysdate), TO_DATE('01010001','ddmmyyyy')) FROM dptprmhist_dbt WHERE t_partyid=" + PartyID +
           " AND t_paramkindid = 100 AND t_valueafter = 'X'";
  rs = SQL_ExecuteAndGetRs(sqlStr); 
  rs.moveNext(); 
  return rs.value(0);
end;

/* Получить код субъекта по PartyID и CodeKind */
macro ПолучитьКод( PartyID, CodeKind );
  //debugbreak;
  var Code : string;
  
  var strSql : string;
  var rs : RsdRecordset;

  Code = "";

  strSql = "SELECT t_code FROM dpartcode_dbt WHERE t_CodeKind = " + CodeKind + " AND t_PartyID = " + PartyID + ";";

  rs = RsdRecordset( strSql );

  if( rs.MoveNext() )
    Code = rs.value( 0 );
  end;
    
  return Code;      
end;

/* Получить ИНН по PartyID */
macro ПолучитьИНН( PartyID )
  //debugbreak;
  var INN, FullINN;
  FullINN = ПолучитьКод( PartyID, PTCK_INN );
  SplitFullINN( FullINN, INN, null );
  return INN;
end;

/* Номера контактных телефонов и факсов */
macro ТелефоныФаксы( client_ )
  record RecordAdress ( adress );
  var str;

  str = "";
  /* телефоны */
  ClearRecord(RecordAdress);
//  debugbreak;
 // msgbox("~");
  var sql_phone = "SELECT NVL (REGEXP_REPLACE (   DBMS_LOB.SUBSTR (wmsys.wm_concat (adr.t_phonenumber))"  +
                                                         "                            || ',' " +
                                                         "                            || DBMS_LOB.SUBSTR (wmsys.wm_concat (adr.t_phonenumber2)), " +
                                                         "                            '('||CHR (1)||',)|'||chr(1) " +
                                                         "            ), " +
                                                         "            ' ' " +
                                                         "       ) " +
                                                         "          phone " +
                                                         "FROM dadress_dbt adr " +
                                                         "WHERE adr.t_partyid = "+client_.PartyID +";" ;
//	msgbox(sql_phone);
  var rs_phone = RsdRecordSet(sql_phone);
  if (rs_phone.MoveNext)
        str = str + ", \n телефоны: " + rs_phone.value(0);
  end;

 /*  
  НайтиАдресСубъекта(client_.PartyID, 1, RecordAdress); //PTADDR_REAL
  if( Trim(RecordAdress.PhoneNumber) != "" )
    str = str + "тел.: " + RecordAdress.PhoneNumber;
  end;
    
  if( Trim(RecordAdress.PhoneNumber2) != "" )
    if( str )
      str = str + ", \nдоп. телефон: ";
    end;
    str = str + RecordAdress.PhoneNumber2;
  end;
*/
  /*VDN 30.04.2015 I-00565020-2*/
  var sql_mphone = "    SELECT NVL(DBMS_LOB.SUBSTR(wmsys.wm_concat(ADR.T_MOBILEPHONE)),' ') mphone" +
                 "\n            FROM dadress_dbt adr" +
                 "\n            WHERE ADR.T_MOBILEPHONE <> chr(1)" +
                 "\n            AND adr.t_partyid = "+client_.PartyID +";";
  var rs_mphone = RsdRecordSet(sql_mphone);
  if (rs_mphone.MoveNext)
        str = str + ", \n моб. телефон: " + rs_mphone.value(0);
  end;

  /*
  if( Trim(RecordAdress.MobilePhone) != "" )
    if( str )
      str = str + ", \nмоб. телефон: ";
    end;
    str = str + RecordAdress.MobilePhone;
  end;
*/
  /* факс */
  if( Trim(RecordAdress.Fax) != "" )
    if( str )
      str = str + ", ";
    end;
    str = str + "\nфакс: " + RecordAdress.Fax;
  end;

  return str;
end;

private macro GetDprtPartyID( DprtID : integer )
  
  file dprt("dp_dep.dbt");
  var PartyID : integer = -1;

  dprt.Code = DprtID;

  if( getEQ(dprt) )
    PartyID = dprt.PartyID;
  end;

  return PartyID;

end;

macro ДолжностиСотрудника( str : @string, PartyID : integer, PersonID : integer )
  
  var strSql : string;
  var rs : RsdRecordset;

  var Post : string;

  strSql = "select t_Post from dofficer_dbt where t_PartyID = " + PartyID + " and t_PersonID = " + PersonID;
  
  rs = RsdRecordset( strSql );

  while( rs.MoveNext() )
    Post = rs.value(0);
    if( (Post != "")  and (post != strfor(1)))
      /* EVG 15/05/2012 Хотят должность в начале. Надеюсь, все так хотят.
      str = str + ", " + Post;*/
      str = Post + " " + str;
    end;
  end;

end;

macro СотрудникПоСчету( oper : integer )

  file person("person.dbt");

  var PartyID : integer;
  var str : string;

  str = "";
  
  if( oper )
    
    person.Oper = oper;
  
    if( getEQ(person) )
    
      str = person.Name;

      if( (str != "") and (person.PartyID > 0) )

        PartyID = GetDprtPartyID(person.CodeDepart);

        if( PartyID > 0 )

          /* EVG 15/05/2012 ЭВ хочет должность сотрудника (Иванова) */
          if( fgBank.is_EXV() )
             ДолжностиСотрудника( @str, PartyID, person.PartyID );
          end;
          //debugbreak;
        end;

      end;
  
    end;

  end;

  return str;

end;


/* ПервыйСчетКлиента */
macro ПервыйСчет( client, _Open_Date : @date )
  var OpenDate : date, Oper : integer, ControlOper : integer;
  var strOper : string, strControlOper : string;
  var PartyID : integer;
  var InstOpenDate : date;

  // KS C-8822 Определение минимальной даты открытия счета по счетам из РС5
  macro МинимальнаяДатаОткрытияСчетаПоРС5( client, onlyOpened : bool )
    var strSql = "";
    var params : TArray;
    var OpenDate : date;

    OpenDate = null;

    strSql = strSql + "select min(t.t_open_date) opendate";
    strSql = strSql + "  from daccount_5_dbt t, dobjcode_dbt c, dparty_dbt p";
    strSql = strSql + " where t.t_client = c.t_code";
    strSql = strSql + "   and c.t_objecttype = 3";
    strSql = strSql + "   and c.t_objectid = " + client.PartyID;
    strSql = strSql + "   and c.t_objectid = p.t_partyid";
    strSql = strSql + "   and c.t_codekind = 101";
    strSql = strSql + "   and t.t_nameaccount in (p.t_shortname,p.t_name)";

    if(onlyOpened)
      strSql = strSql + " AND t_Open_Close = CHR(0) ";
    end;

    var rs = TRsbDataset (strSql);
    if( rs.MoveNext() )
      OpenDate = rs.opendate;
    end;

    return OpenDate;

  onerror()

    return null;

  end;

  macro МинимальнаяДатаОткрытияСчета( client, onlyOpened : bool )
    var strSql = "";
    var params : TArray;
    var OpenDate    : date;
    var OpenDateRS5 : date; // KS C-8822 Определение минимальной даты открытия счета по счетам из РС5

    OpenDate    = null;
    OpenDateRS5 = null; // KS C-8822 Определение минимальной даты открытия счета по счетам из РС5

    strSql = strSql + "SELECT MIN(t_Open_Date) opendate";
    // KS 29.11.2013 Перенос пользовательских доработок в 31ю сборку
    //strSql = strSql + "  FROM daccounts_dbt ";
    strSql = strSql + "  FROM daccount_dbt ";
    strSql = strSql + " WHERE t_Client = " + client.PartyID;
    if(onlyOpened)
      strSql = strSql + " AND t_Open_Close = CHR(0) ";
    end;
    var rs = TRsbDataset (strSql);
    if( rs.MoveNext() )
      OpenDate = rs.opendate;
    end;

    // KS C-8822 Определение минимальной даты открытия счета по счетам из РС5
    OpenDateRS5 = МинимальнаяДатаОткрытияСчетаПоРС5( client, onlyOpened ); // onlyOpened оставил для единообразия
    if( OpenDateRS5 != null )
      if(( OpenDate == null ) or
         ( OpenDateRS5 < OpenDate )
         )
        OpenDate = OpenDateRS5;
      end;
    end;
    // KS end
    
    return OpenDate;

  end;

  macro ДобавитьТипСчета( strSql : @string, ТипСчета : string )
    strSql = strSql + ", DECODE(INSTR(t_Type_Account,'" + ТипСчета + "'), 0, 1, 0) \"" + ТипСчета +"\" ";
  end;

  macro ДобавитьТипСчетаСорт( strSql : @string, ТипСчета : string )
    strSql = strSql + ", \"" + ТипСчета +"\"";
  end;
  
  macro _СчетаЗаДату( strSql : @string, client, TableName : string, OpenDate : date )
    
    strSql = strSql + "SELECT t_Open_Date a_Open_Date, t_Oper a_Oper, t_ControlOper a_ControlOper ";
    
    ДобавитьТипСчета( @strSql, "L" );
    ДобавитьТипСчета( @strSql, "Ч" );
    ДобавитьТипСчета( @strSql, "X" );
    ДобавитьТипСчета( @strSql, "Я" );
    ДобавитьТипСчета( @strSql, "Q" );
    
    strSql = strSql + "  FROM " + TableName;
    strSql = strSql + " WHERE t_Client = " + string(client.PartyID);
    strSql = strSql + "   AND t_Open_Date = " + To_SQLData(OpenDate);
    if(client.LegalForm == PTLEGF_INST)
      strSql = strSql + "   AND t_Open_Close = CHR(0) ";
    end;

  end;

  macro СчетаЗаДату( client, OpenDate : @date, Oper : @integer, ControlOper : @integer )
    
    var strSql : string;
    var rs : RsdRecordset;

    strSql = "";
    
    // KS 29.11.2013 Перенос пользовательских доработок в 31ю сборку
    //_СчетаЗаДату( @strSql, client, "daccounts_dbt" , OpenDate );
    _СчетаЗаДату( @strSql, client, "daccount_dbt" , OpenDate );

    strSql = strSql + " ORDER BY a_Open_Date";

    ДобавитьТипСчетаСорт( @strSql, "L" );
    ДобавитьТипСчетаСорт( @strSql, "Ч" );
    ДобавитьТипСчетаСорт( @strSql, "X" );
    ДобавитьТипСчетаСорт( @strSql, "Я" );
    ДобавитьТипСчетаСорт( @strSql, "Q" );
//debugbreak;
    rs = RsdRecordset( strSql );

    if( rs.MoveNext() )
      OpenDate    = ReadDate( rs, 0 );
      Oper        = rs.value(1);
      ControlOper = rs.value(2);
    end;

  end;

  PartyID = client.PartyID;
  if( client.PartyID == {OurBank} )
    PartyID = {OurBank};
  end;

  OpenDate = МинимальнаяДатаОткрытияСчета( client, false );
  
  if( OpenDate != null )
    
    if(client.LegalForm == PTLEGF_INST)
      InstOpenDate = МинимальнаяДатаОткрытияСчета( client, true );
      //Gurin S. 16.09.2015 R-619654-2 если нет открытых счетов
      if (InstOpenDate != null)
         СчетаЗаДату( client, @InstOpenDate, @Oper, @ControlOper );
      end;
    else
      СчетаЗаДату( client, @OpenDate, @Oper, @ControlOper );
    end;

  else
    
    Oper        = 0;
    ControlOper = 0;

  end;

  _Open_Date   = OpenDate;
  
  strOper        = СотрудникПоСчету( Oper );
  //Lavrenov scr: I-102472
  //strControlOper = СотрудникПоСчету( ControlOper );
  /* EVG 15/05/2012 Хотят должность главбуха (Иванова)
  strControlOper = {FIO_Book};*/
  strControlOper = {Name_Book} + " " + {FIO_Book};

  StrSplit( strOper       , _AccountOper       , 50, 50, 2 );
  StrSplit( strControlOper, _AccountControlOper, 50, 50, 2 );

end;

macro Получить_ИмяКлиента( Name );
  StrSplit( Name, _ИмяКлиента, 50, 50, 10 );

end;

macro Получить_МестоГосударственнойРегистрации( );
  //debugbreak;
  StrSplit( РП_Регистрация.RegPlace, _МестоГосударственнойРегистрации,
            50, 50, 10 );

end;

macro Получить_НаименованиеРегОргана( );
  //debugbreak;
  StrSplit( getpartyname(РП_Регистрация.RegPartyid), _НаименованиеРегОргана,
            50, 50, 10 );

end;


macro Получить_E_MailКлиента( E_Mail );
  StrSplit( E_Mail, _E_MailКлиента, 50, 50, 2 );

end;

macro ДопечататьПримечания(Примечание, НомерПервойСтроки, НомерПоследнейСтроки)
  //debugbreak;
  var i = НомерПервойСтроки;

  if( НомерПоследнейСтроки == null ) НомерПоследнейСтроки = ASize(Примечание); end;

  while ( (StrLen(Примечание(i) ) > 0) AND (i<= НомерПоследнейСтроки) )
    [|                       | ################################################## |]
     (Примечание(i));
    i = i + 1;
  end;

end;

macro Напечатать_ИмяКлиента( Шапка, КороткоеНазвание );
//      debugbreak;
  var i = 0;
  var _Fullname = "";

  while ( (StrLen(_ИмяКлиента(i) ) > 0) AND (i <= 10) )
    [| ##################### | ################################################## |]
     (Шапка(i),_ИмяКлиента(i));
    i = i + 1;
  end;
  _Fullname = _ИмяКлиента(i);

  [| ##################### |                                                    |
   | ##################### | ################################################## |]
     (Шапка(i),Шапка(i+1),КороткоеНазвание.ShortName);
  _Fullname = _Fullname + "\n" + КороткоеНазвание.ShortName;
  i = i + 2;

  while ( (StrLen(Шапка(i) ) > 0) AND (i <= 10) )
    [| ##################### | ################################################## |]
     (Шапка(i),_ИмяКлиента(i));
    i = i + 1;
  end;
  _Fullname = _Fullname + "\n" + _ИмяКлиента(i);

    [|                       | ################################################## |]
     (КороткоеНазвание.LatName);

   return _Fullname;    
end;

macro СформироватьПочтовыйАдрес( client_ )
  record RecordAdress ( adress );

  ClearRecord(RecordAdress);
  НайтиПочтовыйАдресСубъекта(client_.PartyID,RecordAdress);
  VAddressP = RecordAdress.Adress;
  StrSplit( RecordAdress.Adress, AddressP, 50, 50, 10 );

end;

macro СформироватьЮридическийАдрес( client_ )

  record RecordAdress ( adress );

  ClearRecord(RecordAdress);
  НайтиЮридическийАдресСубъекта(client_.PartyID,RecordAdress);
  VAddress = RecordAdress.Adress;
  StrSplit( RecordAdress.Adress, Address, 50, 50, 10 );

end;

macro СформироватьФактическийАдрес( client_ )

  record RecordAdress ( adress );

  ClearRecord(RecordAdress);
  НайтиАдресСубъекта(client_.PartyID,PTADDR_REAL,RecordAdress);
  VAddressF = RecordAdress.Adress;
  StrSplit( RecordAdress.Adress, AddressF, 50, 50, 10 );

end;

macro СформироватьМестоРождения( client_ )

  var stat;
  var find = 0;
  file region ("ptregion.dbt") key 0;
  file persn("persn.dbt") key 0;

  ClearRecord( persn );
  persn.PersonID = client_.PartyID;
  GetEQ( persn );

  var AddressTEMP = "";

  if(StrLen(persn.BirsPlase)>0)
    AddressTEMP = persn.BirsPlase;
  else

    if(StrLen(persn.RegionBorn)>0)
      region.CodeRegion = persn.RegionBorn;
      stat = GetEQ(region);
      if(stat)
        AddressTEMP = AddressTEMP + region.NameRegion;
        find = 1;
      end;
    end;

    if(StrLen(persn.RaionBorn)>0)
      if(find) AddressTEMP = AddressTEMP + ", "; end;
      AddressTEMP = AddressTEMP + persn.RaionBorn;
      find = 1;
    end;

    if(StrLen(persn.PlaceBorn)>0)
      if(find) AddressTEMP = AddressTEMP + ", "; end;
      AddressTEMP = AddressTEMP + persn.PlaceBorn;
      find = 1;
    end;

  end;

  StrSplit( AddressTEMP, _МестоРождения, 50, 50, 10 );

end;

macro СформироватьСведЛицоОткрывающееСчет( client_ )

  var strSql : string;
  var rs : RsdRecordset;

 
  СведЛицоОткрывающееСчет = "";

  strSql = "SELECT t_DelegatePost, t_DelegateName1, t_DelegateName2, t_DelegateName3 " +
           "FROM dreqopena_dbt WHERE " +
           // KS 29.11.2013 Перенос пользовательских доработок в 31ю сборку
           //"  EXISTS(SELECT 1 FROM daccounts_dbt acc WHERE acc.t_Account = t_Account AND acc.t_Code_Currency = t_Code_Currency) AND " +
           "  EXISTS(SELECT 1 FROM daccount_dbt acc WHERE acc.t_Account = t_Account AND acc.t_Code_Currency = t_Code_Currency) AND " +
           "  t_DelegateName1 <> CHR(1) AND t_clientID = " + client_.PartyID;
  
  rs = RsdRecordset( strSql );

  if( rs.MoveNext() )
    if( StrLen(rs.value(0)) > 0 )
      СведЛицоОткрывающееСчет = СведЛицоОткрывающееСчет + rs.value(0) + " ";
    end;

    if( StrLen(rs.value(1)) > 0 )
      СведЛицоОткрывающееСчет = СведЛицоОткрывающееСчет + rs.value(1) + " ";
    end;

    if( StrLen(rs.value(2)) > 0 )
      СведЛицоОткрывающееСчет = СведЛицоОткрывающееСчет + rs.value(2) + " ";
    end;

    if( StrLen(rs.value(3)) > 0 )
      СведЛицоОткрывающееСчет = СведЛицоОткрывающееСчет + rs.value(3);
    end;

  end;

  StrSplit( СведЛицоОткрывающееСчет, _СведЛицоОткрывающееСчет, 50, 50, 10 );
end;

macro ПолучитьДатыАнкеты()
  
  FormDateFill  = readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), ДатаЗаполненияАнкеты );
  FormDateModif = readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), ДатаОбновленияАнкеты );

  //ASV Подтягивать максимальную дату примечание <> история изменений
  /*TAM I-00193608-2 15.05.2012
  var modifSql = "select max(hist.t_sysdate) date_modif from dptprmhist_dbt hist where HIST.T_PARTYID=" +client_.PartyID; 
  var modifRs = RsdRecordset( modifSql );

  if (( modifRs.MoveNext() ) and (valtype(modifRs.value(0)) != 26)) /*Special value 0 */
        if (FormDateModif < modifRs.value(0)) 
                FormDateModif = modifRs.value(0);
        end;
  end;*/

  /*Tikh  Дата обновления при 0 дате примечании*/
//   debugbreak;
   if (FormDateModif == " 1.01.0001")
    FormDateModif = FormDateFill + 301;
    if (isholiday(FormDateModif))
       FormDateModif = FormDateModif + 2;
    end;
    if (FormDateModif > {curdate})
      FormDateModif =  {curdate} - 31;
    end;
    end;
   FormDateStore = readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), СрокХраненияАнкеты   );

  if( FormDateFill == " 1.01.0001") FormDateFill  = date(0, 0, 0); end;
  if( FormDateFill  == null ) FormDateFill  = date(0, 0, 0); end;
  if( FormDateModif == null ) FormDateModif = date(0, 0, 0); end;
  if( FormDateStore == null ) FormDateStore = date(0, 0, 0); end;

  if( FormDateModif == date(0, 0, 0) ) FormDateModif = FormDateFill; end;

end;

macro ПрочитатьПримечания()
	  //debugbreak;
  var ObjCat = RsbObjCategories( OBJTYPE_PARTY, UniID( client_, OBJTYPE_PARTY ));
  var risk_note = "";


  StrSplit( readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Прим_Учредители ),
            _Учредители, 50, 50, 35 );
  StrSplit( readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Прим_Лицензии ),
            _Лицензии, 50, 50, 35 );
//  debugbreak;
  StrSplit( readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Прим_Органы ),
            _Органы, 50, 50, 35 );
  StrSplit( readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Прим_Подразделения ),
            _Подразделения, 50, 50, 35 );
  StrSplit( readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Прим_ВидыДеятельности ),
            _ВидыДеятельности, 50, 50, 35 );
  StrSplit( readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Прим_ПостКонтрагенты ),
            _ПостКонтрагенты, 50, 50, 35 );
  StrSplit( readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Прим_ИсторияРепутация ),
            _ИсторияРепутация, 50, 50, 35 );
  StrSplit( readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Прим_ХарактОпераций ),
            _ХарактОпераций, 74, 74, 35 );

  StrSplit( readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), ИПДЛ_Должность ),
            DOLG, 50, 50, 10 );
  StrSplit( readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), ИПДЛ_Организация ),
            ORG, 50, 50, 10 );

  StrSplit( readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Oснования_ДВП),
            OSNOV_DVP, 50, 50, 10 );


  //Если есть категория используем ее, иначе примечание.  
  if( ObjCat.GetMainAttr( Катег_ОценкаРиска, {curdate}, attr ) == 0)
     StrSplit( attr.fullName, _ОценкаРиска, 74, 74, 35);
  else
    risk_note = readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), 16 );
    if(strlen(risk_note) != 0) //Если ничего нет в 16 примечании ищем в 111
       StrSplit( risk_note, _ОценкаРиска, 74, 74, 35 );
    else
       StrSplit( readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Прим_ОценкаРиска ), _ОценкаРиска, 74, 74, 35 );
    end;

  end;
            
end;

macro ИмяОперациониста( oper )
    file person("person.dbt");

    person.Oper = oper;
    if( getEQ(person) ) return person.Name; end;
    return "";
end;

/* Вспомогательные функции печати */
private macro ПечатьЛицензий( PartyID )

  var strSql : string;
  var Count : integer;

  var DocKind : integer;
  
  var RegNumber : string, RegDate : date;
  var rs : RsdRecordset;
  
  array _ВидЛицензии;

  file objkdoc("objkdoc.dbt") key 0;

private macro _Печать()
[| Вид лицензии  на осу- | ################################################## |
| ществление банковских | ################################################## |
| операций              | ################################################## |
]
(
  _ВидЛицензии(0), _ВидЛицензии(1), _ВидЛицензии(2)
);

ДопечататьПримечания(_ВидЛицензии, 3, 9);

[|-----------------------+----------------------------------------------------|
| Номер лицензии        | ################################################## |
|-----------------------+----------------------------------------------------|
| Дата выдачи лицензии  | ##########                                         |
|-----------------------+----------------------------------------------------|
]
(
  RegNumber,
  RegDate:f
);

WordDoc.Bookmarks("LIC").Range.Text = _ВидЛицензии(0) + " " + _ВидЛицензии(1) + " " + _ВидЛицензии(2) + " " + RegNumber + " " + RegDate;

end;
  //debugbreak;
  RegNumber = GetCodeParty( PartyID, PTCK_BANKREGNUM );
  if( RegNumber == null ) RegNumber = ""; end;

  strSql = "SELECT objrgdoc.t_RegDocKind, objrgdoc.t_DocDate";
  strSql = strSql + " FROM dobjrgdoc_dbt objrgdoc, dobjalreg_dbt objalreg";
  strSql = strSql + " WHERE objrgdoc.t_ObjectType = " + string(OBJTYPE_PARTY);
  strSql = strSql + " AND objrgdoc.t_ObjectID = " + string(PartyID);
  strSql = strSql + " AND objrgdoc.t_RegPartyKind = " + string(REGPT_CENTRALBANK);
  strSql = strSql + " AND objalreg.t_ObjectType = objrgdoc.t_ObjectType";
  strSql = strSql + " AND objalreg.t_RegDocKind = objrgdoc.t_RegDocKind";
  strSql = strSql + " AND objalreg.t_CodeKind = " + string(PTCK_BANKREGNUM);
  strSql = strSql + " AND objrgdoc.t_IsClosed = chr(0)";
  strSql = strSql + " AND (objrgdoc.t_FinishDate =  " + To_SQLData(date(0, 0, 0)) +
                      " OR objrgdoc.t_FinishDate >= " + To_SQLData({curdate}) + ")";

  Count = 0;

  rs = RsdRecordset( strSql );

  while( rs.MoveNext() )
    
    DocKind = rs.value(0);
    RegDate = ReadDate( rs, 1 );

    ClearRecord( objkdoc );
      
    objkdoc.RegDocKind = DocKind;
    objkdoc.ObjectType = OBJTYPE_PARTY;

    if( (GetEQ(objkdoc)) and (objkdoc.Name != "Лицензия ЦБ РФ") )
      
      Count = Count + 1;

      StrSplit( objkdoc.Name, _ВидЛицензии, 50, 50, 10 );

      _Печать();

    end;

  end;

  /* если нет ни одной лицензии - напечатаем пустые графы */
  if( Count == 0 )
    
    RegDate = date(0, 0, 0);

    StrSplit( "", _ВидЛицензии, 50, 50, 10 );

    _Печать();

  end;

end;

Macro ПечатьВыгодоприобретателейFL(Надпись)

var i = 1;


[|############################################################################|
+------------------------------------------+---------------------------------+
| Наличие выгодоприобретателей             | ############################### | 
+------------------------------------------+---------------------------------+
| Сведения об основаниях действия в интересах выгодоприобретателей           | 
+----------------------------------------------------------------------------+]
(Надпись, Выгодоприобретатели);

[| ########################################################################## |]
(OSNOV_DVP(0));

  while ( StrLen(OSNOV_DVP(i) ) > 0)
    [| ########################################################################## |]
     (OSNOV_DVP(i));
    i = i + 1;
  end;

[+----------------------------------------------------------------------------+];

end;

macro ХарактеристикаОпераций( client_ID : integer )
  
  var strSql : string;
  var rs : RsdRecordset;
  var shapka, period, num, sum;
  var i = 0;
  array Шапка;

  strSql = "SELECT t_Quarter, t_Year, t_Quantity, t_Sum FROM dopcontr_benefit_dbt WHERE t_clientID = " + client_ID + " ORDER BY t_Year, t_Quarter DESC ;";
  
  rs = RsdRecordset( strSql );

[Характеристика операций, по которым субъект является выгодоприобретателем:
+----------------------------------------------------------------------------+
| Операции,  проводимые | За период  | Число операций |     Общая сумма      |
| от имени или к выгоде |            |                |                      |
];

  Шапка(0) = "субъекта";

  while( rs.MoveNext() )

    period = rs.value(0) + " кв. " + rs.value(1);
    num    = rs.value(2);
    sum    = rs.value(3);

    if(i<3)
      shapka = Шапка(i);
    else
      shapka = "";
    end;

    i = i + 1;

[| ##################### | ########## | ############## | #################### |]
( shapka, period, num, sum );
  end;
  if( i == 0 )
    shapka = Шапка(i);
[| ##################### |            |                |                      |]
( shapka );
  end;
[+----------------------------------------------------------------------------+]

end;


/* Вспомогательные фукнции печати */
macro ПечатьОпераций( Надпись, client_ID )

  var str = "",shapka;
  var i;
  var rs;

  array Шапка;

macro GetSQLstring( OprType )
  
  return "SELECT t_Quarter, t_Year, t_Quantity, t_Sum FROM dacc_chrt_dbt " + 
         "WHERE t_clientID = " + string(client_ID) + " AND t_Type = '" + string(OprType) + "' "
         "ORDER BY t_Year, t_Quarter";

end;

[#############################](Надпись);

[
+----------------------------------------------------------------------------+
| Операции,  проводимые | Число операций          | Общая сумма              |
| по счету (предполага- |                         |                          |
];

  Шапка(0) = "емые  клиентом,  если";
  Шапка(1) = "клиент  ранее  не об-";
  Шапка(2) = "служивался)";

  rs = RsdRecordset( GetSQLstring("О") );

  i = 0;
  while( rs.moveNext() )

    str = "(за " + rs.value("t_Quarter") + " кв. " + rs.value("t_Year") + ")";
    if( i < 3 )
      shapka = Шапка(i);
    else
      shapka = "";
    end;
[| ##################### | ####################### | ######################## |](shapka, str, str);
    
    i = i + 1;

    if( i < 3 )
      shapka = Шапка(i);
    else
      shapka = "";
    end;

[| ##################### | ####################### | ######################## |](shapka, rs.value("t_Quantity"), rs.value("t_Sum"));

    i = i + 1;
  
  end;

  while( i < 3 )
    [| ##################### |                         |                          |](Шапка(i));
    i = i + 1;
  end;

[+----------------------------------------------------------------------------+
| Источники поступления | Число операций          | Общая сумма              |
| денежных      средств |                         |                          |
];

  Шапка(0) = "(ожидаемые  клиентом,";
  Шапка(1) = "если клиент  ранее не";
  Шапка(2) = "обслуживался)";

  rs = RsdRecordset( GetSQLstring("И") );
  
  i = 0;

  while( rs.moveNext() )

    str = "(за " + rs.value("t_Quarter") + " кв. " + rs.value("t_Year") + ")";
    if( i < 3 )
      shapka = Шапка(i);
    else
      shapka = "";
    end;
[| ##################### | ####################### | ######################## |](shapka, str, str);
    
    i = i + 1;

    if( i < 3 )
      shapka = Шапка(i);
    else
      shapka = "";
    end;

[| ##################### | ####################### | ######################## |](shapka, rs.value("t_Quantity"), rs.value("t_Sum"));

    i = i + 1;

  end;

  while(i<3)
    [| ##################### |                         |                          |](Шапка(i));
    i = i + 1;
  end;

[+----------------------------------------------------------------------------+

]

end;

macro ПечатьХарактеристикиОпераций( Надпись )

var i = 0;

[########################

+----------------------------------------------------------------------------+
| Характеристика операций (оценка  соотношения операций с деятельностью кли- |
| ента, реальных оборотов по счету заявленным и т.д.)                        |
|----------------------------------------------------------------------------|
]
(
  Надпись
);

  while ( StrLen(_ХарактОпераций(i) ) > 0)
    [| ########################################################################## |]
     (_ХарактОпераций(i));
    i = i + 1;
  end;


[|                                                                            |
 +----------------------------------------------------------------------------+

];
end;


macro ПечатьОценкиРискаFL(Надпись )

var i = 1;

[########################

+----------------------------------------------------------------------------+
| Информация об уровне риска осуществлении клиентом легализации (отмывании)- |
| доходов, полученых преступным путем и финансирования терроризма            |
+------------------------------------------+---------------------------------+
| Уровень риска легализации доходов        | ############################### | 
+------------------------------------------+---------------------------------+
| Обоснование оценки  риска осуществления  клиентом легализации  (отмывания) |
| доходов полученных преступным путем (в соответствии с критериями разрабо - |
| танными кредитной организацией)                                            |
+----------------------------------------------------------------------------+
]
(
   Надпись, УровеньРиска
);
[| ########################################################################## |]
(_ОценкаРиска(0));

  while ( StrLen(_ОценкаРиска(i) ) > 0)
    [| ########################################################################## |]
     (_ОценкаРиска(i));
    i = i + 1;
  end;

[+----------------------------------------------------------------------------+];

end;


macro ПечатьОценкиРиска( Надпись )
        //debugbreak;
        var i = 1;
        
        [########################

        +----------------------------------------------------------------------------+
        | Информация об уровне риска осуществлении клиентом легализации (отмывании)- |
        | доходов, полученых преступным путем и финансирования терроризма            |
        +------------------------------------------+---------------------------------+
        | Уровень риска легализации доходов        | ############################### | 
        +------------------------------------------+---------------------------------+
        | Обоснование оценки  риска осуществления  клиентом легализации  (отмывания) |
        | доходов полученных преступным путем (в соответствии с критериями разрабо - |
        | танными кредитной организацией)                                            |
        +----------------------------------------------------------------------------+
        ]
        ( Надпись, УровеньРиска );

        var RetParm = Tarray(2);
        var risk_note = "";
        
        WordDoc.Bookmarks("RISK").Range.Text = УровеньРиска;
        RetParm(0) = УровеньРиска;
        
                var sql_risk = "SELECT   ATTR.T_FULLNAME "
+"\n                            FROM   dobjatcor_dbt atcor, dobjattr_dbt attr "
+"\n                             WHERE       ATCOR.T_OBJECTTYPE = 3 "
+"\n                                     AND ATCOR.T_GROUPID = 108 "
+"\n                                     AND ATTR.T_OBJECTTYPE = 3 "
+"\n                                     AND ATTR.T_GROUPID = 108 "
+"\n                                     AND ATTR.T_ATTRID = ATCOR.T_ATTRID "
+"\n                                     AND ATCOR.T_OBJECT = LPAD ('"+client_.partyid+"', 10, 0) ";
        var rsb_risk = trsbdataset(sql_risk);
        if (rsb_risk.movenext())        
                risk_note = rsb_risk.T_FULLNAME;
        else
                risk_note = readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), 16 );
        end;
        if(strlen(risk_note) != 0)
                RetParm(1) = risk_note;
        else
                RetParm(1) = readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Прим_ОценкаРиска );
        end;
        [| ########################################################################## |]
        (_ОценкаРиска(0));
        //      RetParm(1) = _ОценкаРиска(0);
        while ( StrLen(_ОценкаРиска(i) ) > 0)
                [| ########################################################################## |]
                (_ОценкаРиска(i));
                i = i + 1;
        end;
        WordDoc.Bookmarks("LEVRISK").Range.Text = RetParm[1]; 
        [+----------------------------------------------------------------------------+];
        return RetParm;
end;


Macro ПечатьВыгодоприобретателей(Надпись)
//debugbreak;
var i = 1;


[|############################################################################|
+------------------------------------------+---------------------------------+
| Наличие выгодоприобретателей             | ############################### | 
+------------------------------------------+---------------------------------+
| Перечень выгодоприобретателей                                              | 
+----------------------------------------------------------------------------+]
(Надпись, Выгодоприобретатели);

        var sql_vigodo ="       SELECT (SELECT 'Клиент №' || code.t_code || ' Наименование:' || t_name"+
"\n                             FROM dparty_dbt, dobjcode_dbt code"+
"\n                             WHERE     t_partyid = TO_NUMBER (objlnk.t_attrid)"+
"\n                                   AND code.t_objectid = TO_NUMBER (objlnk.t_attrid)"+
"\n                                   AND code.t_codekind = 1)"+
"\n                               t_vig , UTL_RAW.cast_to_varchar2(PRM.T_VALUE) prim"+
"\n                             FROM dobjlink_dbt objlnk, dparty_dbt part, dobjlinkprm_dbt prm"+
"\n                             WHERE     objlnk.t_objecttype = 3"+
"\n                             AND TO_NUMBER (objlnk.t_objectid) = part.t_partyid"+
"\n                            AND objlnk.t_groupid = 603"+
"\n                            AND part.t_partyid =" + client_.partyid + 
"\n                            AND OBJLNK.T_LINKID = PRM.T_LINKID;";


        //msgbox(sql_vigodo);

        var rs_vigodo = RsdRecordset(sql_vigodo);
        var buff = "";
       while( rs_vigodo.moveNext() )
                buff = rs_vigodo.value("t_vig") + "(" + rs_vigodo.value("prim") + ")";
                if(StrLen(buff)<=70)
                [| ########################################################################## |]
                (buff);         
                else
                        while(StrLen(buff)>70)
        [| ########################################################################## |]
        (SubStr(buff,1,70));
                                buff = SubStr(buff,71);
                                if(StrLen(buff)<=70)
        [| ########################################################################## |]
        (buff);
                                end;
                        end;
                end;
        end;

//         WordDoc.Bookmarks("WIGODAPRIOBR").Range.Text     = Выгодоприобретатели;
//         WordDoc.Bookmarks("SVED").Range.Text     = readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Oснования_ДВП);


  while ( StrLen(OSNOV_DVP(i) ) > 0)
    [| ########################################################################## |]
     (OSNOV_DVP(i));
    i = i + 1;
  end;

[+----------------------------------------------------------------------------+];

end;




macro ПечатьПодписи( КураторСчета )

/* EVG 15/05/2012 В ЭВ попросили фиксированную подпись (Иванова). */
if( fgBank.is_EXV() )
   [Ф.И.О. , должность лица, заполнившего анкету ведущий экономист Мальцева Ирина Александровна];
else
   [
      __________________________________     __________________________________
      ##################################         Руководитель подразделения
   ]
   (
     КураторСчета:c
   );
end;

end;


/*
 *  АНКЕТА КЛИЕНТА - ЮРИДИЧЕСКОГО ЛИЦА 
 */
macro АнкетаЮридическогоЛица( party, partyKind )
/*FIV Доработано для выпуска АК в MS Word 09.07.2010*/
  //debugbreak;
  record RecordAdress ( adress );

  SetBuff( client_, party );

  /* Организационно-правовая форма */
  ОПФ_Имя = ЗначениеКатегории( OBJTYPE_PARTY, client_, ОПФ_Категория, "", 1);

  /* Уровень риска */
  УровеньРиска = ЗначениеКатегории( OBJTYPE_PARTY, client_, Риск_Категория );
  Выгодоприобретатели = ЗначениеКатегории( OBJTYPE_PARTY, client_, 103 );

  var Number: string;

  Number = "";
  Регистрация( client_, РП_Регистрация, Number );

  StrSplit( ТелефоныФаксы(client_), Phone,    50, 50, 4 );  /* телефоны и факсы */
  StrSplit(readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), КодыФормГосСтатНабл ),_КодыФормГосСтатНабл,50, 50, 35);
  StrSplit(readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Прим_ОрганыУправления ),_ОрганыУправления,50, 50, 35);

  СформироватьЮридическийАдрес( client_ );
  СформироватьФактическийАдрес( client_ );
  СформироватьПочтовыйАдрес( client_ );
  СформироватьСведЛицоОткрывающееСчет( client_ );
  
  /* Первый счет */
  ПервыйСчет( client_, @Account_Open_Date );

  /* Прочитать примечания */
  ПрочитатьПримечания();

  ПолучитьДатыАнкеты();

  ClearRecord(RecordAdress);
  НайтиЮридическийАдресСубъекта(client_.PartyID,RecordAdress);
  Получить_ИмяКлиента( client_.Name );
  Получить_МестоГосударственнойРегистрации();
  Получить_НаименованиеРегОргана();
  НайтиАдресСубъекта(client_.PartyID,PTADDR_REAL,RecordAdress);
  Получить_E_MailКлиента(RecordAdress.E_Mail);

  /* EVG 16/05/2012 В ЭВ попросили изменить формулировку (Иванова) */
  if( fgBank.is_Exv() )
     _НаименованиеШапка(0)  = "Полное, а также (если";
     _НаименованиеШапка(1)  = "имеется)  сокращенное";
     _НаименованиеШапка(2)  = "наименование и наиме-";
     _НаименованиеШапка(3)  = "нование  на иностран-";
     _НаименованиеШапка(4)  = "ном языке";
  else
     _НаименованиеШапка(0)  = "Полное  и  (в случае,";
     _НаименованиеШапка(1)  = "если имеется)  сокра-";
     _НаименованиеШапка(2)  = "щенное  наименование,";
     _НаименованиеШапка(3)  = "в том числе фирменное";
     _НаименованиеШапка(4)  = "наименование";
  end;

  var i = 5;

  while (i<13)
    _НаименованиеШапка(i)  = "";
    i = i + 1;
  end;

  if( partyKind == 43 )
[                 АНКЕТА ВЫГОДОПРИОБРЕТАТЕЛЯ - ЮРИДИЧЕСКОГО ЛИЦА
]
  else
[                      АНКЕТА КЛИЕНТА - ЮРИДИЧЕСКОГО ЛИЦА
]
  end;
[                     (не являющегося кредитной организацией)
];
  if( client_.Locked == "X" )
[                            СУБЪЕКТ ЭКОНОМИКИ ЗАКРЫТ
];
  end;
[                                                    
1.1. Часть 1 (в виде таблицы)

+----------------------------------------------------------------------------+
];

 //debugbreak;

    FullDotFileName = createdoc("ak_ul.dot");
  if( WordApp )
    
    WordDoc = WordApp.Documents.Add( FullDotFileName );
    if( WordDoc )
         /*FIV Собираю имя клиента*/
         VName = client_.Name;
         if (/*(client_.ShortName != client_.Name) and */(client_.ShortName != strfor(0)))
            VName = Vname + ", " + client_.ShortName;
         end;
         if (client_.LatName != strfor(0)) 
            VName = Vname + ", " + client_.LatName;
         end;
         /*FIV WordDoc.Bookmarks("").Range.Text Вывод текста в закладку в шаблоне*/
         WordDoc.Bookmarks("FullName").Range.Text     = VName;
         WordDoc.Bookmarks("OPF").Range.Text     = ОПФ_Имя;
         /*FIV Собираю данные регистрации*/
         var regorg;
         if (date(РП_Регистрация.DocDate) != date(0,0,0))
            regorg = string(РП_Регистрация.DocDate:f);
         end;
         if (StrLen(string(Number)) > 1)
            regorg = regorg + ", " + string(Number)+_НаименованиеРегОргана(0)+_НаименованиеРегОргана(1);
         end;
         if (StrLen(string(РП_Регистрация.RegPlace)) > 1)
            regorg = regorg + ", " + string(РП_Регистрация.RegPlace);
         end;
         WordDoc.Bookmarks("REGORG").Range.Text     = regorg;

//debugbreak;
Напечатать_ИмяКлиента( _НаименованиеШапка, client_ );

[|-----------------------+----------------------------------------------------|
| Организационно-право- | #################################################  |
| вая форма             |                                                    |
|-----------------------+----------------------------------------------------|
| Регистрационный номер | ###################################                |
|-----------------------+----------------------------------------------------|
| Дата  государственной | ##########                                         |
| регистрации           |                                                    |
|-----------------------+----------------------------------------------------|
| Место государственной | ################################################## |
| регистрации           | ################################################## |
|-----------------------+----------------------------------------------------|
| Наименование рег.     | ################################################## |
| органа                | ################################################## |
]
(
  ОПФ_Имя,                             /* организационно-правовая форма */
  Number,                              /* регистрационный номер */
  РП_Регистрация.DocDate:f,            /* дата государственной регистрации */
  _МестоГосударственнойРегистрации(0), /* место государственной регистрации */
  _МестоГосударственнойРегистрации(1),
  _НаименованиеРегОргана(0),
  _НаименованиеРегОргана(1));
/*FIV Открываем документ Word по шаблону*/
  
ДопечататьПримечания(_МестоГосударственнойРегистрации, 2, 9);

[|-----------------------+----------------------------------------------------|
| Юридический адрес     | ################################################## |
]
(
  Address(0):w                          /* Юридический адрес */
);

ДопечататьПримечания(Address, 1, 9);
         WordDoc.Bookmarks("UADRES").Range.Text     = VAddress;

[|-----------------------+----------------------------------------------------|
| Органы     управления | ################################################## |
| находятся  по  юриди- | ################################################## |
| ческому адресу        | ################################################## |
]
(
  _ОрганыУправления(0),_ОрганыУправления(1),_ОрганыУправления(2)
);

ДопечататьПримечания(_ОрганыУправления, 3, 34);
         WordDoc.Bookmarks("PLACE").Range.Text     = readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Прим_ОрганыУправления );

[|-----------------------+----------------------------------------------------|
| Адрес местонахождения | ################################################## |
]
(
  AddressF(0)                          /* фактический адрес */
);

ДопечататьПримечания(AddressF, 1, 9);
         WordDoc.Bookmarks("FACTADR").Range.Text     = VAddressF;

[|-----------------------+----------------------------------------------------|
| Почтовый адрес        | ################################################## |]
(AddressP(0) /* почтовый адрес */);

ДопечататьПримечания(AddressP, 1, 9);
         WordDoc.Bookmarks("POSTADR").Range.Text     = VAddressP;

[|-----------------------+----------------------------------------------------|
| Номера контактных те- | ################################################## |
| лефонов и факсов      | ################################################## |
]
(
  Phone(0), Phone(1)         /* телефоны и факсы */
);

ДопечататьПримечания(Phone, 2, 3);
         WordDoc.Bookmarks("PHONES").Range.Text     = Phone(0)+"\n"+Phone(1)+"\n"+Phone(2)+"\n"+Phone(3);

[|-----------------------+----------------------------------------------------|
| Адрес электронной по- | ################################################## |
| чты                   | ################################################## |
|-----------------------+----------------------------------------------------|
| Идентификационный но- | ###################################                |
| мер налогоплательщика |                                                    |
]
(
  _E_MailКлиента(0), _E_MailКлиента(1), /* адрес электронной почты */
  ПолучитьИНН( client_.PartyID )
);
//         WordDoc.Bookmarks("MAIL").Range.Text     = _E_MailКлиента(0) + _E_MailКлиента(1);
//debugbreak;
         WordDoc.Bookmarks("INN").Range.Text     = ПолучитьИНН( client_.PartyID );

WordDoc.Bookmarks("FGSN").Range.Text = ПечатьКодыФГСН( client_ );

[|-----------------------+----------------------------------------------------|
| Код клиента           | ###################################                |
|                       |                                                    |
](Получитькодсубъекта(client_.PartyID,1));
//        debugbreak;
         WordDoc.Bookmarks("CODE").Range.Text     = Получитькодсубъекта(client_.PartyID,1);

[|-----------------------+----------------------------------------------------|
| Сведения о лице,  от- | ################################################## |
| крывающем  счет   для | ################################################## |
| юридического     лица | ################################################## |
| (вносящем   вклад   в | ################################################## |
| пользу   юридического | ################################################## |
| лица) (в  случае  от- | ################################################## |
| крытия счета  (внесе- | ################################################## |
| ния  вклада) не самим | ################################################## |
| юридическим    лицом) | ################################################## |
| (заполняется с учетом | ################################################## |
| подпунктов   2.2.3  и |                                                    |
| 2.2.4 настоящих Реко- |                                                    |
| мендаций)             |                                                    |
]
( 
  _СведЛицоОткрывающееСчет(0),
  _СведЛицоОткрывающееСчет(1),
  _СведЛицоОткрывающееСчет(2),
  _СведЛицоОткрывающееСчет(3),
  _СведЛицоОткрывающееСчет(4),
  _СведЛицоОткрывающееСчет(5),
  _СведЛицоОткрывающееСчет(6),
  _СведЛицоОткрывающееСчет(7),
  _СведЛицоОткрывающееСчет(8),
  _СведЛицоОткрывающееСчет(9)
);
//        WordDoc.Bookmarks("SOTR").Range.Text     = СведЛицоОткрывающееСчет;

//|-----------------------+----------------------------------------------------|
//| Уровень риска         | #############################                      |
[|-----------------------+----------------------------------------------------|
| Дата открытия первого | ##########                                         |
| счета                 |                                                    |
]
(
  //УровеньРиска,
  PrintDate(Account_Open_Date) /* Дата открытия первого счета */
);
         WordDoc.Bookmarks("OPENFIRSTAC").Range.Text     = Account_Open_Date;

[|-----------------------+----------------------------------------------------|
| Куратор счета         | ################################################## |
]
(
  _AccountOper(0)
);

ДопечататьПримечания( _AccountOper, 1);

         WordDoc.Bookmarks("CURATOR").Range.Text     = _AccountOper(0);

[|-----------------------+----------------------------------------------------|
| Резервный     куратор |                                                    |
| счета (если существу- |                                                    |
| ет)                   |                                                    |
|-----------------------+----------------------------------------------------|
| Сотрудник,  утвердив- | ################################################## |
| ший открытие счета    |                                                    |
]
(
/* EVG 15/05/2012 Хотят должность главбуха (Иванова). Делаю для всех.
{FIO_Book}*/
{Name_Book} + " " + {FIO_Book}
);
        /* EVG 15/05/2012 Хотят должность главбуха (Иванова). Делаю для всех.
        WordDoc.Bookmarks("SOTR").Range.Text     =  {FIO_Book}; //_AccountControlOper(0) +"\n"+ _AccountControlOper(1);*/
        WordDoc.Bookmarks("SOTR").Range.Text     =  {Name_Book} + " " + {FIO_Book}; //_AccountControlOper(0) +"\n"+ _AccountControlOper(1);

  if( client_.Locked == "X" )
[|-----------------------+----------------------------------------------------|
| Дата закрытия         | ##########                                         |
| субъекта экономики    |                                                    |
]
(ПолучитьДатуЗакрытия(client_.PartyID):f);
  end;

ДопечататьПримечания(_AccountControlOper, 2 );

[|-----------------------+----------------------------------------------------|
| Дата заполнения Анке- | ##########                                         |
| ты                    |                                                    |
|-----------------------+----------------------------------------------------|
| Дата обновления Анке- | ##########                                         |
| ты                    |                                                    |
|-----------------------+----------------------------------------------------|
| Срок хранения  Анкеты | ##########                                         |
|                       |                                                    |
+----------------------------------------------------------------------------+

]
(
  FormDateFill :f,
  FormDateModif:f,
  FormDateStore:f
);
         WordDoc.Bookmarks("DATEZAP").Range.Text     = string(FormDateFill:f);
         WordDoc.Bookmarks("DATEMODIF").Range.Text     = string(FormDateModif:f);
         WordDoc.Bookmarks("MANAGER").Range.Text     = readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Менеджер );


[1.2. Часть 2 (текстовая)

+----------------------------------------------------------------------------+
| Сведения об учредите- | ################################################## |
| лях,    собственниках | ################################################## |
| имущества юридическо- | ################################################## |
| го лица, лицах, кото- | ################################################## |
| рые имеют  право  да- | ################################################## |
| вать обязательные для | ################################################## |
| юридического     лица | ################################################## |
| указания  либо   иным | ################################################## |
| образом имеют возмож- | ################################################## |
| ность определять  его | ################################################## |
| решения, в том  числе | ################################################## |
| сведения  об основном | ################################################## |
| обществе или преобла- | ################################################## |
| дающем,   участвующем | ################################################## |
| обществе  (для дочер- | ################################################## |
| них или зависимых об- | ################################################## |
| ществ)    холдинговой | ################################################## |
| компании или финансо- | ################################################## |
| во-промышленной груп- | ################################################## |
| пе(если субъект в ней | ################################################## |
| участвует)  (заполня- | ################################################## |
| ется  с  учетом  под- | ################################################## |
| пунктов 2.2.3 и 2.2.4 | ################################################## |
| настоящих  Рекоменда- | ################################################## |
| ций)                  | ################################################## |
]
(
  _Учредители(0), _Учредители(1), _Учредители(2), _Учредители(3), _Учредители(4), _Учредители(5),
  _Учредители(6), _Учредители(7), _Учредители(8), _Учредители(9), _Учредители(10), _Учредители(11),
  _Учредители(12),_Учредители(13),_Учредители(14),_Учредители(15),_Учредители(16),
  _Учредители(17),_Учредители(18),_Учредители(19),_Учредители(20),_Учредители(21),
  _Учредители(22),_Учредители(23),_Учредители(24)
);

ДопечататьПримечания(_Учредители, 25, 34);
         WordDoc.Bookmarks("UTCHR").Range.Text     = readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Прим_Учредители );

GetInstitute(client_.partyid);
[|-----------------------+----------------------------------------------------|
| Величина  зарегистри- |                                                    |
| рованного   уставного |                                                    |
| (складочного)   капи- | ################################################## |
| тала   или   величина |                                                    |
| уставного       фонда | ################################################## |
| (иммущества)          |                                                    |
](CAPITAL(0):a:l, CAPITAL(1):a:l);
         WordDoc.Bookmarks("REGCAPITAL").Range.Text     = CAPITAL(0) + "\n" + CAPITAL(1);
         WordDoc.Bookmarks("OPLCAPITAL").Range.Text     = CAPITAL(0) + "\n" + CAPITAL(1);



[|-----------------------+----------------------------------------------------|
| Сведения  о   наличии | ################################################## |
| лицензий (разрешений) | ################################################## |
| на осуществление  оп- | ################################################## |
| ределенного вида дея- | ################################################## |
| тельности или  опера- | ################################################## |
| ций  (номер  лицензии | ################################################## |
| (разрешения),  когда, | ################################################## |
| кем и  на осуществле- | ################################################## |
| ние какого  вида дея- | ################################################## |
| тельности  (операции) | ################################################## |
| выдана)               | ################################################## |
]
(
  _Лицензии(0), _Лицензии(1), _Лицензии(2), _Лицензии(3), _Лицензии(4),_Лицензии(5),
  _Лицензии(6),_Лицензии(7),_Лицензии(8),_Лицензии(9),_Лицензии(10)
);
ДопечататьПримечания(_Лицензии, 11, 34);

          var license = readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Прим_Лицензии );
          if (license == "") 
                license = "НЕТ";
          end;
      WordDoc.Bookmarks("LIC").Range.Text     = license;

//         WordDoc.Bookmarks("LIC").Range.Text     = readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Прим_Лицензии );

[|-----------------------+----------------------------------------------------|
| Сведения  об  органах | ################################################## |
| юридического     лица | ################################################## |
| (структура    органов | ################################################## |
| управления  юридичес- | ################################################## |
| кого лица  и сведения | ################################################## |
| о  физических  лицах, | ################################################## |
| входящих в состав ис- | ################################################## |
| полнительных  органов | ################################################## |
| юридического  лица, с | ################################################## |
| учетом     подпунктов | ################################################## |
| 2.2.3 и 2.2.4 настоя- | ################################################## |
| щих Рекомендаций)     | ################################################## |
]
(
  _Органы(0), _Органы(1), _Органы(2), _Органы(3), _Органы(4), _Органы(5),_Органы(6),
  _Органы(7),_Органы(8),_Органы(9),_Органы(10),_Органы(11)
);
ДопечататьПримечания(_Органы, 12, 34);
//       debugbreak;
// Zlenko M 23.04.2012 Если есть примечания тянем его, нет - из БД

if (readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Прим_Органы ))
   WordDoc.Bookmarks("ORG").Range.Text     = readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Прим_Органы );
else
        var sql_sotr = "    SELECT    offi.t_post " 
+"\n                    || ' ' " 
+"\n                    || pers.t_name1 " 
+"\n                    || ' ' " 
+"\n                       || pers.t_name2 " 
+"\n                       || ' ' " 
+"\n                       || pers.t_name3 " 
+"\n                          fname, " 
+"\n                          'Паспорт серия: ' " 
+"\n                       || idc.t_paperseries " 
+"\n                       || ' № ' " 
+"\n                       || idc.t_papernumber " 
+"\n                       || ' Кем выдан: ' " 
+"\n                       || idc.t_paperissuer " 
+"\n                       || ' Дата выдачи: ' " 
+"\n                       || idc.t_paperissueddate " 
+"\n                       || ' Номер подразделения: ' " 
+"\n                       || idc.t_paperissuercode " 
+"\n                       || ' Место рождения: ' " 
+"\n                       || pers.T_BIRSPLASE "
+"\n                       || ' Адрес регистрации: ' "; 
    //13.11.2013 Gurin S. R-282343-2
    if( fgBank.is_GO() )
        sql_sotr = sql_sotr +

         "\n               || (SELECT   T_ADRESS "
        +"\n                     FROM   dadress_dbt "
        +"\n                    WHERE   t_partyid = pers.t_personid AND t_type = 1) ";
    else
        sql_sotr = sql_sotr +
         "\n               || ADR.T_ADRESS ";
    end;
sql_sotr = sql_sotr +  
 "\n                          pasp " 
+"\n                FROM dpersn_dbt pers, dofficer_dbt offi, dpersnidc_dbt idc, dadress_dbt adr " 
+"\n                WHERE     offi.t_personid = pers.t_personid " 
+"\n                      AND idc.t_personid = offi.t_personid " 
+"\n                      AND offi.t_partyid = ADR.T_PARTYID " 
+"\n                      AND ADR.t_type = 1                  "
+"\n                      AND offi.t_isfirstperson = 'X' " 
+"\n                      AND offi.t_partyid = " + client_.partyid;



//      msgbox(sql_sotr);
        var rsb_sotr = TRsbDataSet(sql_sotr);
        var fname = "";
        while(rsb_sotr.movenext());
               fname = fname + rsb_sotr.fname + "\n" + rsb_sotr.pasp + "\n"; 
       end;
        WordDoc.Bookmarks("ORG").Range.Text = fname;
end;

[|-----------------------+----------------------------------------------------|
| Обособленные  подраз- | ################################################## |
| деления (если имеются | ################################################## |
| и сведения о  них из- | ################################################## |
| вестны  кредитной ор- | ################################################## |
| ганизации)            | ################################################## |
]
(
  _Подразделения(0), _Подразделения(1), _Подразделения(2),
  _Подразделения(3), _Подразделения(4)
);

ДопечататьПримечания(_Подразделения, 5, 34);
//         WordDoc.Bookmarks("OBSPDR").Range.Text     = readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Прим_Подразделения );

StrSplit( Виды_Деятельности, _ВидыДеятельности, 50, 50, 35 );

[|-----------------------+----------------------------------------------------|
| Основные  виды   дея- | ################################################## |
| тельности  (в том чи- | ################################################## |
| сле  производимые то- | ################################################## |
| вары, выполняемые ра- | ################################################## |
| боты, предоставляемые | ################################################## |
| услуги)               | ################################################## |
]
(
  _ВидыДеятельности(0), _ВидыДеятельности(1), _ВидыДеятельности(2),
  _ВидыДеятельности(3), _ВидыДеятельности(4), _ВидыДеятельности(5)
);

ДопечататьПримечания(_ВидыДеятельности, 6, 34);
         WordDoc.Bookmarks("DTLNST").Range.Text     =  Виды_Деятельности;
//readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Прим_ВидыДеятельности );

[|-----------------------+----------------------------------------------------|
| Сведения о постоянных | ################################################## |
| контрагентах          | ################################################## |
]
(
  _ПостКонтрагенты(0),_ПостКонтрагенты(1)
);

ДопечататьПримечания(_ПостКонтрагенты, 2, 34);
//         WordDoc.Bookmarks("CONTR").Range.Text     = readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Прим_ПостКонтрагенты );

[|-----------------------+----------------------------------------------------|
| История,   репутация, | ################################################## |
| сектор рынка и конку- | ################################################## |
| ренция   (сведения  о | ################################################## |
| реорганизации,  изме- | ################################################## |
| нения в характере де- | ################################################## |
| ятельности,   прошлые | ################################################## |
| финансовые  проблемы, | ################################################## |
| репутация  на  нацио- | ################################################## |
| нальном и  зарубежных | ################################################## |
| рынках, основные  об- | ################################################## |
| служиваемые    рынки, | ################################################## |
| присутствие  на  рын- | ################################################## |
| ках,  основная доля в | ################################################## |
| конкуренции и на рын- | ################################################## |
| ке)                   | ################################################## |
]
(
  _ИсторияРепутация(0), _ИсторияРепутация(1), _ИсторияРепутация(2), _ИсторияРепутация(3),
  _ИсторияРепутация(4), _ИсторияРепутация(5), _ИсторияРепутация(6), _ИсторияРепутация(7),
  _ИсторияРепутация(8), _ИсторияРепутация(9), _ИсторияРепутация(10),
  _ИсторияРепутация(11), _ИсторияРепутация(12), _ИсторияРепутация(13),
  _ИсторияРепутация(14)
);

ДопечататьПримечания(_ИсторияРепутация, 15, 34);
//         WordDoc.Bookmarks("HIST").Range.Text     = readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Прим_ИсторияРепутация );

[+----------------------------------------------------------------------------+

];

  //ПечатьОпераций( "1.3. Часть 3 (в виде таблицы)", client_.PartyID );
//  debugbreak;
  //ПечатьХарактеристикиОпераций( "1.4. Часть 4 (текстовая)" );
  var RetParm = TArray;
  //debugbreak;
  RetParm = ПечатьОценкиРиска( "1.3. Часть 3 (текстовая)" );
//  WordDoc.Bookmarks("RISK").Range.Text = RetParm(0);

  var ssql, srsb, fulllevrisk;


  if (fgBank.is_GEB)
//      debugbreak;
      ssql = " SELECT attr.t_fullname " +
                 "   FROM dobjatcor_dbt atcor, dobjattr_dbt attr " +
                 "  WHERE atcor.t_object = LPAD ('"+ client_.PartyID +"', 10, '0') " +
                 "    AND atcor.t_attrid = attr.t_attrid " +
                 "    AND attr.T_GROUPID = 108 ";

      srsb = TRsbDataSet(ssql);
      fulllevrisk= "";
      while(srsb.movenext())
          fulllevrisk = fulllevrisk + "\n" + srsb.t_fullname;
      end;
      if (fulllevrisk == "")
          fulllevrisk = RetParm(1);
      end;
      WordDoc.Bookmarks("LEVRISK").Range.Text = fulllevrisk;  
  elif (fgBank.is_EXV)
//      debugbreak;
      ssql = " SELECT attr.t_fullname " +
                 "   FROM dobjatcor_dbt atcor, dobjattr_dbt attr " +
                 "  WHERE atcor.t_object = LPAD ('"+ client_.PartyID +"', 10, '0') " +
                 "    AND atcor.t_attrid = attr.t_attrid " +
                 "    AND attr.T_GROUPID = 108 ";

      srsb = TRsbDataSet(ssql);
      fulllevrisk= "";
      while(srsb.movenext())
          fulllevrisk = fulllevrisk + "\n" + srsb.t_fullname;
      end;
      if (fulllevrisk == "")
          fulllevrisk = RetParm(1);
      end;
    //  WordDoc.Bookmarks("LEVRISK").Range.Text = fulllevrisk;  
  else
//      WordDoc.Bookmarks("LEVRISK").Range.Text = RetParm(1);
  end;  


  ПечатьВыгодоприобретателей("Сведения о выгодоприобретателях");

  if( partyKind == 43 )
    ХарактеристикаОпераций( client_.PartyID );
  end;

  ПечатьПодписи( "Куратор счета" );

      if( IsStandAlone() )
        WordApp.Visible = TRUE;
      else
        ShowReportOnTerminal( WordApp, WordDoc );
      end; 
  
    
    end; /*if( WordDoc )*/
  end; /*if( WordApp )*/

end;



/****************************************************************************************/

/*
 *  АНКЕТА КЛИЕНТА - ФИЗИЧЕСКОГО ЛИЦА 
 */
macro АнкетаФизическогоЛица( party, partyKind )

  var person, pers_migr, migr_card, nr_reg_doc, pers_nr_doc;
  var stat;

  var zap = 0;

  var ipdl, ИПДЛ_Организация, ИПДЛ_Должность;

  file persn("persn.dbt");
  file attr("objattr.dbt") key 0;

  record RecordAdress ( adress );
  record persnidc("persnidc.dbt");

  array PAPER_KIND, VISA, REG_PALACE, MG_CARD, NR_DOC, CNT, OV_PRS;
 
  private array ИДПЛ;
  private var gos;

  macro Удостоверение()
    file ppkind("paprkind.dbt");

    var str;
    str = "";
    /* Вид документа */
    if( GetPersonIdc(persn.PersonId, persnidc) )
      ppkind.PaperKind = persnidc.PaperKind;
      if( GetEQ(ppkind) )
        str = ДобавитьСтроку( str, ppkind.Name, "" );
      end;
    end;
    //debugbreak;
    /* серия */
    str = ДобавитьСтроку( str, persnidc.PaperSeries, "серия " );
    /* номер */
    str = ДобавитьСтроку( str, persnidc.PaperNumber, "номер " );
    /* выдан */
    str = ДобавитьСтроку( str, persnidc.PaperIssuer, "выдан " );
    /* дата выдачи */
    str = ДобавитьСтроку( str, string(persnidc.PaperIssuedDate:f), "дата выдачи " );
    /* ASV Код подразделения */
    str = ДобавитьСтроку( str, persnidc.paperissuercode, "код подразделения " );
    
    return str;
  end;


  macro Удостоверение_ДЛ(trp_id)
    file ppkind("paprkind.dbt");

    var str;
    str = "";
    /* Вид документа */
    if( GetPersonIdc(trp_id, persnidc) )
      ppkind.PaperKind = persnidc.PaperKind;
      if( GetEQ(ppkind) )
        str = ДобавитьСтроку( str, ppkind.Name, "" );
      end;
    end;
    /* серия */
    str = ДобавитьСтроку( str, persnidc.PaperSeries, "серия " );
    /* номер */
    str = ДобавитьСтроку( str, persnidc.PaperNumber, "номер " );
    /* выдан */
    str = ДобавитьСтроку( str, persnidc.PaperIssuer, "выдан " );
    /* дата выдачи */
    str = ДобавитьСтроку( str, string(persnidc.PaperIssuedDate:f), "дата выдачи " );
    
    return str;
  end;




  macro Виза()

    /*record ptreg("partyreg.dbt");*/
    record ptreg("objrgdoc.dbt");
    file regParty("party.dbt");

    var Number: string, rs;
    var str, tmp_str;
    str = "";
//debugbreak;
    if( client_.NotResident == "X" )   /* "Виза" */
//      if( GetPartyReg( client_, ptreg, REGPT_MID, OBJKDOC_VISA, Number ) )
        rs = USR_GetPartyReg( client_.partyid, REGPT_MID, OBJKDOC_VISA); 
        if(rs and rs.movenext) 
        str = ДобавитьСтроку( str, "Виза", "Вид документа " );
        /* выдана */
        if( rs.RegPartyID > 0 )
          ClearRecord(regParty);
          regParty.PartyID = rs.RegPartyID;
          GetEQ( regParty );
          str = ДобавитьСтроку( str, regParty.Name, "выдана " );
        end;
        /* дата выдачи */
        str = ДобавитьСтроку( str, substr(string(rs.DocDate:f),1,10), "дата выдачи " );
        /* срок */
        tmp_str = "";
        if( (substr(string(rs.StartDate),1,10) != Date(0, 0, 0)) or (substr(string(rs.FinishDate),1,10) != Date(0, 0, 0)) )
          tmp_str = " - ";
        end;
        str = ДобавитьСтроку( str, substr(string(rs.StartDate:f),1,10) + tmp_str + substr(string(rs.FinishDate:f),1,10), "срок " );
        /* серия */
        str = ДобавитьСтроку( str, rs.Series, "серия " );
        /* номер */
        str = ДобавитьСтроку( str, rs.Number, "номер " );
      end;
    end;

    return str;

  end;

  macro РегистрацияПредпринимателя()
    //debugbreak;
    /*record ptreg("partyreg.dbt");*/
    record ptreg("objrgdoc.dbt");
    file regParty("party.dbt");

    var str, tmp_str;
    str = "";
    var Number: string = "";

    if( persn.IsEmployer == "X" )
      if( Регистрация( client_, ptreg, Number ) )
        /* рег № */
        str = ДобавитьСтроку( str, string(Number), "рег № " );
        /* дата регистрации */
        str = ДобавитьСтроку( str, string(ptreg.DocDate:f), "дата регистрации " );
        /* место регистрации */
        str = ДобавитьСтроку( str, string(ptreg.RegPlace), "место регистрации " );
        /* выдана */
        if( ptreg.RegPartyID > 0 )
          ClearRecord(regParty);
          regParty.PartyID = ptreg.RegPartyID;
          GetEQ( regParty );
          str = ДобавитьСтроку( str, regParty.Name, "орган, выдавший свидетельство " );
        end;
        
        /* 
        tmp_str = "";
        if( (ptreg.StartDate != Date(0, 0, 0)) or (ptreg.FinishDate != Date(0, 0, 0)) )
          tmp_str = " - ";
        end;
        str = ДобавитьСтроку( str, string(ptreg.FinishDate:f) + tmp_str + string(ptreg.StartDate:f), "на срок " );
         */
      end;
    end;

    return str;
  end;
  
  MACRO Гражданство (country)
    var rs, str;
    
    str = "SELECT t_fullname " +
          "  FROM dcountry_dbt " +
          " WHERE t_codelat3 = '"+country+"' ";
    
    rs = trsbdataset(str);
    if(rs and rs.movenext)
      return rs.t_fullname;
    else
      return "Российская Федерация";  
    end;
  END;
  
  MACRO Резидентность(NotResident)
   if(NotResident== "X")
      return "Нерезидент";
   else
      return "Резидент";
   end;
  END;

macro ПолучитьВидыДеятельности( client_ )

  var ObjCat = RsbObjCategories( OBJTYPE_PARTY, UniID( client_, OBJTYPE_PARTY ));

  /*ОКВЭД - категория <Код ОКВЭД> - objatcor.GroupID = 17. Множественная*/
  if( ObjCat.GetFirst( 17, {curdate}, attr ) == 0)
    Виды_Деятельности = attr.FullName;
    while( ObjCat.GetNext( attr ) == 0)
      Виды_Деятельности = Виды_Деятельности + "; " + attr.FullName;
    end;
  end;

end;



macro ПолучитьДoкументРегистрации(party, kind)

var SQL, cmd, rs;
var str = "";

SQL = "SELECT * FROM dobjrgdoc_dbt WHERE t_objecttype = 3 AND t_regdockind = ? AND t_codekind = 0 AND t_objectid = ?";

cmd = RsdCommand(SQL);
cmd.AddParam("kind", RSDBP_IN, kind);
cmd.AddParam("party", RSDBP_IN, party);
cmd.execute();

rs = RsdRecordSet(cmd);

  if(rs.MoveNext())
    if   (kind == 19)
      str = "Миграционная карта";
    elif (kind == 16)
      str = "Разрешение на временное проживание";
    end;

    if((valtype(rs.Value("t_series")) != 26) and (string(rs.Value("t_series")) != ""))
      str = str + "серия " + rs.Value("t_series");
    end;

    str = str + " номер " + rs.Value("t_number") + ", на срок с " + date(rs.Value("t_startdate"));

    if(rs.value("t_finishdate") != date(0,0,0))
      str = str + " по " + date(rs.Value("t_finishdate"));
    end;

  end;

return str;

end;



macro ПолучитьСубъектаПоКоду(tr_code, kind)

var SQL, cmd, rs;

SQL = "SELECT t_objectid as party FROM dobjcode_dbt WHERE t_codekind = ? AND t_code = ? AND t_objecttype = 3";
cmd = RsdCommand(SQL);
cmd.AddParam("kind", RSDBP_IN, kind);
cmd.AddParam("code", RSDBP_IN, tr_code);
cmd.Execute();

rs = RsdRecordSet(cmd);

  if(rs.MoveNext())
    return rs.value("party");
  end;

return 0;

end;


macro ПолучитьДатуКода(type, object, kind, code)

var SQL, cmd, rs;

SQL = "SELECT t_bankdate FROM dobjcode_dbt WHERE t_objecttype = ? AND t_objectid = ? AND t_codekind = ? AND t_code = ? AND t_state = 0";
cmd = RsdCommand(SQL);
cmd.AddParam("type", RSDBP_IN, type);
cmd.AddParam("obj", RSDBP_IN, object);
cmd.AddParam("kind", RSDBP_IN, kind);
cmd.AddParam("code", RSDBP_IN, code);

cmd.execute();

rs = RsdRecordSet(cmd);

  if (rs.MoveNext())
    if(date(rs.Value(0)) != date(0,0,0))
      return trim(string(rs.Value(0)));
    else
      return "";
    end;
  end;

return "";

end;


macro ПечатьДоверенногоЛица(ptid);
 //debugbreak;
array FIO, PAPER, MG_CARD, NR_DOC, ADR_REG, ADR_FACT;

private var tr_code, dv_pers_id, cntr = "";
private var migr_card_str="", doc_str="", pass_str = "", bn = "", bn_pls = "", date_tr = "";

private var part   = TBFILE("party");
private var pers   = TBFILE("persn");
private var adr_r    = TBFILE("adress");
private var adr_f    = TBFILE("adress");
private var ps_idc = TBFILE("persnidc");

tr_code = ПолучитьКодСубъекта(ptid, 105);
 //debugbreak;
if(tr_code != "")

  date_tr = ПолучитьДатуКода(3, ptid, 105, tr_code);
  dv_pers_id = ПолучитьСубъектаПоКоду(tr_code, 1);

  if (dv_pers_id != 0)

    /* Получим заполненные структуры */
    part.KeyNum = 0;
    part.rec.PartyID = dv_pers_id;
    part.GetEQ();

    pers.KeyNum = 0;
    pers.rec.PersonID = dv_pers_id;
    pers.GetEQ();

    ps_idc.KeyNum = 0;
    ps_idc.rec.personid = dv_pers_id;
    ps_idc.rec.paperkind = 0; /* Паспорт */
    ps_idc.GetEQ();

    adr_r.KeyNum = 0;
    adr_r.rec.PartyID = dv_pers_id;
    adr_r.rec.Type = 1; /* Адрес регистрации */
    adr_r.GetEQ();

    adr_f.KeyNum = 0;
    adr_f.rec.PartyID = dv_pers_id;
    adr_f.rec.Type = 2; /* Адрес места пребывания */
    adr_f.GetEQ();

    migr_card_str = ПолучитьДoкументРегистрации(part.rec.partyid, 19);
    doc_str       = ПолучитьДoкументРегистрации(part.rec.partyid, 16);

    pass_str = "Паспорт серия " + ps_idc.rec.paperseries + " номер " + ps_idc.rec.papernumber +  " выдан " + ps_idc.rec.paperissueddate + " " + ps_idc.rec.paperissuer + " к/п " + ps_idc.rec.paperissuercode;

    StrSplit(part.rec.name, FIO, 50, 50, 10 );
    StrSplit(pass_str, PAPER, 50, 50, 10 );

    StrSplit(migr_card_str, MG_CARD, 50, 50, 10);
    StrSplit(doc_str, NR_DOC, 50, 50, 10);

    cntr = Гражданство(part.rec.nrcountry);

    StrSplit(adr_r.rec.adress, ADR_REG, 50,50,2);
    StrSplit(adr_f.rec.adress, ADR_FACT, 50,50,2);

    bn     = trim(string(pers.rec.born));
    bn_pls = trim(string(pers.rec.birsplase));

  else

    FIO(0) = FIO(1) = PAPER(0) = PAPER(1) = PAPER(2) = PAPER(3) = PAPER(4) = PAPER(5) = PAPER(6) = MG_CARD(0) =  MG_CARD(1) = NR_DOC(0) = NR_DOC(1) = NR_DOC(2) = NR_DOC(3) = NR_DOC(4) = NR_DOC(5) = NR_DOC(6) = ADR_REG(0) =  ADR_REG(1) = ADR_FACT(0) =  ADR_FACT(1) = "";

  end;

else

  FIO(0) = FIO(1) = PAPER(0) = PAPER(1) = PAPER(2) = PAPER(3) = PAPER(4) = PAPER(5) = PAPER(6) = MG_CARD(0) =  MG_CARD(1) = NR_DOC(0) = NR_DOC(1) = NR_DOC(2) = NR_DOC(3) = NR_DOC(4) = NR_DOC(5) = NR_DOC(6) = ADR_REG(0) =  ADR_REG(1) = ADR_FACT(0) =  ADR_FACT(1) = "";

end;

//debugbreak;
[+----------------------------------------------------------------------------+
| Сведения о доверенном лице клиента                                         |
+-----------------------+----------------------------------------------------+
| Фамилия, имя  и (если | ################################################## |
| имеется) отчество     | ################################################## |
+-----------------------+----------------------------------------------------+
| Дата рождения         | ##########                                         |
+-----------------------+----------------------------------------------------+
| Место рождения        | ################################################## |
+-----------------------+----------------------------------------------------+
| Сведения о документе, | ################################################## |
| удостоверяющем   лич- | ################################################## |
| ность  (наименование, | ################################################## |
| серия и номер, орган, | ################################################## |
| выдавший    документ, | ################################################## |
| дата   выдачи   доку- | ################################################## |
| мента)                | ################################################## |
+-----------------------+----------------------------------------------------+
| Гражданство  (поддан- | ################################################## |
| ство)                 |                                                    |
+-----------------------+----------------------------------------------------+
| Данные миграционной   | ################################################## |
| карты                 | ################################################## |
+-----------------------+----------------------------------------------------+
| Наименование и данные | ################################################## |
| документа, удостоверя-| ################################################## |
| ющего право иностран- | ################################################## |
| ного гражданина или   | ################################################## |
| лица без гражданства  | ################################################## |
| на пребывание на тер- | ################################################## |
| ритории РФ            | ################################################## |
+-----------------------+----------------------------------------------------+
| Место жительства (ре- | ################################################## |
| гистрации)            | ################################################## |
+-----------------------+----------------------------------------------------+
| Место пребывания      | ################################################## |
|                       | ################################################## |
+-----------------------+----------------------------------------------------|
| Дата доверенности     | ##########                                         |
+----------------------------------------------------------------------------+


]
(
FIO(0),FIO(1),
bn, 
bn_pls,
PAPER(0),PAPER(1),PAPER(2),PAPER(3),PAPER(4),PAPER(5),PAPER(6),
cntr,
MG_CARD(0), MG_CARD(1),
NR_DOC(0),NR_DOC(1),NR_DOC(2),NR_DOC(3),NR_DOC(4),NR_DOC(5),NR_DOC(6),
ADR_REG(0), ADR_REG(1),
ADR_FACT(0), ADR_FACT(1),
date_tr
);


end;
  //debugbreak;
  person = RsbParty(client_.PartyID);
  pers_migr = person.PartyRegDoc(2, 19);  /* Миграционная карта */
  pers_nr_doc = person.PartyRegDoc(2, 16); /* Разрешение на временное проживание */

  SetBuff( client_, party );
  ClearRecord( persn );
  persn.PersonID = client_.PartyID;
  GetEQ( persn );

  /* Уровень риска */
  УровеньРиска = ЗначениеКатегории( OBJTYPE_PARTY, client_, Риск_Категория );
  Выгодоприобретатели = ЗначениеКатегории( OBJTYPE_PARTY, client_, 103 );


  StrSplit( ТелефоныФаксы(client_), Phone,      50, 50, 4 );  /* телефоны и факсы */
  StrSplit( Удостоверение(),       PAPER_KIND, 50, 50, 10 ); /* удостоверение */
  StrSplit( Виза(),                VISA,       50, 50, 14 ); /* виза */
  StrSplit( РегистрацияПредпринимателя(), REG_PALACE, 50, 50, 13 );  /* предприниматель */

  /* Первый счет */
  ПервыйСчет( client_, @Account_Open_Date );

  /* Прочитать примечания */
  ПрочитатьПримечания();

  ПолучитьДатыАнкеты();

  StrSplit(persn.Name1 + ", " + persn.Name2 + ", " + persn.Name3,_ФИО,50, 50, 2);
  StrSplit(persn.PlaceWork,_МестоРаботы_И_Должность,50, 50, 2);

  ClearRecord(RecordAdress);
  НайтиАдресСубъекта(client_.PartyID,PTADDR_REAL,RecordAdress);
  Получить_E_MailКлиента(RecordAdress.E_Mail);
  СформироватьЮридическийАдрес( client_ );
  СформироватьФактическийАдрес( client_ );

  СформироватьПочтовыйАдрес( client_ );

  СформироватьМестоРождения( client_ );
  СформироватьСведЛицоОткрывающееСчет( client_ );



if( persn.ISEMPLOYER != "X")
  if( partyKind == 43 )
[                 АНКЕТА ВЫГОДОПРИОБРЕТАТЕЛЯ - ФИЗИЧЕСКОГО ЛИЦА
]
  else
[                      АНКЕТА КЛИЕНТА - ФИЗИЧЕСКОГО ЛИЦА
]
  end;
else
[                 АНКЕТА  - ИНДИВИДУАЛЬНОГО ПРЕДПРИНИМАТЕЛЯ
]
end;

if( client_.Locked == "X" )
[                            СУБЪЕКТ ЭКОНОМИКИ ЗАКРЫТ
];
  end;
//debugbreak;
FullDotFileName = createdoc("ak_ip.dot");
  if( WordApp )
        //debugbreak;
       WordDoc = WordApp.Documents.Add( FullDotFileName );
        if( WordDoc )
        
        [
        2.1. Часть 1 (в виде таблицы)
        
        +----------------------------------------------------------------------------+
        | Фамилия, имя  и (если | ################################################## |
        | имеется) отчество     | ################################################## |
        |-----------------------+----------------------------------------------------|
        | Дата рождения         | ##########                                         |
        |-----------------------+----------------------------------------------------|
        | Место рождения        | ################################################## |
        ]
        (
        _ФИО(0),_ФИО(1),
        persn.Born:f,
        _МестоРождения(0)
        );
        
      //        debugbreak;
        WordDoc.Bookmarks("FullName").Range.Text     =          strsubst(_ФИО(0), ",", "")+"\n"+strsubst(_ФИО(1), ",", "");     
        WordDoc.Bookmarks("DATEROGD").Range.Text     =          persn.Born + "\n" + _МестоРождения(0);

        var sql_code = "SELECT t.t_code" + 
                    "\n FROM dobjcode_dbt t" + 
                    "\n WHERE t_objecttype = 3 AND t_codekind = 1 AND t_objectid = " + client_.partyid;
                
       var rs_code = trsbdataset(sql_code);
        rs_code.movenext();
        WordDoc.Bookmarks("CODE").Range.Text               =          rs_code.t_code;   
        WordDoc.Bookmarks("CURATOR").Range.Text      =          _AccountOper(0);
        WordDoc.Bookmarks("SOTR").Range.Text               =            _AccountControlOper(0) +"\n"+ _AccountControlOper(1);
       WordDoc.Bookmarks("MANAGER").Range.Text      =           readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Менеджер );

        ДопечататьПримечания(_МестоРождения, 1, 1);
        
        [|-----------------------+----------------------------------------------------|
        | Гражданство  (поддан- | ########################                           |
        | ство)                 |                                                    |
        |-----------------------+----------------------------------------------------|
        | Статус                | ########################                           |
        |-----------------------+----------------------------------------------------|
        | Место жительства (ре- | ################################################## |
        | гистрации)            | ################################################## |
        ]
        (
        Гражданство(client_.nrcountry), Резидентность(client_.NotResident),
        Address(0), Address(1) /* юридический адрес */
        );
        WordDoc.Bookmarks("FACTADDR").Range.Text    =          AddressF(0)+"\n"+AddressF(1); 
        
        //WordDoc.Bookmarks("POSTADDR").Range.Text     =           AddressP(0) + "\n" + AddressP(1);
        WordDoc.Bookmarks("GRAGDAN").Range.Text     =           Гражданство(client_.nrcountry);
        
        ДопечататьПримечания(Address, 2, 9);
        [|-----------------------+----------------------------------------------------|
        | Место пребывания      | ################################################## |
        |                       | ################################################## |
        ]
        (
        AddressF(0), AddressF(1) /* Фактический адрес */
        );
        /* EVG 9/05/2011 Автор - дятел.*/
        if (fgBank.is_EXV)
            WordDoc.Bookmarks("URADRES").Range.Text     =            AddressF(0)+"\n"+AddressF(1);
         elif(fgBank.is_VUZ)
            //Gurin S. 05.05.2015 I-00565047-2
            //WordDoc.Bookmarks("URADRES").Range.Text     =            AddressF(0)+"\n"+AddressF(1);              
            //WordDoc.Bookmarks("REGADDR").Range.Text     =            AddressF(0)+"\n"+AddressF(1);
            WordDoc.Bookmarks("URADRES").Range.Text     =            AddressP(0)+"\n"+AddressP(1);              
            WordDoc.Bookmarks("REGADDR").Range.Text     =            Address(0)+"\n"+Address(1);
        else
            WordDoc.Bookmarks("REGADDR").Range.Text     =            AddressF(0)+"\n"+AddressF(1);
        end;

        ДопечататьПримечания(AddressF, 2, 9);
        
        /* Grant */
        [|-----------------------+----------------------------------------------------|
        | Почтовый адрес        | ################################################## |
        |                       | ################################################## |
        ]
        (
        AddressP(0), AddressP(1) /* Почтовый адрес */
        );

        /* EVG 9/05/2011 Автор - дятел.*/
        //WordDoc.Bookmarks("REGADDR").Range.Text    =             Address(0) + "\n" +Address(1);
        if (fgBank.is_EXV)
            WordDoc.Bookmarks("POSTADDR").Range.Text    =             Address(0) + "\n" +Address(1);
        end;
        
        ДопечататьПримечания(AddressP, 2, 9);
        /* End */
        
        
        
        [|-----------------------+----------------------------------------------------|
        | Сведения о лице,  от- | ################################################## |
        | крывающем  счет   для | ################################################## |
        | физического      лица | ################################################## |
        | (вносящем   вклад   в | ################################################## |
        | пользу    физического | ################################################## |
        | лица)  (в  случае от- | ################################################## |
        | крытия счета  (внесе- | ################################################## |
        | ния вклада)  не самим | ################################################## |
        | физическим     лицом) | ################################################## |
        | (заполняется с учетом | ################################################## |
        | подпунктов   2.2.3  и |                                                    |
        | 2.2.4 настоящих Реко- |                                                    |
        | мендаций)             |                                                    |
        ]
        ( 
        _СведЛицоОткрывающееСчет(0),
        _СведЛицоОткрывающееСчет(1),
        _СведЛицоОткрывающееСчет(2),
        _СведЛицоОткрывающееСчет(3),
        _СведЛицоОткрывающееСчет(4),
        _СведЛицоОткрывающееСчет(5),
        _СведЛицоОткрывающееСчет(6),
        _СведЛицоОткрывающееСчет(7),
        _СведЛицоОткрывающееСчет(8),
        _СведЛицоОткрывающееСчет(9)
        );
        
        [|-----------------------+----------------------------------------------------|
        | Сведения о документе, | ################################################## |
        | удостоверяющем   лич- | ################################################## |
        | ность  (наименование, | ################################################## |
        | серия и номер, орган, | ################################################## |
        | выдавший    документ, | ################################################## |
        | дата   выдачи   доку- | ################################################## |
        | мента)                | ################################################## |
        ]
        (
        PAPER_KIND(0), PAPER_KIND(1), PAPER_KIND(2), /* удостоверение */
        PAPER_KIND(3), PAPER_KIND(4), PAPER_KIND(5), PAPER_KIND(6)
        );


//        debugbreak;
        var sql_docum = "select T.T_PAPERISSUERCODE code from dpersnidc_dbt t where T.T_PERSONID = " + client_.partyid;
        var rsb_docum = trsbdataset(sql_docum);
        rsb_docum.movenext();
        
        var ci = 0;
        var doc_PAPER_KIND = "";
        WHILE (ci <= 6)  
        if (PAPER_KIND(ci) != "")
                        doc_PAPER_KIND = doc_PAPER_KIND + PAPER_KIND(ci);
                end;
                ci = ci + 1;
        END;
        doc_PAPER_KIND = doc_PAPER_KIND + "\n Код подразделения:"+rsb_docum.code;
        
        if(rsb_docum.code)
           WordDoc.Bookmarks("DOCUM").Range.Text     =             doc_PAPER_KIND;//PAPER_KIND(0)+"\n"+PAPER_KIND(1)+"\n"+PAPER_KIND(2)+"\n"+PAPER_KIND(3)+"\n"+PAPER_KIND(4)+"\n"+
        else
        WordDoc.Bookmarks("DOCUM").Range.Text = " ";                                                                //PAPER_KIND(5)+"\n"+PAPER_KIND(6) + "\n Код подразделения:"+rsb_docum.code;
        end;
        
        ДопечататьПримечания(PAPER_KIND, 7, 9);
        
        [|-----------------------+----------------------------------------------------|
        | Сведения  о  въездной | ################################################## |
        | визе (для лиц, не яв- | ################################################## |
        | ляющихся   гражданами | ################################################## |
        | Российской Федерации, | ################################################## |
        | если    международным | ################################################## |
        | договором  Российской | ################################################## |
        | Федерации  не  преду- | ################################################## |
        | смотрен    безвизовый | ################################################## |
        | въезд  на  территорию | ################################################## |
        | Российской Федерации) | ################################################## |
        | (в том числе срок, на | ################################################## |
        | который выдана виза)  | ################################################## |
        ]
        (
        VISA(0), VISA(1), VISA(2), VISA(3), VISA(4), VISA(5),
        VISA(6), VISA(7), VISA(8), VISA(9), VISA(10), VISA(11)
        );
        
        ДопечататьПримечания(VISA, 12, 13);
        
        /* Grant */
        
        if(not (persn.ISEMPLOYER == "X"))
        
        migr_card = "";
        nr_reg_doc = "";
        
        if(client_.NotResident == "X")
        /* Миграционная карта ФЛ - НР */
        if(pers_migr.DocumentID != 0)
        migr_card = "N " + pers_migr.number + " на срок с " + pers_migr.StartDate + " по " + pers_migr.FinishDate; 
        end;
        
        /* Разрешение на пребывание на терр.РФ */
        if(pers_nr_doc.DocumentID != 0)
        nr_reg_doc = "Разрешение на временное проживание на территории РФ ";
        if((VALTYPE(pers_nr_doc.series) != v_undef) and (strlen(pers_nr_doc.series) != 0))
                nr_reg_doc = nr_reg_doc + "серия " + pers_nr_doc.series + " ";
        end;
        nr_reg_doc = nr_reg_doc + "N " + pers_nr_doc.number + " на срок с " + pers_nr_doc.StartDate + " по " + pers_nr_doc.FinishDate; 
        end;
        
        end;
        
        StrSplit(migr_card, MG_CARD, 50, 50, 10);
        StrSplit(nr_reg_doc, NR_DOC, 50, 50, 10);
        
        [|-----------------------+----------------------------------------------------|
        | Данные миграционной   | ################################################## |
        | карты                 | ################################################## |]
        (MG_CARD(0), MG_CARD(1));

        
        [|-----------------------+----------------------------------------------------|
        | Наименование и данные | ################################################## |
        | документа, удостоверя-| ################################################## |
        | ющего право иностран- | ################################################## |
        | ного гражданина или   | ################################################## |
        | лица без гражданства  | ################################################## |
        | на пребывание на тер- | ################################################## |
        | ритории РФ            | ################################################## |]
        (NR_DOC(0), NR_DOC(1), NR_DOC(2), NR_DOC(3), NR_DOC(4), NR_DOC(5), NR_DOC(6));
        
        WordDoc.Bookmarks("MIGRATE").Range.Text     =           MG_CARD(0)+"\n"+MG_CARD(1);     
        WordDoc.Bookmarks("INGRAD").Range.Text     =            NR_DOC(0)+"\n"+NR_DOC(1)+"\n"+NR_DOC(2)+"\n"+NR_DOC(3)+"\n"+NR_DOC(4)+"\n"+NR_DOC(5)+"\n"+NR_DOC(6);    
       else     
                WordDoc.Bookmarks("MIGRATE").Range.Text     =           "Отсутствуют";  
                WordDoc.Bookmarks("INGRAD").Range.Text     =            "Отсутствуют";  
        end;
        /* End */
        
        if( persn.ISEMPLOYER == "X")
        [|-----------------------+----------------------------------------------------|
        | Сведения о свидетель- | ################################################## |
        | стве о  регистрации в | ################################################## |
        | качестве индивидуаль- | ################################################## |
        | ного  предпринимателя | ################################################## |
        | (для    индивидульных | ################################################## |
        | предпринимателей)(но- | ################################################## |
        | мер    свидетельства, | ################################################## |
        | дата  и место выдачи, | ################################################## |
        | орган,  выдавший сви- | ################################################## |
        | детельство, срок,  на | ################################################## |
        | который выдано свиде- | ################################################## |
        | тельство)             | ################################################## |
        ]
        (
        REG_PALACE(0), REG_PALACE(1), REG_PALACE(2), REG_PALACE(3), REG_PALACE(4), REG_PALACE(5),
        REG_PALACE(6), REG_PALACE(7), REG_PALACE(8), REG_PALACE(9), REG_PALACE(10), REG_PALACE(11)
        );

        
                

        ДопечататьПримечания(REG_PALACE, 12, 12);
        
        ПолучитьВидыДеятельности(client_);
        StrSplit( Виды_Деятельности, _ВидыДеятельности, 50, 50, 35 );
        
        [|-----------------------+----------------------------------------------------|
        | Вид  предприниматель- | ################################################## |
        | ской     деятельности | ################################################## |
        | (для   индивидуальных | ################################################## |
        | предпринимателей)  (в | ################################################## |
        | том числе  производи- | ################################################## |
        | мые товары, выполняе- | ################################################## |
        | мые работы, оказывае- | ################################################## |
        | мые услуги)           | ################################################## |
        ]
        (
        _ВидыДеятельности(0), _ВидыДеятельности(1), _ВидыДеятельности(2),
        _ВидыДеятельности(3), _ВидыДеятельности(4), _ВидыДеятельности(5),
        _ВидыДеятельности(6), _ВидыДеятельности(7)
        );
        

        
        ДопечататьПримечания(_ВидыДеятельности, 8, 34);
        
        /* Grant */
        
        [|-----------------------+----------------------------------------------------|
        | Сведения  о   наличии | ################################################## |
        | лицензий (разрешений) | ################################################## |
        | на осуществление  оп- | ################################################## |
        | ределенного вида дея- | ################################################## |
        | тельности или  опера- | ################################################## |
        | ций  (номер  лицензии | ################################################## |
        | (разрешения),  когда, | ################################################## |
        | кем и  на осуществле- | ################################################## |
        | ние какого  вида дея- | ################################################## |
        | тельности  (операции) | ################################################## |
        | выдана)               | ################################################## |
        ]
        (
        _Лицензии(0), _Лицензии(1), _Лицензии(2), _Лицензии(3), _Лицензии(4),_Лицензии(5),
        _Лицензии(6),_Лицензии(7),_Лицензии(8),_Лицензии(9),_Лицензии(10)
        );


        
        ДопечататьПримечания(_Лицензии, 11, 34);
        
        /* End */
        
        end;
        
        WordDoc.Bookmarks("GOSREG").Range.Text     =            REG_PALACE(0)+"\n"+REG_PALACE(1)+"\n"+REG_PALACE(2)+"\n"+REG_PALACE(3)+"\n"+REG_PALACE(4)+"\n"+REG_PALACE(5)+"\n"+
                                                                        REG_PALACE(6)+"\n"+REG_PALACE(7)+"\n"+REG_PALACE(8)+"\n"+REG_PALACE(9)+"\n"+REG_PALACE(10)+"\n"+REG_PALACE(11);

        WordDoc.Bookmarks("DTLNST").Range.Text     =                    _ВидыДеятельности(0)+"\n"+_ВидыДеятельности(1)+"\n"+_ВидыДеятельности(2)+"\n"+
                                                                        _ВидыДеятельности(3)+"\n"+_ВидыДеятельности(4)+"\n"+_ВидыДеятельности(5)+"\n"+
                                                                        _ВидыДеятельности(6)+"\n"+_ВидыДеятельности(7);
        if (_Лицензии(0) != "") 
               WordDoc.Bookmarks("LIC").Range.Text     =                        _Лицензии(0)+"\n"+_Лицензии(1)+"\n"+_Лицензии(2)+"\n"+_Лицензии(3)+"\n"+_Лицензии(4)+"\n"+_Лицензии(5)+"\n"+
                                                                                _Лицензии(6)+"\n"+_Лицензии(7)+"\n"+_Лицензии(8)+"\n"+_Лицензии(9)+"\n"+_Лицензии(10);
        else
                WordDoc.Bookmarks("LIC").Range.Text     =                      "Отсутствуют";   
        end;
        



        [|-----------------------+----------------------------------------------------|
        | Место  работы и зани- | ################################################## |
        | маемая должность      | ################################################## |
        |-----------------------+----------------------------------------------------|
        | Идентификационный но- | ###################################                |
        | мер налогоплательщика |                                                    |
        | (при его наличии)     |                                                    |
        |-----------------------+----------------------------------------------------|
        | Номера контактных те- | ################################################## |
        | лефонов и факсов      | ################################################## |
        ]
        (
        _МестоРаботы_И_Должность(0), _МестоРаботы_И_Должность(1),
        ПолучитьИНН( client_.PartyID ),    /* ИНН */
        Phone(0), Phone(1)                /* телефоны и факсы */
        );
//debugbreak;        
        WordDoc.Bookmarks("INN").Range.Text     =               ПолучитьИНН( client_.PartyID );
        WordDoc.Bookmarks("PHONES").Range.Text     =    Phone(0)+"\n"+Phone(1)+"\n"+Phone(2)+"\n"+Phone(3);
        
        ДопечататьПримечания(Phone, 2, 3);
        
        [|-----------------------+----------------------------------------------------|
        | Адрес электронной по- | ################################################## |
        | чты                   | ################################################## |
        |-----------------------+----------------------------------------------------|
        | Дата открытия первого | ##########                                         |
        | счета                 |                                                    |
        ]
        (
        _E_MailКлиента(0), _E_MailКлиента(1), /* адрес электронной почты */
        //УровеньРиска,
        PrintDate(Account_Open_Date) /* Дата открытия первого счета */
        );
        WordDoc.Bookmarks("OPENFIRSTAC").Range.Text     =  PrintDate(Account_Open_Date);
        
        [|-----------------------+----------------------------------------------------|
        | Сотрудник,  открывший | ################################################## |
        | счет                  | ################################################## |
        ]
        (
        _AccountOper(0), _AccountOper(1)
        );
        
        ДопечататьПримечания( _AccountOper, 2 );
        
        [|-----------------------+----------------------------------------------------|
        | Сотрудник,  утвердив- | ################################################## |
        | ший открытие счета    | ################################################## |
        ]
        (
        _AccountControlOper(0), _AccountControlOper(1)
        );
//              msgbox(_AccountControlOper(0));
//              debugbreak;
        
        if ( client_.Locked == "X" )
        [|-----------------------+----------------------------------------------------|
        | Дата закрытия         | ##########                                         |
        | субъекта экономики    |                                                    |
        ]
        (ПолучитьДатуЗакрытия(client_.PartyID):f);
        
        end;
        
        ДопечататьПримечания( _AccountControlOper, 2 );
        
        [|-----------------------+----------------------------------------------------|
        | Дата заполнения Анке- | ##########                                         |
        | ты                    |                                                    |
        |-----------------------+----------------------------------------------------|
        | Дата обновления Анке- | ##########                                         |
        | ты                    |                                                    |
        |-----------------------+----------------------------------------------------|
        | Срок хранения  Анкеты | ##########                                         |
        |                       |                                                    |]
        (
        FormDateFill :f,
        FormDateModif:f,
        FormDateStore:f
        );

//       debugbreak;
        WordDoc.Bookmarks("DATEZAP").Range.Text     =           FormDateFill;
        WordDoc.Bookmarks("DATEMODIF").Range.Text     =         FormDateModif;

        
        ИДПЛ(1) = "Нет";
        ИДПЛ(2) = "Нет";
        ИДПЛ(3) = "Нет";
        
        ipdl = КодКатегории(3, client_.PartyID, 34);
        
        if (ipdl != 0)
        ИДПЛ(ipdl) = "Да";
        end;
        
        gos = "";
        
        if( (ИДПЛ(1) == "Да") or (ИДПЛ(2) == "Да") or (ИДПЛ(3) == "Да") )
        gos = Гражданство(client_.nrcountry);
        if((ИДПЛ(1) == "Да"))
        zap = 1; /* Заполнять парамерты ИПДЛ - 1 "Да", по умолчанию - 0 "Нет" */
        end;
        end;
        
        StrSplit (gos, CNT, 50, 50, 10);
        
        if  ((ИДПЛ(2) == "Да"))
        StrSplit( readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), ИПДЛ_Родственник ),
                OV_PRS, 50, 50, 10 );
        elif (ИДПЛ(3) == "Да")
        StrSplit( readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), ИПДЛ_Заинтересованное),
                OV_PRS, 50, 50, 10 );
        else
        OV_PRS(0) = OV_PRS(1) = OV_PRS(2) = OV_PRS(3) = OV_PRS(4) = OV_PRS(5) = "";
        end;
        
        if(zap == 0) /* Признак того, что параметры для ИПДЛ не заполняются, даже если заданы */
        ORG(0) = ORG(1) = ORG(2) = DOLG(0) = DOLG(1) = DOLG(2) = "";
        end;
        
        [|-----------------------+----------------------------------------------------|
        | Отношение к иностранным публичным должностным лицам (ИПДЛ)                 |
        +----------------------------------------------------------------------------+
        | Является ИПДЛ         | ################################################## |
        +-----------------------+----------------------------------------------------+
        | Родственник ИПДЛ      | ################################################## |
        +-----------------------+----------------------------------------------------+
        | Представитель ИПДЛ    | ################################################## |
        +-----------------------+----------------------------------------------------+
        | Название государства  | ################################################## |
        | ИДПЛ                  | ################################################## |
        +-----------------------+----------------------------------------------------+
        | Наименование ведомст- | ################################################## |
        | ва, органа или пред-  | ################################################## |
        | приятия ИПДЛ          | ################################################## |
        +-----------------------+----------------------------------------------------+
        | Занимаемая должность  | ################################################## |
        | или фыполняемая функ- | ################################################## |
        | ция ИПДЛ              | ################################################## |
        +-----------------------+----------------------------------------------------+
        | ФИО ИПДЛ, супругом(су-| ################################################## |
        | пругой) или близким   | ################################################## |
        | родственником которого| ################################################## |
        | является клиент или от| ################################################## |
        | имени которого дейст- | ################################################## |
        | вует                  | ################################################## |]
        
        (
        ИДПЛ(1), ИДПЛ(2), ИДПЛ(3),
        CNT(0),CNT(1),
        ORG(0),ORG(1),ORG(2),
        DOLG(0),DOLG(1),DOLG(2),
        OV_PRS(0),OV_PRS(1),OV_PRS(2),OV_PRS(3),OV_PRS(4),OV_PRS(5) 
        );
        [+----------------------------------------------------------------------------+
        
        ];
        
        var RetParm = TArray;
       //debugbreak;
       RetParm = ПечатьОценкиРиска( "" );
//       WordDoc.Bookmarks("RISK").Range.Text = RetParm(0);
//        WordDoc.Bookmarks("LEVRISK").Range.Text = RetParm(1);   

        if( persn.ISEMPLOYER != "X")
        ПечатьДоверенногоЛица(client_.PartyID);
        end;
        
        
        //ПечатьОпераций( "2.2. Часть 2 (в виде таблицы)", client_.PartyID );
        
        //ПечатьХарактеристикиОпераций( "2.3. Часть 3 (текстовая)" );
        
        //  ПечатьДоверенногоЛица(persn.PersonID);
//        debugbreak;
//        ПечатьОценкиРиска( "2.2. Часть 2 (текстовая)" );
        
        if(persn.ISEMPLOYER == "X")
        ПечатьВыгодоприобретателей("Cведения о выгодоприобретателях");
        end;
        
        if( partyKind == 43 )
        ХарактеристикаОпераций( client_.PartyID );
        end;
        
        ПечатьПодписи( "Сотрудник, открывший счет" );
        end;
        WordApp.Visible = True;

  end;  
end;


macro АнкетаКредитнойОрганизации( party, partyKind )  // Формируем анкету кредитной организации


  record RecordAdress ( adress );

  var Лицензия = "";

  SetBuff( client_, party );

  /* Организационно-правовая форма */
  ОПФ_Имя = ЗначениеКатегории( OBJTYPE_PARTY, client_, ОПФ_Категория );

  /* Уровень риска */
  //УровеньРиска = ЗначениеКатегории( OBJTYPE_PARTY, client_, Риск_Категория );

  var Number: string = "";
  Регистрация( client_, РП_Регистрация, Number );

  StrSplit( ТелефоныФаксы(client_), Phone,    50, 50, 4 );  /* телефоны и факсы */
  StrSplit(readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Прим_ОрганыУправления ),_ОрганыУправления,50, 50, 35);
  
  /* Первый счет */
  ПервыйСчет( client_, @Account_Open_Date );

  /* Прочитать примечания */
  ПрочитатьПримечания();

  ПолучитьДатыАнкеты();

  СформироватьЮридическийАдрес( client_ );
  СформироватьФактическийАдрес( client_ );
  СформироватьПочтовыйАдрес( client_ );

  Получить_ИмяКлиента( client_.Name );
  Получить_МестоГосударственнойРегистрации();
  
  StrSplit(readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), КодыФормГосСтатНабл ),_КодыФормГосСтатНабл,50, 50, 35);

  ClearRecord(RecordAdress);
  НайтиАдресСубъекта(client_.PartyID,PTADDR_REAL,RecordAdress);
  Получить_E_MailКлиента(RecordAdress.E_Mail);

  _НаименованиеШапка(0)  = "Фирменное     (полное";
  _НаименованиеШапка(1)  = "официальное)   и   (в";
  _НаименованиеШапка(2)  = "случае, если имеется)";
  _НаименованиеШапка(3)  = "сокращенное  наимено-";
  _НаименованиеШапка(4)  = "вание  и наименование";
  _НаименованиеШапка(5)  = "на иностранном языке";

  var i = 6;

  while (i<13)
    _НаименованиеШапка(i)  = "";
    i = i + 1;
  end;

  if( partyKind == 43 )
[               АНКЕТА ВЫГОДОПРИОБРЕТАТЕЛЯ - КРЕДИТНОЙ ОРГАНИЗАЦИИ
]
  else
[                   АНКЕТА КЛИЕНТА - КРЕДИТНОЙ ОРГАНИЗАЦИИ
]
  end;
  if( client_.Locked == "X" )
[                            СУБЪЕКТ ЭКОНОМИКИ ЗАКРЫТ
];
  end;
[
3.1. Часть 1 (в виде таблицы)

+----------------------------------------------------------------------------+
];

FullDotFileName = createdoc("ak_ulko.dot");
  if( WordApp )
    
       WordDoc = WordApp.Documents.Add( FullDotFileName );
        if( WordDoc )
              /*if ((fgBank.is_GEB) or (fgBank.is_EXV))
                Напечатать_ИмяКлиента( _НаименованиеШапка, client_.ShortName );
              else*/
                Напечатать_ИмяКлиента( _НаименованиеШапка, client_ );
              //end;
              VName = client_.Name;
              if (/*(client_.ShortName != client_.Name) and */(client_.ShortName != strfor(0)))
                 VName = Vname + ", " + client_.ShortName;
              end;
              if (client_.LatName != strfor(0)) 
                 VName = Vname + ", " + client_.LatName;
              end;
              WordDoc.Bookmarks("FullName").Range.Text     = VName;
              WordDoc.Bookmarks("OPF").Range.Text     = ОПФ_Имя;
             /*FIV Собираю данные регистрации*/
             var regorg;
             if (date(РП_Регистрация.DocDate) != date(0,0,0))
                 regorg = string(РП_Регистрация.DocDate:f);
             end;
             if (StrLen(string(Number)) > 1)
                 regorg = regorg + ", " + string(Number)+ ", " +_НаименованиеРегОргана(0)+_НаименованиеРегОргана(1);
             end;
             if (StrLen(string(РП_Регистрация.RegPlace)) > 1)
                 regorg = regorg + ", " + string(РП_Регистрация.RegPlace);
             end;
             WordDoc.Bookmarks("REGORG").Range.Text     = regorg;
             WordDoc.Bookmarks("FGSN").Range.Text = ПечатьКодыФГСН( client_ );
             WordDoc.Bookmarks("REGCAPITAL").Range.Text     = CAPITAL(0);
             WordDoc.Bookmarks("OPLCAPITAL").Range.Text     = CAPITAL(1);
              WordDoc.Bookmarks("PLACE").Range.Text     = readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Прим_ОрганыУправления );


                [|-----------------------+----------------------------------------------------|
                | Организационно-право- | #############################                      |
                | вая форма             |                                                    |
                |-----------------------+----------------------------------------------------|
                | Регистрационный номер | ###################################                |
                |-----------------------+----------------------------------------------------|
                | Дата  государственной | ##########                                         |
                | регистрации           |                                                    |
                |-----------------------+----------------------------------------------------|
                | Место государственной | ################################################## |
                | регистрации           | ################################################## |
                |-----------------------+----------------------------------------------------|
                ]
                (
                ОПФ_Имя,                        /* организационно-правовая форма */
                Number,                         /* регистрационный номер */
                РП_Регистрация.DocDate:f,       /* дата государственной регистрации */
                _МестоГосударственнойРегистрации(0), /* место государственной регистрации */
                _МестоГосударственнойРегистрации(1)
                );

                WordDoc.Bookmarks("REGNOM").Range.Text     = Number;

                ДопечататьПримечания(_МестоГосударственнойРегистрации, 2, 9);
                
                ПечатьЛицензий( client_.PartyID );
                [| Юридический адрес     | ################################################## |
                ]
                (
                Address(0)                          /* Юридический адрес */
                );
//                debugbreak;
                WordDoc.Bookmarks("UADRES").Range.Text     = AddressF(0);
                
                ДопечататьПримечания(Address, 1, 9);
                
                [|-----------------------+----------------------------------------------------|
                | Органы     управления | ################################################## |
                | находятся  по  юриди- | ################################################## |
                | ческому адресу        | ################################################## |
                ]
                (
                _ОрганыУправления(0),_ОрганыУправления(1),_ОрганыУправления(2)
                );
                
                ДопечататьПримечания(_ОрганыУправления, 3, 34);
                
                [|-----------------------+----------------------------------------------------|
                | Адрес местонахождения | ################################################## |
                ]
                (
                AddressF(0)                     /* фактический адрес */
                );

                WordDoc.Bookmarks("FACTADR").Range.Text     = AddressF(0);

                
                ДопечататьПримечания(AddressF, 1, 9);
                
                [|-----------------------+----------------------------------------------------|
                | Почтовый адрес        | ################################################## |
                ]
                (
                AddressP(0)                     /* почтовый адрес */
                );

                if ((fgBank.is_GEB) )
                    WordDoc.Bookmarks("POSTADDR").Range.Text     = AddressP(0);
                else
                    WordDoc.Bookmarks("POSTADR").Range.Text     = AddressP(0);
                end;
                
                ДопечататьПримечания(AddressP, 1, 9);
                
                [|-----------------------+----------------------------------------------------|
                | Номера контактных те- | ################################################## |
                | лефонов и факсов      | ################################################## |
                ]
                (
                Phone(0), Phone(1)     /* телефоны и факсы */
                );

                WordDoc.Bookmarks("PHONES").Range.Text     = Phone(0)+ "\n" +Phone(1)+ "\n" +Phone(2)+ "\n" +Phone(3);          
                
                ДопечататьПримечания(Phone, 2, 3);
                
                [|-----------------------+----------------------------------------------------|
                | Адрес электронной по- | ################################################## |
                | чты                   | ################################################## |
                |-----------------------+----------------------------------------------------|
                | Банковский идентифи-  | ###################################                |
                | кационный код         |                                                    |
                |-----------------------+----------------------------------------------------|
                | Идентификационный но- | ###################################                |
                | мер налогоплательщика |                                                    |
                ]
                (
                _E_MailКлиента(0),_E_MailКлиента(1),
                ПолучитьКод( client_.PartyID, PTCK_BIC ), /* БИК */
                ПолучитьИНН( client_.PartyID )           /* ИНН */
                );
                
                WordDoc.Bookmarks("EMAIL").Range.Text     = _E_MailКлиента(0)+ "\n" +_E_MailКлиента(1);
                WordDoc.Bookmarks("BIC").Range.Text     = ПолучитьКод( client_.PartyID, PTCK_BIC );
//debugbreak;
                WordDoc.Bookmarks("INN").Range.Text     = ПолучитьИНН( client_.PartyID );
                
                //|-----------------------+----------------------------------------------------|
                //| Уровень риска         | #############################                      |
                [|-----------------------+----------------------------------------------------|
                | Дата открытия первого | ##########                                         |
                | счета                 |                                                    |
                ]
                (
                //УровеньРиска,
                PrintDate(Account_Open_Date) /* Дата открытия первого счета */
                );

                WordDoc.Bookmarks("OPENFIRSTAC").Range.Text =   PrintDate(Account_Open_Date);
                
                [|-----------------------+----------------------------------------------------|
                | Куратор счета         | ################################################## |
                ]
                (
                _AccountOper(0)
                );

                WordDoc.Bookmarks("CURATOR").Range.Text =       _AccountOper(0);
                
                ДопечататьПримечания( _AccountOper, 1 );
                
                [|-----------------------+----------------------------------------------------|
                | Резервный     куратор |                                                    |
                | счета  (если  сущест- |                                                    |
                | вует)                 |                                                    |
                |-----------------------+----------------------------------------------------|
                | Сотрудник,  утвердив- | ################################################## |
                | ший открытие счета    | ################################################## |
                ]
                (
                _AccountControlOper(0), _AccountControlOper(1)
                );

                WordDoc.Bookmarks("SOTR").Range.Text =          _AccountControlOper(0)+ "\n" +_AccountControlOper(1);
                
                if( client_.Locked == "X" )
                [|-----------------------+----------------------------------------------------|
                | Дата закрытия         | ##########                                         |
                | субъекта экономики    |                                                    |
                ]
                (ПолучитьДатуЗакрытия(client_.PartyID):f)
                ;
                end;
                
                ДопечататьПримечания( _AccountControlOper, 2 );
                
                [|-----------------------+----------------------------------------------------|
                | Дата заполнения Анке- | ##########                                         |
                | ты                    |                                                    |
                |-----------------------+----------------------------------------------------|
                | Дата обновления Анке- | ##########                                         |
                | ты                    |                                                    |
                |-----------------------+----------------------------------------------------|
                | Срок хранения  Анкеты | Постоянное                                         |
                |                       |                                                    |
                +----------------------------------------------------------------------------+
                
                ]
                (
                FormDateFill :f,
                FormDateModif:f
                );

                WordDoc.Bookmarks("DATEZAP").Range.Text = FormDateFill;

                [3.2. Часть 2 (текстовая)
                
                +----------------------------------------------------------------------------+
                | Сведения об учредите- | ################################################## |
                | лях,  лицах,  которые | ################################################## |
                | имеют  право   давать | ################################################## |
                | обязательные для кли- | ################################################## |
                | ента  указания   либо | ################################################## |
                | иным   образом  имеют | ################################################## |
                | возможность   опреде- | ################################################## |
                | лять его действия,  в | ################################################## |
                | том числе сведения об | ################################################## |
                | основном обществе или | ################################################## |
                | преобладающем, участ- | ################################################## |
                | вующем  обществе (для | ################################################## |
                | дочерних или  зависи- | ################################################## |
                | мых обществ), холдин- | ################################################## |
                | говой  или финансово- | ################################################## |
                | промышленной   группе | ################################################## |
                | (если  клиент  в  ней | ################################################## |
                | участвует)  (заполня- | ################################################## |
                | ется  с  учетом  под- | ################################################## |
                | пунктов 2.2.3 и 2.2.4 | ################################################## |
                | настоящих  Рекоменда- | ################################################## |
                | ций)                  | ################################################## |
                ]
                (
                _Учредители(0), _Учредители(1), _Учредители(2), _Учредители(3), _Учредители(4), _Учредители(5),
                _Учредители(6), _Учредители(7), _Учредители(8), _Учредители(9), _Учредители(10), _Учредители(11),
                _Учредители(12),_Учредители(13),_Учредители(14),_Учредители(15),_Учредители(16),
                _Учредители(17),_Учредители(18),_Учредители(19),_Учредители(20),_Учредители(21)
                );
                
                WordDoc.Bookmarks("UTCHR").Range.Text =                 _Учредители(0) + "\n" + _Учредители(1) + "\n" + _Учредители(2) + "\n" + _Учредители(3) + "\n" + _Учредители(4) + 
                                                                        "\n" + _Учредители(5) + "\n" + _Учредители(6) + "\n" + _Учредители(7) + "\n" + _Учредители(8) + "\n" + 
                                                                        _Учредители(9) + "\n" + _Учредители(10) + "\n" + _Учредители(11) + "\n" + _Учредители(12) + "\n" + 
                                                                        _Учредители(13) + "\n" + _Учредители(14) + "\n" + _Учредители(15) + "\n" + _Учредители(16) + "\n" +
                                                                        _Учредители(17) + "\n" + _Учредители(18) + "\n" + _Учредители(19) + "\n" + _Учредители(20) + "\n" + _Учредители(21);
                
                ДопечататьПримечания(_Учредители, 22, 34);
                
                [|-----------------------+----------------------------------------------------|
                | Сведения  об  органах | ################################################## |
                | субъекта   (структура | ################################################## |
                | органов    управления | ################################################## |
                | юридического  лица  и | ################################################## |
                | сведения о физических | ################################################## |
                | лицах, входящих в со- | ################################################## |
                | став   исполнительных | ################################################## |
                | органов  юридического | ################################################## |
                | лица,  с  учетом под- | ################################################## |
                | пунктов 2.2.3 и 2.2.4 | ################################################## |
                | настоящих  Рекоменда- | ################################################## |
                | ций)                  | ################################################## |
                ]
                (
                _Органы(0), _Органы(1), _Органы(2), _Органы(3), _Органы(4), _Органы(5),
                _Органы(6), _Органы(7), _Органы(8), _Органы(9), _Органы(10), _Органы(11)
                );

                var sql_sotr = "SELECT offi.t_post || ' ' ||pers.t_name1 || ' ' || pers.t_name2 || ' ' || pers.t_name3 fname" +
                         "\n    FROM dpersn_dbt pers, dofficer_dbt offi" +
                         "\n    WHERE offi.t_personid = pers.t_personid AND offi.t_partyid = " + client_.PartyID;
                      //        msgbox(sql_sotr);
                        var rsb_sotr = TRsbDataSet(sql_sotr);
                        var fname = "";
                        while(rsb_sotr.movenext());
                        fname = fname + rsb_sotr.fname + "\n"; 
                end;
                
                WordDoc.Bookmarks("ORG").Range.Text =   fname;
                if (fgBank.is_VUZ)
                    WordDoc.Bookmarks("MANAGER").Range.Text  =      readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Менеджер );
                else
                    WordDoc.Bookmarks("FIOZAP").Range.Text   =      readNoteForObject(OBJTYPE_PARTY, UniID(client_, OBJTYPE_PARTY), Менеджер );
                end;


                ДопечататьПримечания(_Органы, 12, 34);
                
                [|-----------------------+----------------------------------------------------|
                | Обособленные  подраз- | ################################################## |
                | деления (если имеются | ################################################## |
                | и сведения о  них из- | ################################################## |
                | вестны кредитной  ор- | ################################################## |
                | ганизации)            | ################################################## |
                ]
                (
                _Подразделения(0), _Подразделения(1), _Подразделения(2),
                _Подразделения(3), _Подразделения(4)
                );

                WordDoc.Bookmarks("OBPODR").Range.Text =_Подразделения(0) + "\n" + _Подразделения(1) + "\n" + _Подразделения(2) + "\n" + _Подразделения(3) + "\n" + _Подразделения(4);


                ДопечататьПримечания(_Подразделения, 5, 34);
                
                [|-----------------------+----------------------------------------------------|
                | Сведения о корреспон- | ################################################## |
                | дентах субъекта       | ################################################## |
                ]
                (
                _ПостКонтрагенты(0), _ПостКонтрагенты(1)
                );

                WordDoc.Bookmarks("CORR").Range.Text = _ПостКонтрагенты(0) + "\n" + _ПостКонтрагенты(1);
                
                ДопечататьПримечания(_ПостКонтрагенты, 2, 34);
                
                [|-----------------------+----------------------------------------------------|
                | История,   репутация, | ################################################## |
                | сектор рынка и конку- | ################################################## |
                | ренция     (сведения, | ################################################## |
                | подтверждающие    су- | ################################################## |
                | ществование кредитной | ################################################## |
                | организации   (напри- | ################################################## |
                | мер,    ссылка     на | ################################################## |
                | Bankers     Almanac), | ################################################## |
                | сведения  о реоргани- | ################################################## |
                | зации,  изменения   в | ################################################## |
                | характере    деятель- | ################################################## |
                | ности, прошлые финан- | ################################################## |
                | совые проблемы, репу- | ################################################## |
                | тация на национальном | ################################################## |
                | и зарубежных  рынках, | ################################################## |
                | присутствие  на  рын- | ################################################## |
                | ках, основная  доля в | ################################################## |
                | конкуренции и на рын- | ################################################## |
                | ке, специализация  по | ################################################## |
                | банковским  продуктам | ################################################## |
                | и пр.)                | ################################################## |
                ]
                (
                _ИсторияРепутация(0), _ИсторияРепутация(1), _ИсторияРепутация(2), _ИсторияРепутация(3),
                _ИсторияРепутация(4), _ИсторияРепутация(5), _ИсторияРепутация(6), _ИсторияРепутация(7),
                _ИсторияРепутация(8), _ИсторияРепутация(9), _ИсторияРепутация(10), _ИсторияРепутация(11),
                _ИсторияРепутация(12), _ИсторияРепутация(13), _ИсторияРепутация(14), _ИсторияРепутация(15),
                _ИсторияРепутация(16), _ИсторияРепутация(17), _ИсторияРепутация(18), _ИсторияРепутация(19),
                _ИсторияРепутация(20)
                );
                
                ДопечататьПримечания(_ИсторияРепутация, 21, 34);
                
                [+----------------------------------------------------------------------------+
                
                ];
                
                WordDoc.Bookmarks("REPUT").Range.Text = _ИсторияРепутация(0) + "\n" + _ИсторияРепутация(1) + "\n" + _ИсторияРепутация(2) + "\n" + _ИсторияРепутация(3) + "\n" + 
                                                             _ИсторияРепутация(4) + "\n" + _ИсторияРепутация(5) + "\n" + _ИсторияРепутация(6) + "\n" + _ИсторияРепутация(7) + "\n" + 
                                                             _ИсторияРепутация(8) + "\n" + _ИсторияРепутация(9) + "\n" + _ИсторияРепутация(10) + "\n" + _ИсторияРепутация(11) + "\n" + 
                                                             _ИсторияРепутация(12) + "\n" + _ИсторияРепутация(13) + "\n" + _ИсторияРепутация(14) + "\n" + _ИсторияРепутация(15) + "\n" + 
                                                             _ИсторияРепутация(16) + "\n" + _ИсторияРепутация(17) + "\n" + _ИсторияРепутация(18) + "\n" + _ИсторияРепутация(19) + "\n" + 
                                                             _ИсторияРепутация(20);

                ПечатьОпераций( "3.3. Часть 3 (в виде таблицы)", client_.PartyID );
                
                ПечатьХарактеристикиОпераций( "3.4. Часть 4 (текстовая)" );
                //debugbreak;
                ПечатьОценкиРиска( "3.5. Часть 5 (текстовая)" );
                
                ПечатьВыгодоприобретателей("Cведения о выгодоприобретателях");
                
                if( partyKind == 43 )
                ХарактеристикаОпераций( client_.PartyID );
                end;
                
                ПечатьПодписи( "Куратор счета" );
        end;
        WordApp.Visible = True;
  end;

end;
