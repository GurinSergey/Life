/*11.04.12 Добавление каркасного плана LAO*/
/*
   "Финансовый мониторинг"
   Макрос скроллинга операций по легализации
*/
//28.06.2013 Жаворонкова Н. (joy) C-5115 - Информация о представителе (только для ВУЗа)

Import BankInter, FMInter;
import RSD;
import lib_fg; // 28.06.2013 joy C-5115


record Операция("opcontr.dbt");
record СтараяОперация("opcontr.dbt"); /* заполняется при редактировании */

/* Макрофункция инициализации новой операции */
/*
   необходимо заполнить структуру "Операция"
   возвращаемое значение
   0 - ошибок не было
   1 - была ошибка
*/
macro НоваяОперация()
  
    return 0;

end;


/* Макрофункция проверки операции при вводе, редактировании, удалении */
/*
   0 - ошибок не было
   1 - была ошибка
*/
macro ПроверитьОперацию( Режим )

    var stat;
    stat = true;

    if( Режим == FM_INSERT ) /* ввод новой операции */

    elif( Режим == FM_UPDATE ) /* редактирование операции */

    elif( Режим == FM_DELETE ) /* удаление операции */

    elif( Режим == FM_CHANGE_STATUS )  /* смена статуса */
  
    end;

    if( stat )
        return 0;
    else
        return 1;
    end;
  
end;

private macro Lpad(str, length, symbol)
    var i = strlen(string(str));

    while (i < length)
        str = symbol + str;
        i = i + 1;
    end;

    return str;
end;



/* Макрофункция вызывается по Ctrl-Z */
macro ФункцияПользователя()

    var arr = TArray;
    arr(0) = "Активировать каркасный план";
    arr(1) = "Установить DESCR";
    if (fgbank.is_VUZ)
        arr(2) = "Заполнить информацию о представителе";
    end;

    var chois_up = menu(arr, "Режим" ,"Режим", null, null, 0);
    if(chois_up == 0)
        /* Активация каркасного плана для ФМ LAO */
        var st = rsdcommand("ALTER  session SET USE_STORED_OUTLINES = FINMONITOR");
        st.execute;
        st = rsdcommand("commit");
        st.execute;
        msgbox("Каркасный план активирован");
    elif (chois_up == 1)
        var arrprim = TArray;
        arrprim(0) = "не ясен процентный характер займа";
        arrprim(1) = "не ясен процентный характер займа, не предоставляется возможным установить заимодавца";
        arrprim(2) = "не предоставляется возможным установить состав приобретаемой продукции";
        arrprim(3) = "п.1.3 ПВК";
        arrprim(4) = "п.1.8 ПВК Дробление";
        arrprim(5) = "Систематическое снятие крупных сумм денежных средств в наличной форме";
        arrprim(6) = "Систематическое перечисление крупных сумм денежных средств на счета широкого круга физических лиц";


        var chois_prim = menu(arrprim, "Режим" ,"Режим", null, null, 0);

        var stat;
        stat = AddNoteForObject(700, Lpad(string(Операция.operationid), 10, 0), 2, arrprim(chois_prim));
//	msgbox(stat);
//	msgbox(Lpad(string(Операция.operationid), 10, 0
    //28.06.2013 joy C-5115 - Информация о представителе
    elif (chois_up == 2)
        debugbreak;
        var operationFM: RsbFMOperation;
        
        operationFM = RsbFMOperation( Операция.operationid );
        var list = TArray;
        var clientType, clientTitle, AgentType;

        var query, rs, cmd;
        list (0) = "Представитель плательщика";
        list (1) = "Представитель получателя";
        
        var chois_list = menu(list, "Выберите участника операции" ,"Представитель клиента", null, null, 0);
        
        if (chois_list == -2) 
            return 0; // Обработка ESC        
        elif (chois_list == 0);
            clientType = _FM_PARTY_PAYER;
            clientTitle = "Плательщик";
            AgentType = _FM_PARTY_PAYER_REPRESENT;
        elif (chois_list == 1);
            clientType = _FM_PARTY_RECEIVER;
            clientTitle = "Получатель";
            AgentType = _FM_PARTY_RECEIVER_REPRESENT;
        end;
        
        execMacroFile ("lib_menu_common.mac", "GetClientRepresent", operationFM, clientType, clientTitle, AgentType ); 
    // end joy
    end;

end;

/* Установка подсказки для скролингов из макроса */
MACRO УстановитьПодсказку( TableName:string, IndexNum:integer, DefaultHint:string, Mode:integer, ScrolStates:integer ):string
  //  Возможные значения Mode:
  //   0, Список операций
  //   1, Список экспортированных операций
  //   2, Список импортированных операций

  //  Возможные значения ScrolStates:
  //   0, Список всех операций   
  //   1, Список операций для контроля   
  //   2, Список операций для визирования   
  //   3, Список операций для выгрузки   
  //   4, Список отложенных операций   
  //   5, Список выгруженных операций
  //   6, Список приостановленных операций  
  //   7, Не используется
  //   8, Список отвергнутых операций
      
  return "/*+ FIRST_ROWS USE_NL(t ptpayer fm_opr_scrol ptreceiverl dp_dep fininstr namealg opcontrseance oprkdoc) */"; 
  
//  return DefaultHint;
END;
    /* Активация каркасного плана для ФМ LAO */
var st = rsdcommand("ALTER  session SET USE_STORED_OUTLINES = FINMONITOR");
    st.execute;
st = rsdcommand("commit");
    st.execute;


