/*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ 

RR - Рахмедов Руслан 22.04.2012

Комиссия 12.1.1 обслуживание корпоративной пластиковой карты/карт MC BUSINESS/VISA BUSINESS, в год.

Тип комиссии: Периодическая

Имя файла com1211p.mac

Изменения:

//RR 22.01.2012 Исправлена макска счетом отбора с 40817 на 40807
//RR 18.02.2013 Выполнил рефакторинг перенес проверку в ComissLib
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/

import sfinter, ctinter, cb_sql;
import CommissLib;

/*
    Если при расчете произошла ошибка, поместить в эту переменную ненулевое значение
*/
var MacroError :integer = 0;
private var FICode_calc:string = "";

  /* Тип величины
enum SfBaseTypes{*/
private const   SF_BASETYPE_SUM     = 1;      /* Сумма*/
private const   SF_BASETYPE_QUONT   = 2;      /* Количество*/

record sfbassum( "sfbassum.str" );

macro CalcServiceSum( sfcontr_addr/*Договор обслуживания*/, BeginDate/*Начало периода*/, EndDate/*Конец периода*/,
      sAddr /* EVG Какой-то ещё адрес */, sfcontrStruc /*Cтруктура sfcontr*/ )

    record sfcontr( sfcontr );
    var stat,
        CommQuont   = 0;
        
    if ( ValType (sfcontr_addr) != V_UNDEF )
       SetBuff( sfcontr, sfcontr_addr );
    else
       Copy ( sfcontr, sfcontrStruc );
    end;

    CommQuont = ExecMacroFile ("Commisslib.mac", "CheckUserField1", 1,3,sfcontr.object);

    if ( ValType (sfcontrStruc) != V_UNDEF )
      if (CommQuont > 0)
         return true;
      end;
    return false;
    end;

    sfbassum.baseType   = SF_BASETYPE_QUONT;
    sfbassum.baseQuont  = CommQuont;

    sfbassum.baseType2  = SF_BASETYPE_QUONT;
    sfbassum.baseQuont2 = CommQuont;

    stat = InsertSumList(sfbassum);

    if( stat )
      MsgBox("Ошибка при вставке базовой суммы");
    end;
end;