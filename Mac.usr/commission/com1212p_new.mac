/*++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ 
joy - Жаворонкова Надежда 17.09.2014
Комиссия 12.1.2 
Тип комиссии: Периодическая
Имя файла com1212p.mac

Комиссия создана по заявке С-27764 

Изменения:

++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/

import sfinter, lib_fc_corporate;

record sfbassum( "sfbassum.str" );

macro CalcServiceSum( sfcontr_addr, BeginDate, EndDate, sAddr, sfcontrStruc)
    DebugBreak ();
    private const   SF_BASETYPE_SUM     = 1;      /* Сумма*/
    private const   SF_BASETYPE_QUONT   = 2;      /* Количество*/

    record sfcontr( sfcontr );
        
    /* EVG При вызове из sfacrpay.mac используем полученную структуру sfcontrStruc вместо адреса sfcontr_addr */
    if ( ValType (sfcontr_addr) != V_UNDEF )
        SetBuff( sfcontr, sfcontr_addr );
    else
        Copy ( sfcontr, sfcontrStruc );
    end;

    var CommQuont = 0;
    if (Acc_IsCardAccount (sfcontr.object))
        CommQuont = Com_FC_GetBaseQuantity (sfcontr.PartyID, EndDate, V_UNDEF, true, false);
    end;
    
    if ( ValType (sfcontrStruc) != V_UNDEF )
        return (CommQuont > 0);
    end;

    sfbassum.baseType  = sfbassum.baseType2  = SF_BASETYPE_QUONT;
    sfbassum.baseQuont = sfbassum.baseQuont2 = CommQuont;

    if (InsertSumList(sfbassum))
        msgbox ("Ошибка при вставке базовой суммы");
    end;
end;

